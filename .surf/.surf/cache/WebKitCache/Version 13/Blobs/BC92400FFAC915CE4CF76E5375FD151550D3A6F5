"use strict";"undefined"==typeof O&&(window.O={}),function(t){var e=t.meta=function(t){var e=t.__meta__;return e?e.object!==t&&((e=Object.create(e)).object=t,e.cache={},e.observers=Object.create(e.observers),e.changed=null,e.depth=0,e.bindings=Object.create(e.bindings),e.inits=Object.create(e.inits),t.__meta__=e):e=new function(t){this.object=t,this.dependents={},this.allDependents={},this.cache={},this.observers={},this.changed=null,this.depth=0,this.pathObservers={},this.bindings={},this.inits={},this.isInitialised=!1,t.__meta__=this}(t),e},i=0;t.guid=function(t){if(null===t)return"null";switch(typeof t){case"boolean":return t?"true":"false";case"number":return"num:"+t.toString(36);case"string":return"str:"+t;case"undefined":return"undefined"}return t instanceof Date?"date:"+ +t:t.__guid__||(t.__guid__="id:"+(i+=1).toString(36))};var n=t.mixin=function(t,i,n){if(i){var s,r,o,a,h=!n;for(s in i)"__meta__"===s||!h&&t.hasOwnProperty(s)||(r=t[s],o=i[s],r&&r.__teardownProperty__&&(a||(a=e(t)),r.__teardownProperty__(a,s,t)),o&&o.__setupProperty__&&(a||(a=e(t)),o.__setupProperty__(a,s,t)),t[s]=o)}return t},s=t.extend=function(t,e,i){for(var n in e)!e.hasOwnProperty(n)||i&&t.hasOwnProperty(n)||(t[n]=e[n]);return t},r=t.merge=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)&&t[i]&&e[i]&&"object"==typeof t[i]&&"object"==typeof e[i]?r(t[i],e[i]):t[i]=e[i]);return t},o=t.clone=function(t){var e,i,n=t;if(t&&"object"==typeof t)if(t instanceof Array)for(n=[],e=t.length;e--;)n[e]=o(t[e]);else if(t instanceof Date)n=new Date(t);else for(i in n={},t)n[i]=o(t[i]);return n},a=t.isEqual=function(t,e){var i,n,s,r;if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){if(!(t instanceof Array)){if(t instanceof Date)return+t==+e;if(r=t.constructor,t.constructor!==e.constructor)return!1;if(r.isEqual)return r.isEqual(t,e);for(s in t)if(!a(t[s],e[s]))return!1;for(s in e)if(!a(t[s],e[s]))return!1;return!0}if(e instanceof Array&&t.length===e.length){for(i=0,n=t.length;i<n;i+=1)if(!a(t[i],e[i]))return!1;return!0}}return!1};t.Class=function(t){var e,i,n,s=t.Extends,r=t.Mixin,o=t.init||(s?function(){s.apply(this,arguments)}:function(){});if(s&&(e=s.prototype,o.parent=e,o.prototype=Object.create(e),o.prototype.constructor=o,delete t.Extends),r){for(r instanceof Array||(r=[r]),i=0,n=r.length;i<n;i+=1)o.implement(r[i],!0);delete t.Mixin}return o.implement(t,!0),o};var h=/^\d+$/;t.sortByProperties=function(e){e instanceof Array||(e=[e]);var i=e.length;return function(n,s){var r,o,a,c,l,u=!!n.get;for(r=0;r<i;r+=1)if(o=e[r],(l=typeof(a=u?n.get(o):n[o]))===typeof(c=u?s.get(o):s[o])){if("boolean"===l&&a!==c)return a?-1:1;if("string"===l)if(h.test(a)&&h.test(c))a=+a,c=+c;else if(t.i18n)return t.i18n.compare(a,c);if(a<c)return-1;if(a>c)return 1}return 0}},Function.prototype.implement=function(t,e){return n(this.prototype,t,!e),this},Function.prototype.extend=function(t,e){return s(this,t,!e),this}}(O),Array.implement({get:function(t){return this[t]},set:function(t,e){return this[t]=e,this},getObjectAt:function(t){return this[t]},setObjectAt:function(t,e){return this[t]=e,this},include:function(t){for(var e=0,i=this.length;e<i&&this[e]!==t;)e+=1;return this[e]=t,this},erase:function(t){for(var e=this.length;e--;)this[e]===t&&this.splice(e,1);return this}}),function(t){var e=function(t){return t%4==0&&t%100!=0||t%400==0},i=[31,28,31,30,31,30,31,31,30,31,30,31],n=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:Z|(?:([+\-])(\d{2})(?::(\d{2}))?)?)?)?$/;Date.extend({fromJSON:function(t){var e=t?n.exec(t):null;return e?new Date(Date.UTC(+e[1]||0,(+e[2]||1)-1,+e[3]||1,+e[4]||0,+e[5]||0,+e[6]||0,+e[7]||0)+(e[8]?6e4*("+"===e[8]?-1:1)*(60*(+e[9]||0)+(+e[10]||0)):0)):null},getDaysInMonth:function(t,n){return 1===t&&e(n)?29:i[t]},getDaysInYear:function(t){return e(t)?366:365},isLeapYear:e});var s=function(t,e,i){return e||t>9?t:(i||"0")+t},r={second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5};Date.implement({isToday:function(t){var e=new Date,i=e.getDate(),n=e.getMonth(),s=e.getFullYear();return t?this.getUTCFullYear()===s&&this.getUTCMonth()===n&&this.getUTCDate()===i:this.getFullYear()===s&&this.getMonth()===n&&this.getDate()===i},isOnSameDayAs:function(t,e){return e?t.getUTCFullYear()===this.getUTCFullYear()&&t.getUTCMonth()===this.getUTCMonth()&&t.getUTCDate()===this.getUTCDate():t.getFullYear()===this.getFullYear()&&t.getMonth()===this.getMonth()&&t.getDate()===this.getDate()},getDayName:function(e,i){var n=t.i18n&&t.i18n.get((e?"abbreviatedD":"d")+"ayNames"),s=i?this.getUTCDay():this.getDay();return n?n[s]:s},getMonthName:function(e,i){var n=t.i18n&&t.i18n.get((e?"abbreviatedM":"m")+"onthNames"),s=i?this.getUTCMonth():this.getMonth();return n?n[s]:s},getDayOfYear:function(t){var e=t?Date.UTC(this.getUTCFullYear(),0,1):+new Date(this.getFullYear(),0,1);return 1+~~((this.getTime()-e)/864e5)},getWeekNumber:function(t,e){var i=e?this.getUTCDay():this.getDay(),n=this.getDayOfYear(e)-1,s=((t||0)-i).mod(7)||7;return Math.floor((n+s)/7)},getISOWeekNumber:function(t,e){null==t&&(t=1);var i=e?new Date(Date.UTC(this.getUTCFullYear(),0,4)):new Date(this.getFullYear(),0,4),n=i-864e5*((e?i.getUTCDay():i.getDay())-t).mod(7),s=Math.floor((this-n)/6048e5)+1;return 53===s&&(e?this.getUTCDate():this.getDate())-((e?this.getUTCDay():this.getDay())-t).mod(7)>28&&(s=1),s||new Date((e?this.getUTCFullYear():this.getFullYear())-1,11,31,12).getISOWeekNumber(t,!1)},add:function(t,e){return"year"===e?this.setFullYear(this.getFullYear()+t):"month"===e?this.setMonth(this.getMonth()+t):this.setTime(this.getTime()+t*(r[e||"day"]||0)),this},subtract:function(t,e){return this.add(-t,e)},format:function(e,i){var n=this;return e?e.replace(/%(\-)?([%A-Za-z])/g,function(e,r,o){var a,h;switch(o){case"a":return n.getDayName(!0,i);case"A":return n.getDayName(!1,i);case"b":return n.getMonthName(!0,i);case"B":return n.getMonthName(!1,i);case"c":return t.i18n?t.i18n.date(n,"fullDateAndTime"):n.toLocaleString();case"C":return s(~~((i?n.getUTCFullYear():n.getFullYear())/100),r);case"d":return s(i?n.getUTCDate():n.getDate(),r);case"D":return n.format("%m/%d/%y",i);case"e":return s(i?n.getUTCDate():n.getDate(),r," ");case"h":return n.getMonthName(!0,i);case"H":return s(i?n.getUTCHours():n.getHours(),r);case"I":return(a=i?n.getUTCHours():n.getHours())?s(a<13?a:a-12,r):12;case"j":return a=n.getDayOfYear(i),r?a:a<100?"0"+s(a):s(a);case"m":return s((i?n.getUTCMonth():n.getMonth())+1,r);case"M":return s(i?n.getUTCMinutes():n.getMinutes(),r);case"n":return"\n";case"p":return h=(i?n.getUTCHours():n.getHours())<12?"am":"pm",t.i18n?t.i18n.get(h+"Designator"):h.toUpperCase();case"r":return n.format("%I:%M:%S %p",i);case"R":return n.format("%H:%M",i);case"S":return s(i?n.getUTCSeconds():n.getSeconds(),r);case"t":return"\t";case"T":return n.format("%H:%M:%S",i);case"u":return(i?n.getUTCDay():n.getDay())||7;case"U":return s(this.getWeekNumber(0,i),r);case"V":return s(this.getISOWeekNumber(1,i),r);case"w":return i?n.getUTCDay():n.getDay();case"W":return s(this.getWeekNumber(1,i),r);case"x":return t.i18n?t.i18n.date(n,"date"):n.format("%d/%m/%y",i);case"X":return t.i18n?t.i18n.date(n,"time"):n.format("%H:%M",i);case"y":return(i?n.getUTCFullYear():n.getFullYear()).toString().slice(2);case"Y":return i?n.getUTCFullYear():n.getFullYear();case"Z":return(/\((.*)\)/.exec(n.toString())||[""]).pop();case"%":return o;default:return e}}):this.toString()}})}(O),Number.implement({limit:function(t,e){return this<t?t:this>e?e:this+0},mod:function(t){var e=this%t;return e<0?e+t:e}}),Object.extend({values:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},keyOf:function(t,e){for(var i in t)if(t[i]===e)return i},filter:function(t,e){var i,n={};for(i in t)e[i]&&(n[i]=t[i]);return n},zip:function(t,e){for(var i=Math.min(t.length,e.length),n={};i--;)n[t[i]]=e[i];return n},fromQueryString:function(t){var e={};return t.split("&").forEach(function(t){var i=t.split("=").map(decodeURIComponent);e[i[0]]=i[1]}),e}}),RegExp.email=/\b([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,})\b/i,RegExp.url=/\b(?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’])/i,function(t){var e,i,n,s,r,o=/%(\+)?(?:'(.))?(-)?(\d+)?(?:\.(\d+))?(?:\$(\d+))?([%sn@])/g;String.implement({format:function(){o.lastIndex=0;for(var t,e,i,n,s,r,a="",h=0,c=1;t=o.exec(this);){switch(a+=this.slice(h,t.index),h=t.index+t[0].length,e=arguments[(parseInt(t[6],10)||c)-1],t[7]){case"%":a+="%";continue;case"s":i=e;break;case"n":i=t[1]&&e>=0?"+":"",i+=void 0!==t[5]?e.toFixed(t[5]):e+"";break;case"@":i=e.toString()}if((n=(t[4]||0)-i.length)>0){for(r=s=t[2]||" ";n-=1;)r+=s;t[3]?i+=r:i=r+i}a+=i,c+=1}return a+=this.slice(h)},repeat:function(t){for(var e=this,i="";t;)t%2==1&&(i+=e),t>1&&(e+=e),t>>=1;return i},escapeHTML:function(){return this.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")},escapeRegExp:function(){return this.replace(/([\-.*+?\^${}()|\[\]\/\\])/g,"\\$1")},capitalise:function(){return this.charAt(0).toUpperCase()+this.slice(1)},camelCase:function(){return this.replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})},contains:function(t,e){return(e?(e+this+e).indexOf(e+t+e):this.indexOf(t))>-1},hash:function(){for(var t=this.length,e=1&t,i=t-e,n=0;n<i;n+=2)t=(t+=this.charCodeAt(n))<<16^this.charCodeAt(n+1)<<11^t,t+=t>>11;return e&&(t+=this.charCodeAt(i),t^=t<<11,t+=t>>17),t^=t<<3,t+=t>>5,t^=t<<4,t+=t>>17,t^=t<<25,t+=t>>6},md5:(e=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],i=[3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745],n=function(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i},s=function(t,e){return t<<e|t>>>32-e},r=function(t){var e,i="";for(e=0;e<32;e+=8)i+="0123456789abcdef"[t>>e+4&15],i+="0123456789abcdef"[t>>e&15];return i},function(){var t,o,a,h,c,l,u,d,f,g,p=function(t){var e,i,n,s,r=t.length,o=[0];for(e=0,i=0,n=0;i<r;i+=1)o[e]|=t.charCodeAt(i)<<n,32===(n+=8)&&(n=0,o[e+=1]=0);for(o[e]|=128<<n,s=(e+=1)+16-((e+2)%16||16);e<s;e+=1)o[e]=0;return o[e]=r<<3,o[e+1]=r>>>29,o}(function(t){var e,i,n,s="";for(e=0,i=t.length;e<i;e+=1)(n=t.charCodeAt(e))<128?s+=t.charAt(e):n<2048?(s+=String.fromCharCode(n>>6|192),s+=String.fromCharCode(63&n|128)):(s+=String.fromCharCode(n>>12|224),s+=String.fromCharCode(n>>6&63|128),s+=String.fromCharCode(63&n|128));return s}(this)),v=1732584193,m=4023233417,y=2562383102,w=271733878;for(o=0,a=p.length;o<a;o+=16){for(h=v,c=m,l=y,u=w,t=0;t<64;t+=1)t<16?(d=c&l|~c&u,f=t):t<32?(d=u&c|~u&l,f=(5*t+1)%16):t<48?(d=c^l^u,f=(3*t+5)%16):(d=l^(c|~u),f=7*t%16),g=u,u=l,l=c,c=n(c,s(n(h,n(d,n(i[t],p[o+f]))),e[t])),h=g;v=n(v,h),m=n(m,c),y=n(y,l),w=n(w,u)}return r(v)+r(m)+r(y)+r(w)})})}(),function(t,e){var i=Array.prototype.slice,n=t.meta,s=function(t){return function(){this.computedPropertyDidChange(t)}},r=function(e,i,n){var r,o,a,h,c,l=this.dependencies,u=e.dependents;for(e.hasOwnProperty("dependents")||(u=e.dependents=t.clone(u),e.allDependents={}),r=l.length;r--;)-1===(o=l[r]).indexOf(".")?(u[o]||(u[o]=[])).push(i):(a||(a="__"+i+"DidChange__",e.inits.Observers=(e.inits.Observers||0)+1),n[a]||(n[a]=s(i)),h||(h=e.pathObservers,e.hasOwnProperty("pathObservers")||(h=e.pathObservers=Object.create(h)),(c=h[a])?h.hasOwnProperty(a)||(c=h[a]=c.slice()):c=h[a]=[]),c.push(o))},o=function(e,i){var n,s,r,o,a,h=this.dependencies,c=e.dependents;for(e.hasOwnProperty("dependents")||(c=e.dependents=t.clone(c),e.allDependents={}),n=h.length;n--;)-1===(s=h[n]).indexOf(".")?c[s].erase(i):(r||(r="__"+i+"DidChange__",e.inits.Observers-=1),o||(o=e.pathObservers,e.hasOwnProperty("pathObservers")||(o=e.pathObservers=Object.create(o)),a=o[r],o.hasOwnProperty(r)||(a=o[r]=a.slice())),a.erase(s))};Function.implement({property:function(){return this.isProperty=!0,arguments.length&&(this.dependencies=i.call(arguments),this.__setupProperty__=r,this.__teardownProperty__=o),this},nocache:function(){return this.isVolatile=!0,this},doNotNotify:function(){return this.isSilent=!0,this}});var a=/^\d+$/,h=t.getFromPath=function(t,e){for(var i,n,s=0,r=e.length;s<r;){if(!t)return;-1===(i=e.indexOf(".",s))&&(i=r),n=e.slice(s,i),t=t.getObjectAt&&a.test(n)?t.getObjectAt(+n):t.get?t.get(n):t[n],s=i+1}return t},c=function(t,e,i){var n=t[e];if(n)for(var s=n.length;s--;){var r=n[s];-1===i.indexOf(r)&&(i.push(r),c(t,r,i))}return i};t.ComputedProps={propertiesDependentOnKey:function(t){var e=n(this);return e.allDependents[t]||(e.allDependents[t]=c(e.dependents,t,[]))},propertyDidChange:function(t){for(var e=this.propertiesDependentOnKey(t),i=e.length,s=n(this).cache;i--;)delete s[e[i]];return this},computedPropertyDidChange:function(t){var e=n(this).cache,i=e[t];return delete e[t],this.propertyDidChange(t,i)},clearPropertyCache:function(){return n(this).cache={},this},set:function(t,e){var i,s,r=this[t];return r&&r.isProperty?(i=!!r.isSilent,e=r.call(this,e,t),r.isVolatile?r=void 0:(r=(s=n(this).cache)[t],s[t]=e)):(i=r===e,this[t]=e),i?this:this.propertyDidChange(t,r,e)},get:function(t){var e,i=this[t];return i&&i.isProperty?i.isVolatile?i.call(this,void 0,t):t in(e=n(this).cache)?e[t]:e[t]=i.call(this,void 0,t):i},getFromPath:function(t){return h(this,t)},increment:function(t,e){return this.set(t,this.get(t)+e)},toggle:function(t){return this.set(t,!this.get(t))}}}(O),function(t,e,i){var n=function(e,i,n,s){var r=s.lastIndexOf("*")+1,o=s.slice(r),a=r?s.slice(0,r-1):"",h=o.lastIndexOf(".");e[i+"Object"]=a?t.getFromPath(n,a):n,e[i+"Path"]=o,e[i+"PathBeforeKey"]=-1===h?"":o.slice(0,h),e[i+"Key"]=o.slice(h+1)},s=/^\d+$/,r=function(t){return t},o=t.Class({__setupProperty__:function(t,e){t.bindings[e]=this,t.inits.Bindings=(t.inits.Bindings||0)+1},__teardownProperty__:function(t,e){t.bindings[e]=null,t.inits.Bindings-=1},init:function(t){for(var e in this.isConnected=!1,this.isSuspended=!0,this.isNotInSync=!0,this.willSyncForward=!0,this._fromPath=null,this._fromRoot=null,this._toPath=null,this._toRoot=null,this.fromObject=null,this.fromPath="",this.fromPathBeforeKey="",this.fromKey="",this.toObject=null,this.toPath="",this.toPathBeforeKey="",this.toKey="",this.isTwoWay=!1,this.transform=r,this.queue="bindings",t)this[e]=t[e]},destroy:function(){this.disconnect(),this.isConnected=!0},from:function(t,e){var i="string"==typeof t;return this._fromRoot=i?e:t,this._fromPath=i?t:e,this},to:function(t,e){var i="string"==typeof t;return this._toRoot=i?e:t,this._toPath=i?t:e,this},_doNotDelayConnection:!1,connect:function(){if(this.isConnected)return this;this.isSuspended=!1,n(this,"from",this._fromRoot||this._toRoot,this._fromPath),n(this,"to",this._toRoot||this._fromRoot,this._toPath);var i=this.fromObject,s=this.toObject;return s instanceof e&&(this.queue="render"),this._doNotDelayConnection||i&&s?(i.addObserverForPath(this.fromPath,this,"fromDidChange"),this.sync(),this.isTwoWay&&s.addObserverForPath(this.toPath,this,"toDidChange"),this.isConnected=!0,this):(this._doNotDelayConnection=!0,t.RunLoop.queueFn("before",this.connect,this),this)},disconnect:function(){return this.isConnected?(this.fromObject.removeObserverForPath(this.fromPath,this,"fromDidChange"),this.isTwoWay&&this.toObject.removeObserverForPath(this.toPath,this,"toDidChange"),this.isConnected=!1,this.isSuspended=!0,this.isNotInSync=!0,this.willSyncForward=!0,this):this},suspend:function(){return this.isSuspended=!0,this},resume:function(){return this.isSuspended&&this.isConnected&&(this.isSuspended=!1,this.sync()),this},fromDidChange:function(){return this.needsSync(!0)},toDidChange:function(){return this.needsSync(!1)},needsSync:function(e){var i=this.queue,n=this.isNotInSync;return this.willSyncForward=e,this.isNotInSync=!0,n||this.isSuspended||(i?t.RunLoop.queueFn(i,this.sync,this,!0):this.sync()),this},sync:function(t){if(!t&&(!this.isNotInSync||this.isSuspended))return!1;this.isNotInSync=!1;var e,i,n=this.willSyncForward,r=n?"from":"to",o=n?"to":"from",a=this[o+"PathBeforeKey"],h=this[o+"Object"];return a&&(h=h.getFromPath(a)),!!h&&(e=this[o+"Key"],void 0!==(i=this.transform.call(this,this[r+"Object"].getFromPath(this[r+"Path"]),n))&&(s.test(e)?h.setObjectAt(+e,i):h.set(e,i)),!0)}});t.Binding=o;var a=t.bind=function(t,e,i){var n=(new o).from(t,e);return i&&(n.transform=i),n};t.bindTwoWay=function(t,e,i){var n=a(t,e,i);return n.isTwoWay=!0,n}}(O,void 0!==typeof Element?Element:function(){}),function(t,e){var i=t.meta;t.BoundProps={initBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&(n.hasOwnProperty(t)||(e=n[t]=Object.create(e)),this[t]=void 0,e.to(t,this).connect());return this},destroyBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&e.destroy();return this},registerBinding:function(e){var n=i(this);return n.bindings["__binding__"+t.guid(e)]=e,n.inits.Bindings=(n.inits.Bindings||0)+1,this},deregisterBinding:function(t){var e=i(this),n=e.bindings,s=Object.keyOf(n,t);return s&&(n[s]=null,e.inits.Bindings-=1),this},suspendBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&e.suspend();return this},resumeBindings:function(){var t,e,n=i(this).bindings;for(t in n)(e=n[t])&&e.resume();return this}}}(O),function(t){var e=function(t,e){return t<e?-1:t>e?1:0},i=function(t,e){return e?function(i,n,s){return t.call(e,i,n,s)}:t},n={first:function(){return this.getObjectAt(0)},last:function(){return this.getObjectAt(this.get("length")-1)},indexOf:function(t,e){var i=this.get("length");for(e=e<0?Math.max(0,i+e):e||0;e<i;e+=1)if(this.getObjectAt(e)===t)return e;return-1},lastIndexOf:function(t,e){var i=this.get("length");for(e=e<0?i+e:e||i-1;e>=0;e-=1)if(this.getObjectAt(e)===t)return e;return-1},binarySearch:function(t,i){var n,s=0,r=this.get("length");for(i||(i=e);s<r;)n=s+r>>1,i(this.getObjectAt(n),t)<0?s=n+1:r=n;return s},contains:function(t){return this.indexOf(t)>-1},find:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");s<r;s+=1){var o=this.getObjectAt(s);if(n(o,s,this))return o}return null},forEach:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");s<r;s+=1)n(this.getObjectAt(s),s,this);return this},filter:function(t,e){for(var n=i(t,e),s=[],r=0,o=this.get("length");r<o;r+=1){var a=this.getObjectAt(r);n(a,r,this)&&s.push(a)}return s},map:function(t,e){for(var n=i(t,e),s=[],r=0,o=this.get("length");r<o;r+=1)s[r]=n(this.getObjectAt(r),r,this);return s},reduce:function(t,e){var i,n=0,s=this.get("length");if(!s&&1===arguments.length)throw new TypeError;for(arguments.length>=2?i=e:(i=this.getObjectAt(0),n=1);n<s;n+=1)i=t(i,this.getObjectAt(n),n,this);return i},every:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");s<r;s+=1)if(!n(this.getObjectAt(s),s,this))return!1;return!0},some:function(t,e){for(var n=i(t,e),s=0,r=this.get("length");s<r;s+=1)if(n(this.getObjectAt(s),s,this))return!0;return!1}};Array.implement(n),t.Enumerable=n}(O),function(t){var e=t.meta,i=Array.prototype.slice;Function.implement({on:function(){return this.observes.apply(this,i.call(arguments).map(function(t){return"__event__"+t}))}});var n=t.Class({init:function(e,i,n){this.type=e,this.target=i,this.defaultPrevented=!1,this.propagationStopped=!1,t.extend(this,n)},preventDefault:function(){return this.defaultPrevented=!0,this},stopPropagation:function(){return this.propagationStopped=!0,this}});t.Event=n,t.EventTarget={nextEventTarget:null,on:function(t,i,n){i instanceof Function||(i={object:i,method:n}),t="__event__"+t;var s=e(this).observers,r=s[t];return s.hasOwnProperty(t)||(r=s[t]=r?r.slice():[]),r.push(i),this},once:function(t,e){var i=function(n){e.call(this,n),this.off(t,i)};return this.on(t,i),this},fire:function(i,s){var r,o,a,h=this,c="__event__"+i;for(s&&s instanceof n||(s&&/Event\]$/.test(s.toString())?s.stopPropagation=function(){return this.propagationStopped=!0,this}:s=new n(i,h,s)),s.propagationStopped=!1;h;){for(a=(o=e(h).observers[c])?o.length:0;a--;)try{(r=o[a])instanceof Function?r.call(h,s):(r.object||h)[r.method](s)}catch(e){t.RunLoop.didError(e)}h=s.propagationStopped?null:h.get?h.get("nextEventTarget"):h.nextEventTarget}return this},off:function(t,i,n){t="__event__"+t;var s=e(this).observers,r=s[t];if(r)if(s.hasOwnProperty(t)||(r=s[t]=r.slice()),i)if(i instanceof Function)r.erase(i);else for(var o=r.length;o--;){var a=r[o];a.object===i&&a.method===n&&r.splice(o,1)}else r.length=0;return this}}}(O),function(t){var e=t.Class({init:function(t){this.data=[],this.length=0,this.comparator=t},_up:function(t){var e,i,n,s=this.data,r=this.comparator;for(i=s[t];t&&!(r(i,n=s[e=t-1>>1])>=0);)s[e]=i,s[t]=n,t=e;return t},_down:function(t){var e,i,n,s,r=this.data,o=this.length,a=this.comparator;for(e=r[t];!(n=(i=1+(t<<1))+1,i>=o||(s=r[i],n<o&&a(s,r[n])>0&&(s=r[n],i=n),a(e,s)<=0));)r[i]=e,r[t]=s,t=i;return t},push:function(t){if(null!=t){var e=this.length;this.data[e]=t,this.length=e+1,this._up(e)}return this},pop:function(){var t,e=this.data,i=this.length;return i?(t=e[0],i-=1,e[0]=e[i],e[i]=null,this.length=i,this._down(0),t):null},peek:function(){return this.data[0]},remove:function(t){var e=this.data,i=this.length,n=null!=t&&i?e.lastIndexOf(t,i-1):-1;return n<0?this:(i-=1,e[n]=e[i],e[i]=null,this.length=i,n!==i&&this._down(this._up(n)),this)}});t.Heap=e}(O),function(t,e){var i=Array.prototype.slice;t.MutableEnumerable={push:function(){var t=i.call(arguments);return this.replaceObjectsAt(this.get("length"),0,t),this.get("length")},pop:function(){var t=this.get("length");return 0===t?void 0:this.replaceObjectsAt(t-1,1)[0]},unshift:function(){var t=i.call(arguments);return this.replaceObjectsAt(0,0,t),this.get("length")},shift:function(){return 0===this.get("length")?void 0:this.replaceObjectsAt(0,1)[0]},splice:function(t,e){var n=i.call(arguments,2);return this.replaceObjectsAt(t,e,n)}}}(O),function(t,e,i){var n,s=e.requestAnimationFrame||e.oRequestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||(n=0,function(t){var i=Date.now(),s=Math.max(0,16-(i-n));n=i,e.setTimeout(function(){t(i+s)},s)}),r=function(t,e,i,n){this.time=t,this.period=e,this.fn=i,this.bind=n},o={mayRedraw:!1,_queueOrder:["before","bindings","middle","render","after"],_queues:{before:[],bindings:[],middle:[],render:[],after:[],nextLoop:[],nextFrame:[]},_timeouts:new t.Heap(function(t,e){return t.time-e.time}),_nextTimeout:0,_timer:null,_depth:0,flushQueue:function(t){var e,i,n,s,r=this._queues[t],a=r.length;if(a){for(this._queues[t]=[],e=0;e<a;e+=1){n=(i=r[e])[0],s=i[1];try{s?n.call(s):n()}catch(t){o.didError(t)}}return!0}return!1},flushAllQueues:function(){for(var t=this._queueOrder,e=0,i=t.length;e<i;){if(3===e&&!this.mayRedraw&&!document.hidden)return void this.invokeInNextFrame(this.flushAllQueues,this);e=this.flushQueue(t[e])?0:e+1}},queueFn:function(t,e,i,n){var s,r,a=this._queues[t],h=a.length;if(e){if(!n)for(s=0;s<h;s+=1)if((r=a[s])[0]===e&&r[1]===i)return this;a[h]=[e,i]}else try{e()}catch(t){o.didError(t)}return this},invoke:function(t,e,i){this._depth+=1;try{i?t.apply(e,i):e?t.call(e):t()}catch(t){o.didError(t)}return 1===this._depth&&this.flushAllQueues(),this._depth-=1,this._depth||this.processTimeouts(),this},invokeInNextEventLoop:function(t,e){var n=this._queues.nextLoop;return n.length||i(a),n.push([t,e]),this},invokeInNextFrame:function(t,e){var i=this._queues.nextFrame;return i.length||s(c),i.push([t,e]),this},invokeAfterDelay:function(t,e,i){var n=new r(Date.now()+e,0,t,i);return this._timeouts.push(n),this._scheduleTimeout(),n},invokePeriodically:function(t,e,i){var n=new r(Date.now()+e,e,t,i);return this._timeouts.push(n),this._scheduleTimeout(),n},_scheduleTimeout:function(){var t=this._timeouts.peek(),e=t?t.time:0;e&&e!==this._nextTimeout&&(clearTimeout(this._timer),e-Date.now()>0?(this._timer=setTimeout(h,e-Date.now()),this._nextTimeout=e):this._nextTimeout=0)},processTimeouts:function(){for(var t,e,i=this._timeouts;i.length&&i.peek().time<=Date.now();)(e=(t=i.pop()).period)&&(t.time=Date.now()+e,i.push(t)),this.invoke(t.fn,t.bind);return this._scheduleTimeout(),this},cancel:function(t){return this._timeouts.remove(t),this},didError:function(t){console.log(t.name,t.message,t.stack)}};t.RunLoop=o,Function.implement({queue:function(t){var e=this;return function(){return o.queueFn(t,e,this),this}},nextLoop:function(){var t=this;return function(){return o.invokeInNextEventLoop(t,this),this}},nextFrame:function(){var t=this;return function(){return o.invokeInNextFrame(t,this),this}},invokeInRunLoop:function(){var t=this;return function(){o.invoke(t,this,arguments)}}});var a=o.invoke.bind(o,o.flushQueue,o,["nextLoop"]),h=o.processTimeouts.bind(o),c=function(t){o.frameStartTime=t,o.mayRedraw=!0,o.invoke(o.flushQueue,o,["nextFrame"]),o.mayRedraw=!1}}(O,window,"undefined"!=typeof setImmediate?setImmediate:function(t){return setTimeout(t,0)}),function(t,e){var i=t.meta,n=function(t,e){for(var i,n,s,r=this.observedProperties,o=t.observers,a=r.length;a--;)-1===(i=r[a]).indexOf(".")?(n=o[i],o.hasOwnProperty(i)||(n=o[i]=n?n.slice():[]),n.push({object:null,method:e})):(s||(s=t.pathObservers,t.hasOwnProperty("pathObservers")||(s=t.pathObservers=Object.create(s)),s=s[e]=[],t.inits.Observers=(t.inits.Observers||0)+1),s.push(i))},s=function(t,e){for(var i,n,s,r,o,a=this.observedProperties,h=t.observers,c=a.length;c--;)if(-1===(i=a[c]).indexOf(".")){for(n=h[i],h.hasOwnProperty(i)||(n=h[i]=n.slice()),r=n.length;r--;)if(null===(s=n[r]).object&&s.method===e){n.splice(r,1);break}}else o||(o=t.pathObservers,t.hasOwnProperty("pathObservers")||(o=t.pathObservers=Object.create(o)),o[e]=null,t.inits.Observers-=1)};Function.implement({observes:function(){for(var t=this.observedProperties||(this.observedProperties=[]),e=arguments.length;e--;)t.push(arguments[e]);return this.__setupProperty__=n,this.__teardownProperty__=s,this}});var r=function(t,e){var n,s,r,o=i(t).pathObservers;for(n in o)if(s=o[n])for(r=s.length;r--;)t[e](s[r],t,n)},o=function(e,i,n,s,r){var o,a,h,c,l,u=i.observers[n],d=i.isInitialised,f=!1;if(u&&(l=u.length))for(u=u.slice();l--;)a=(o=u[l]).object||e,h=o.method,d?(c=o.path)?(void 0!==r||f||(r=/^\d+$/.test(n)?e.getObjectAt(parseInt(n,10)):e.get(n),f=!0),s&&s.removeObserverForPath(c,a,h),r&&r.addObserverForPath(c,a,h),a[h](e,n,s&&s.getFromPath(c),r&&r.getFromPath(c))):a[h](e,n,s,r):(r&&(c=o.path)&&r.addObserverForPath(c,a,h),a instanceof t.Binding&&(a[h](),a.sync()))},a=function(t,e,i){var n,s,r=e.observers["*"];if(r)for(s=r.length;s--;)((n=r[s]).object||t)[n.method](t,i)};t.ObservableProps={initObservers:function(){r(this,"addObserverForPath")},destroyObservers:function(){r(this,"removeObserverForPath")},hasObservers:function(){var e,n,s,r,o=i(this).observers;for(e in o)for(s=(n=o[e]).length;s--;)if((r=n[s].object)&&r!==this&&(!r instanceof t.Binding||r.toObject!==this))return!0;return!1},beginPropertyChanges:function(){return i(this).depth+=1,this},endPropertyChanges:function(){var t,e,n=i(this);if(1===n.depth)for(;t=n.changed;){for(e in n.changed=null,t)o(this,n,e,t[e].oldValue,t[e].newValue);n.observers["*"]&&a(this,n,t)}return n.depth-=1,this},propertyDidChange:function(t,e,n){var s,r=i(this),h=r.isInitialised,c=h?this.propertiesDependentOnKey(t):[],l=c.length,u=r.depth,d=r.observers["*"],f=!l&&!u&&!d,g=f?null:r.changed||{},p=r.cache;if(f)o(this,r,t,e,n);else{for(;l--;)g[s=c[l]]||(g[s]={oldValue:p[s]}),delete p[s];if(g[t]={oldValue:g[t]?g[t].oldValue:e,newValue:n},r.depth)r.changed=g;else{for(s in g)o(this,r,s,g[s].oldValue,g[s].newValue);h&&d&&a(this,r,g)}}return this},addObserverForKey:function(t,e,n){var s=i(this).observers,r=s[t];return s.hasOwnProperty(t)||(r=s[t]=r?r.slice():[]),r.push({object:e,method:n}),this},removeObserverForKey:function(t,e,n){var s,r,o=i(this).observers,a=o[t];if(a){for(r=a.length;r--;)if((s=a[r]).object===e&&s.method===n){a.splice(r,1);break}a.length||delete o[t]}return this},addObserverForPath:function(e,n,s){var r=e.indexOf(".");if(-1===r)this.addObserverForKey(e,n,s);else{var o=e.slice(0,r),a=this.get(o),h=e.slice(r+1),c=i(this).observers,l=c[o];c.hasOwnProperty(o)||(l=c[o]=l?l.slice():[]),l.push({path:h,object:n,method:s}),!a||a instanceof t.Binding||a.addObserverForPath(h,n,s)}return this},removeObserverForPath:function(t,e,n){var s=t.indexOf(".");if(-1===s)this.removeObserverForKey(t,e,n);else{var r,o,a=t.slice(0,s),h=this.get(a),c=t.slice(s+1),l=i(this).observers[a];if(l)for(o=l.length;o--;)if((r=l[o]).path===c&&r.object===e&&r.method===n){l.splice(o,1);break}h&&h.removeObserverForPath(c,e,n)}return this}}}(O),function(t){var e=t.meta,i=t.mixin;t.Object=t.Class({Mixin:[t.ComputedProps,t.BoundProps,t.ObservableProps,t.EventTarget],init:function(){var t,n,s,r,o;for(this.isDestroyed=!1,t=0,n=arguments.length;t<n;t+=1)i(this,arguments[t]);for(o in r=(s=e(this)).inits)r[o]&&this["init"+o]();s.isInitialised=!0},destroy:function(){var t,i=e(this).inits;for(t in i)i[t]&&this["destroy"+t]();this.isDestroyed=!0}})}(O),function(t,e){var i=t.meta;t.ObservableRange={rangeDidChange:function(t,e){void 0===e&&(e=t+1);var n,s,r=i(this);for(n in r.observers)t<=(s=parseInt(n,10))&&s<e&&this.propertyDidChange(n);for(var o=r.rangeObservers,a=o?o.length:0,h=this.get("length")||0;a--;){var c=o[a],l=c.range,u=l.start||0,d="end"in l?l.end:Math.max(h,e);u<0&&(u+=h),d<0&&(d+=h),u<e&&d>t&&c.object[c.method](this,t,e)}return this.computedPropertyDidChange("[]"),this},addObserverForRange:function(t,e,n){var s=i(this);return(s.rangeObservers||(s.rangeObservers=[])).push({range:t,object:e,method:n}),this},removeObserverForRange:function(t,e,n){for(var s=i(this).rangeObservers,r=s?s.length:0;r--;){var o=s[r];if(o.range===t&&o.object===e&&o.method===n){s.splice(r,1);break}}return this}}}(O),function(t,e){var i=Array.prototype.splice,n=Array.prototype.slice;function s(t){return"number"==typeof t&&t%1==0}var r=t.Class({Extends:t.Object,Mixin:[t.ObservableRange,t.Enumerable,t.MutableEnumerable],init:function(t,e){this._array=t||[],this._length=this._array.length,r.parent.init.call(this,e)},"[]":function(t){if(t){var e=this._array,i=this._length,n=t.length,s=0,r=n;for(this._array=t,this._length=n;s<n&&t[s]===e[s];)s+=1;if(n===i)for(var o=r-1;r>s&&t[o]===e[o];)r=o,o-=1;else r=Math.max(i,n),this.propertyDidChange("length",i,n);s!==r&&this.rangeDidChange(s,r)}return this._array.slice()}.property(),getObjectAt:function(t){return this._array[t]},length:function(t){var e=this._length;return"number"==typeof t&&t!==e&&(this._array.length=t,this._length=t,t<e&&this.rangeDidChange(t,e),e=t),e}.property().nocache(),setObjectAt:function(t,e){if(!s(t))throw new Error("index is not an integer");this._array[t]=e;var i=this._length;return i<=t&&(this._length=t+1,this.propertyDidChange("length",i,t+1)),this.rangeDidChange(t),this},replaceObjectsAt:function(t,e,r){var o,a,h,c,l=this._length,u=this._array;if(!s(t))throw new Error("index is not an integer");if(r=r?n.call(r):[],l<=t)for(h=0,c=r.length;h<c;h+=1)u[t+h]=r[h];else r.unshift(t,e),o=i.apply(u,r);return l!==(a=u.length)?(this._length=a,this.propertyDidChange("length",l,a),this.rangeDidChange(t,Math.max(l,a))):this.rangeDidChange(t,t+e),o||[]},sort:function(t){return this._array.sort(t),this.rangeDidChange(0,this._length),this},reverse:function(){return this._array.reverse(),this.rangeDidChange(0,this._length),this},concat:function(){var t,e,i,n=[];for(t=0,e=arguments.length;t<e;t+=1)i=arguments[t],n[t]=i instanceof r?i._array:i;return Array.prototype.concat.apply(this._array,n)},join:function(t){return this._array.join(t)},slice:function(t,e){return this._array.slice(t,e)}});t.ObservableArray=r}(O),O.Transform={toBoolean:function(t){return!!t},toString:function(t){return null!=t?t+"":""},toInt:function(t){return parseInt(t,10)||0},toFloat:function(t){return parseFloat(t)},invert:function(t){return!t},defaultValue:function(t){return function(e){return void 0!==e?e:t}},undefinedToNull:function(t){return void 0===t?null:t},isEqualToValue:function(t){return function(e,i){return i?e===t:e?t:void 0}}},function(t){var e=navigator.userAgent.toLowerCase(),i=["other","0"],n=/windows phone/.test(e)?"winphone":/ip(?:ad|hone|od)/.test(e)?"ios":(/android|webos/.exec(e)||/mac|win|linux/.exec(navigator.platform.toLowerCase())||i)[0],s=(/firefox|edge|msie|iemobile|opr\//.exec(e)||/chrome|safari|opera/.exec(e)||i)[0],r=parseFloat((/(?:; rv:|edge\/|version\/|firefox\/|opr\/|msie\s|os )(\d+(?:[._]\d+)?)/.exec(e)||/chrome\/(\d+\.\d+)/.exec(e)||i)[1].replace("_",".")),o={firefox:"-moz-",msie:"-ms-",opera:"-o-"}[s]||"-webkit-",a={};"opr/"===s&&(s="opera"),function(){var t,i,s,h=document.createElement("div"),c=h.style,l={"box-shadow":{name:"box-shadow",value:"0 0 0 #000"},transform:{name:"transform",value:"translateX(0)"},transform3d:{name:"transform",value:"translateZ(0)"},transition:{name:"transition",value:"all .3s"},perspective:{name:"perspective",value:"1px"},"user-select":{name:"user-select",value:"none"}};for(t in l)s=(i=l[t]).name+":"+i.value,c.cssText=s,c.length?a[t]=i.name:(c.cssText=o+s,a[t]=c.length?o+i.name:null);c.cssText="display:flex",c.length?a.flexbox="flex":(c.cssText="display:"+o+"flex",a.flexbox=h.style.length?o+"flex":null),s=a.transition,["delay","timing","duration","property"].forEach(function(t){a["transition-"+t]=s?s+"-"+t:null}),h=null,c=null,("ios"===n&&r<6||/windows nt 5.1/.test(e))&&(a.transform3d=!1)}(),t.UA={platform:n,isMac:"mac"===n,isWin:"win"===n,isLinux:"linux"===n,isIOS:"ios"===n,isWKWebView:"ios"===n&&!!window.indexedDB,isAndroid:"android"===n,isWinPhone:"winphone"===n,browser:s,version:r,chrome:"chrome"===s?r:0,safari:"safari"===s?r:0,firefox:"firefox"===s?r:0,edge:"edge"===s?r:0,msie:"msie"===s?r:0,iemobile:"iemobile"===s?r:0,opera:"opera"===s?r:0,operaMobile:/opera mobi/.test(e)?r:0,operaMini:window.operamini?r:0,cssProps:a,cssPrefix:o,canTouch:"ontouchstart"in document.documentElement,canU2F:"chrome"===s&&r>=41}}(O),function(t){var e=function(t,e,i,n){var s=3*t,r=3*(i-t)-s,o=1-s-r,a=3*e,h=3*(n-e)-a,c=1-a-h,l=function(t){return t*(s+t*(r+t*o))},u=function(t){return s+t*(2*r+3*o*t)};return function(t){var e=function(t){var e,i=t;do{e=i,i-=(l(i)-t)/u(i)}while(Math.abs(i-e)>1e-4);return i}(t);return e*(a+e*(h+e*c))}.extend({cssName:"cubic-bezier("+t+","+e+","+i+","+n+")"})};O.Easing={linear:function(t){return t}.extend({cssName:"linear"}),ease:e(.25,.1,.25,1),easeIn:e(.42,0,1,1),easeOut:e(0,0,.58,1),easeInOut:e(.42,0,.58,1)}}(),function(t){var e=[],i=function(){var n,s,r,o,a,h,c,l=e,u=l.length,d=t.RunLoop.frameStartTime;if(u)for(t.RunLoop.invokeInNextFrame(i);u--;){for((r=(s=(n=l[u]).length)>1)&&(a=n[0].object).beginPropertyChanges();s--;){if((h=(o=n[s]).startTime)<=0){if(!h){o.startTime=-1;continue}o.startTime=h=d}(h=d-h)<(c=o.duration)?o.drawFrame(o.ease(h/c),h):(o.drawFrame(1,c),o.stop())}r&&a.endPropertyChanges()}},n=t.meta;t.Animation=t.Class({init:function(e){this.duration=this.duration,this.ease=this.ease,this.isRunning=!1,this.startTime=0,this.startValue=null,this.endValue=null,this.deltaValue=null,t.extend(this,e)},duration:300,ease:t.Easing.ease,animate:function(s,r,o){if(this.isRunning&&this.stop(),null!=r&&(this.duration=r),null!=o&&(this.ease=o),!this.prepare(s))return this;var a=this.object,h=n(a),c=h.animations||(h.animations=[]);return this.startTime=0,e.length||t.RunLoop.invokeInNextFrame(i),c.length||e.push(c),c.push(this),this.isRunning=!0,a.willAnimate&&a.willAnimate(this),this},prepare:function(t){return"object"==typeof t?(this.startValue=t.startValue,this.endValue=t.endValue):(this.startValue=this.object.get(this.property),this.endValue=t),this.deltaValue=this.endValue-this.startValue,!!this.deltaValue},drawFrame:function(t){var e=t<1?this.startValue+t*this.deltaValue:this.endValue;this.object.set(this.property,e)},stop:function(){if(this.isRunning){var t=this.object,i=n(t).animations;i.erase(this),i.length||e.erase(i),this.isRunning=!1,t.didAnimate&&t.didAnimate(this)}return this}})}(O),function(t){t.AnimatableView={animateLayer:!0,animateLayerDuration:300,animateLayerEasing:t.Easing.ease,animating:0,willAnimate:function(){this.increment("animating",1)},didAnimate:function(){this.increment("animating",-1)},layerAnimation:function(){return new t.StyleAnimation({object:this,element:this.get("layer")})}.property(),redrawLayerStyles:function(e,i){var n,s,r=this.get("layerStyles"),o=this.get("layerAnimation"),a=t.Element.setStyle;if(this.get("animateLayer")&&this.get("isInDocument"))o.current||(o.current=i||r),o.animate(r,this.get("animateLayerDuration"),this.get("animateLayerEasing")),o.isRunning||(this.willAnimate(o),this.didAnimate(o));else for(n in o.stop(),o.current=r,r)(s=r[n])!==i[n]&&a(e,n,s);for(n in i)n in r||a(e,n,null)}}}(O),function(t){var e=/[.\-\d]+/g,i=function(t){var e,i,n,s=[],r=t.length,o=0,a=!1,h=!1;for(e=0;e<r;e+=1)i=t.charAt(e),(h||a)&&h!==/^[.\-\d]/.test(i)?(n=t.slice(o,e),s.push(h?parseFloat(n):n),o=e,h=!h):"("===i?a=!0:")"===i&&(a=!1);return s.push(t.slice(o)),s},n=function(t){for(var e=1,i=(t=t.slice()).length;e<i;e+=2)t[e]=0;return t},s={display:{calcDelta:function(t,e){return"none"===e?t:e},calcValue:function(t,e,i){return t?e:i}},transform:{calcDelta:function(t,e){var s,r,o=i(t||""),a=i(e||"");for(e&&"none"!==e||(a=n(o)),t&&"none"!==t||(o=n(a)),o.length!==a.length&&(o=[t],a=[e]),s=0,r=o.length;s<r;s+=1)0===o[s]&&/^[,\)]/.test(o[s+1])&&(o[s+1]=a[s+1].replace(/[,\)].*/g,"")+o[s+1]);return{start:o,delta:a.map(function(t,e){return 1&e?t-o[e]:0})}},calcValue:function(t,e){for(var i=e.start,n=e.delta,s=i[0],r=1,o=i.length;r<o;r+=2)s+=i[r]+t*n[r],s+=i[r+1];return s}}},r={display:1,top:1,right:1,bottom:1,left:1,marginTop:1,marginRight:1,marginBottom:1,marginLeft:1,paddingTop:1,paddingRight:1,paddingBottom:1,paddingLeft:1,width:1,height:1,transform:1,opacity:1},o=t.Class({Extends:t.Animation,prepare:function(i){var n=t.Element.setStyle,o=this.animated=[],a=this.startValue=this.current,h=this.current=t.clone(a),c=this.deltaValue={},l=this.units={},u=this.element;for(var d in this.endValue=i,i){var f=a[d],g=i[d];if(f!==g)if(r[d]){o.push(d);var p=s[d];p?c[d]=p.calcDelta(f,g):(l[d]="string"==typeof f&&f.replace(e,"")||"string"==typeof g&&g.replace(e,"")||0,f=a[d]=parseInt(f,10),c[d]=parseInt(g,10)-f)}else t.RunLoop.didError({name:"Can’t animate property: "+d}),h[d]=g,n(u,d,g)}if(c.top&&(!l.top||"px"===l.top)){var v=i.transform||"";if("none"===v&&(v=""),""===v||/^translate3d\([^,]+,|\d+(?:px)?,0\)$/.test(v)){if(c.transform||o.push("transform"),""===v)i.transform=v,v="translate3d(0,"+c.top+"px,0)";else{var m=v.split(",");m[1]=parseInt(m[1],10)+c.top+"px",v=m.join(",")}c.transform=s.transform.calcDelta(a.transform||"",v),c.top=0}}return!!o.length&&(n(u,"will-change",o.join(", ")),!0)},drawFrame:function(e){for(var i=this.animated,n=i.length,r=this.startValue,o=this.endValue,a=this.deltaValue,h=this.units,c=this.current,l=this.element,u=e<1;n--;){var d=i[n],f=r[d],g=o[d],p=a[d],v=h[d],m=s[d],y=c[d]=u?m?m.calcValue(e,p,f,g):f+e*p+v:g;t.Element.setStyle(l,d,y)}u||t.Element.setStyle(l,"will-change","auto")}});t.StyleAnimation=o}(O),function(t){var e={keys:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",144:"numlock"},lookupKey:function(t,i){var n,s=t.keyCode||t.which,r="keypress"===t.type,o=r&&s>32&&0!==t.which&&0!==t.charCode,a=String.fromCharCode(s).toLowerCase(),h=!o&&e.keys[s]||a;!o&&111<s&&s<124&&(h="f"+(s-111));var c="";return i||(n=!r||/[a-z]/.test(h),t.altKey&&n&&(c+="alt-"),t.ctrlKey&&(c+="ctrl-"),t.metaKey&&(c+="meta-"),t.shiftKey&&n&&(c+="shift-")),c+h},isClickModified:function(t){return!!t.button||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}};O.DOMEvent=e}(),function(t,e){var i,n,s,r,o,a={class:"className",className:"className",defaultValue:"defaultValue",for:"htmlFor",html:"innerHTML",text:"textContent",unselectable:"unselectable",value:"value"},h={autofocus:1,checked:1,defaultChecked:1,disabled:1,hidden:1,multiple:1,readOnly:1,required:1,selected:1};Element.prototype.get=function(t){var e=a[t];return e?this[e]:h[t]?!!this[t]:this.getAttribute(t)},Element.prototype.set=function(t,e){var i,s=a[t];if(s)this[s]=null==e?"":""+e;else if(h[t])this[t]=!!e;else if("styles"===t)n(this,e);else if("children"===t){for(;i=this.lastChild;)this.removeChild(i);r(this,e)}else null==e?this.removeAttribute(t):this.setAttribute(t,""+e);return this};var c={opacity:1,zIndex:1},l=function(){var e,i,n=t.UA.cssProps,s={float:void 0!==document.body.style.cssFloat?"cssFloat":"styleFloat"};for(e in n)(i=n[e])&&("Ms"===(i=i.camelCase()).slice(0,2)&&(i="m"+i.slice(1)),s[e.camelCase()]=i);return s}(),u=document,d=!!u.addEventListener.isFake,f=null;t.Element={forView:function(t){var e=f;return f=t,e},create:function(e,i,n){var o,a,h,c,l;if(i instanceof Array&&(n=i,i=null),/[#.]/.test(e))for(e=(h=e.split(/([#.])/))[0],i||(i={}),o=1,a=h.length;o+1<a;o+=2)c=h[o+1],"#"===h[o]?i.id=c:i.className=i.className?i.className+" "+c:c;return l=u.createElement(e),!d||"input"!==e&&"select"!==e&&"textarea"!==e||l.addEventListener("select"===e?"change":"propertychange",t.ViewEventsController,!1),i&&s(l,i),n&&r(l,n),l},setAttributes:s=function(e,i){var n,s;for(n in i)void 0!==(s=i[n])&&(s instanceof t.Binding?(s.to(n,e).connect(),f&&f.registerBinding(s)):e.set(n,s));return e},appendChildren:r=function(e,i){var n,s,o;for(i instanceof Array||(i=[i]),n=0,s=i.length;n<s;n+=1)(o=i[n])&&(o instanceof Array?r(e,o):o instanceof t.View?f.insertView(o,e):("object"!=typeof o&&(o=u.createTextNode(o)),e.appendChild(o)));return e},hasClass:function(t,e){return t.className.contains(e," ")},addClass:function(t,e){var i=t.className;return i.contains(e," ")||(t.className=(i?i+" ":"")+e),this},removeClass:function(t,e){var i=t.className,n=(" "+i+" ").indexOf(" "+e+" ");return n>-1&&(t.className=i.slice(0,n&&n-1)+i.slice(n+e.length)),this},setStyle:i=function(e,i,n){if(void 0!==n){i=i.camelCase(),i=l[i]||i,"number"!=typeof n||c[i]||(n+="px");try{e.style[i]=n}catch(s){t.RunLoop.didError({name:"Element#setStyle",message:"Invalid value set",details:"Style: "+i+"\nValue: "+n+"\nEl id: "+e.id+"\nEl class: "+e.className})}}return this},setStyles:n=function(t,e){for(var n in e)i(t,n,e[n]);return this},contains:function(t,e){var i=t.compareDocumentPosition(e);return!i||!!(16&i)},nearest:function(t,e,i){if(i||(i=t.ownerDocument.documentElement),"string"==typeof e){var n=e.toUpperCase();e=function(t){return t.nodeName===n}}for(;t&&!e(t);){if(!t||t===i)return null;t=t.parentNode}return t},getPosition:o=function(t,e){var i=t.getBoundingClientRect(),n={top:i.top,left:i.left,width:i.right-i.left,height:i.bottom-i.top};return e&&(i=o(e),"BODY"===e.nodeName&&(e=e.parentNode),n.top-=i.top-e.scrollTop,n.left-=i.left-e.scrollLeft),n}},Object.toCSSString=function(e){var i,n,s="";for(i in e)void 0!==(n=e[i])&&("number"!=typeof n||c[i]||(n+="px"),i=i.hyphenate(),s+=i=t.UA.cssProps[i]||i,s+=":",s+=n,s+=";");return s}}(O),function(t){t.Stylesheet={create:function(e,i){var n=document,s=n.getElementsByTagName("head")[0],r=t.Element.create("style",{type:"text/css",id:e});return r.styleSheet?(s.appendChild(r),r.styleSheet.cssText=i):(r.appendChild(n.createTextNode(i)),s.appendChild(r)),r}}}(O),function(t){var e=t.UA.isMac,i={alt:e?"⌥":"Alt-",cmd:e?"⌘":"Ctrl-",meta:e?"⌘":"Meta-",shift:e?"⇧":"Shift-",enter:e?"↵":"Enter",backspace:e?"⌫":"Backspace"};t.formatKeyForPlatform=function(t){return t.split("-").map(function(t){return i[t]||t.capitalise()}).join("")};var n={checkbox:1,radio:1,file:1,submit:1},s={},r=t.Class({Extends:t.Object,init:function(e){this.isEnabled=!0,this._shortcuts={},r.parent.init.call(this,e);var i=t.ViewEventsController;i.kbShortcuts=this,i.addEventTarget(this,-10)},destroy:function(){var e=t.ViewEventsController;e.kbShortcuts===this&&delete t.ViewEventsController.kbShortcuts,e.removeEventTarget(this),r.parent.destroy.call(this)},register:function(t,i,n){t=t.replace("cmd-",e?"meta-":"ctrl-");var s=this._shortcuts;return(s[t]||(s[t]=[])).push([i,n]),this},deregister:function(t,i,n){t=t.replace("cmd-",e?"meta-":"ctrl-");for(var s,r=this._shortcuts[t],o=r?r.length:0,a=o;a--;)(s=r[a])[0]===i&&s[1]===n&&(1===o?delete this._shortcuts[t]:r.splice(a,1));return this},getHandlerForKey:function(t){var e=this._shortcuts[t];return e&&this.get("isEnabled")?e[e.length-1]:null},trigger:function(e){var i,r,o=e.target,a=o.nodeName;if(e.ctrlKey||e.metaKey||!("TEXTAREA"===a||"SELECT"===a||"INPUT"===a&&!n[o.type]||e.targetView instanceof t.RichTextView)){if(r=t.DOMEvent.lookupKey(e),"keydown"===e.type)s[r]=!0;else if(s[r])return;(i=this.getHandlerForKey(r))&&(i[0][i[1]](e),e.doDefault||e.preventDefault())}}.on("keydown","keypress")});t.GlobalKeyboardShortcuts=r}(O),function(t){var e=function(t){var e=t.href,i=e.indexOf("#/");return i>-1?e.slice(i+2):""},i=function(t,e){return t.pathname.slice(e.length)},n=t.Class({Extends:t.Object,title:document.title,currentPath:"",useHash:!history.pushState||"file:"===location.protocol,baseUrl:"/",encodedState:"",mayGoBack:!0,replaceState:!1,routes:[],init:function(t,s){n.parent.init.call(this,t),s||(s=window);var r=s.location,o=this.useHash&&e(r)||i(r,this.baseUrl);this.set("currentPath",o),this.restoreStateFromUrl(o),s.addEventListener(this.useHash?"hashchange":"popstate",this,!1),this._win=s},setTitle:function(){document.title=this.get("title")}.observes("title"),handleEvent:function(){var t=this._win.location,n=this.useHash?e(t):i(t,this.baseUrl);this.get("mayGoBack")&&n!==this.get("currentPath")&&(this.set("currentPath",n),this.restoreStateFromUrl(n))}.invokeInRunLoop(),restoreStateFromUrl:function(t){var e,i,n,s,r=this.get("routes");for(e=0,i=r.length;e<i;e+=1)if(s=(n=r[e]).url.exec(t)){this.beginPropertyChanges(),n.handle.apply(this,s),this.endPropertyChanges();break}return this},encodeStateToUrl:function(){var t,e,i,n,s,r,o=this.get("encodedState"),a=this.get("replaceState"),h=this._win;if(this.get("currentPath")!==o){if(this.set("currentPath",o),this.useHash)t=h.location,a?((n=(i=t.href).indexOf("#"))>-1&&(i=i.slice(0,n)),t.replace(i+"#/"+o)):t.hash="#/"+o;else{e=h.history,s=this.get("title"),r=this.getUrlForEncodedState(o);try{a?e.replaceState(null,s,r):e.pushState(null,s,r)}catch(t){}}a&&this.set("replaceState",!1)}}.queue("after").observes("encodedState"),getUrlForEncodedState:function(t){return this.get("baseUrl")+t}});t.Router=n}(O),function(t){var e=t.Class({Extends:t.Object,init:function(t){this._images={all:{}},this._styles={all:{}},this._activeStylesheets={},this.theme="",e.parent.init.call(this,t)},changeTheme:function(t,e){var i,n=this._activeStylesheets;for(i in n)n[i]&&(this.addStylesheet(i,e),this.removeStylesheet(i,t))},imageDidLoad:function(t,e,i){return(this._images[t]||(this._images[t]={}))[e]=i,this},stylesheetDidLoad:function(t,e,i){return(this._styles[t]||(this._styles[t]={}))[e]=i,this},addStylesheet:function(e,i){i||(i=this.get("theme"));var n=this._styles[i][e]||this._styles.all[e],s=this._images[i]||{},r=this._images.all,o=this._activeStylesheets;return n&&(n=n.replace(/url\(([^)]+)\)/g,function(e,i){return"url("+(s[i]||r[i]||t.loc(i)||i)+")"}),t.Stylesheet.create(i+"-"+e,n),o[e]=(o[e]||0)+1),this},removeStylesheet:function(t,e){e||(e=this.get("theme"));var i=document.getElementById(e+"-"+t);return i&&(i.parentNode.removeChild(i),this._activeStylesheets[t]-=1),this},getImageSrc:function(t){var e=this._images,i=e[this.get("theme")]||{},n=e.all;return i[t]||n[t]||null}});t.ThemeManager=e}(O),function(t,e,i,n){var s=t.Class({Extends:t.Object,broadcastKey:"owm:broadcast",init:function(n){this.id=(new Date).format("%y%m%d%H%M%S")+Math.random(),this.isMaster=!1,this.isFocussed=8===t.UA.msie||!i.hasFocus||i.hasFocus(),this._seenWCs={},s.parent.init.call(this,n),e.addEventListener("storage",this,!1),e.addEventListener("unload",this,!1),e.addEventListener("focus",this,!1),e.addEventListener("blur",this,!1),this.broadcast("wc:hello");var r=t.RunLoop,o=this;this._checkTimeout=r.invokeAfterDelay(function t(){o.checkMaster(),o._checkTimeout=r.invokeAfterDelay(t,9e3)},500),this._pingTimeout=r.invokeAfterDelay(function t(){o.sendPing(),o._pingTimeout=r.invokeAfterDelay(t,17e3)},17e3)},destroy:function(){t.RunLoop.cancel(this._pingTimeout).cancel(this._checkTimeout),e.removeEventListener("storage",this,!1),e.removeEventListener("unload",this,!1),e.removeEventListener("focus",this,!1),e.removeEventListener("blur",this,!1),this.broadcast("wc:bye"),s.parent.destroy.call(this)},handleEvent:function(t){switch(t.type){case"storage":if(t.key===this.get("broadcastKey"))try{var e=JSON.parse(t.newValue);e.wcId!==this.id&&this.fire(e.type,e)}catch(t){}break;case"unload":this.destroy();break;case"focus":this.set("isFocussed",!0);break;case"blur":this.set("isFocussed",!1)}}.invokeInRunLoop(),sendPing:function(){this.broadcast("wc:ping")},_hello:function(t){this._ping(t),t.wcId<this.id?this.checkMaster():this.sendPing()}.on("wc:hello"),_ping:function(t){this._seenWCs[t.wcId]=Date.now()}.on("wc:ping"),_bye:function(t){delete this._seenWCs[t.wcId],this.checkMaster()}.on("wc:bye"),checkMaster:function(){var t,e=Date.now(),i=!0,n=this._seenWCs,s=this.id;for(t in n)n[t]+23e3<e?delete n[t]:t<s&&(i=!1);this.set("isMaster",i)},broadcast:function(e,i){try{n.setItem(this.get("broadcastKey"),JSON.stringify(t.extend({wcId:this.id,type:e},i)))}catch(t){}}}).extend({openExternal:function(i){var n=e.open("","_blank"),s=i;if(n){t.UA.msie&&i.indexOf(";")>-1&&(s="'"+s.replace(/'/g,"%27")+"'"),s=s.escapeHTML().replace(/"/g,"&quot;");try{n.opener=null,n.document.write('<META HTTP-EQUIV="refresh" content="0; url='+s+'">'),n.document.close()}catch(t){(n.location||e.location).href=i}}return n}});t.WindowController=s}(O,window,document,localStorage),O.Status={EMPTY:1,READY:2,DESTROYED:4,NON_EXISTENT:8,LOADING:16,COMMITTING:32,NEW:64,DIRTY:128,OBSOLETE:256},function(t){var e=t.Status,i=e.READY,n=e.DESTROYED,s=function(t,e){return t-e},r=t.Class({Extends:t.Object,Mixin:[t.ObservableRange,t.Enumerable],id:function(){return t.guid(this)}.property().nocache(),init:function(e){var n,s=e.Type,o=e.sort,a=e.store||this.store;!o||o instanceof Function||(o=e.sort=t.sortByProperties(o)),n=a.findAll(s,e.filter,o),this._storeKeys=n,this._sort=n.sortFn,this._filter=n.filterFn,this.status=a.getTypeStatus(s)&i,this.length=n.length,r.parent.init.call(this,e),a.addQuery(this)},destroy:function(){this.set("status",n),this.get("store").removeQuery(this),r.parent.destroy.call(this)},is:function(t){return!!(this.get("status")&t)},"[]":function(){var t=this.get("store"),e=this.get("Type");return this._storeKeys.map(function(i){return t.materialiseRecord(i,e)})}.property().nocache(),indexOfStoreKey:function(t,e,i){var n=this._storeKeys.indexOf(t,e);return i&&i(n),n},getObjectAt:function(t){var e,i=this._storeKeys[t];return i&&(e=this.get("store").materialiseRecord(i,this.get("Type"))),e},refresh:function(t){return this.get("store").fetchAll(this.get("Type"),t),this},reset:function(){var t=this._storeKeys,e=this.get("store").findAll(this.get("Type"),this.filter,this.sort),i=Math.max(e.length,t.length);return this._storeKeys=e,this.beginPropertyChanges().set("length",e.length).rangeDidChange(0,i).endPropertyChanges().fire("query:reset")},storeDidChangeRecords:function(t){var e,n,r,o,a,h,c,l,u,d,f,g,p,v,m,y=this._filter,w=this._sort,_=this._storeKeys,b=[],S=[],D=[],T=[],C=this.get("length"),O=this.get("store");for(n=t.length;n--;)r=t[n],o=_.indexOf(r),a=O.getStatus(r)&i&&(!y||y(r)),o>-1?a?w&&(T.push(o),b.push(r)):T.push(o):a&&b.push(r);if(p=T.length,g=b.length,p)for(T.sort(s),e=0;e<p;e+=1)D[e]=_[T[e]];if(g||p)for(g&&w&&b.sort(w),v=C-p+g,h=new Array(v),e=0,c=0,l=0,u=0;e<v;e+=1){for(;l<p&&c===T[l];)l+=1,c+=1;w&&c<C&&u<g?w(d=_[c],f=b[u])<0?(h[e]=d,c+=1):(h[e]=f,S[u]=e,u+=1):c<C?(h[e]=_[c],c+=1):(h[e]=b[u],S[u]=e,u+=1)}if(g)for(S.sort(s),e=0;e<g;e+=1)b[e]=h[S[e]];for(n=Math.min(g,p);n--;)b[n]===D[n]&&S[n]===T[n]&&(b.splice(n,1),S.splice(n,1),D.splice(n,1),T.splice(n,1),g-=1,p-=1);return!(!g&&!p)&&(this._storeKeys=h,m=Math.max(v,C),this.beginPropertyChanges().set("length",v).rangeDidChange(Math.min(g?S[0]:m,p?T[0]:m),v===C?Math.max(g?S[g-1]:0,p?T[p-1]:0)+1:m).endPropertyChanges().fire("query:updated",{removed:D,removedIndexes:T,added:b,addedIndexes:S}),!0)},getStoreKeysForObjectsInRange:function(t,e,i){return t=Math.max(0,t),e=Math.min(this.get("length"),e),i(this._storeKeys.slice(t,e),t,e),!1},getStoreKeysForAllObjects:function(t){return this.getStoreKeysForObjectsInRange(0,2147483647,t)}});t.LiveQuery=r}(O),function(t){var e=t.Class({Extends:t.Object,Mixin:t.Enumerable,init:function(t,i,n){this.store=t,this.Type=i,this.storeKeys=n,e.parent.init.call(this)},length:function(){return this.get("storeKeys").length}.property("storeKeys"),getObjectAt:function(t){var e,i=this.get("storeKeys")[t];return i&&(e=this.get("store").materialiseRecord(i,this.get("Type"))),e}});t.RecordArray=e}(O),function(t,e){var i=t.Class({Extends:t.Object,init:function(e){i.parent.init.call(this);var n,s,r,o,a,h,c=t.meta(e).attrs,l=t.meta(this),u=l.dependents=t.clone(l.dependents),d=0;for(n in c)if((s=c[n])&&(r=e[s],(this[s]=r.validate?r.validate(e.get(s),s,e):null)&&(d+=1),o=r.validityDependencies))for(a=o.length;a--;)u[h=o[a]]||(u[h]=[],e.addObserverForKey(h,this,"attrDidChange")),u[h].push(s);this.errorCount=d,this._record=e},attrDidChange:function(e,i){var n,s,r=t.meta(this),o=r.changed={},a=r.dependents[i],h=a.length,c=this._record;for(this.beginPropertyChanges();h--;)s=c[n=a[h]],o[n]={oldValue:this[n],newValue:this[n]=s.validate?s.validate(c.get(n),n,c):null};this.endPropertyChanges()},setRecordValidity:function(t,e){var i,n,s,r,o=this.get("errorCount");for(i in e)"errorCount"!==i&&(s=!(n=e[i]).oldValue,r=!n.newValue,s&&!r?o+=1:r&&!s&&(o-=1));this.set("errorCount",o)._record.set("isValid",!o)}.observes("*")}),n=t.Status,s=n.READY|n.NEW|n.DIRTY,r=t.Class({Extends:t.Object,init:function(t,e){this._noSync=!1,this._data=e?null:{},this.store=t,this.storeKey=e,r.parent.init.call(this)},clone:function(e){var i,n,s,o=this.constructor,a=o.prototype,h=new o(e),c=t.meta(this).attrs;for(i in c)a[n=c[i]].noSync||((s=this.get(n))instanceof r&&(s=s.getDoppelganger(e)),void 0!==s&&h.set(n,s));return h},status:function(){var t=this.get("storeKey");return t?this.get("store").getStatus(t):s}.property().nocache(),is:function(t){return!!(this.get("status")&t)},setObsolete:function(){var t=this.get("storeKey"),e=this.get("status");return t&&this.get("store").setStatus(t,e|n.OBSOLETE),this},setLoading:function(){var t=this.get("storeKey"),e=this.get("status");return t&&this.get("store").setStatus(t,e|n.LOADING),this},id:function(){var t=this.get("storeKey");return t?this.get("store").getIdFromStoreKey(t):this.get(this.constructor.primaryKey)}.property(),toJSON:function(){return this.get("storeKey")},toIdOrStoreKey:function(){return this.get("id")||"#"+this.get("storeKey")},saveToStore:function(){if(this.get("storeKey"))throw new Error("Record already created in store.");var e,i,n,s,r=this.constructor,o=this._data,a=this.get("store"),h=r.primaryKey||"id",c=this[h].key||h,l=a.getStoreKey(r,o[c]),u=t.meta(this).attrs;for(e in this._data=null,u)(i=u[e])&&(n=this[i],e in o||void 0===(s=n.defaultValue)||n.noSync||(o[e]=s&&s.toJSON?s.toJSON():t.clone(s)),n.willCreateInStore&&n.willCreateInStore(this,i,l));return a.createRecord(l,o).setRecordForStoreKey(l,this).fire("record:user:create",{record:this}),this.set("storeKey",l)},discardChanges:function(){if(this.get("status")===s)this.destroy();else{var t=this.get("storeKey");t&&this.get("store").revertData(t)}return this},refresh:function(){var t=this.get("storeKey");return t&&this.get("store").fetchData(t),this},destroy:function(){var t=this.get("storeKey");t&&this.get("isEditable")&&this.get("store").fire("record:user:destroy",{record:this}).destroyRecord(t)},getDoppelganger:function(t){return this.get("store")===t?this:t.materialiseRecord(this.get("storeKey"),this.constructor)},storeWillUnload:function(){r.parent.destroy.call(this)},stopSync:function(){return this._noSync=!0,this},startSync:function(){return this._noSync=!1,this},isEditable:!0,isValid:function(t){return void 0!==t?t:!this.get("errorForAttribute").get("errorCount")}.property(),errorToSet:function(t,e){var i=this[t];return i.validate?i.validate(e,t,this):null},errorForAttribute:function(){return new i(this)}.property()}).extend({getClientSettableAttributes:function(e){var i,n,s,r,o=e.clientSettableAttributes;if(!o){for(s in i=e.prototype,o={},n=t.meta(i).attrs)(r=n[s])&&(i[r].noSync||(o[s]=!0));e.clientSettableAttributes=o}return o}});t.Record=r}(O),function(t,e){var i=t.Status,n=i.EMPTY,s=i.READY,r=i.DESTROYED,o=i.NON_EXISTENT,a=i.LOADING,h=i.OBSOLETE,c=t.Class({Extends:t.Object,Mixin:[t.Enumerable,t.ObservableRange],id:function(){return t.guid(this)}.property().nocache(),sort:"",filter:"",Type:t.Record,is:function(t){return!!(this.get("status")&t)},setObsolete:function(){return this.set("status",this.get("status")|h)},setLoading:function(){return this.set("status",this.get("status")|a)},init:function(t){this._list=[],this._awaitingIdFetch=[],this._refresh=!1,this.state="",this.status=n,this.length=null,c.parent.init.call(this,t),this.get("store").addQuery(this)},destroy:function(){this.set("status",this.is(n)?o:r),this.get("store").removeQuery(this),c.parent.destroy.call(this)},refresh:function(t,e){var i=this.get("status");return t||i===n||i&h?(i&s&&(this._refresh=!0),this.get("source").fetchQuery(this,e)):e&&e(),this},reset:function(t,e){var i=this.get("length");return this._list.length=0,this._refresh=!1,this.set("state","").set("status",n).set("length",null).rangeDidChange(0,i),e&&this.get("source").fetchQuery(this),this.fire("query:reset")}.observes("sort","filter"),getObjectAt:function(t,e){var i,n=this.get("length");if(!(null===n||t<0||t>=n))return e||(e=this.fetchDataForObjectAt(t)),(i=this._list[t])?this.get("store").getRecord(this.get("Type"),"#"+i,e):null},fetchDataForObjectAt:function(){return!1},indexOfStoreKey:function(t,e,i){var n=this._list.indexOf(t,e);return i&&(null===this.get("length")?this.get("source").fetchQuery(this,function(){i(this._list.indexOf(t,e))}.bind(this)):i(n)),n},getStoreKeysForObjectsInRange:function(t,e,i){var n=this.get("length");return null===n?(this._awaitingIdFetch.push([t,e,i]),this.refresh(),!0):(t<0&&(t=0),e>n&&(e=n),i(this._list.slice(t,e),t,e),!1)},getStoreKeysForAllObjects:function(t){return this.getStoreKeysForObjectsInRange(0,2147483647,t)},_adjustIdFetches:function(t){var e,i,n,s,r,o,a,h,c=t.addedIndexes,l=t.removedIndexes,u=this._awaitingIdFetch;for(e=0,i=u.length;e<i;e+=1){for(s=(n=u[e])[0],r=n[1],o=0,a=l.length;o<a;o+=1)(h=l[o])<s&&(s-=1),h<r&&(r-=1);for(o=0,a=c.length;o<a;o+=1)(h=c[o])<=s&&(s+=1),h<r&&(r+=1);n[0]=s,n[1]=r}}.on("query:updated"),_idsWereFetched:function(){var t=this._awaitingIdFetch;t.length&&(t.forEach(function(t){this.getStoreKeysForObjectsInRange(t[0],t[1],t[2])},this),t.length=0)}.queue("before").on("query:idsLoaded"),sourceWillFetchQuery:function(){var t=this._refresh;return this._refresh=!1,this.set("status",(this.get("status")|a)&~h),t},sourceDidFetchQuery:function(t){if(this.get("sort")===t.sort&&this.get("filter")===t.filter){this.set("state",t.state);var e,i=this.get("store"),n=i.getStoreKey.bind(i,this.get("Type")),r=this._list,o=this._list=t.idList.map(n),a=this.get("length"),c=o.length,l=[],u=[],d=[],f=[],g=0,p=c-1,v=(a||0)-1,m=Math.min(c,a||0);if(null!==a){for(;g<m&&o[g]===r[g];)g+=1;for(;p>=0&&v>=0&&o[p]===r[v];)p-=1,v-=1;for(e=g;e<=v;e+=1)l.push(e),u.push(r[e]);for(e=g;e<=p;e+=1)d.push(e),f.push(o[e])}return p=c===a?p+1:Math.max(a||0,c),this.beginPropertyChanges().set("status",s|(this.is(h)?h:0)).set("length",c),g<p&&this.rangeDidChange(g,p),this.endPropertyChanges(),null!==a&&g<p&&this.fire("query:updated",{removed:u,removedIndexes:l,added:f,addedIndexes:d}),this.fire("query:idsLoaded")}}});t.RemoteQuery=c}(O),function(t,e){var i,n=t.Status,s=n.EMPTY,r=n.READY,o=n.DIRTY,a=n.LOADING,h=n.OBSOLETE,c=function(t,e){var i=t.map(function(t,i){return[t,e[i]]});i.sort(function(t,e){return t[0]-e[0]}),i.forEach(function(i,n){t[n]=i[0],e[n]=i[1]})},l=function(t,e,i,n,s){var r,o,a,h,c,l,u=[],d=[];for(r=0,o=t.length;r<o;r+=1)if((a=t[r])!==e[h=e.binarySearch(a)]){for(a-=h,c=0,l=i.length;c<l&&a>=i[c];c+=1)a+=1;u.push(a),d.push(n[r])}return function(t,e,i,n){for(var s=[],r=[],o=0,a=0,h=t.length,c=e.length;o<h||a<c;)a>=c||o<h&&t[o]<e[a]?(s.push(t[o]),r.push(i[o]),o+=1):(s.push(e[a]),r.push(n[a]),a+=1);return[s,r]}(i,u,s,d)},u=function(t,e){var i=l(e.removedIndexes,t.addedIndexes,t.removedIndexes,e.removedStoreKeys,t.removedStoreKeys),n=l(t.addedIndexes,e.removedIndexes,e.addedIndexes,t.addedStoreKeys,e.addedStoreKeys);return{removedIndexes:i[0],removedStoreKeys:i[1],addedIndexes:n[0],addedStoreKeys:n[1],truncateAtFirstGap:t.truncateAtFirstGap||e.truncateAtFirstGap,total:e.total,upto:e.upto}},d=function(t){var e=t.removedIndexes;return t.removedIndexes=t.addedIndexes,t.addedIndexes=e,e=t.removedStoreKeys,t.removedStoreKeys=t.addedStoreKeys,t.addedStoreKeys=e,t.total=t.total+t.addedStoreKeys.length-t.removedStoreKeys.length,t},f=function(t,e,i,n){for(var s,r,o,a,h,c=t*e,l=i*e,u=n.length;u--&&(r=(s=n[u]).start||0,"end"in s)&&(o=s.end,!((a=c)<(h=r-l)?h<c+e:a<o+l)););return-1!==u},g=t.Class({Extends:t.RemoteQuery,windowSize:30,windowCount:function(){var t=this.get("length");return null===t?t:Math.floor((t-1)/this.get("windowSize"))+1}.property("length"),triggerPoint:10,optimiseFetching:!1,prefetch:1,canGetDeltaUpdates:!0,allIdsAreLoaded:function(){var t=this.get("windowCount"),e=this._windows;if(null===t)return!1;for(;t--&&4&e[t];);return t<0}.property().nocache(),init:function(t){this._windows=[],this._indexOfRequested=[],this._waitingPackets=[],this._preemptiveUpdates=[],this._isAnExplicitIdFetch=!1,g.parent.init.call(this,t)},reset:function(t,e){this._windows.length=this._indexOfRequested.length=this._waitingPackets.length=this._preemptiveUpdates.length=0,this._isAnExplicitIdFetch=!1,g.parent.reset.call(this,t,e)}.observes("sort","filter"),_toStoreKey:function(){var t=this.get("store"),e=this.get("Type"),i={};return function(n){return i[n]||(i[n]=t.getStoreKey(e,n))}}.property(),indexOfStoreKey:function(t,e,i){var n,s=this._list.indexOf(t,e);if(i)if(s<0){if(this.get("allIdsAreLoaded"))return i(s),s;n=this.get("store").getIdFromStoreKey(t),this._indexOfRequested.push([n,function(){i(this._list.indexOf(t,e))}.bind(this)]),this.get("source").fetchQuery(this)}else i(s);return s},getStoreKeysForObjectsInRange:function(t,e,i){var n,s,r,o,a=this.get("length"),h=!0;if(null!==a)for(t<0&&(t=0),e>a&&(e=a),n=this._windows,s=this.get("windowSize"),r=Math.floor(t/s),o=Math.floor((e-1)/s)+1;r<o;r+=1)4&n[r]||(h=!1,this._isAnExplicitIdFetch=!0,this.fetchWindow(r,!1,0));else h=!1;return h?i(this._list.slice(t,e),t,e):this._awaitingIdFetch.push([t,e,i]),!h},fetchDataForObjectAt:function(t){var e=this.get("windowSize"),i=this.get("triggerPoint"),n=Math.floor(t/e),s=t%e;return this.fetchWindow(n,!0),s<i&&this.fetchWindow(n-1,!0),s+i>=e&&this.fetchWindow(n+1,!0),!0},fetchWindow:function(t,e,i){var n,s,r=this.get("status"),o=this._windows,a=!1;for(r&h&&this.refresh(),void 0===i&&(i=this.get("prefetch")),n=Math.max(0,t-i),s=Math.min(t+i+1,this.get("windowCount")||0);n<s;n+=1)0===(r=o[n]||0)&&(r=1,a=!0),n===t&&e&&r<8&&(4&r&&this.checkIfWindowIsFetched(n)?r=36:(r|=8,a=!0)),o[n]=r;return a&&this.get("source").fetchQuery(this),this},checkIfWindowIsFetched:function(t){for(var e=this.get("store"),i=this.get("windowSize"),n=this._list,r=t*i,o=Math.min(r+i,this.get("length"));r<o;r+=1)if(e.getStatus(n[r])&(s|h))return!1;return!0},recalculateFetchedWindows:function(t,e){t||(t=0),void 0===e&&(e=this.get("length"));var i,n,s=this.get("windowSize"),r=this._windows,o=this._list,a=Math.floor((e-1)/s),h=e-1;for(t=Math.floor(t/s),r.length=a+1;a>=t;){for(i=a*s,n=-33&(r[a]||0),n|=4;h>=i;){if(!o[h]){n&=-5;break}h-=1}r[a]=n,h=i-1,a-=1}return this},_normaliseUpdate:function(t){var e,i,n,s,r,o,a=this._list,h=t.removed||[],l=function(t,e){var i,n,s,r={},o=[],a=t.length,h=e.length;if(h<1+~~Math.log(a))for(s=0;s<h;s+=1)o.push(t.indexOf(e[s]));else{for(s=0;s<a;s+=1)(i=t[s])&&(r[i]=s);for(s=0;s<h;s+=1)n=r[e[s]],o.push(void 0===n?-1:n)}return o}(a,h),u=[],d=[],f=t.added||[];for(c(l,h),e=0;-1===l[e];e+=1);for(e&&(l=l.slice(e),h=h.slice(e)),t.truncateAtFirstGap=!!e,t.removedIndexes=l,t.removedStoreKeys=h,e=0,n=f.length;e<n;e+=1)r=(s=f[e])[0],o=s[1],(i=h.indexOf(o))>-1&&l[i]-i+d.length===r?(l.splice(i,1),h.splice(i,1)):(d.push(r),u.push(o));return t.addedIndexes=d,t.addedStoreKeys=u,"total"in t||(t.total=this.get("length")-l.length+d.length),t},_applyUpdate:function(t){var e,i,n,s,r,o=t.removedIndexes,a=t.removedStoreKeys,h=a.length,c=t.addedIndexes,l=t.addedStoreKeys,u=l.length,d=this._list,f=!(!u&&!h),g=this.get("length"),p=t.total,v=g;for(i=h;i--;)n=o[i],d.splice(n,1),n<v&&(v=n);if(t.truncateAtFirstGap){for(e=0;d[e];)e+=1;d.length=e,e<v&&(v=e)}for(r=d.length,e=0,i=u;e<i;e+=1)n=c[e],s=l[e],n>=r?(d[n]=s,r=n+1):(d.splice(n,0,s),r+=1),n<v&&(v=n);if(t.upto){if(!(i=d.lastIndexOf(t.upto)+1))return this.reset();i!==r&&(f=!0,d.length=i)}return f&&this.recalculateFetchedWindows(v,p),this.set("length",p).rangeDidChange(v,Math.max(g,p)),this.fire("query:updated",{removed:a,removedIndexes:o,added:l,addedIndexes:c}),this._applyWaitingPackets(),this},_applyWaitingPackets:function(){for(var t,e=!1,i=this._waitingPackets,n=i.length,s=this.get("state");n--;)(t=i.shift()).state!==s?e=!0:this.sourceDidFetchIdList(t);e&&this._fetchObservedWindows()},_fetchObservedWindows:function(){var e,i,n,s,r,o,a=t.meta(this).rangeObservers,h=this.get("length"),c=this.get("windowSize");if(a)for(o=a.length;o--;){e=(r=a[o].range).start||0,i="end"in r?r.end:h,e<0&&(e+=h),i<0&&(i+=h),n=Math.floor(e/c),s=Math.floor((i-1)/c);for(;n<=s;n+=1)this.fetchWindow(n,!0)}},clientDidGenerateUpdate:function(t){return this._normaliseUpdate(t),t.truncateAtFirstGap=!1,this._applyUpdate(t),this._preemptiveUpdates.push(t),this.set("status",this.get("status")|o),this.refresh(!0),this},sourceDidFetchUpdate:(i=function(t,e){var i=t.length;if(e.length!==i)return!1;for(;i--;)if(t[i]!==e[i])return!1;return!0},function(e){var n,s,r,h,l,f,g=this.get("state"),p=this.get("status"),v=this._preemptiveUpdates,m=v.length;if(this.set("status",p&~a),g===e.newState)return!m||p&o||(s=v.reduce(u),this._applyUpdate(d(s)),v.length=0),this;if(g!==e.oldState)return this.setObsolete();if(!t.isEqual(e.sort,this.get("sort"))||!t.isEqual(e.filter,this.get("filter")))return this;if(this.set("state",e.newState),this.get("store"),n=this.get("_toStoreKey"),e.removed=e.removed.map(n),e.added.forEach(function(t){t[1]=n(t[1])}),e.upto=e.upto&&n(e.upto),m){for(r=[v[0]],h=1;h<m;h+=1)r[h]=u(r[h-1],v[h]);var y,w,_,b,S=this._normaliseUpdate({added:e.added,total:e.total,upto:e.upto}),D=e.removed,T=[],C=[],O=[],x=[],k=this._list,E=!1;for(s=r[m-1],h=0,m=D.length;h<m;h+=1)_=D[h],(b=s.removedStoreKeys.indexOf(_))>-1?(O.push(s.removedIndexes[b]),x.push(_)):(b=k.indexOf(_))>-1?(T.push(b),C.push(_)):S.truncateAtFirstGap=!0;if(T.length){var R,V=u(s,{removedIndexes:T,removedStoreKeys:C,addedIndexes:[],addedStoreKeys:[]});for(T=C.map(function(t){return V.removedIndexes[V.removedStoreKeys.indexOf(t)]}),R=O.length,h=0,m=T.length;h<m;h+=1)O[R]=T[h],x[R]=C[h],R+=1}for(c(O,x),S.removedIndexes=O,S.removedStoreKeys=x,y=S.addedIndexes,w=S.addedStoreKeys,m=y.length;m--;)_=w[m],(h=x.indexOf(_))>-1&&O[h]-h+m===y[m]&&(O.splice(h,1),x.splice(h,1),y.splice(m,1),w.splice(m,1));if(!S.truncateAtFirstGap)if(x.length||w.length){for(m=r.length;m--;)if(l=S,f=r[m],l.total===f.total&&i(l.addedIndexes,f.addedIndexes)&&i(l.addedStoreKeys,f.addedStoreKeys)&&i(l.removedIndexes,f.removedIndexes)&&i(l.removedStoreKeys,f.removedStoreKeys)){v.splice(0,m+1),E=!0;break}}else E=!0;E?p&o||!v.length?this._applyWaitingPackets():(s=v.reduce(u),this._applyUpdate(d(s)),v.length=0):(v.length=0,this._applyUpdate(u(d(s),S)))}else this._applyUpdate(this._normaliseUpdate(e));return this}),sourceDidFetchIdList:function(e){if(!t.isEqual(e.sort,this.get("sort"))||!t.isEqual(e.filter,this.get("filter")))return this;var i,n,o,a,h,c,l,f,g=this.get("state"),p=this.get("status"),v=this.get("length")||0,m=this.get("canGetDeltaUpdates"),y=e.position,w=e.total,_=e.idList,b=_.length,S=this._list,D=this._windows,T=this._preemptiveUpdates,C=!1,O=!0;if(g&&g!==e.state){if(m)return this._waitingPackets.push(e),this.setObsolete().refresh();S.length=D.length=T.length=0,C=!0}if(this.set("state",e.state),n=this.get("_toStoreKey"),i=_.map(n),T.length){var x,k=T.reduce(u),E=k.addedIndexes,R=k.addedStoreKeys,V=k.removedIndexes;if(m){for(h=V.length;h--;)(x=V[h]-y)<b&&(x>=0?(i.splice(x,1),b-=1):y-=1);for(a=0,h=E.length;a<h;a+=1)if((x=E[a]-y)<=0)y+=1;else{if(!(x<b))break;i.splice(x,0,R[a]),b+=1}w=k.total}else this._applyUpdate(d(k)),T.length=0}for(o=y+b,a=0;a<b;a+=1)S[y+a]=i[a];if(c=this.get("windowSize"),l=Math.floor(y/c),f=y%c){for(h=(a=l*c)+f;a<h;a+=1)if(!S[a]){O=!1;break}O?b+=f:(l+=1,b-=c-f)}for(;(b-=c)>=0;)D[l]|=4,l+=1;return(b+=c)&&o===w&&b===w%c&&(D[l]|=4),this.beginPropertyChanges().set("length",w).set("status",p&s?r:p).endPropertyChanges().rangeDidChange(C?0:y,C?Math.max(v,o):o).fire("query:idsLoaded")},sourceWillFetchQuery:function(){var e,i,n,r,c,l,u,d=this.get("windowSize"),g=this._windows,p=this._isAnExplicitIdFetch,v=this._indexOfRequested,m=this._refresh,y=[],w=[],_=this.get("optimiseFetching"),b=(t.meta(this).rangeObservers||[]).map(function(t){return t.range}),S=m&&!this.get("canGetDeltaUpdates"),D=this.get("prefetch");for(this._isAnExplicitIdFetch=!1,this._indexOfRequested=[],this._refresh=!1,e=0,i=g.length;e<i;e+=1)9&(n=g[e])?(r=!_||f(e,d,D,b),8&n&&(n&=-9,r&&(u=e*d,c&&c.start+c.count===u?c.count+=d:y.push(c={start:u,count:d}),n|=2,n|=16),r||!p?n&=-2:n|=1),1&n&&((r||p)&&(u=e*d,l&&l.start+l.count===u?l.count+=d:w.push(l={start:u,count:d}),n|=2),n&=-2)):S&&(r=f(e,d,D,b))&&(u=e*d,l&&l.start+l.count===u?l.count+=d:w.push(l={start:u,count:d})),g[e]=n;return(m||this.is(s))&&this.set("status",(this.get("status")|a)&~(h|o)),{ids:w,records:y,indexOf:v,refresh:m,callback:function(){this._windows=this._windows.map(function(t){return-19&t}),this.set("status",this.get("status")&~a)}.bind(this)}}});t.WindowedRemoteQuery=g}(O),function(t,e){var i=t.Class({__setupProperty__:function(e,i,n){var s,r=e.attrs;e.hasOwnProperty("attrs")||(r=e.attrs=r?Object.create(r):{}),this.isPrimaryKey&&(n.constructor.primaryKey=i,s=e.dependents,e.hasOwnProperty("dependents")||(s=e.dependents=t.clone(s),e.allDependents={}),(s[i]||(s[i]=[])).push("id")),r[this.key||i]=i,n.constructor.clientSettableAttributes=null},__teardownProperty__:function(t,e){t.attrs[this.key||e]=null,object.constructor.clientSettableAttributes=null},init:function(e){t.extend(this,e)},isProperty:!0,isVolatile:!1,isSilent:!0,noSync:!1,Type:null,isNullable:!0,key:null,isPrimaryKey:!1,willSet:function(t,e,i){if(!i.get("isEditable"))return!1;if(null===t){if(!this.isNullable)return!1}else if(this.Type&&!function(t,e){switch(typeof t){case"string":return e===String;case"boolean":return e===Boolean;case"number":return e===Number}return t instanceof e}(t,this.Type))throw new Error("Incorrect value type for record attribute: \nkey: "+e+"\nvalue: "+t);return!0},defaultValue:void 0,validate:null,validityDependencies:null,call:function(e,i,n){var s,r,o,a,h,c=e.get("store"),l=e.get("storeKey"),u=l?c.getData(l):e._data;if(u){if(o=u[s=this.key||n],void 0!==i&&this.willSet(i,n,e))return r=i&&i.toJSON?i.toJSON():i,t.isEqual(r,o)||(l?((a={})[s]=r,c.updateData(l,a,!(this.noSync||e._noSync)),c.fire("record:user:update",{record:this})):(u[s]=r,e.computedPropertyDidChange(n),this.validate&&e.get("errorForAttribute").set(n,this.validate(i,n,e)))),i;h=this.Type}return void 0!==o?null!==o&&h&&h.fromJSON?h.fromJSON(o):o:this.defaultValue}});t.RecordAttribute=i,t.Record.attr=function(t,e){return e||(e={}),t&&!e.Type&&(e.Type=t),new i(e)}}(O),function(t){var e=Array.prototype.slice,i=t.Class({Extends:t.ObservableArray,init:function(t,e,n,s){this.record=t,this.propKey=e,this.Type=s,this.store=t.get("store"),this._updatingStore=!1,i.parent.init.call(this,n&&n.slice()),t.addObserverForKey(e,this,"updateListFromRecord")},destroy:function(){this.get("record").removeObserverForKey(this.get("propKey"),this,"updateListFromRecord"),i.parent.destroy.call(this)},toJSON:function(){return this._array.slice()},updateListFromRecord:function(){if(!this._updatingStore){var t=this.get("record"),e=this.get("propKey"),i=t[e].getRaw(t,e);this.set("[]",i?i.slice():[])}},getObjectAt:function(t){var e=i.parent.getObjectAt.call(this,t);return e?this.get("store").getRecord(this.get("Type"),"#"+e):null},setObjectAt:function(t,e){return this.replaceObjectsAt(t,1,[e]),this},replaceObjectsAt:function(t,n,s){s=s?e.call(s):[];var r=this.get("record"),o=this.get("propKey"),a=this.get("Type"),h=this.get("store"),c=i.parent.replaceObjectsAt.call(this,t,n,s.map(function(t){return t.get("storeKey")})).map(function(t){return h.getRecord(a,"#"+t)});return this._updatingStore=!0,r[o].setRaw(r,o,this._array.slice()),this._updatingStore=!1,c},add:function(t){return-1===this._array.indexOf(t.get("storeKey"))&&this.replaceObjectsAt(this.get("length"),0,[t]),this},remove:function(t){var e=this._array.indexOf(t.get("storeKey"));return e>-1&&this.replaceObjectsAt(e,1),this}}),n=t.Class({Extends:t.RecordAttribute,Type:Array,recordType:null,call:function(t,e,s){var r="_"+s+"RecordArray";return t[r]||(t[r]=new i(t,s,n.parent.call.call(this,t,void 0,s),this.recordType))},getRaw:function(t,e){return n.parent.call.call(this,t,void 0,e)},setRaw:function(t,e,i){return n.parent.call.call(this,t,i,e)}});t.ToManyAttribute=n,t.Record.toMany=function(t){return new n(t)}}(O),function(t,e){var i=t.Class({Extends:t.RecordAttribute,willSet:function(t,e,n){if(i.parent.willSet.call(this,t,e,n)){if(t&&!t.get("storeKey"))throw new Error("O.ToOneAttribute: Cannot set connection to record not saved to store.");return!0}return!1},call:function(t,e,n){var s=i.parent.call.call(this,t,e,n);return s&&"string"==typeof s&&(s=t.get("store").getRecord(this.Type,"#"+s)),s||null}});t.ToOneAttribute=i,t.Record.toOne=function(t){return new i(t)}}(O),function(t){var e=function(t,e){this.type=t,this.explanation=e};e.REQUIRED=1,e.TOO_SHORT=2,e.TOO_LONG=4,e.INVALID_CHAR=8,e.FIRST_CUSTOM_ERROR=16,t.ValidationError=e}(O),function(t){var e=t.Class({Extends:t.Object,fetchRecord:function(){return!1},fetchAllRecords:function(){return!1},refreshRecord:function(t,e,i){return this.fetchRecord(t,e,i)},fetchQuery:function(){return!1},commitChanges:function(){return!1}});t.Source=e}(O),function(t){var e=t.Class({Extends:t.Source,init:function(t){this.sources=[],e.parent.init.call(this,t)},addSource:function(t){return t.set("store",this.get("store")),this.get("sources").push(t),this},removeSource:function(t){return this.get("sources").erase(t),this},storeWasSet:function(){var t=this.get("store");this.sources.forEach(function(e){e.set("store",t)})}.observes("store"),fetchRecord:function(t,e,i){return this.get("sources").some(function(n){return n.fetchRecord(t,e,i)})},fetchAllRecords:function(t,e,i){return this.get("sources").some(function(n){return n.fetchAllRecords(t,e,i)})},refreshRecord:function(t,e,i){return this.get("sources").some(function(n){return n.refreshRecord(t,e,i)})},commitChanges:function(t,e){var i,n=0;return e&&(i=function(){(n-=1)||e()}),this.get("sources").forEach(function(e){e.commitChanges(t,i)&&(n+=1)}),this},fetchQuery:function(t,e){return this.get("sources").some(function(i){return i.fetchQuery(t,e)})}});t.AggregateSource=e}(O),function(t){var e=function(t,e){var i,n,s,r=t.records,o=t.changes,a=r.length,h=new Array(a);for(i=0;i<a;i+=1)n=r[i],(s=Object.filter(n,o[i]))[e]=n[e],h[i]=s;return h},i={precedence:"commitPrecedence",fetch:"recordFetchers",refresh:"recordRefreshers",commit:"recordCommitters",create:"recordCreators",update:"recordUpdaters",destroy:"recordDestroyers",query:"queryFetchers"},n=t.Class({Extends:t.Source,init:function(t){this._sendQueue=[],this._callbackQueue=[],this._recordsToFetch={},this._recordsToRefresh={},this._queriesToFetch={},this._inFlightRemoteCalls=null,this._inFlightCallbacks=null,this.inFlightRequest=null,n.parent.init.call(this,t)},url:"/",willRetry:!0,timeout:3e4,inFlightRequest:null,ioDidSucceed:function(t){var e;try{e=JSON.parse(t.data)}catch(t){}if(!(e instanceof Array))return this.ioDidFail(t);this.receive(e,this._inFlightCallbacks,this._inFlightRemoteCalls),this._inFlightRemoteCalls=this._inFlightCallbacks=null}.on("io:success"),ioDidFail:function(){this.get("willRetry")||(this.receive([],this._inFlightCallbacks,this._inFlightRemoteCalls),this._inFlightRemoteCalls=this._inFlightCallbacks=null)}.on("io:failure","io:abort"),ioDidEnd:function(t){this.set("inFlightRequest",null).send(),t.target.destroy()}.on("io:end"),callMethod:function(t,e,i){var n=this._sendQueue.length+"";return this._sendQueue.push([t,e||{},n]),i&&this._callbackQueue.push([n,i]),this.send(),this},send:function(){if(!this.get("inFlightRequest")){var e,i=this._inFlightRemoteCalls;if(!this._inFlightRemoteCalls){if(!(i=(e=this.makeRequest())[0]).length)return;this._inFlightRemoteCalls=i,this._inFlightCallbacks=e[1]}this.set("inFlightRequest",new t.HttpRequest({nextEventTarget:this,timeout:this.get("timeout"),method:"POST",url:this.get("url"),contentType:"application/json",data:JSON.stringify(i)}).send())}}.queue("after"),receive:function(e,i,n){var s,r,o,a,h,c,l,u,d=this.response;for(s=0,r=e.length;s<r;s+=1)if(a=d[(o=e[s])[0]]){u=n[+(c=o[2])];try{a.call(this,o[1],u[0],u[1])}catch(e){t.RunLoop.didError(e)}}if(r=i.length)for(n.length,s=0;s<r;s+=1)h=i[s],c=h[0],l=h[1],c&&(u=n[+c],o=e.filter(function(t){return t[2]===c}),l=l.bind(null,o,u)),t.RunLoop.queueFn("middle",l)},makeRequest:function(){var e,i,n,s,r=this._sendQueue,o=this._callbackQueue,a=this._recordsToFetch,h=this._recordsToRefresh,c=this._queriesToFetch;for(i in c)n=c[i],(s=this.queryFetchers[t.guid(n.constructor)])&&s.call(this,n);for(e in h)this.recordRefreshers[e].call(this,Object.keys(h[e]));for(e in a)this.recordFetchers[e].call(this,Object.keys(a[e]));return this._sendQueue=[],this._callbackQueue=[],this._recordsToFetch={},this._recordsToRefresh={},this._queriesToFetch={},[r,o]},fetchRecord:function(t,e,i){return this.fetchRecords(t,[e],i)},fetchAllRecords:function(t,e,i){return e?this.refreshRecords(t,null,e,i):this.fetchRecords(t,null,i)},fetchRecords:function(e,i,n){var s=t.guid(e),r=this.recordFetchers[s];if(!r)return!1;if("string"==typeof r)this.callMethod(r);else if(i instanceof Array)for(var o=this._recordsToFetch,a=o[s]||(o[s]={}),h=i.length;h--;)a[i[h]]=!0;else r.call(this,i);return n&&this._callbackQueue.push(["",n]),this.send(),!0},refreshRecord:function(t,e,i){return this.refreshRecords(t,[e],null,i)},refreshRecords:function(e,i,n,s){var r=t.guid(e),o=this.recordRefreshers[r];if(!o)return this.fetchRecords(e,i,s);if("string"==typeof o)this.callMethod(o,{state:n});else if(i instanceof Array)for(var a=this._recordsToRefresh,h=a[r]||(a[r]={}),c=i.length;c--;)h[i[c]]=!0;else o.call(this,i,n);return s&&this._callbackQueue.push(["",s]),this.send(),!0},commitPrecedence:null,commitChanges:function(t,i){var n,s,r,o,a,h,c,l=Object.keys(t),u=l.length,d=this.commitPrecedence,f=!1;for(d&&l.sort(function(t,e){return(d[e]||-1)-(d[t]||-1)});u--;)o=t[n=l[u]],s=this.recordCommitters[n],r=!1,a=o.create,h=o.update,c=o.destroy,s?("string"==typeof s?this.callMethod(s,{state:o.state,create:Object.zip(a.storeKeys,a.records),update:Object.zip(h.storeKeys,e(h,o.primaryKey)),destroy:Object.zip(c.storeKeys,c.ids)}):s.call(this,o),r=!0):((s=this.recordCreators[n])&&(s.call(this,a.storeKeys,a.records),r=!0),(s=this.recordUpdaters[n])&&(s.call(this,h.storeKeys,h.records,h.changes),r=!0),(s=this.recordDestroyers[n])&&(s.call(this,c.storeKeys,c.ids),r=!0)),r&&delete t[n],f=f||r;return f&&i&&this._callbackQueue.push(["",i]),f},fetchQuery:function(e,i){if(!this.queryFetchers[t.guid(e.constructor)])return!1;var n=e.get("id");return this._queriesToFetch[n]=e,i&&this._callbackQueue.push(["",i]),this.send(),!0},handle:function(e,n){var s,r,o,a,h=t.guid(e);for(s in n)(o=!(r=i[s]))&&(r="response"),a=this[r],this.hasOwnProperty(r)||(this[r]=a=Object.create(a)),a[o?s:h]=n[s];return this},recordFetchers:{},recordRefreshers:{},recordCommitters:{},recordCreators:{},recordUpdaters:{},recordDestroyers:{},queryFetchers:{},didFetch:function(t,e,i){var n=this.get("store");n.sourceDidFetchRecords(t,e.list,e.state,i),e.notFound&&n.sourceCouldNotFindRecords(t,e.notFound)},didFetchUpdates:function(t,e){this.get("store").sourceDidFetchUpdates(t,e.changed,e.removed,e.oldState,e.newState)},didCommit:function(t,e){var i,n=this.get("store");e.created&&n.sourceDidCommitCreate(e.created),(i=e.updated)&&i.length&&n.sourceDidCommitUpdate(i),(i=e.destroyed)&&i.length&&n.sourceDidCommitDestroy(i),(i=e.notCreated)&&i.length&&n.sourceDidNotCreate(i),(i=e.notUpdated)&&i.length&&n.sourceDidNotUpdate(i),(i=e.notDestroyed)&&i.length&&n.sourceDidNotDestroy(i),(i=e.error)&&i.length&&n.sourceDidError(i),e.newState&&n.sourceCommitDidChangeState(t,e.oldState,e.newState)},response:{}});t.RPCSource=n}(O),function(t){var e=t.Status,i=1,n=function(t,e){return t(this._skToData[e],this,e)},s=t.isEqual,r=t.guid,o=t.RunLoop.invoke.bind(t.RunLoop),a={},h=function(e){var i,n,s,o,h,c=r(e),l=a[c];if(!l){for(s in i=e.prototype,l=[],n=t.meta(i).attrs)(h=(o=n[s])&&i[o])instanceof t.ToOneAttribute&&l.push([s,1,h.Type]),h instanceof t.ToManyAttribute&&l.push([s,0,h.recordType]);a[c]=l}return l},c=function(t,e,i){return t.getStoreKey(e,i)},l=function(t,e,i){var n,s,r,o,a,h;for(n=0,s=e.length;n<s;n+=1)o=(r=e[n])[0],a=r[2],o in i&&(h=i[o],i[o]=h&&(1===r[1]?c(t,a,h):h.map(c.bind(null,t,a))))},u=function(t,e){return t.getIdFromStoreKey(e)||"#"+e},d=function(e,i,n){var s,r,o,a,c,l=h(i),d=n;for(s=0,r=l.length;s<r;s+=1)(a=(o=l[s])[0])in n&&(d===n&&(d=t.clone(n)),c=n[a],d[a]=c&&(1===o[1]?u(e,c):c.map(u.bind(null,e))));return d},f=t.Class({Mixin:t.EventTarget,autoCommit:!0,rebaseConflicts:!0,isNested:!1,init:function(e){this._skToRecord={},this._skToData={},this._skToStatus={},this._skToType={},this._typeToSkToId={},this._typeToIdToSk={},this._skToChanged={},this._skToCommitted={},this._skToRollback={},this._skToLastAccess={},this.isCommitting=!1,this._created={},this._destroyed={},this._idToQuery={},this._liveQueries={},this._remoteQueries=[],this._queryTypesNeedRefresh=[],this._nestedStores=[],this._typeToChangedSks={},this._typeToStatus={},this._typeToClientState={},this._typeToServerState={},this._commitCallbacks=[],t.extend(this,e),e.source.set("store",this)},addNested:function(t){return this._nestedStores.push(t),this},removeNested:function(t){return this._nestedStores.erase(t),this},getStoreKey:function(t,e){var n=r(t),s=this._typeToIdToSk[n]||(this._typeToIdToSk[n]={}),o=this._typeToSkToId[n]||(this._typeToSkToId[n]={}),a=e&&s[e];return a||(a="k"+i++,this._skToType[a]=t,o[a]=e,e&&(s[e]=a)),a},getIdFromStoreKey:function(t){var e=this._skToType[t];return e&&(this._typeToSkToId[r(e)]||{})[t]},getTypeFromStoreKey:function(t){return this._skToType[t]||null},setIdForStoreKey:function(t,e){var i=this._skToType[t],n=r(i),s=i.primaryKey||"id",o=i.prototype[s].key||s,a=this._typeToSkToId[n],h=this._typeToIdToSk[n],c=a[t],l={};return e!==c&&(a[t]=e,c&&delete h[c],h[e]=t,2&this.getStatus(t)?(l[o]=e,this.updateData(t,l,!1)):this._skToData[t][o]=e),this},getRecordStatus:function(t,e){var i=this._typeToIdToSk[r(t)];return i?this.getStatus(i[e]):1},getRecord:function(t,e,i){var n,s;if(!t||!e)return null;if("#"===e.charAt(0)){if(n=e.slice(1),this.getTypeFromStoreKey(n)!==t)return null}else n=this.getStoreKey(t,e);return s=this.materialiseRecord(n,t),i||1!==this.getStatus(n)||this.fetchData(n),this._skToLastAccess[n]=Date.now(),s},getOne:function(t,e){var i=this.findOne(t,e);return i?this.materialiseRecord(i,t):null},getAll:function(e,i,n){var s=this.findAll(e,i,n);return new t.RecordArray(this,e,s)},hasChanges:function(){var t;for(t in this._created)return!0;for(t in this._skToChanged)return!0;for(t in this._destroyed)return!0;return!1},commitChanges:function(e){e&&this._commitCallbacks.push(e),t.RunLoop.queueFn("middle",this._commitChanges,this)},_commitChanges:function(){if(!this.isCommitting){this.isCommitting=!0,this.fire("willCommit");var t,e,i,n,s,a,h,c,l,u=this._created,f=this._destroyed,g=this._skToData,p=this._skToStatus,v=this._skToType,m=this._typeToSkToId,y=this._skToChanged,w=this._skToCommitted,_=this._skToRollback,b=this._typeToClientState,S=this._typeToStatus,D={},T={},C={},O=this._commitCallbacks,x={},k=!1,E=function(t){var e,i,n=r(t),s=C[n];return s||(e=t.primaryKey||"id",i=t.prototype[e].key||e,s=C[n]={primaryKey:i,create:{storeKeys:[],records:[]},update:{storeKeys:[],records:[],changes:[]},destroy:{storeKeys:[],ids:[]},state:b[n]},S[n]|=32,x[n]=t,k=!0),s};for(t in u)a=p[t],i=v[t],e=g[t],e=d(this,i,e),(h=E(i).create).storeKeys.push(t),h.records.push(e),this.setStatus(t,-129&a|32);for(t in y)a=p[t],i=v[t],e=g[t],n=y[t],32&a?D[t]=n:(_[t]=w[t],delete w[t],e=d(this,i,e),(c=E(i).update).storeKeys.push(t),c.records.push(e),c.changes.push(n),this.setStatus(t,-129&a|32));for(t in f)a=p[t],i=v[t],s=m[r(i)][t],64&a?T[t]=1:((l=E(i).destroy).storeKeys.push(t),l.ids.push(s),this.setStatus(t,-129&a|32));this._skToChanged=D,this._created={},this._destroyed=T,this._commitCallbacks=[],k?this.source.commitChanges(C,function(){for(var t in O.forEach(o),x)S[t]&=-33,this._checkServerStatus(x[t]);this.isCommitting=!1,this.hasChanges()&&this.autoCommit&&this.commitChanges()}.bind(this)):this.isCommitting=!1,this.fire("didCommit")}},discardChanges:function(){var t,e=this._created,i=this._destroyed,n=this._skToChanged,s=this._skToCommitted;for(t in e)this.destroyRecord(t);for(t in n)this.updateData(t,s[t],!0);for(t in i)this.undestroyRecord(t);return this._created={},this._destroyed={},this},getInverseChanges:function(){var e,i,n=this._created,s=this._destroyed,r=this._skToType,o=this._skToData,a=this._skToChanged,h=this._skToCommitted,c={create:[],update:[],destroy:[]};for(e in n)c.destroy.push(e);for(e in a)i=r[e],c.update.push([e,Object.filter(h[e],a[e])]);for(e in s)i=r[e],c.create.push([e,i,Object.filter(t.clone(o[e]),t.Record.getClientSettableAttributes(i))]);return c},applyChanges:function(t){var e,i,n,s,r,o,a,h=t.create,c=t.update,l=t.destroy;for(n=0,s=h.length;n<s;n+=1)r=(e=h[n])[0],o=e[1],a=e[2],this.undestroyRecord(r,o,a);for(n=0,s=c.length;n<s;n+=1)r=(i=c[n])[0],a=i[1],this.updateData(r,a,!0);for(n=0,s=l.length;n<s;n+=1)r=l[n],this.destroyRecord(r)},getTypeStatus:function(t){return this._typeToStatus[r(t)]||1},getTypeState:function(t){return this._typeToClientState[r(t)]||null},getStatus:function(t){return this._skToStatus[t]||1},setStatus:function(t,e){var i=this.getStatus(t),n=this._skToRecord[t];return i!==e&&(this._skToStatus[t]=e,2&(i^e)&&this._recordDidChange(t),n&&n.propertyDidChange("status",i,e),this._nestedStores.forEach(function(n){n.parentDidChangeStatus(t,i,e)})),this},setRecordForStoreKey:function(t,e){return this._skToRecord[t]=e,this},materialiseRecord:function(t,e){return this._skToRecord[t]||(this._skToRecord[t]=new e(this,t))},mayUnloadRecord:function(t){var e=this._skToRecord[t],i=this.getStatus(t);return!(224&i||2&i&&e&&e.hasObservers())&&this._nestedStores.every(function(e){return e.mayUnloadRecord(t)})},willUnloadRecord:function(t){var e=this._skToRecord[t];return e&&e.storeWillUnload(),this._nestedStores.forEach(function(e){e.willUnloadRecord(t)}),this},unloadRecord:function(t){return!!this.mayUnloadRecord(t)&&(this.willUnloadRecord(t),delete this._skToLastAccess[t],delete this._skToRecord[t],delete this._skToRollback[t],delete this._skToData[t],delete this._skToStatus[t],!0)},createRecord:function(i,n){var s=this.getStatus(i);return 1!==s&&4!==s?(t.RunLoop.didError({name:"O.Store Error: Cannot create existing record",message:"\nStatus: "+(Object.keyOf(e,s)||s)+"\nData: "+JSON.stringify(n)}),this):(this._created[i]=1,this._skToData[i]=n||{},this.setStatus(i,194),this.autoCommit&&this.commitChanges(),this)},destroyRecord:function(t){var e=this.getStatus(t);return 194===e?(delete this._created[t],this.setStatus(t,4),this.unloadRecord(t)):2&e&&(128&e&&(this.setData(t,this._skToCommitted[t]),delete this._skToCommitted[t],delete this._skToChanged[t],this.isNested&&delete this._skToData[t]),this._destroyed[t]=1,this.setStatus(t,132|352&e),this.autoCommit&&this.commitChanges()),this},undestroyRecord:function(t,e,i){var n,s=this.getStatus(t);1===s||4===s?(n=e.primaryKey||"id",delete i[e.prototype[n].key||n],this._skToType[t]=e,this.createRecord(t,i)):36==(-273&s)?this.setStatus(t,98):4&s&&(delete this._destroyed[t],this.setStatus(t,-133&s|2))},sourceStateDidChange:function(t,e){var i,n=r(t),s=this._typeToClientState[n],o=this._remoteQueries,a=o.length;if(s&&e!==s)if(48&this._typeToStatus[n])this._typeToServerState[n]=e;else{for(;a--;)(i=o[a]).get("Type")===t&&i.setObsolete();this.fetchAll(t,!0)}return this},_checkServerStatus:function(t){var e=r(t),i=this._typeToServerState[e];i&&(delete this._typeToServerState[e],this.sourceStateDidChange(t,i))},fetchAll:function(t,e){var i=r(t),n=this._typeToStatus[i],s=this._typeToClientState[i];return 16&n||s&&!e||(this.source.fetchAllRecords(t,s,function(){this._typeToStatus[i]&=-17,this._checkServerStatus(t)}.bind(this)),this._typeToStatus[i]=16|n),this},fetchData:function(t){var e,i,n,s=this.getStatus(t);return 92&s?this:(e=this._skToType[t])?(i=r(e),n=this._typeToSkToId[i][t],1&s?(this.source.fetchRecord(e,n),this.setStatus(t,17)):(this.source.refreshRecord(e,n),this.setStatus(t,-257&s|16)),this):this},getData:function(t){return this._skToData[t]},setData:function(t,e){if(2&this.getStatus(t))this.updateData(t,e,!1);else{var i=Object.keys(e);this._skToData[t]=e,this._notifyRecordOfChanges(t,i),this._nestedStores.forEach(function(e){e.parentDidSetData(t,i)})}return this},updateData:function(i,n,r){var o,a,h,c,l,u=this.getStatus(i),d=this._skToData,f=this._skToCommitted,g=this._skToChanged,p=d[i],v=[],m=!1;if(!(2&u))return this._skToType[i],t.RunLoop.didError({name:"O.Store Error: Cannot write to unready record",message:"\nStatus: "+(Object.keyOf(e,u)||u)+"\nData: "+JSON.stringify(n)}),!1;if(this.isNested&&!d.hasOwnProperty(i)&&(d[i]=p=t.clone(p)),r&&194!==u){for(o in c=f[i]||(f[i]=t.clone(p)),l=g[i]||(g[i]={}),n)a=n[o],h=p[o],s(a,h)||(p[o]=a,v.push(o),l[o]=!s(a,c[o]),m=m||l[o]);if(!m)for(o in l)if(l[o]){m=!0;break}m?(this.setStatus(i,128|u),this.autoCommit&&this.commitChanges()):(this.setStatus(i,-129&u),delete f[i],delete g[i],this.isNested&&delete d[i])}else for(o in n)a=n[o],h=p[o],s(a,h)||(p[o]=a,v.push(o));return this._notifyRecordOfChanges(i,v),this._nestedStores.forEach(function(t){t.parentDidUpdateData(i,v)}),this._recordDidChange(i),!0},revertData:function(t){var e=this._skToCommitted[t];return e&&this.updateData(t,e,!0),this},_notifyRecordOfChanges:function(e,i){var n,s,r,o,a,h=this._skToRecord[e],c=i.length;if(h){for(n=t.meta(h).attrs,h.beginPropertyChanges();c--;){if(!(r=n[s=i[c]])){if("id"!==s)continue;r=s}o=h[r],h.computedPropertyDidChange(r),o.validate&&(a||(a=h.get("errorForAttribute")),a.set(r,o.validate(h.get(r),r,h)))}h.endPropertyChanges()}return this},sourceDidFetchRecords:function(i,n,s,o){for(var a,c,u,d,f,g=r(i),p=this._typeToClientState,v=n.length,m=i.primaryKey||"id",y=i.prototype[m].key||m,w=Date.now(),_={},b={},S=h(i);v--;)_[u=(c=n[v])[y]]=!0,d=this.getStoreKey(i,u),f=this.getStatus(d),S.length&&l(this,S,c),2&f?b[u]=c:4&f&&160&f?(this._skToData[d]=c,this.setStatus(d,-17&f)):(1&f||(t.RunLoop.didError({name:"O.Store Error: Record loaded which has status destroyed or non-existent",message:"\nStatus: "+(Object.keyOf(e,f)||f)+"\nId: "+u}),this.setStatus(d,1)),this.setData(d,c),this.setStatus(d,2),this._skToLastAccess[d]=w);if(o){var D=this._typeToIdToSk[r(i)],T=[];for(u in D)_[u]||T.push(u);T.length&&this.sourceDidDestroyRecords(i,T)}return this.sourceDidFetchPartialRecords(i,b,!0),s&&(a=p[g],!o&&a&&a!==s?this.sourceStateDidChange(i,s):p[g]=s),this._typeToStatus[g]|=2,t.RunLoop.queueFn("middle",this.liveQueriesAreReady.bind(this,i)),this},sourceDidFetchPartialRecords:function(e,i,n){var o,a,c,u,d,f=r(e),g=this._skToData,p=this._skToStatus,v=this._typeToIdToSk[f]||{},m=this._typeToSkToId[f]||{},y=this._skToChanged,w=this._skToCommitted,_=e.primaryKey||"id",b=e.prototype[_].key||_,S=n?[]:h(e);for(o in i)if(c=p[a=v[o]],u=i[o],2&c)if(288&c)this.setStatus(a,-17&c),this.fetchData(a);else{if(S.length&&l(this,S,u),128&c){if(u=t.extend(w[a],u),this.rebaseConflicts){var D,T=g[a],C=y[a],O={},x={},k=!0;for(D in T)D in C?(s(T[D],u[D])||(x[D]=!0,k=!1),O[D]=T[D]):O[D]=u[D];if(!k){y[a]=x,w[a]=u,this.setData(a,O),this.setStatus(a,130);continue}}delete y[a],delete w[a]}(d=u[b])&&d!==o&&(m[a]=d,delete v[o],v[d]=a),this.updateData(a,u,!1),this.setStatus(a,2)}return this},sourceCouldNotFindRecords:function(t,e){for(var i,n,s=e.length,r=this._skToCommitted,o=this._skToChanged;s--;)i=this.getStoreKey(t,e[s]),1&(n=this.getStatus(i))?this.setStatus(i,8):(128&n&&(this.setData(i,r[i]),delete r[i],delete o[i]),this.setStatus(i,4),this.unloadRecord(i));return this},sourceDidFetchUpdates:function(t,e,i,n,s){var o=r(t);return this._typeToClientState[o]===n?(e&&this.sourceDidModifyRecords(t,e),i&&this.sourceDidDestroyRecords(t,i),this._typeToClientState[o]=s):this.sourceStateDidChange(t,s),this},sourceDidModifyRecords:function(t,e){for(var i,n,s=this._skToStatus,o=this._typeToIdToSk[r(t)]||{},a=e.length;a--;)2&(n=s[i=o[e[a]]])&&this.setStatus(i,256|n);return this},sourceDidDestroyRecords:function(t,e){for(var i,n=e.length;n--;)i=this.getStoreKey(t,e[n]),this.setStatus(i,4),this.unloadRecord(i);return this},sourceCommitDidChangeState:function(t,e,i){var n=r(t),s=this._typeToClientState;return s[n]===e?s[n]=i:(delete this._typeToServerState[n],this.sourceStateDidChange(t,i)),this},sourceDidCommitCreate:function(e){var i,n;for(i in e)64&(n=this.getStatus(i))?(this.setIdForStoreKey(i,e[i]),this.setStatus(i,-97&n)):t.RunLoop.didError({name:"O.Store Error: Source committed a create on a record not marked new"});return this.autoCommit&&this.commitChanges(),this},sourceDidNotCreate:function(t){for(var e,i,n=t.length,s=this._skToCommitted,r=this._skToChanged,o=this._created;n--;)e=t[n],4&(i=this.getStatus(e))?(this.setStatus(e,4),this.unloadRecord(e)):(128&i&&(delete s[e],delete r[e]),this.setStatus(e,194),o[e]=1);return this.autoCommit&&this.commitChanges(),this},sourceDidCommitUpdate:function(t){for(var e,i,n=t.length,s=this._skToRollback;n--;)e=t[n],i=this.getStatus(e),delete s[e],1!==i&&this.setStatus(e,-33&i);return this.autoCommit&&this.commitChanges(),this},sourceDidNotUpdate:function(t){for(var e,i,n,r,o,a,h=t.length,c=this._skToData,l=this._skToChanged,u=this._skToCommitted,d=this._skToRollback;h--;)if(e=t[h],4&(i=this.getStatus(e))&&d[e]&&(c[e]=d[e],delete d[e]),2&i){for(o in n=u[e]=d[e],delete d[e],a={},r=c[e],delete l[e],r)s(r[o],n[o])||(a[o]=!0,l[e]=a);l[e]?this.setStatus(e,-33&i|128):this.setStatus(e,-33&i)}else 1!==i&&this.setStatus(e,-33&i);return this.autoCommit&&this.commitChanges(),this},sourceDidCommitDestroy:function(e){for(var i,n,s=e.length;s--;)i=e[s],98==(-129&(n=this.getStatus(i)))?(128&n&&(delete this._skToCommitted[i],delete this._skToChanged[i]),this.setStatus(i,194),this._created[i]=1):4&n?(this.setStatus(i,4),this.unloadRecord(i)):t.RunLoop.didError({name:"O.Store Error: Source commited a destroy on a record not marked destroyed"});return this.autoCommit&&this.commitChanges(),this},sourceDidNotDestroy:function(e){for(var i,n,s=e.length,r=this._destroyed;s--;)i=e[s],98==(-129&(n=this.getStatus(i)))?this.setStatus(i,-97&n):4&n?(this.setStatus(i,-33&n|128),r[i]=1):t.RunLoop.didError({name:"O.Store Error: Source commited a destroy on a record not marked destroyed"});return this.autoCommit&&this.commitChanges(),this},sourceDidError:function(t){for(var e,i=t.length,n=this._skToChanged,s=this._skToCommitted,r=this._skToRollback;i--;)e=t[i],64&this.getStatus(e)?(this.setStatus(e,4),this.unloadRecord(e)):(r[e]&&this.setData(e,r[e]),delete n[e],delete s[e],delete r[e],this.setStatus(e,258));return this},findAll:function(t,e,i){var s,o,a,h=this._typeToSkToId[r(t)]||{},c=this._skToStatus,l=[];for(s in h)2&c[s]&&l.push(s);return e&&(o=n.bind(this,e),(l=l.filter(o)).filterFn=o),i&&(a=function(t,e,i){var n=this._skToData;return t(n[e],n[i],this)||~~e.slice(1)-~~i.slice(1)}.bind(this,i),l.sort(a),l.sortFn=a),l},findOne:function(t,e){var i,s=this._typeToSkToId[r(t)]||{},o=this._skToStatus,a=e&&n.bind(this,e);for(i in s)if(2&o[i]&&(!a||a(i)))return i;return null},addQuery:function(e){var i=this.source;if(this._idToQuery[e.get("id")]=e,e instanceof t.LiveQuery){var n=e.get("Type"),s=r(n);this.fetchAll(n),(this._liveQueries[s]||(this._liveQueries[s]=[])).push(e)}else e instanceof t.RemoteQuery&&(i.fetchQuery(e),this._remoteQueries.push(e));return this},removeQuery:function(e){if(delete this._idToQuery[e.get("id")],e instanceof t.LiveQuery){var i=this._liveQueries,n=r(e.get("Type")),s=i[n];s.length>1?s.erase(e):delete i[n]}else e instanceof t.RemoteQuery&&this._remoteQueries.erase(e);return this},getQuery:function(e,i,n){var s=e&&this._idToQuery[e]||null;return!s&&i&&(s=new i(t.extend(n||{},{id:e,store:this,source:this.source}))),s&&(s.lastAccess=Date.now()),s},getAllRemoteQueries:function(){return this._remoteQueries},_recordDidChange:function(e){var i=r(this._skToType[e]),n=this._typeToChangedSks;(n[i]||(n[i]={}))[e]=!0,t.RunLoop.queueFn("middle",this.refreshLiveQueries,this)},refreshLiveQueries:function(){var t,e,i,n,s=this._typeToChangedSks,r=this._liveQueries;for(t in this._typeToChangedSks={},s){for(e=Object.keys(s[t]),n=(i=r[t])?i.length:0;n--;)i[n].storeDidChangeRecords(e);this.fire(t,{storeKeys:e})}return this},liveQueriesAreReady:function(t){for(var e=this._liveQueries[r(t)],i=e?e.length:0;i--;)e[i].set("status",2)}});["on","once","off"].forEach(function(e){f.prototype[e]=function(i,n,s){return"string"!=typeof i&&(i=r(i)),t.EventTarget[e].call(this,i,n,s)}}),t.Store=f}(O),function(t){var e=t.Class({init:function(e,i,n){this._index=0,this._store=e,this._restrictions=i,this.isPaused=!1,this.frequency=n||3e4,t.RunLoop.invokeAfterDelay(this.cleanup,this.frequency,this)},addRestriction:function(t){return this._restrictions.push(t),this},cleanup:function(){var e,i=this._index,n=this._restrictions[i],s=n.Type,r=s,o=n.max,a=n.afterCleanup;if(this.isPaused)t.RunLoop.invokeAfterDelay(this.cleanup,this.frequency,this);else{do{if(r===t.Record){e=this.cleanupRecordType(s,o);break}if(r===t.RemoteQuery){e=this.cleanupQueryType(s,o);break}}while(r=r.parent.constructor);a&&a(e),this._index=i=(i+1)%this._restrictions.length,i?t.RunLoop.invokeInNextEventLoop(this.cleanup,this):t.RunLoop.invokeAfterDelay(this.cleanup,this.frequency,this)}},cleanupRecordType:function(e,i){var n,s,r=this._store,o=r._skToLastAccess,a=r._skToData,h=Object.keys(r._typeToSkToId[t.guid(e)]||{}),c=h.length,l=c-i,u=[];for(h.sort(function(t,e){return o[e]-o[t]});l>0&&c--;)n=a[s=h[c]],r.unloadRecord(s)&&(l-=1,n&&u.push(n));return u},cleanupQueryType:function(t,e){var i,n=this._store.getAllRemoteQueries().filter(function(e){return e instanceof t}),s=n.length,r=s-e,o=[];for(n.sort(function(t,e){return e.lastAccess-t.lastAccess});r>0&&s--;)(i=n[s]).hasObservers()||(i.destroy(),o.push(i),r-=1);return o}});t.MemoryManager=e}(O),function(t){var e=t.Class({Extends:t.Store,autoCommit:!1,isNested:!0,init:function(t){this._skToRecord={},this._skToData=Object.create(t._skToData),this._skToStatus=Object.create(t._skToStatus),this._skToType=t._skToType,this._typeToSkToId=t._typeToSkToId,this._typeToIdToSk=t._typeToIdToSk,this._skToChanged={},this._skToCommitted={},this._skToRollback={},this._skToLastAccess=t._skToLastAccess,this._created={},this._destroyed={},this._idToQuery={},this._liveQueries={},this._remoteQueries=[],this._queryTypesNeedRefresh=[],this._nestedStores=[],this._typeToChangedSks={},this._typeToStatus=t._typeToStatus,t.addNested(this),this._source=t._source,this._parentStore=t},destroy:function(){this._parentStore.removeNested(this)},commitChanges:function(t){this.fire("willCommit");var e,i,n,s=this._created,r=this._destroyed,o=this._skToData,a=this._skToChanged,h=this._parentStore;for(e in s)i=h.getStatus(e),n=o[e],1===i||4===i?h.createRecord(e,n):36==(-273&i)?(h._skToData[e]=n,h.setStatus(e,98)):4&i&&(delete h._destroyed[e],h._skToData[e]=n,h.setStatus(e,-133&i|2));for(e in a)h.updateData(e,Object.filter(o[e],a[e]),!0);for(e in r)h.destroyRecord(e);return this._skToData=Object.create(h._skToData),this._skToStatus=Object.create(h._skToStatus),this._skToChanged={},this._skToCommitted={},this._created={},this._destroyed={},t&&t(),this.fire("didCommit")},discardChanges:function(){e.parent.discardChanges.call(this);var t=this._parentStore;return this._skToData=Object.create(t._skToData),this._skToStatus=Object.create(t._skToStatus),this},getStatus:function(t){var e=this._skToStatus[t]||1;return this._skToData.hasOwnProperty(t)?e:-225&e},fetchAll:function(t){return this._parentStore.fetchAll(t),this},fetchData:function(t){return this._parentStore.fetchData(t),this},parentDidChangeStatus:function(t,e,i){var n=this._skToStatus;if(e&=-225,i&=-225,n.hasOwnProperty(t)&&(e=n[t],4&i?(4&e||(this.setData(t,this._skToCommitted[t]),delete this._skToCommitted[t],delete this._skToChanged[t]),delete this._skToData[t],delete n[t]):n[t]=i=e|272&i),e!==i){2&(e^i)&&this._recordDidChange(t);var s=this._skToRecord[t];s&&s.propertyDidChange("status",e,i),this._nestedStores.forEach(function(n){n.parentDidChangeStatus(t,e,i)})}},parentDidSetData:function(t,e){this._notifyRecordOfChanges(t,e),this._nestedStores.forEach(function(i){i.parentDidSetData(t,e)})},parentDidUpdateData:function(e,i){if(this._skToData.hasOwnProperty(e)){var n,s,r=this._skToData,o=this._skToChanged,a=this._skToCommitted,h=this._parentStore,c=this.rebaseConflicts,l=h.getData(e),u=r[e],d=o[e],f={},g={},p=!0;for(s in i=[],u)n=!t.isEqual(u[s],l[s]),c&&s in d?(n&&(g[s]=!0,p=!1),f[s]=u[s]):(n&&i.push(s),f[s]=l[s]);if(!p)return o[e]=g,a[e]=t.clone(l),void this.setData(e,f);this.setStatus(e,-225&h.getStatus(e)),delete r[e],delete o[e],delete a[e],delete this._skToStatus[e]}this._notifyRecordOfChanges(e,i),this._nestedStores.forEach(function(t){t.parentDidUpdateData(e,i)}),this._recordDidChange(e)},sourceDidFetchRecords:null,sourceDidFetchPartialRecords:null,sourceCouldNotFindRecords:null,sourceDidFetchUpdates:null,sourceDidModifyRecords:null,sourceDidDestroyRecords:null,sourceCommitDidChangeState:null,sourceDidCommitCreate:null,sourceDidNotCreate:null,sourceDidCommitUpdate:null,sourceDidNotUpdate:null,sourceDidCommitDestroy:null,sourceDidNotDestroy:null,sourceDidError:null});t.NestedStore=e}(O),function(t){var e=t.Class({Extends:t.Object,init:function(t){this._undoStack=[],this._redoStack=[],this._isInUndoState=!1,this.canUndo=!1,this.canRedo=!1,this.maxUndoCount=1,e.parent.init.call(this,t)},_pushState:function(t,e){for(t.push(e);t.length>this.maxUndoCount;)t.shift();this._isInUndoState=!0},dataDidChange:function(){return this._isInUndoState=!1,this._redoStack.length=0,this.set("canRedo",!1).set("canUndo",!0).fire("input")},saveUndoCheckpoint:function(){if(!this._isInUndoState){var t=this.getUndoData();null!==t?this._pushState(this._undoStack,t):(this._isInUndoState=!0,this.set("canUndo",!!this._undoStack.length))}return this},undo:function(){if(this.get("canUndo"))if(this._isInUndoState){var t=this.applyChange(this._undoStack.pop(),!1);t&&this._pushState(this._redoStack,t),this.set("canUndo",!!this._undoStack.length).set("canRedo",!!t).fire("undo")}else this.saveUndoCheckpoint(),this.undo();return this},redo:function(){return this.get("canRedo")&&(this._pushState(this._undoStack,this.applyChange(this._redoStack.pop(),!0)),this.set("canUndo",!0).set("canRedo",!!this._redoStack.length).fire("redo")),this},getUndoData:function(){},applyChange:function(){}}),i=t.Class({Extends:e,init:function(t){i.parent.init.call(this,t),this.get("store").on("willCommit",this,"saveUndoCheckpoint").on("record:user:create",this,"dataDidChange").on("record:user:update",this,"dataDidChange").on("record:user:destroy",this,"dataDidChange")},destroy:function(){this.get("store").off("willCommit",this,"saveUndoCheckpoint").off("record:user:create",this,"dataDidChange").off("record:user:update",this,"dataDidChange").off("record:user:destroy",this,"dataDidChange"),i.parent.destroy.call(this)},getUndoData:function(){var t=this.get("store");return t.hasChanges()?t.getInverseChanges():null},applyChange:function(t){var e,i=this.get("store");return i.applyChanges(t),e=i.getInverseChanges(),i.commitChanges(),e},undo:function(){return!this._isInUndoState&&this.get("store").hasChanges()||i.parent.undo.call(this),this}});t.UndoManager=e,t.StoreUndoManager=i}(O),function(t,e){var i=0,n="-moz-user-select"===t.UA.cssProps["user-select"]?"-moz-none":"none",s=function(t){return t.render().get("layer")},r=t.Class({Extends:t.Object,syncOnlyInDocument:!0,init:function(){this._needsRedraw=null,this.id="v"+i++,this.parentView=null,this.isRendered=!1,this.isInDocument=!1,r.parent.init.apply(this,arguments);for(var t=this.get("childViews")||(this.childViews=[]),e=t.length;e--;)t[e].set("parentView",this);this.get("syncOnlyInDocument")&&this.suspendBindings()},destroy:function(){if(this.get("isInDocument"))throw new Error("Cannot destroy a view in the document");for(var t=this.get("childViews"),e=t.length;e--;)t[e].destroy();this.get("isRendered")&&this.willDestroyLayer(this.get("layer")),this.clearPropertyCache(),r.parent.destroy.call(this)},ariaAttributes:null,className:void 0,layerTag:"div",layer:function(){var e=t.Element.create(this.get("layerTag"),{id:this.get("id"),className:this.get("className"),style:Object.toCSSString(this.get("layerStyles")),unselectable:this.get("allowTextSelection")?void 0:"on"});return this.didCreateLayer(e),this.redrawAriaAttributes(e),e}.property(),didCreateLayer:function(){},willDestroyLayer:function(){this.set("isRendered",!1)},willEnterDocument:function(){this.get("syncOnlyInDocument")&&this.resumeBindings(),this._needsRedraw&&this.redraw();var t,e=this.get("childViews");for(t=0;t<e.length;t+=1)e[t].willEnterDocument();return this},didEnterDocument:function(){this._needsRedraw&&t.RunLoop.queueFn("render",this.redraw,this),this.set("isInDocument",!0),t.ViewEventsController.registerActiveView(this),this.computedPropertyDidChange("pxLayout");var e,i=this.get("childViews");for(e=0;e<i.length;e+=1)i[e].didEnterDocument();return this},willLeaveDocument:function(){this.set("isInDocument",!1),t.ViewEventsController.deregisterActiveView(this);for(var e=this.get("childViews"),i=e.length;i--;)e[i].willLeaveDocument();return this},didLeaveDocument:function(){for(var t=this.get("childViews"),e=t.length;e--;)t[e].didLeaveDocument();return this.get("syncOnlyInDocument")&&this.suspendBindings(),this},nextEventTarget:function(){return this.get("parentView")}.property("parentView"),handleEvent:function(e){t.ViewEventsController.handleEvent(e)},isDraggable:!1,allowTextSelection:!1,positioning:"relative",layout:{},layerStyles:function(){var e=this.get("allowTextSelection");return t.extend({position:this.get("positioning"),cursor:e?"auto":void 0,userSelect:e?"text":n},this.get("layout"))}.property("layout","allowTextSelection","positioning"),render:function(){if(!this.get("isRendered")){this.get("syncOnlyInDocument")&&this.resumeBindings(),this.set("isRendered",!0);var e=t.Element,i=e.forView(this),n=this.get("layer"),s=this.draw(n,e,e.create);s&&e.appendChildren(n,s),e.forView(i)}return this},draw:function(){return this.get("childViews").map(s)},propertyNeedsRedraw:function(e,i,n){if(this.get("isRendered")){var s,r,o=this._needsRedraw||(this._needsRedraw=[]);for(s=0,r=o.length;s<r;s+=1)if(o[s][0]===i)return this;o[r]=[i,n],this.get("isInDocument")&&t.RunLoop.queueFn("render",this.redraw,this)}return this}.observes("className","layerStyles","ariaAttributes"),redraw:function(){var t,e,i,n,s=this._needsRedraw;if(s&&!this.isDestroyed&&this.get("isRendered"))for(t=this.get("layer"),this._needsRedraw=null,e=0,i=s.length;e<i;e+=1)this["redraw"+(n=s[e])[0].capitalise()](t,n[1]);return this},redrawLayer:function(e){for(var i,n,s=t.Element,r=s.forView(this),o=this.get("childViews"),a=o.length;a--;)n=o[a],this.removeView(n),n.destroy();for(;i=e.lastChild;)e.removeChild(i);s.appendChildren(e,this.draw(e,s,s.create)),s.forView(r)},redrawClassName:function(t){t.className=this.get("className")},redrawLayerStyles:function(t){t.style.cssText=Object.toCSSString(this.get("layerStyles")),this.didResize()},redrawAriaAttributes:function(t){var e,i,n=this.get("ariaAttributes");for(e in n)i=n[e],"role"!==e&&(e="aria-"+e),t.setAttribute(e,i)},parentViewDidResize:function(){this.get("isInDocument")&&this.didResize()},didResize:function(){this.computedPropertyDidChange("pxLayout");for(var t=this.get("childViews"),e=t.length;e--;)t[e].parentViewDidResize()},scrollTop:0,scrollLeft:0,pxLayout:function(){return{top:this.get("pxTop"),left:this.get("pxLeft"),width:this.get("pxWidth"),height:this.get("pxHeight")}}.property(),pxTop:function(){if(!this.get("isInDocument"))return 0;var t=this.get("parentView").get("layer"),e=t.offsetParent,i=this.get("layer"),n=0;do{if(i===e){n-=t.offsetTop;break}n+=i.offsetTop}while(i&&(i=i.offsetParent)!==t);return n}.property("pxLayout"),pxLeft:function(){if(!this.get("isInDocument"))return 0;var t=this.get("parentView").get("layer"),e=t.offsetParent,i=this.get("layer"),n=0;do{if(i===e){n-=t.offsetLeft;break}n+=i.offsetLeft}while(i&&(i=i.offsetParent)!==t);return n}.property("pxLayout"),pxWidth:function(){return this.get("isInDocument")?this.get("layer").offsetWidth:0}.property("pxLayout"),pxHeight:function(){return this.get("isInDocument")?this.get("layer").offsetHeight:0}.property("pxLayout"),visibleRect:function(){return{x:this.get("scrollLeft"),y:this.get("scrollTop"),width:this.get("pxWidth"),height:this.get("pxHeight")}}.property("scrollLeft","scrollTop","pxLayout"),getPositionRelativeTo:function(e){e.syncBackScroll&&e.syncBackScroll();var i=t.Element.getPosition,n=i(this.get("layer")),s=i(e.get("layer"));return n.top-=s.top-e.get("scrollTop"),n.left-=s.left-e.get("scrollLeft"),n},insertView:function(t,e,i){var n,s,o,a,h,c=t.get("parentView"),l=this.get("childViews");return c===this?this:e||"before"!==i&&"after"!==i?(c&&c.removeView(t),t.set("parentView",this),e instanceof r?(n=(n=l.indexOf(e))>-1?"before"===i?n:n+1:l.length,l.splice(n,0,t),e=e.get("layer")):"top"===i?l.unshift(t):l.push(t),this.get("isRendered")&&(e||(e=this.get("layer"),"before"!==i&&"after"!==i||(i="")),s=this.get("isInDocument"),a="before"===i||"after"===i?e.parentNode:e,h="before"===i?e:"top"===i?e.firstChild:"after"===i?e.nextSibling:null,o=t.render().get("layer"),s&&t.willEnterDocument(),h?a.insertBefore(o,h):a.appendChild(o),s&&t.didEnterDocument()),this.propertyDidChange("childViews"),this):(this.get("parentView").insertView(t,this,i),this)},replaceView:function(t,e){if(t===e)return this;var i=this.get("childViews"),n=i.indexOf(e),s=t.get("parentView");if(-1===n)return this;if(s&&s.removeView(t),t.set("parentView",this),i.setObjectAt(n,t),this.get("isRendered")){var r=this.get("isInDocument"),o=e.get("layer");t.render(),r&&(e.willLeaveDocument(),t.willEnterDocument()),o.parentNode.replaceChild(t.get("layer"),o),r&&(t.didEnterDocument(),e.didLeaveDocument())}return e.set("parentView",null),this.propertyDidChange("childViews"),this},removeView:function(t){var e,i,n=this.get("childViews"),s=n.lastIndexOf(t);return-1===s?this:(this.get("isRendered")&&(e=this.get("isInDocument"),i=t.get("layer"),e&&t.willLeaveDocument(),i.parentNode.removeChild(i),e&&t.didLeaveDocument()),n.splice(s,1),t.set("parentView",null),this.propertyDidChange("childViews"),this)},detach:function(){var t=this.get("parentView");return t&&t.removeView(this),this},compareViewTreePosition:function(t){if(this===t)return 0;for(var e,i,n,s,r,o=this,a=[o],h=[t],c=o;c=c.get("parentView");){if(c===t)return 16;a.push(c)}for(c=t;c=c.get("parentView");){if(c===o)return 8;h.push(c)}for(e=a.length,i=h.length;e--&&i--;)if((o=a[e])!==(t=h[i])){if(c=a[e+1]){for(s=(n=c.get("childViews")).length;s--;){if((r=n[s])===t)return 2;if(r===o)return 4}break}return 1}return 1},getParent:function(t){var e=this;do{e=e.get("parentView")}while(e&&!(e instanceof t));return e||null}});r.LAYOUT_FILL_PARENT={top:0,left:0,bottom:0,right:0},r.POSITION_SAME=0,r.POSITION_DISCONNECTED=1,r.POSITION_PRECEDING=2,r.POSITION_FOLLOWING=4,r.POSITION_CONTAINS=8,r.POSITION_CONTAINED_BY=16,r.peekId=function(){return"v"+i},t.View=r}(O),function(t){var e=!1;try{var i=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",i,i),window.removeEventListener("test",i,i)}catch(t){e=!1}var n=t.Class({Extends:t.View,syncOnlyInDocument:!1,layer:null,init:function(t,i){n.parent.init.call(this,i);var s,r,o=9===t.nodeType,a=(o?t:t.ownerDocument).defaultView;for(r=(s=["click","mousedown","mouseup","dblclick","keypress","keydown","keyup","dragstart","touchstart","touchmove","touchend","touchcancel","cut","submit"]).length;r--;)t.addEventListener(s[r],this,!!e&&{passive:!1});for(r=(s=["focus","blur","change","input"]).length;r--;)t.addEventListener(s[r],this,!0);for(r=(s=["resize","scroll"]).length;r--;)a.addEventListener(s[r],this,!1);this.isRendered=!0,this.isInDocument=!0,this.layer=o?t.body:t},_onScroll:function(t){var e=this.get("layer"),i="BODY"===e.nodeName,n=e.ownerDocument,s=n.defaultView,r=n.documentElement,o=i?s.pageXOffset||r.scrollLeft||0:e.scrollLeft,a=i?s.pageYOffset||r.scrollTop||0:e.scrollTop;this.beginPropertyChanges().set("scrollLeft",o).set("scrollTop",a).endPropertyChanges(),t.stopPropagation()}.on("scroll"),preventRootScroll:t.UA.isIOS?function(e){var i,n,s=e.targetView,r=t.ScrollView;s instanceof r||s.getParent(r)||(n=(i=this.layer.ownerDocument).defaultView,this.get("pxHeight")<=n.innerHeight&&!/^(?:INPUT|TEXTAREA)$/.test(i.activeElement.nodeName)&&e.preventDefault())}.on("touchmove"):null,focus:function(){var e=this.get("layer").ownerDocument.activeElement,i=t.ViewEventsController.getViewFromNode(e);i instanceof t.AbstractControlView?i.blur():e.blur&&e.blur()},pxTop:0,pxLeft:0,handleEvent:function(e){switch(e.type){case"mousedown":this.get("layer").ownerDocument.addEventListener("mousemove",this,!1);break;case"mouseup":this.get("layer").ownerDocument.removeEventListener("mousemove",this,!1);break;case"resize":return void this.didResize();case"scroll":return void this._onScroll(e)}t.ViewEventsController.handleEvent(e,null,this)}.invokeInRunLoop()});t.RootView=n}(O),function(t){var e=function(t,e){var i=t[0];return i<e?-1:i>e?1:0},i={_activeViews:{},registerActiveView:function(t){return this._activeViews[t.get("id")]=t,this},deregisterActiveView:function(t){return delete this._activeViews[t.get("id")],this},getViewFromNode:function(t){for(var e=this._activeViews,i=t.ownerDocument,n=null;!n&&t&&t!==i;)n=e[t.id],t=t.parentNode;return n},_eventTargets:[],addEventTarget:function(t,i){i||(i=0);for(var n=this._eventTargets.slice(),s=n.binarySearch(i,e),r=n.length;s<r&&n[s][0]===i;)s+=1;return n.splice(s,0,[i,t]),this._eventTargets=n,this},removeEventTarget:function(t){return this._eventTargets=this._eventTargets.filter(function(e){return e[1]!==t}),this},handleEvent:function(t,e,i){var n,s=this._eventTargets,r=s.length;for(e||(e=this.getViewFromNode(t.target)||i),t.targetView=e;r--&&((n=s[r][1])===this&&(n=e),!n||(n.fire(t.type,t),!t.propagationStopped)););}.invokeInRunLoop()};i.addEventTarget(i,0),t.ViewEventsController=i}(O),O.DragEffect={NONE:0,COPY:1,MOVE:2,LINK:4,ALL:7,DEFAULT:8,effectToString:["none","copy","move","copyMove","link","copyLink","linkMove","all",""]},function(t){var e=t.DragEffect.effectToString,i=t.Class({Extends:t.Object,init:function(t){var e=t.event;this._dragCursor=null,this._stylesheet=null,this._scrollBounds=null,this._scrollView=null,this._scrollBy=null,this._scrollInterval=null,this._lastTargetView=null,this.isNative=!1,this.dragSource=null,this.allowedEffects=7,this.dataSource=null,this.dropTarget=null,this.dropEffect=8,this.cursorPosition=this.startPosition={x:e.clientX,y:e.clientY},this.defaultCursor="default",this.dragImage=null,i.parent.init.call(this,t),this._setCursor(!0),this.startDrag()},dragImageOffset:{x:5,y:5},_dragImageDidChange:function(e,i,n,s){if(this.isNative){var r=this.get("dragImageOffset");this.event.dataTransfer.setDragImage(s,r.x,r.y)}else{var o=this._dragCursor;o?n&&o.removeChild(n):(o=this._dragCursor=t.Element.create("div",{style:"position: fixed; z-index: 9999;"}),this._updateDragImagePosition(),document.body.appendChild(o)),o.appendChild(s)}}.observes("dragImage"),_updateDragImagePosition:function(){var t,e,i=this._dragCursor;i&&(t=this.get("cursorPosition"),e=this.get("dragImageOffset"),i.style.left=t.x+Math.max(e.x,5)+"px",i.style.top=t.y+Math.max(e.y,5)+"px")}.queue("render").observes("cursorPosition","dragImageOffset"),_setCursor:function(e){var i=this._stylesheet,n=this.get("defaultCursor");if(i&&(i.parentNode.removeChild(i),i=null),e){switch(this.get("dropEffect")){case 0:n="no-drop";break;case 1:n="copy";break;case 4:n="alias"}i=t.Stylesheet.create("o-drag-cursor","*{cursor:default !important;cursor:"+n+" !important;}")}this._stylesheet=i}.observes("defaultCursor","dropEffect"),dataTypes:function(){var t=this.get("dataSource")||this.get("dragSource");if(t&&t.get("isDragDataSource"))return t.get("dragDataTypes");if(this.isNative){var e,i,n=this.event.dataTransfer,s=n&&n.items,r=[],o=!1,a=s?s.length:0;if(a){for(;a--;)i=(e=s[a]).type,o||(o="file"===e.kind),i&&r.include(i);return o&&r.push("Files"),r}if(n&&n.types)return Array.prototype.slice.call(n.types)}return[]}.property(),hasDataType:function(t){return-1!==this.get("dataTypes").indexOf(t)},getFiles:function(t){var e,i,n,s,r,o=[],a=this.event.dataTransfer;if(a)if(e=a.items){for(i=0,n=e.length;i<n;i+=1)if(r=(s=e[i]).type,"file"===s.kind){if(!r){if(s.getAsEntry&&!s.getAsEntry().isFile)continue;if(s.webkitGetAsEntry&&!s.webkitGetAsEntry().isFile)continue}t&&!t.test(r)||o.push(s.getAsFile())}}else if(e=a.files)for(i=0,n=e.length;i<n;i+=1)r=(s=e[i]).type,!s.size||t&&!t.test(r)||o.push(s);return o},getDataOfType:function(t,e){var i=this.get("dataSource")||this.get("dragSource"),n=!1;if(i&&i.get("isDragDataSource"))e(i.getDragDataOfType(t,this)),n=!0;else if(this.isNative){var s,r,o,a=this.event.dataTransfer,h=a.items;if(h){for(s=0,r=h.length;s<r;s+=1)if((o=h[s]).type===t){o.getAsString(e),n=!0;break}}else a.getData&&(e(a.getData(t)),n=!0)}return n||e(null),this},startDrag:function(){t.DragController.register(this),this.fire("dragStarted");var i,n,s,r,o,a=this.get("dragSource");return a&&(a.set("isDragging",!0).dragStarted(this),i=a.get("allowedDragEffects"),this.set("allowedEffects",i),this.isNative&&(n=this.event.dataTransfer,s=this.get("dataSource")||a,r=!1,n.effectAllowed=e[this.get("allowedEffects")],s.get("isDragDataSource")&&s.get("dragDataTypes").forEach(function(t){t.contains("/")&&(o=s.getDragDataOfType(t,this),n.items?n.items.add(o,t):n.setData&&n.setData(t,o),r=!0)}),r||n.setData("x-private",""))),this},endDrag:function(){var e=this.get("dropTarget"),i=this.get("dragSource");return e&&e.dropExited(this),i&&i.set("isDragging",!1).dragEnded(this),this._dragCursor&&(document.body.removeChild(this._dragCursor),this._dragCursor=null),this._scrollInterval&&(t.RunLoop.cancel(this._scrollInterval),this._scrollInterval=null),this._setCursor(!1),this.fire("dragEnded"),t.DragController.deregister(this),this},move:function(t){this.event=t;var e,i,n=t.targetView;return n||(n=this.get("dropTarget")),this.set("cursorPosition",{x:e=t.clientX,y:i=t.clientY}),this._check(n,e,i),this._update(n),this},_check:function(e,i,n){var s,r,o,a=this._scrollBounds,h=this._scrollView;(!a||i<a.l||i>a.r||n<a.t||n>a.b)&&(a=null,e&&this._lastTargetView!==e&&(this._lastTargetView=h=e,h instanceof t.ScrollView||(h=h.getParent(t.ScrollView)),h&&(a={l:(s=h.get("layer").getBoundingClientRect()).left-15,r:s.right+15,t:s.top-15,b:s.bottom+15},r=Math.min(75,s.right-s.left>>2),o=Math.min(75,s.bottom-s.top>>2),a.hl=a.l+r,a.hr=a.r-r,a.ht=a.t+o,a.hb=a.b-o),this._scrollView=h,this._scrollBounds=a)),this._scrollInterval&&(t.RunLoop.cancel(this._scrollInterval),this._scrollInterval=null),a&&(r=i<a.hl?-10:i>a.hr?10:0,o=n<a.ht?-10:n>a.hb?10:0,(r||o)&&(this._scrollBy={x:r,y:o},this._scrollInterval=t.RunLoop.invokePeriodically(this._scroll,100,this)))},_scroll:function(){var e=this._scrollView,i=this._scrollBy;if(e.scrollBy(i.x,i.y)){var n=this.get("cursorPosition"),s=document.elementFromPoint(n.x,n.y);s&&this._update(t.ViewEventsController.getViewFromNode(s))}},_update:function(t){for(var e=this.get("dropTarget"),i=this.get("dragSource");t&&!(t===e||t.get("isDropTarget")&&t.willAcceptDrag(this));)t=t.get("parentView")||null;t!==e&&(e&&e.dropExited(this),t&&t.dropEntered(this),e=t,this.set("dropTarget",t)),e&&e.dropMoved(this),i&&i.dragMoved(this)},drop:function(t){this.event=t;var e=this.dropEffect;return this.dropTarget&&0!==e&&8!==e&&this.dropTarget.drop(this),this}});t.Drag=i}(O),function(t){var e={BUTTON:1,INPUT:1,OPTION:1,SELECT:1,TEXTAREA:1},i=t.DragEffect.effectToString,n=t.DragEffect.DEFAULT;function s(e){var i=e.clientX,n=e.clientY,s=document.elementFromPoint(i,n)||e.target;this.touch=e,this.clientX=i,this.clientY=n,this.target=s,this.targetView=t.ViewEventsController.getViewFromNode(s)}var r=function(t,e){var i,n=t.length;if(null===e)return null;for(;n--;)if((i=t[n]).identifier===e)return i;return null},o=new t.Object({_x:0,_y:0,_targetView:null,_ignore:!0,_touchId:null,_drag:null,register:function(t){this._drag&&this._drag.endDrag(),this._drag=t},deregister:function(t){this._drag===t&&(this._drag=null,this._touchId=null)},getNearestDragView:function(t){for(;t&&!t.get("isDraggable");)t=t.get("parentView")||null;return t},handleEvent:function(t){var e;try{e=t.type}catch(t){}e&&this.fire(e,t)}.invokeInRunLoop(),_onMousedown:function(t){t.button||t.metaKey||t.ctrlKey||(e[t.target.nodeName]?this._ignore=!0:(this._x=t.clientX,this._y=t.clientY,this._targetView=t.targetView,this._ignore=!1))}.on("mousedown"),_onMousemove:function(e){var i=this._drag;if(i&&null===this._touchId)i.get("isNative")||i.move(e),e.stopPropagation();else if(!this._ignore){var n,s=e.clientX-this._x,r=e.clientY-this._y;s*s+r*r>25&&((n=this.getNearestDragView(this._targetView))&&new t.Drag({dragSource:n,event:e,startPosition:{x:this._x,y:this._y}}),this._ignore=!0)}}.on("mousemove"),_onMouseup:function(t){this._ignore=!0,this._targetView=null;var e=this._drag;e&&null===this._touchId&&e.drop(t).endDrag()}.on("mouseup"),_onHold:function(i){var n=i.touch,r=new s(n),o=this.getNearestDragView(r.targetView);o&&!e[r.target.nodeName]&&(this._drag=new t.Drag({dragSource:o,event:r}),this._touchId=n.identifier)}.on("hold"),_onTouchstart:function(t){null!==this._touchId&&(r(t.touches,this._touchId)||this._drag.endDrag())}.on("touchstart"),_onTouchmove:function(t){var e=r(t.changedTouches,this._touchId);e&&(this._drag.move(new s(e)),t.preventDefault(),t.stopPropagation())}.on("touchmove"),_onTouchend:function(t){var e=r(t.changedTouches,this._touchId);e&&this._drag.drop(new s(e)).endDrag()}.on("touchend"),_onTouchcancel:function(t){r(t.changedTouches,this._touchId)&&this._drag.endDrag()}.on("touchcancel"),_onDragstart:function(e){this.getNearestDragView(e.targetView)?e.preventDefault():new t.Drag({event:e,isNative:!0})}.on("dragstart"),_onDragover:function(e){var s,r,o=this._drag,a=e.dataTransfer,h=!0;if(e.targetView||(e.targetView=t.ViewEventsController.getViewFromNode(e.target)),o){var c=e.clientX,l=e.clientY;this._x===c&&this._y===l?h=!1:(this._x=c,this._y=l)}else{try{r=a.effectAllowed}catch(e){r=t.DragEffect.ALL}o=new t.Drag({event:e,isNative:!0,allowedEffects:i.indexOf(r)})}h&&o.move(e),(s=o.get("dropEffect"))!==n&&(a.dropEffect=i[s&o.get("allowedEffects")],e.preventDefault())}.on("dragover"),_nativeRefCount:0,_onDragenter:function(){this._nativeRefCount+=1}.on("dragenter"),_onDragleave:function(){var t=this._drag;!(this._nativeRefCount-=1)&&t&&t.endDrag()}.on("dragleave"),_onDrop:function(t){var e=this._drag;e&&(e.get("dropEffect")!==n&&t.preventDefault(),e.drop(t).endDrag())}.on("drop"),_onDragend:function(){var t=this._drag;t&&t.endDrag()}.on("dragend"),_escCancel:function(e){var i=this._drag;i&&"esc"===t.DOMEvent.lookupKey(e)&&i.endDrag()}.on("keydown")});["dragover","dragenter","dragleave","drop","dragend"].forEach(function(t){document.addEventListener(t,o,!1)}),t.ViewEventsController.addEventTarget(o,20),t.DragController=o}(O),function(t){t.DragDataSource={init:function(t){t||(t={}),this._dragData=t,this.dragDataTypes=Object.keys(t),this.get=function(t){return this[t]}},isDragDataSource:!0,allowedDragEffects:t.DragEffect.ALL,dragDataTypes:[],getDragDataOfType:function(t){return this._dragData[t]}}}(O),O.Draggable={isDraggable:!0,isDragging:!1,dragStarted:function(){},dragMoved:function(){},dragEnded:function(){}},function(t){t.DropTarget={isDropTarget:!0,hasDragOver:!1,dropEffect:t.DragEffect.MOVE,dropAcceptedDataTypes:{},willAcceptDrag:function(t){for(var e=this.get("dropAcceptedDataTypes"),i=t.get("dataTypes"),n=i.length;n--;)if(e[i[n]])return!0;return!1},dropEntered:function(t){t.set("dropEffect",this.get("dropEffect")),this.set("hasDragOver",!0)},dropMoved:function(){},dropExited:function(e){e.set("dropEffect",t.DragEffect.DEFAULT),this.set("hasDragOver",!1)},drop:function(){}}}(O),function(t){var e=t.Class({makeAsyncRequests:!0,init:function(t){var e=new XMLHttpRequest;this._isRunning=!1,this._status=0,this.io=t||null,this.xhr=e,e.upload&&(e.upload.addEventListener("progress",this,!1),e.addEventListener("progress",this,!1))},destroy:function(){this.abort();var t=this.xhr;t.upload&&(t.upload.removeEventListener("progress",this,!1),t.removeEventListener("progress",this,!1))},isRunning:function(){return!!this._isRunning},getHeader:function(t){var e;try{e=this.xhr.getResponseHeader(t)}catch(t){}return e||""},getResponse:function(){var t="";try{t=this.xhr.responseText}catch(t){}return t||""},getResponseType:function(){return this.getHeader("Content-type")},getStatus:function(){return this._status},send:function(t,e,i,n,s){this._isRunning&&this.abort(),this._isRunning=!0;var r,o=this.xhr,a=this.io,h=this;for(r in a&&a.fire("io:begin"),o.open(t,e,this.makeAsyncRequests),o.withCredentials=!!s,n||{})"Content-type"===r&&i instanceof FormData||o.setRequestHeader(r,n[r]);o.onreadystatechange=function(){h._xhrStateDidChange(this)};try{o.send(i)}catch(t){this.abort()}return this},_xhrStateDidChange:function(t){var e,i,n,s,r,o,a=t.readyState,h=this.io;a<3||!this._isRunning||(3!==a?(this._isRunning=!1,t.onreadystatechange=function(){},e=t.status,this._status=e=1223===e?204:e,h&&(s=function(t){for(var e,i,n={},s=0;;){for(;/\s/.test(t.charAt(s));)s+=1;if((e=t.indexOf(":",s))<0)break;for(i=t.slice(s,e).toLowerCase(),s=e+1;" "===t.charAt(s);)s+=1;for((e=t.indexOf("\n",s))<0&&(e=t.length);e>s&&/\s/.test(t.charAt(e-1));)e-=1;n[i]=t.slice(s,e),s=e+1}return n}(i=t.getAllResponseHeaders()),r=this.getResponseType(),o=this.getResponse(),n=e>=200&&e<300&&(!!i||!!o),h.set("uploadProgress",100).set("progress",100).set("status",e).set("responseHeaders",s).set("responseType",r).set("response",o).fire(n?"io:success":"io:failure",{status:e,headers:s,type:r,data:o}).fire("io:end"))):h&&h.set("uploadProgress",100).fire("io:loading"))}.invokeInRunLoop(),handleEvent:function(t){var e,i=this.io;i&&"progress"===t.type&&(e=t.target===this.xhr?"progress":"uploadProgress",i.set(e,Math.min(99,~~(t.loaded/t.total*100))).fire("io:"+e,t))}.invokeInRunLoop(),abort:function(){if(this._isRunning){this._isRunning=!1;var t=this.xhr,e=this.io;t.abort(),t.onreadystatechange=function(){},e&&e.fire("io:abort").fire("io:end")}return this}});t.XHR=e}(O),function(t,e){var i=e?t.Class({Extends:t.Object,url:"",init:function(e){this.readyState=2,i.parent.init.call(this,e);var n,s=["open","message","error"],r=t.meta(this).observers;for(n in r)/^__event__/.test(n)&&s.include(n.slice(9));this._eventTypes=s},on:function(t){var e=this._eventTypes,n=this._eventSource;-1===e.indexOf(t)&&(e.push(t),n&&n.addEventListener(t,this,!1)),i.parent.on.apply(this,arguments)},handleEvent:function(t){this.set("readyState",this._eventSource.readyState),this.fire(t.type,t)}.invokeInRunLoop(),open:function(){if(2===this.get("readyState")){var t=this._eventSource=new e(this.get("url"));this._eventTypes.forEach(function(e){t.addEventListener(e,this,!1)},this),this.set("readyState",t.readyState)}return this},close:function(){return this.set("readyState",2)},_sourceDidClose:function(){if(2===this.get("readyState")){var t=this._eventSource,e=this._eventTypes,i=e.length;for(t.close();i--;)t.removeEventListener(e[i],this,!1);this._eventSource=null}}.observes("readyState")}):t.Class({Extends:t.Object,readyState:0,init:function(e){i.parent.init.call(this,e),this._xhr=new t.XHR(this)},open:function(){var t={Accept:"text/event-stream","Cache-Control":"no-cache"};return this._lastEventId&&(t["Last-Event-ID"]=this._lastEventId),this._poll&&(t["X-Nginx-PushStream-Mode"]="long-polling"),this.set("readyState",0),this._data="",this._eventName="",this._processedIndex=0,this._lastNewLineIndex=0,this._xhr.send("GET",this.get("url"),null,t),this},close:function(){return 2!==this.get("readyState")&&(this._xhr.abort(),this.set("readyState",2)),this},_reconnectAfter:3e4,_lastEventId:"",_poll:!!t.UA.msie&&t.UA.msie<10,_dataDidArrive:function(){var t=this._xhr,e=t.getResponseType();e&&e.indexOf("text/event-stream")?this._failConnection():(this._openConnection(),this._processData(t.getResponse()))}.on("io:loading"),_requestDidSucceed:function(t){this._openConnection(),this._processData(t.data+"\n\n"),this._reconnect()}.on("io:success"),_requestDidFail:function(){this._failConnection()}.on("io:failure"),_openConnection:function(){0===this.get("readyState")&&this.set("readyState",1).fire("open")},_failConnection:function(){this.close().fire("error")},_reconnect:function(){this._poll?this.open():t.RunLoop.invokeAfterDelay(this.open,this._reconnectAfter,this)},_processData:function(t){var e,i=this._lastNewLineIndex,n=/\u000d\u000a?|\u000a/g;for(i||"\ufeff"!==t.charAt(0)||(i=1),n.lastIndex=this._processedIndex;e=n.exec(t);)this._processLine(t.slice(i,e.index)),i=n.lastIndex;this._lastNewLineIndex=i,this._processedIndex=t.length},_processLine:function(t){if(/^\s*$/.test(t))this._dispatchEvent();else{var e=t.indexOf(":"),i=t,n="";if(!e)return;switch(e>0&&(i=t.slice(0,e),n=t.slice(" "===t.charAt(e+1)?e+2:e+1)),i){case"event":this._eventName=n;break;case"data":this._data+=n+"\n";break;case"id":this._lastEventId=n;break;case"retry":/^\d+$/.test(n)&&(this._reconnectAfter=parseInt(n,10))}}},_dispatchEvent:function(){var t=this._data,e=this._eventName;t&&("\n"===t.slice(-1)&&(t=t.slice(0,-1)),this.fire(e||"message",{data:t,lastEventId:this._lastEventId})),this._data="",this._eventName=""}});i.extend({CONNECTING:0,OPEN:1,CLOSED:2}),t.EventSource=i}(O,"undefined"!=typeof EventSource?EventSource:null),function(t){var e={position:"absolute",top:-1e3,left:-1e3};t.FormUploader=window.FormData?t.XHR:t.Class({io:null,init:function(t){this._isSuccess=!1,this._isRunning=!1,this._response="",this.io=t||null},isRunning:function(){return this._isRunning},getResponse:function(){return this._response},getResponseType:function(){return"application/json"},getStatus:function(){return this._isRunning?0:this._isSuccess?200:400},send:function(i,n,s){if(!(s instanceof window.FormData))throw new Error("IFrameTransport only sends FormData objects");this._isRunning&&this.abort(),this._isRunning=!0,this._isSuccess=!1,this._response="";var r=this,o=document.body,a=this._transactionId="upload"+Date.now(),h="frame-"+a,c=this._iframe=t.Element.create("iframe",{id:h,name:h,styles:e}),l=this._form=s.form;return n+=(n.contains("?")?"&":"?")+"callback=top."+a,l.action=this._targetUrl=n,l.target=h,c.addEventListener("load",this._loadfn=function(){r._formFrameDidLoad()},!1),window[a]=function(t){var e=JSON.stringify(t),i=r.io;r._response=e,r._isSuccess=!0,i&&i.set("uploadProgress",100).set("progress",100).set("status",200).set("responseType","application/json").set("response",e).fire("io:success",{status:200,headers:{},type:"application/json",data:e}).fire("io:end")}.invokeInRunLoop(),o.appendChild(c),o.appendChild(l),l.submit(),this},_formFrameDidLoad:function(){var t;try{t=this._iframe.contentWindow.location.href}catch(t){}"about:blank"!==t&&(this._isRunning=!1,this._isSuccess||this.io.set("uploadProgress",100).set("progress",100).set("status",400).fire("io:failure",{status:400,headers:{},type:"",data:""}).fire("io:end"),this._complete())}.invokeInRunLoop(),abort:function(){return this._isRunning&&(this._isRunning=!1,this._complete(),this.io.fire("io:abort").fire("io:end")),this},_complete:function(){var t=document.body;t.removeChild(this._form),t.removeChild(this._iframe),this._iframe.removeEventListener("load",this._loadfn,!1),window[this._transactionId]=null,this._iframe=this._form=this._loadfn=null}}),window.FormData||(window.FormData=t.Class({init:function(){this.form=t.Element.create("form",{method:"post",enctype:"multipart/form-data",styles:e})},append:function(e,i){if("string"==typeof i)this.form.appendChild(t.Element.create("input",{type:"hidden",name:e,value:i}));else{var n=i.file;n.nodeType&&(n.name=e,this.form.appendChild(n))}}}),window.FormData.isFake=!0)}(O),function(t){var e=t.Class({Extends:t.Object,timeout:0,method:"GET",url:location.pathname,contentType:"application/x-www-form-urlencoded",headers:{Accept:"application/json, */*"},withCredentials:!1,init:function(t){this._transport=null,this._timer=null,this._lastActivity=0,this.uploadProgress=0,this.progress=0,this.status=0,this.responseType="",this.responseHeaders={},this.response="",e.parent.init.call(this,t)},setTimeout:function(){var e=this.get("timeout");e&&(this._lastActivity=Date.now(),this._timer=t.RunLoop.invokeAfterDelay(this.didTimeout,e,this))}.on("io:begin"),resetTimeout:function(){this._lastActivity=Date.now()}.on("io:uploadProgress","io:loading","io:progress"),clearTimeout:function(){var e=this._timer;e&&t.RunLoop.cancel(e)}.on("io:end"),didTimeout:function(){this._timer=null;var e=this.get("timeout")-(Date.now()-this._lastActivity);e<10?this.fire("io:timeout").abort():this._timer=t.RunLoop.invokeAfterDelay(this.didTimeout,e,this)},send:function(){var e,i=this.get("method").toUpperCase(),n=this.get("url"),s=this.get("data")||null,r=this.get("headers"),o=this.get("withCredentials"),a=s instanceof FormData&&t.FormUploader!==t.XHR?new t.FormUploader:new t.XHR;return s&&"GET"===i&&(n+=(n.contains("?")?"&":"?")+s,s=null),(e=r["Content-type"])&&"POST"===i&&"string"==typeof s&&-1===e.indexOf(";")&&(r["Content-type"]+=";charset=utf-8"),this._transport=a,a.io=this,a.send(i,n,s,r,o),this},abort:function(){var t=this._transport;t&&t.io===this&&t.abort()},_releaseXhr:function(){var e=this._transport;e instanceof t.XHR&&(e.io=null,this._transport=null)}.on("io:success","io:failure","io:abort")});t.HttpRequest=e}(O),function(t){var e=t.Class({Extends:t.Object,link:1,maxConnections:1,init:function(t){this._queue=[],this._recent=null,this.activeConnections=0,e.parent.init.call(this,t)},send:function(t){if(this.get("activeConnections")>=this.get("maxConnections"))switch(this.get("link")){case 1:this._queue.push(t);case 2:return this;case 3:this._recent.abort();break;default:throw new Error("Invalid O.IOQueue link type.")}return this.increment("activeConnections",1),t.get("nextEventTarget")||t.set("nextEventTarget",this),this._recent=t.send(),this},abort:function(t){return this._queue.erase(t),t.abort(),this},_complete:function(t){var e=t.target;this._recent===e&&(this._recent=null),e.get("nextEventTarget")===this&&e.set("nextEventTarget",null),this.increment("activeConnections",-1),this._queue.length&&this.send(this._queue.shift())}.on("io:end")});e.QUEUE=1,e.IGNORE=2,e.ABORT=3,t.IOQueue=e}(O),function(t){var e=function(t,e){var i=t+"";return i.length>3&&(i=i.replace(/(\d+?)(?=(?:\d{3})+$)/g,"$1"+e.thousandsSeparator)),i},i=t.Class({init:function(e){["macros","dateFormats"].forEach(function(t){this[t]=Object.create(this[t])},this),this.compiled={},t.merge(this,e)},code:"xx",decimalPoint:".",thousandsSeparator:",",fileSizeUnits:["B","KB","MB","GB"],getFormattedNumber:function(t){var i=t+"",n="",s=i.indexOf(".");return s>-1&&(n=i.slice(s+1),i=i.slice(0,s)),e(i,this)+(n&&this.decimalPoint+n)},getFormattedOrdinal:function(t){return t+"."},getFormattedFileSize:function(t,e){for(var i,n=this.fileSizeUnits,s=n.length-1,r=0;r<s&&t>=1e3;)t/=1e3,r+=1;return i=r<2?Math.round(t)+"":t.toFixed(e||0),this.getFormattedNumber(i)+" "+n[r]},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",use24hClock:!0,dateElementOrder:"dmy",dateFormats:{date:"%d/%m/%Y",time:function(t,e,i){return t.format(e.use24hClock?this.time24:this.time12,i)},time12:"%-I:%M %p",time24:"%H:%M",fullDate:"%A, %-d %B %Y",fullDateAndTime:"%A, %-d %B %Y %H:%M",abbreviatedFullDate:"%a, %-d %b %Y",shortDayMonth:"%-d %b",shortDayMonthYear:"%-d %b ’%y"},datePatterns:{},getFormattedDate:function(t,e,i){var n=this.dateFormats,s=n[e]||n.date;return s instanceof Function?n[e](t,this,i):t.format(s,i)},macros:{"*1":function(t,i,n){return(t||void 0===n?i:n).replace("%n",e(t,this))},"*2":function(t,i,n,s){return(1===t?i:t||void 0===s?n:s).replace("%n",e(t,this))},"*2a":function(t,i,n,s){return(t>1?n:t||void 0===s?i:s).replace("%n",e(t,this))},"*2b":function(t,i,n,s){return(t?/(?:[368]|20|30|60|80|[^0]00|0{6,})$/.test(t+"")?i:n:void 0!==s?s:i).replace("%n",e(t,this))},"*3a":function(t,i,n,s){return(t?t%10==1&&t%100!=11?n:s:i).replace("%n",e(t,this))},"*3b":function(t,i,n,s,r){var o=t%100;return(t||void 0===r?1===t?i:!t||1<=o&&o<=19?n:s:r).replace("%n",e(t,this))},"*3c":function(t,i,n,s,r){var o=t%10,a=t%100;return(t||void 0===r?1===o&&11!==a?i:0===o||10<=a&&a<=20?n:s:r).replace("%n",e(t,this))},"*3d":function(t,i,n,s,r){var o=t%10,a=t%100;return(t||void 0===r?1===o&&11!==a?i:2<=o&&o<=4&&(a<12||a>14)?n:s:r).replace("%n",e(t,this))},"*3e":function(t,i,n,s,r){return(t||void 0===r?1===t?i:2<=t&&t<=4?n:s:r).replace("%n",e(t,this))},"*3f":function(t,i,n,s,r){var o=t%10,a=t%100;return(t||void 0===r?1===t?i:2<=o&&o<=4&&(a<12||a>14)?n:s:r).replace("%n",e(t,this))},"*4a":function(t,i,n,s,r,o){var a=t%100;return(t||void 0===o?1===a?i:2===a?n:3===a||4===a?s:r:o).replace("%n",e(t,this))},"*4b":function(t,i,n,s,r,o){return(t||void 0===o?1===t||11===t?i:2===t||12===t?n:3<=t&&t<=19?s:r:o).replace("%n",e(t,this))},"*5":function(t,i,n,s,r,o,a){return(t||void 0===a?1===t?i:2===t?n:3<=t&&t<=6?s:7<=t&&t<=10?r:o:a).replace("%n",e(t,this))},"*6":function(t,i,n,s,r,o,a){var h=t%100;return(t?1===t?n:2===t?s:3<=h&&h<=10?r:11<=h&&h<=99?o:a:i).replace("%n",e(t,this))},quant:function(t,e,i,n){return t||void 0===n?1===t?"1 "+e:t+" "+(i||e+"s"):n},numerate:function(t,e,i){return 1!==t?i||e+"s":e},numf:function(t){var e=(t+"").split(".");return e[0]=e[0].replace(/(\d+?)(?=(?:\d{3})+$)/g,"$1"+this.thousandsSeparator),e.join(this.decimalPoint)},sprintf:function(t){return String.prototype.format.apply(t,Array.prototype.slice.call(arguments,1))}},translations:{},translate:function(t){var e,i,n,s,r=this.translations[t],o=!0,a=[];for(void 0===r&&(r=t),e=1,i=arguments.length;e<i;e+=1)"object"==typeof(n=arguments[e])&&(o=!1),a[e-1]=n;if(o)return(this.compiled[t]||(this.compiled[t]=function(t){var e,i,n,s,r,o,a,h="",c=0,l=0,u=t.length;t:for(;;){if(-1===(e=t.indexOf("[",l)))e=u;else{for(o=e;o--&&"~"===t[o];);if((e-o)%2==0){l=e+1;continue}}if((n=t.slice(c,e).replace(/~(.)/g,"$1"))&&(h&&(h+="+"),h+='"',h+=n.replace(/\\/g,"\\").replace(/"/g,'\\"'),h+='"'),e===u)break;for(c=l=e+1;;){if(-1===(e=t.indexOf("]",l))){h="";break t}for(o=e;o--&&"~"===t[o];);if((e-o)%2)break;l=e+1}for(a=(i=t.slice(c,e).split(",")).length,h&&(h+="+"),a>1&&(h+='lang.macros["'),r=0;r<a;r+=1){for(r>1&&(h+=","),s=(n=i[r]).length;s&&"~"===n[s-1];)n+=",",s=(n+=i[r+=1]).length;n=n.replace(/~(.)/g,"$1"),/^_(?:\*|\d+)$/.test(n)?(h+="args",h+="*"===(n=n.slice(1))?"":"["+(parseInt(n,10)-1)+"]"):r?(h+='"',h+=n.replace(/\\/g,"\\").replace(/"/g,'\\"'),h+='"'):(h+="*"===n?"quant":"#"===n?"numf":n,h+='"].call(lang,')}a>1&&(h+=")"),c=l=e+1}return new Function("lang","args","return "+(h||'""')+";")}(r)))(this,a);for(e=1,i=(s=r.split(/\[_(\d)\]/)).length;e<i;e+=2)s[e]=a[s[e]-1]||null;return s}});t.Locale=i}(O),function(t,e){var i={xx:new t.Locale({code:"xx"})},n={A:"[AaªÀ-Åà-åĀ-ąǍǎȀ-ȃȦȧᴬᵃḀḁẚẠ-ảₐ℀℁℻⒜Ⓐⓐ㍱-㍴㎀-㎄㎈㎉㎩-㎯㏂㏊㏟㏿Ａａ]",B:"[BbᴮᵇḂ-ḇℬ⒝Ⓑⓑ㍴㎅-㎇㏃㏈㏔㏝Ｂｂ]",C:"[CcÇçĆ-čᶜ℀ℂ℃℅℆ℭⅭⅽ⒞Ⓒⓒ㍶㎈㎉㎝㎠㎤㏄-㏇Ｃｃ]",D:"[DdĎďǄ-ǆǱ-ǳᴰᵈḊ-ḓⅅⅆⅮⅾ⒟Ⓓⓓ㋏㍲㍷-㍹㎗㎭-㎯㏅㏈Ｄｄ]",E:"[EeÈ-Ëè-ëĒ-ěȄ-ȇȨȩᴱᵉḘ-ḛẸ-ẽₑ℡ℯℰⅇ⒠Ⓔⓔ㉐㋍㋎Ｅｅ]",F:"[FfᶠḞḟ℉ℱ℻⒡Ⓕⓕ㎊-㎌㎙ﬀ-ﬄＦｆ]",G:"[GgĜ-ģǦǧǴǵᴳᵍḠḡℊ⒢Ⓖⓖ㋌㋍㎇㎍-㎏㎓㎬㏆㏉㏒㏿Ｇｇ]",H:"[HhĤĥȞȟʰᴴḢ-ḫẖℋ-ℎ⒣Ⓗⓗ㋌㍱㎐-㎔㏊㏋㏗Ｈｈ]",I:"[IiÌ-Ïì-ïĨ-İĲĳǏǐȈ-ȋᴵᵢḬḭỈ-ịⁱℐℑℹⅈⅠ-ⅣⅥ-ⅨⅪⅫⅰ-ⅳⅵ-ⅸⅺⅻ⒤Ⓘⓘ㍺㏌㏕ﬁﬃＩｉ]",J:"[JjĲ-ĵǇ-ǌǰʲᴶⅉ⒥ⒿⓙⱼＪｊ]",K:"[KkĶķǨǩᴷᵏḰ-ḵK⒦Ⓚⓚ㎄㎅㎉㎏㎑㎘㎞㎢㎦㎪㎸㎾㏀㏆㏍-㏏Ｋｋ]",L:"[LlĹ-ŀǇ-ǉˡᴸḶḷḺ-ḽℒℓ℡Ⅼⅼ⒧Ⓛⓛ㋏㎈㎉㏐-㏓㏕㏖㏿ﬂﬄＬｌ]",M:"[MmᴹᵐḾ-ṃ℠™ℳⅯⅿ⒨Ⓜⓜ㍷-㍹㎃㎆㎎㎒㎖㎙-㎨㎫㎳㎷㎹㎽㎿㏁㏂㏎㏐㏔-㏖㏘㏙㏞㏟Ｍｍ]",N:"[NnÑñŃ-ŉǊ-ǌǸǹᴺṄ-ṋⁿℕ№⒩Ⓝⓝ㎁㎋㎚㎱㎵㎻㏌㏑Ｎｎ]",O:"[OoºÒ-Öò-öŌ-őƠơǑǒǪǫȌ-ȏȮȯᴼᵒỌ-ỏₒ℅№ℴ⒪Ⓞⓞ㍵㏇㏒㏖Ｏｏ]",P:"[PpᴾᵖṔ-ṗℙ⒫Ⓟⓟ㉐㍱㍶㎀㎊㎩-㎬㎰㎴㎺㏋㏗-㏚Ｐｐ]",Q:"[Qqℚ⒬Ⓠⓠ㏃Ｑｑ]",R:"[RrŔ-řȐ-ȓʳᴿᵣṘ-ṛṞṟ₨ℛ-ℝ⒭Ⓡⓡ㋍㍴㎭-㎯㏚㏛Ｒｒ]",S:"[SsŚ-šſȘșˢṠ-ṣ₨℁℠⒮Ⓢⓢ㎧㎨㎮-㎳㏛㏜ﬆＳｓ]",T:"[TtŢ-ťȚțᵀᵗṪ-ṱẗ℡™⒯Ⓣⓣ㉐㋏㎔㏏ﬅﬆＴｔ]",U:"[UuÙ-Üù-üŨ-ųƯưǓǔȔ-ȗᵁᵘᵤṲ-ṷỤ-ủ℆⒰Ⓤⓤ㍳㍺Ｕｕ]",V:"[VvᵛᵥṼ-ṿⅣ-Ⅷⅳ-ⅷ⒱Ⓥⓥⱽ㋎㍵㎴-㎹㏜㏞Ｖｖ]",W:"[WwŴŵʷᵂẀ-ẉẘ⒲Ⓦⓦ㎺-㎿㏝Ｗｗ]",X:"[XxˣẊ-ẍₓ℻Ⅸ-Ⅻⅸ-ⅻ⒳Ⓧⓧ㏓Ｘｘ]",Y:"[YyÝýÿŶ-ŸȲȳʸẎẏẙỲ-ỹ⒴Ⓨⓨ㏉Ｙｙ]",Z:"[ZzŹ-žǱ-ǳᶻẐ-ẕℤℨ⒵Ⓩⓩ㎐-㎔Ｚｚ]"},s=i.xx,r={activeLocaleCode:"xx",addLocale:function(t){return i[t.code]=t,this},setLocale:function(t){return i[t]&&(s=i[t],this.activeLocaleCode=t,"undefined"!=typeof Intl&&(this.compare=new Intl.Collator(t,{sensitivity:"base"}).compare)),this},getLocale:function(t){return t?i[t]||null:s},get:function(t){return s[t]},localise:function(t){if(1===arguments.length){var e=s.translations[t];return void 0!==e?e:t}return s.translate.apply(s,arguments)},date:function(t,e,i){return s.getFormattedDate(t,e,i)},number:function(t){return s.getFormattedNumber(t)},ordinal:function(t){return s.getFormattedOrdinal(t)},fileSize:function(t,e){return s.getFormattedFileSize(t,e)},compare:function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())},makeSearchRegExp:function(t){return new RegExp("(?:^|\\W)"+t.escapeRegExp().replace(/[A-Z]/gi,function(t){return n[t.toUpperCase()]}),"i")},letterAlternatives:n};t.LocaleController=t.i18n=r,t.loc=r.localise}(O),function(t){var e=Date.formatDuration=function(e,i){var n,s,r,o,a,h=Math.abs(Math.floor(e/1e3));return h<60?n=i?t.loc(1317):t.loc(1316,h):h<3600?n=t.loc(437,~~(h/60)):h<86400?(i?(o=Math.round(h/3600),a=0):(o=~~(h/3600),a=~~(h/60%60)),n=t.loc(1315,o,a)):(i?h<1814400:h<604800)?(i?(r=Math.round(h/86400),o=0):(r=~~(h/86400),o=~~(h/3600%24)),n=t.loc(1313,r,o)):(i?(s=Math.round(h/604800),r=0):(s=~~(h/604800),r=~~(h/86400)%7),n=t.loc(1318,s,r)),n.trim()};Date.implement({relativeTo:function(i,n){i||(i=new Date);var s,r,o,a=i-this,h=a<0;return h&&(a=-a),a<864e5?s=e(a,n):a<36288e5?(n&&(a=new Date(i.getFullYear(),i.getMonth(),i.getDate())-new Date(this.getFullYear(),this.getMonth(),this.getDate())),s=e(a,n)):(r=i.getFullYear()-this.getFullYear(),o=i.getMonth()-this.getMonth(),h&&(r=-r,o=-o),o<0&&(r-=1,o+=12),s=t.loc(209,r,o).trim()),h?t.loc(1314,s):t.loc(1312,s)}})}(O),function(t){var e=t.Class({init:function(t,e){this.string=t,this.tokens=e||[]},clone:function(){return new e(this.string,this.tokens.slice())},assimilate:function(t){this.string=t.string,this.tokens=t.tokens}});e.define=function(t,e,i){return function(n){var s,r=n.string,o=e.exec(r);return o&&(s=o[0],n.tokens.push([t,s,i||null]),n.string=r.slice(s.length)),!!o}},e.optional=function(t){return function(e){return t(e),!0}},e.not=function(t){return function(e){var i=e.clone();return!t(i)}},e.repeat=function(t,e,i){return i||(i=2147483647),function(n){var s=n.clone(),r=0;do{if(!t(s))break;r+=1}while(r<i);return r>=e&&(r&&n.assimilate(s),!0)}},e.sequence=function(t){return function(e){for(var i=e.clone(),n=0,s=t.length;n<s;n+=1)if(!t[n](i))return!1;return e.assimilate(i),!0}},e.firstMatch=function(t){return function(e){for(var i=0,n=t.length;i<n;i+=1)if(t[i](e))return!0;return!1}},e.longestMatch=function(t){return function(e){var i,n,s,r=[];for(i=0,n=t.length;i<n&&(s=e.clone(),!t[i](s)||(r.push(s),s.string));i+=1);if(n=r.length,n--){for(s=r[n];n--;)r[n].string.length<=s.string.length&&(s=r[n]);return e.assimilate(s),!0}return!1}},t.Parse=e,t.parse={}}(O),function(t){var e="jan feb mar apr may jun jul aug sep oct nov dec".split(" ").reduce(function(t,e,i){return t[e]=i,t},{}),i="sun mon tue wed thu fri sat".split(" ").reduce(function(t,e,i){return t[e]=i,t},{}),n=Date.isLeapYear,s=Date.getDaysInMonth,r={interpret:function(t,e){var i,n,s,r,o={};for(i=0,n=t.length;i<n;i+=1)this[r=(s=t[i])[0]]&&this[r](o,s[1],s[2],t);return this.findDate(o,o.searchMethod||e)},findDate:function(t,e){if(!Object.keys(t).length)return null;var i=new Date,r=i.getDate();i.setDate(1),i.setHours(t.hour||0),i.setMinutes(t.minute||0),i.setSeconds(t.second||0),i.setMilliseconds(0);var o,a,h,c=t.day,l=t.month,u=t.year,d=t.weekday,f=!(!l&&0!==l),g=!(!d&&0!==d);if(c&&f&&u)c>s(l,u)?i=null:(i.setFullYear(u),i.setMonth(l),i.setDate(c));else if(f&&u)i.setFullYear(u),i.setMonth(l),g?-1!==e?c=(d-i.getDay()).mod(7)+1:(i.setDate(c=s(l,u)),c-=(i.getDay()-d).mod(7)):c=1,i.setDate(c);else if(c&&f){if(o=i.getMonth(),u=i.getFullYear(),1===e&&(l<o||l===o&&c<=r)&&(u+=1),-1===e&&(l>o||l===o&&c>=r)&&(u-=1),i.setFullYear(u),i.setMonth(l),i.setDate(c),g){if(a=29===c&&1===l){for(;!n(u);)u+=e||1;i.setFullYear(u)}for(h=(a?4:1)*(e||1);i.getDay()!==d;){do{u+=h}while(a&&!n(u));i.setFullYear(u)}}}else if(c){if(u=i.getFullYear(),l=i.getMonth(),i.setDate(c),g)for(;i.getDay()!==d||i.getDate()!==c;)-1===e?l?l-=1:(u-=1,l=11):l<11?l+=1:(u+=1,l=0),i.setFullYear(u),i.setMonth(l),i.setDate(c)}else f?(u=i.getFullYear(),o=i.getMonth(),1===e&&l<=o&&(u+=1),-1===e&&l>o&&(u-=1),i.setFullYear(u),i.setMonth(l),g&&(-1!==e?c=(d-i.getDay()).mod(7)+1:(i.setDate(c=s(l,u)),c-=(i.getDay()-d).mod(7)),i.setDate(c))):u?(i.setFullYear(u),i.setMonth(0),g&&(-1!==e?c=(d-i.getDay()).mod(7)+1:(i.setMonth(11),i.setDate(c=s(11,u)),c-=(i.getDay()-d).mod(7)),i.setDate(c))):g&&(i.setDate(r),-1===e?(i.setTime(i.getTime()-864e5),i.setTime(i.getTime()-864e5*(i.getDay()-d).mod(7))):(i.setTime(i.getTime()+864e5),i.setTime(i.getTime()+864e5*(d-i.getDay()).mod(7))));return i},weekday:function(t,e,n){t.weekday=i[n]},day:function(t,e){t.day=+e},month:function(t,e){t.month=+e-1},monthname:function(t,i,n){t.month=e[n]},year:function(t,e){var i=+e;2===e.length&&(i+=2e3)>(new Date).getFullYear()+30&&(i-=100),t.year=i},hour:function(t,e){t.hour=+e;var i=t.meridian;i&&this[i](t)},minute:function(t,e){t.minute=+e},second:function(t,e){t.second=+e},am:function(t){t.meridian="am";var e=t.hour;e&&12===e&&(t.hour=0)},pm:function(t){t.meridian="pm";var e=t.hour;e&&e<12&&(t.hour=e+12)},searchMethod:function(t,e,i){t.searchMethod="past"===i?-1:1},relativeDate:function(t,e,i){var n=new Date;switch(i){case"yesterday":n.setTime(n.getTime()-864e5);break;case"tomorrow":n.setTime(n.getTime()+864e5)}t.day=n.getDate(),t.month=n.getMonth(),t.year=n.getFullYear()}},o=t.Parse.define("unknown",/^[^\s]+/),a={},h=function(e,i,n){i||(i=t.i18n.getLocale()),e=e.trim().replace(/[０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)});for(var s=i.code+n,r=a[s]||(a[s]=function(e,i){var n=t.Parse,s=n.define,r=n.optional,o=n.not,a=n.sequence,h=n.firstMatch,c=n.longestMatch,l=e.datePatterns,u=function(t,e){return h(e.split(" ").map(function(e){return s(t,l[e],e)}))},d=s("whitespace",/^(?:[\s"']+|$)/),f=s("hour",/^(?:2[0-3]|[01]?\d)/),g=s("minute",/^[0-5][0-9]/),p=s("second",/^[0-5][0-9]/),v=h([s("am",l.am),s("pm",l.pm)]),m=a([r(d),v]),y=s("timeDelimiter",/^[:.]/),w=s("timeContext",l.timeContext),_=a([f,r(a([y,g,r(a([y,p]))])),r(m),d]);if(1===i)return h([_,a([f,g]),d]);var b=s("ordinalSuffix",l.ordinalSuffix),S=u("weekday","sun mon tue wed thu fri sat"),D=a([s("day",/^(?:[0-2]\d|3[0-1]|\d)/),r(b),o(w)]),T=a([s("month",/^(?:1[0-2]|0\d|\d)/),o(h([w,b]))]),C=u("monthname","jan feb mar apr may jun jul aug sep oct nov dec"),O=h([T,C]),x=s("year",/^\d{4}/),k=a([s("year",/^\d\d(?:\d\d)?/),o(h([w,b]))]),E=u("searchMethod","past future"),R=s("dateDelimiter",/^(?:[\s\-\.\,\'\/]|of)+/),V=u("relativeDate","yesterday tomorrow today now"),F=a(e.dateFormats.date.split(/%\-?([dmbY])/).map(function(t,e){if(1&e)switch(t){case"d":return D;case"m":return T;case"b":return C;case"Y":return k}else if(t)return s("dateDelimiter",new RegExp("^"+t.escapeRegExp()));return null}).filter(function(t){return!!t})),I=a([D,R,O,R,k]),A=a([D,R,O]),L=a([O,R,k,o(w)]),P=a([O,R,D,R,k]),M=a([O,R,D]),N=a([k,R,O,R,D]),K=a([k,R,O]),U=a([h([F,c("dmy"===e.dateElementOrder?[I,A,L,P,M,N,K]:"mdy"===e.dateElementOrder?[P,M,L,I,A,N,K]:[N,K,I,A,L,P,M])]),o(s("",/^\d/))]);return h(2===i?[U,S,x,C,D,V,E,d]:[U,_,S,x,C,D,V,E,d])}(i,n)),h=new t.Parse(e);h.string.length;)r(h)||o(h);return h.tokens};t.parse.tokeniseDateTime=h,t.parse.interpretDateTime=function(t,e){return r.interpret(t,e||0)},t.parse.time=function(t,e){var i=h(t,e,1);return r.interpret(i)},t.parse.date=function(t,e,i){var n=h(t,e,2);return r.interpret(n,i?-1:0)},t.parse.dateTime=function(t,e,i){var n=h(t,e,3);return r.interpret(n,i?-1:0)}}(O),function(t){var e=t.Class({Extends:t.Object,content:null,init:function(t){this._selectionId=0,this._lastSelectedIndex=0,this._selectedStoreKeys={},this.isLoadingSelection=!1,this.length=0,e.parent.init.call(this,t);var i=this.get("content");i&&i.on("query:updated",this,"contentWasUpdated")},contentDidChange:function(t,e,i,n){i&&i.off("query:updated",this,"contentWasUpdated"),n&&n.on("query:updated",this,"contentWasUpdated"),this.selectAll(!1)}.observes("content"),contentWasUpdated:function(t){for(var e,i=this._selectedStoreKeys,n=this.get("length"),s=t.removed,r=t.added.reduce(function(t,e){return t[e]=!0,t},{}),o=s.length;o--;)i[e=s[o]]&&!r[e]&&(n-=1,delete i[e]);this.set("length",n).propertyDidChange("selectedStoreKeys")},selectedStoreKeys:function(){return Object.keys(this._selectedStoreKeys)}.property().nocache(),isStoreKeySelected:function(t){return!!this._selectedStoreKeys[t]},selectStoreKeys:function(t,e,i){if(!i||i===this._selectionId){e=!!e;for(var n,s=this._selectedStoreKeys,r=0,o=t.length;o--;)e!==!!s[n=t[o]]&&(e?s[n]=!0:delete s[n],r+=1);r&&this.increment("length",e?r:-r).propertyDidChange("selectedStoreKeys"),this.set("isLoadingSelection",!1)}},selectIndex:function(t,e,i){var n=this._lastSelectedIndex,s=i?Math.min(t,n):t,r=(i?Math.max(t,n):t)+1;return this._lastSelectedIndex=t,this.selectRange(s,r,e)},selectRange:function(t,e,i){var n=this.get("content"),s=this._selectionId+=1;return n.getStoreKeysForObjectsInRange(t,e=Math.min(e,n.get("length")||0),function(t,e,n){this.selectStoreKeys(t,i,s,e,n)}.bind(this))&&this.set("isLoadingSelection",!0),this},selectAll:function(t){var e=this.get("content"),i=this._selectionId+=1;t?e.getStoreKeysForAllObjects(function(t,e,n){this.selectStoreKeys(t,!0,i,e,n)}.bind(this))&&this.set("isLoadingSelection",!0):(this._lastSelectedIndex=0,this._selectedStoreKeys={},this.set("length",0).propertyDidChange("selectedStoreKeys").set("isLoadingSelection",!1));return this}});t.SelectionController=e}(O),function(t){var e=t.Status.READY,i=t.Class({Extends:t.Object,allowNoSelection:!0,init:function(t){this._ignore=!1,this._range={start:-1,end:0},this.content=null,this.record=null,this.index=-1,this.isFetchingIndex=!1,i.parent.init.call(this,t);var e=this.get("content");e&&this.contentDidChange(null,"",null,e)},destroy:function(){var t=this.get("content");t&&(t.off("query:reset",this,"contentWasReset").off("query:updated",this,"contentWasUpdated"),t.removeObserverForRange(this._range,this,"recordAtIndexDidChange")),i.parent.destroy.call(this)},recordAtIndexDidChange:function(){if(!this.get("record")){var t=this.get("content");this.set("record",t&&t.getObjectAt(this.get("index"))||null)}}.queue("before"),_indexDidChange:function(){var t,e=this.get("content"),i=e?e.get("length"):0,n=this.get("index"),s=this._range;s.start=n,s.end=n+1,this._ignore||(n<0&&!this.get("allowNoSelection")||!i&&n>0?this.set("index",0):i>0&&n>=i?this.set("index",i-1):(i&&n>-1&&(t=e.getObjectAt(n)),this._ignore=!0,this.set("record",t||null),this._ignore=!1))}.observes("index"),_recordDidChange:function(){if(!this._ignore){var e=this.get("record"),i=this.get("content"),n=t.meta(this).bindings.content;n&&(this._ignore=!0,n.sync(),this._ignore=!1),e&&i?(this.set("isFetchingIndex",!0),i.indexOfStoreKey(e.get("storeKey"),0,function(t){this.get("record")===e&&this.get("content")===i&&(this._ignore=!0,this.set("index",t),this._ignore=!1,this.set("isFetchingIndex",!1))}.bind(this))):(e||this.get("allowNoSelection"))&&(this._ignore=!0,this.set("index",-1),this._ignore=!1)}}.observes("record"),setRecordInNewContent:function(e){if(!this.get("isFetchingIndex")){var i=t.meta(this).bindings.record;if(!(i&&i.isNotInSync&&i.willSyncForward)){var n=this.get("allowNoSelection"),s=this.get("record"),r=n?-1:0;e===this.get("content")&&(s&&(r=e.indexOfStoreKey(s.get("storeKey")),!n&&r<0&&(r=0)),r===this.get("index")?(s=e.getObjectAt(r),this.set("record",s||null)):this.set("index",r))}}},contentDidChange:function(t,i,n,s){var r=this._range;n&&(n.off("query:reset",this,"contentWasReset").off("query:updated",this,"contentWasUpdated"),n.removeObserverForRange(r,this,"recordAtIndexDidChange"),n.removeObserverForKey("status",this,"contentBecameReady")),s&&(s.addObserverForRange(r,this,"recordAtIndexDidChange"),s.on("query:updated",this,"contentWasUpdated").on("query:reset",this,"contentWasReset"),this.set("isFetchingIndex",!1),this._ignore||(s.is(e)?this.setRecordInNewContent(s):s.addObserverForKey("status",this,"contentBecameReady")))}.observes("content"),contentBecameReady:function(i,n){i.is(e)&&(i.removeObserverForKey(n,this,"contentBecameReady"),t.RunLoop.queueFn("before",this.setRecordInNewContent.bind(this,i)))},contentWasUpdated:function(t){var e,i,n=this.get("record"),s=n?t.added.indexOf(n.get("storeKey")):-1,r=t.removedIndexes,o=t.addedIndexes,a=this.get("content"),h=0;if(n){if(s>-1)s=o[s];else{if(-1===(s=this.get("index")))return;for(e=0,i=r.length;e<i&&r[e]<s;e+=1)h+=1;for(s-=h,e=0,i=o.length;e<i&&o[e]<=s;e+=1)s+=1}(s=Math.min(s,(a&&a.get("length")||1)-1))===this.get("index")?(n=a&&a.getObjectAt(s),this.set("record",n||null)):this.set("index",s)}},contentWasReset:function(){this._recordDidChange()}});t.SingleSelectionController=i}(O),function(t,e){var i={setItem:function(){},getItem:function(){}},n=t.Class({Extends:t.Object,init:function(t,e){this._name=t+".",this._store="file:"===location.protocol?i:e?sessionStorage:localStorage,n.parent.init.call(this)},get:function(t){if(!(t in this)){var e;try{e=this._store.getItem(this._name+t)}catch(t){}return e?this[t]=JSON.parse(e):void 0}return n.parent.get.call(this,t)},set:function(t,e){try{this._store.setItem(this._name+t,JSON.stringify(e))}catch(t){}return n.parent.set.call(this,t,e)}});t.LocalStorage=n}(O),function(t){var e=function(t,e,i){var n,s,r=t.length-1;for(n=t[r];r--&&!((s=t[r])[0]<e-(i?0:s[1]));)n=s;return n},i=function(t,e,n,s,r){for(var o,a,h,c,l,u,d,f,g,p=t.length,v=n.getUTCFullYear(),m=null;p--&&!((o=t[p])[1]<v);)o[0]<=v&&(u=o[2],d=o[3]||Date.getDaysInMonth(u,v),a=new Date(Date.UTC(v,u,d)),(f=o[4])&&(g=(Math.abs(f)-a.getUTCDay()+6)%7)&&a.add(f<1?g-7:g),a.setUTCHours(o[5]),a.setUTCMinutes(o[6]),a.setUTCSeconds(o[7]),(h=!o[8])!==s&&(a.add((h?1:-1)*e,"second"),2===o[8]&&Math.abs(a-n)<=108e5&&(c=i(t,e,new Date(n-864e5),s,!0))&&a.add((h?1:-1)*c[9],"second")),s||(a.add(o[9],"second"),Math.abs(a-n)<=108e5&&(c=c||i(t,e,new Date(n-864e5),s,!0))&&a.add(c[9],"second")),a<=n&&(!l||a>l)&&(m=o,l=a));return!m&&r?i(t,e,new Date(Date.UTC(v-1,11,31,12,0,0)),s,!1):m},n=t.Class({init:function(t,e){var i=t.replace(/_/g," ");/GMT[+-]/.test(i)&&(i=i.replace(/[+-]/,function(t){return"+"===t?"-":"+"})),this.id=t,this.name=i,this.periods=e},convert:function(t,s){var r=e(this.periods,t),o=r[1],a=i(n.rules[r[2]]||[],o,t,s,!0);return a&&(o+=a[9]),s||(o=-o),new Date(+t+1e3*o)},convertDateToUTC:function(t){return this.convert(t,!1)},convertDateToTimeZone:function(t){return this.convert(t,!0)},getSuffix:function(t){var s=e(this.periods,t,!1),r=s[1],o=i(n.rules[s[2]],r,t,!1,!0),a=s[3],h=a.indexOf("/");return o&&h>-1&&(a=o[9]?a.slice(h+1):a.slice(0,h),o=null),a.format(o?o[10]:"")},toJSON:function(){return this.id}});n.fromJSON=function(t){return n[t]||null},n.isEqual=function(t,e){return t.id===e.id};var s=function(t){var e,i=n.areas,s=t.name.split("/"),r=s.length-1;for(e=0;e<r;e+=1)i=i[s[e]]||(i[s[e]]={});i[s[r]]=t,n[t.id]=t};n.rules={"-":[]},n.areas={},n.load=function(e){var i,r=e.zones,o=e.link,a=e.alias;for(i in r)s(new n(i,r[i]));for(i in o)s(new n(i,r[o[i]]||n[o[i]].periods));for(i in a)n[i]=n[a[i]];t.extend(n.rules,e.rules)},t.TimeZone=n}(O),function(t){var e=new t.Object({_gestures:[],register:function(t){this._gestures.push(t)},deregister:function(t){this._gestures.erase(t)},isMouseDown:!1,fire:function(t,e){if(/^touch/.test(t)){var i=this._gestures,n=i.length;for(t=t.slice(5);n--;)i[n][t](e)}e.button||("mousedown"===t&&this.set("isMouseDown",!0),"mouseup"===t&&this.set("isMouseDown",!1)),e.propagationStopped=!1}});t.ViewEventsController.addEventTarget(e,30),t.GestureManager=e}(O),function(t){t.Gesture=t.Class({init:function(e){t.extend(this,e),t.GestureManager.register(this)},destroy:function(){t.GestureManager.deregister(this)},cancel:function(){},start:function(){},move:function(){},end:function(){}})}(O),function(t){var e=t.Class({init:function(e,i){this.target=e,this.stop=i,this.time=Date.now(),t.ViewEventsController.addEventTarget(this,40)},fire:function(e,i){var n="click"===e&&!i.originalType||/^mouse/.test(e);("touchstart"===e||Date.now()-this.time>1e3)&&(t.ViewEventsController.removeEventTarget(this),n=!1),n&&(this.stop||i.target!==this.target)&&i.preventDefault(),i.propagationStopped=n}}),i=t.Class({Extends:t.Event,originalType:"tap"}),n=function(e,i,n,s){this.x=e,this.y=i,this.time=n;var r=this.activeEls=[];do{/^(?:A|BUTTON|INPUT|LABEL)$/.test(s.nodeName)&&(r.push(s),t.Element.addClass(s,"tap-active"))}while(s=s.parentNode)};n.prototype.done=function(){var e,i,n=this.activeEls;for(e=0,i=n.length;e<i;e+=1)t.Element.removeClass(n[e],"tap-active")};var s=function(t){var e=t.nodeName,i=!1;if("INPUT"===e||"BUTTON"===e||"TEXTAREA"===e||"SELECT"===e)return!0;for(;t&&"inherit"===t.contentEditable;)"A"===t.nodeName&&(i=!0),t=t.parentNode;if(t&&"true"===t.contentEditable)return!0;for(;!i&&t;)"A"===t.nodeName&&(i=!0),t=t.parentNode;return i};t.Tap=new t.Gesture({_tracking:{},cancel:function(){var t,e=this._tracking;for(t in e)e[t].done();this._tracking={}},start:function(t){var e,i,s,r,o=t.changedTouches,a=this._tracking,h=Date.now();for(e=0,i=o.length;e<i;e+=1)a[r=(s=o[e]).identifier]||(a[r]=new n(s.screenX,s.screenY,h,s.target))},move:function(t){var e,i,n,s,r,o,a,h=t.changedTouches,c=this._tracking;for(e=0,i=h.length;e<i;e+=1)(r=c[s=(n=h[e]).identifier])&&(o=n.screenX-r.x)*o+(a=n.screenY-r.y)*a>25&&(r.done(),delete c[s])},end:function(n){var r,o,a,h,c,l,u,d,f=n.changedTouches,g=this._tracking,p=Date.now(),v=t.ViewEventsController;for(r=0,o=f.length;r<o;r+=1)(c=g[h=(a=f[r]).identifier])&&(p-c.time<200&&(l=a.target,u=new i("tap",l),v.handleEvent(u),(d=new i("click",l)).defaultPrevented=u.defaultPrevented,v.handleEvent(d),s(l)||n.preventDefault(),new e(l,d.defaultPrevented)),c.done(),delete g[h])}})}(O),function(t){var e=t.Class({Extends:t.Event,init:function(t){e.parent.init.call(this,"hold",t.target),this.touch=t}}),i=function(){this._ignore||t.ViewEventsController.handleEvent(new e(this.touch))},n=function(e){this.touch=e,this.x=e.screenX,this.y=e.screenY,this.target=e.target,this._ignore=!1,t.RunLoop.invokeAfterDelay(i,750,this)};n.prototype.done=function(){this._ignore=!0},t.Hold=new t.Gesture({_tracking:{},cancel:t.Tap.cancel,start:function(t){var e,i,s,r,o=t.changedTouches,a=this._tracking;for(e=0,i=o.length;e<i;e+=1)a[r=(s=o[e]).identifier]||(a[r]=new n(s))},move:t.Tap.move,end:function(t){var e,i,n,s,r=t.changedTouches,o=this._tracking;for(e=0,i=r.length;e<i;e+=1)(s=o[n=r[e].identifier])&&(s.done(),delete o[n])}})}(O),function(t){var e=t.Class({Extends:t.Object,init:function(t){e.parent.init.call(this,t),this._seenMouseDown=!1},inView:function(t){for(var e=t.targetView,i=this.get("view");e&&e!==i;)e=e.get("parentView");return!!e},handleMouse:function(t){var e,i=t.type;t.seenByModal||this.inView(t)||(t.stopPropagation(),"mousedown"===i?this._seenMouseDown=!0:"click"===i&&(t.preventDefault(),this._seenMouseDown&&(e=this.get("view")).clickedOutside&&e.clickedOutside(t))),t.seenByModal=!0}.on("click","mousedown","mouseup","tap"),handleScroll:function(){this._seenMouseDown=!1}.on("scroll"),handleKeys:function(t){if(!t.seenByModal&&!this.inView(t)){t.stopPropagation();var e=this.get("view");e.keyOutside&&e.keyOutside(t)}t.seenByModal=!0}.on("keypress","keydown","keyup"),handleTouch:function(t){t.seenByModal||this.inView(t)||(t.preventDefault(),t.stopPropagation(),this._seenMouseDown=!0),t.seenByModal=!0}.on("touchstart")});t.ModalEventHandler=e}(O),function(t){var e=t.Class({Extends:t.View,className:"v-PopOver",positioning:"absolute",isVisible:!1,parentPopOverView:null,ariaAttributes:{modal:"true"},show:function(i){if(i.alignWithView===this)return this.get("subPopOverView").show(i);this.hide(),this._options=i;var n,s,r,o,a=this.get("eventHandler"),h=i.view,c=i.alignWithView,l=i.atNode||c.get("layer"),u=l.offsetWidth,d=l.offsetHeight,f=i.positionToThe||"bottom",g=i.alignEdge||"left",p=i.inParent,v=0,m=0,y=t.Element,w=y.create,_=t.RootView,b=t.ScrollView;if(!p)for(p=i.atNode?c:c.get("parentView");!(p instanceof _||p instanceof b||p instanceof e);)p=p.get("parentView");switch(n={top:(s=y.getPosition(l,p.get("layer"))).top,left:s.left},f){case"right":n.left+=u;case"left":switch(g){case"middle":d>>=1;case"bottom":n.top+=d}break;case"bottom":n.top+=d;case"top":switch(g){case"centre":u>>=1;case"right":n.left+=u}}for(o in n.top+=i.offsetTop||0,n.left+=i.offsetLeft||0,n)n[o]=Math.round(n[o]);switch(this.set("layout",n),this.insertView(h),this.render(),r=this.get("layer"),i.showCallout&&r.appendChild(w("b",{className:"v-PopOver-callout v-PopOver-callout--"+f.charAt(0)+" v-PopOver-callout--"+g},[this._callout=w("b",{className:"v-PopOver-triangle v-PopOver-triangle--"+f.charAt(0)})])),p.insertView(this),f){case"left":v-=r.offsetWidth;case"right":switch(g){case"middle":m-=r.offsetHeight>>1;break;case"bottom":m-=r.offsetHeight}break;case"top":m-=r.offsetHeight;case"bottom":switch(g){case"centre":v-=r.offsetWidth>>1;break;case"right":v-=r.offsetWidth}}return this.adjustPosition(v,m),a&&t.ViewEventsController.addEventTarget(a,10),this.set("isVisible",!0),this},adjustPosition:function(i,n){var s,r,o=t.Element,a=this.get("parentView"),h=this.get("layer"),c=this.get("layout"),l=this._options.positionToThe||"bottom",u=this._callout,d=0,f="top"===l||"bottom"===l;i||(i=0),n||(n=0),a instanceof e&&(a=a.getParent(t.ScrollView)||a.getParent(t.RootView)),s=o.getPosition(h,a.get("layer")),a.get("showScrollbarX")||(r=a.get("pxWidth")-s.left-i-h.offsetWidth)<0&&(i+=r,i-=10,u&&f&&(d+=r,d-=10)),(r=s.left+i)<0&&(i-=r,i+=10,u&&f&&(d-=r,d+=10)),a.get("showScrollbarY")||(r=a.get("pxHeight")-s.top-n-h.offsetHeight)<0&&(n+=r,n-=10,u&&!f&&(d+=r,d-=10)),(r=s.top+n)<0&&(n-=r,n+=10,u&&!f&&(d-=r,d+=10)),(i||n)&&this.set("layout",{top:c.top+n,left:c.left+i}).redraw(),d&&o.setStyle(u,f?"left":"top",-d+"px")},didLeaveDocument:function(){return e.parent.didLeaveDocument.call(this),this.hide(),this},hide:function(){if(this.get("isVisible")){var e,i,n,s=this.hasSubView()?this.get("subPopOverView"):null,r=this.get("eventHandler"),o=this._options;s&&s.hide(),this.set("isVisible",!1),i=this.get("childViews")[0],this.detach(),this.removeView(i),o.showCallout&&((n=this.get("layer")).removeChild(n.firstChild),this._callout=null),r&&(t.ViewEventsController.removeEventTarget(r),r._seenMouseDown=!1),this._options=null,(e=o.onHide)&&e(o,this)}return this},hasSubView:function(){return!!t.meta(this).cache.subPopOverView&&this.get("subPopOverView").get("isVisible")},subPopOverView:function(){return new t.PopOverView({parentPopOverView:this})}.property(),eventHandler:function(){return this.get("parentPopOverView")?null:new t.ModalEventHandler({view:this})}.property(),clickedOutside:function(){this.hide()},keyOutside:function(t){for(var e=this;e.hasSubView();)e=e.get("subPopOverView");e.get("childViews")[0].fire(t.type,t),"keydown"===t.type&&e.closeOnEsc(t)},closeOnEsc:function(e){"esc"===t.DOMEvent.lookupKey(e)&&this.hide()}.on("keydown"),stopEvents:function(t){t.stopPropagation()}.on("click","mousedown","mouseup","keypress","keydown","keyup","tap")});t.PopOverView=e}(O),function(t,e){var i=t.Class({Extends:t.View,isDisabled:!1,isFocussed:!1,label:"",name:void 0,value:!1,tabIndex:void 0,shortcut:"",tooltip:function(){var e=this.get("shortcut");return e?t.loc(0,e.split(" ").map(t.formatKeyForPlatform).join(" "+t.loc(10)+" ")):""}.property("shortcut"),didEnterDocument:function(){var e=this.get("shortcut");return e&&e.split(" ").forEach(function(e){t.ViewEventsController.kbShortcuts.register(e,this,"activate")},this),i.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e=this.get("shortcut");return e&&e.split(" ").forEach(function(e){t.ViewEventsController.kbShortcuts.deregister(e,this,"activate")},this),t.UA.isIOS&&this.get("isFocussed")&&this.blur(),i.parent.willLeaveDocument.call(this)},layerTag:"label",_domControl:null,_domLabel:null,draw:function(t,e,i){var n=this._domControl,s=this.get("name"),r=this.get("shortcut"),o=this.get("tabIndex");return n.id||(n.id=this.get("id")+"-input"),n.disabled=this.get("isDisabled"),void 0!==s&&(n.name=s),void 0!==o&&(n.tabIndex=o),r&&/^\w$/.test(r)&&(n.accessKey=r),t.title=this.get("tooltip"),this._domLabel=i("span.label",[this.get("label")])},abstractControlNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("isDisabled","label","name","tooltip","tabIndex"),redrawIsDisabled:function(){this._domControl.disabled=this.get("isDisabled")},redrawLabel:function(){for(var e,i=this._domLabel;e=i.firstChild;)i.removeChild(e);t.Element.appendChildren(i,[this.get("label")])},redrawName:function(){this._domControl.name=this.get("name")},redrawTooltip:function(t){t.title=this.get("tooltip")},redrawTabIndex:function(){this._domControl.tabIndex=this.get("tabIndex")},focus:function(){return this.get("isInDocument")&&(this._domControl.focus(),this.get("isFocussed")||this.fire("focus")),this},blur:function(){return this.get("isInDocument")&&(this._domControl.blur(),this.get("isFocussed")&&this.fire("blur")),this},_updateIsFocussed:function(t){this.set("isFocussed","focus"===t.type)}.on("focus","blur"),activate:function(){}});t.AbstractControlView=i}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,isActive:!1,isWaiting:!1,type:"",icon:"",layerTag:"button",className:function(){var t=this.get("type");return"v-Button"+(t?" "+t:"")+(this.get("icon")?" v-Button--hasIcon":"")+(this.get("shortcut")?" v-Button--hasShortcut":"")+(this.get("isActive")?" is-active":"")+(this.get("isWaiting")?" is-waiting":"")+(this.get("isDisabled")?" is-disabled":"")}.property("type","icon","shortcut","isActive","isWaiting","isDisabled"),draw:function(t,i,n){var s=this.get("icon");return this._domControl=t,[n("i",{className:s?"icon "+s:"u-hidden"}),e.parent.draw.call(this,t,i,n)]},buttonNeedsRedraw:function(t,e,i){return"isWaiting"===e&&(e="isDisabled"),this.propertyNeedsRedraw(t,e,i)}.observes("icon","isWaiting"),redrawIcon:function(t){var e=this.get("icon");t.firstChild.className=e?"icon "+e:"u-hidden"},redrawIsDisabled:function(){this._domControl.disabled=this.get("isDisabled")||this.get("isWaiting")},target:null,action:null,method:null,activate:function(){if(!this.get("isDisabled")&&!this.get("isWaiting")){var t,e=this.get("target")||this;(t=this.get("action"))?e.fire(t,{originView:this}):(t=this.get("method"))&&e[t](this),this.fire("button:activate")}},_ignoreUntil:0,_setIgnoreUntil:function(){this._ignoreUntil=Date.now()+200},_activateOnClick:function(e){this._ignoreUntil>Date.now()||e.button||e.metaKey||e.ctrlKey||("mouseup"!==e.type||this.getParent(t.MenuView))&&(this._ignoreUntil=41024448e5,t.RunLoop.invokeInNextEventLoop(this._setIgnoreUntil,this),this.activate(),e.preventDefault(),this.blur())}.on("mouseup","click"),_activateOnEnter:function(e){"enter"===t.DOMEvent.lookupKey(e)&&(this.activate(),e.stopPropagation())}.on("keypress")});t.ButtonView=e}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,type:"",className:function(){var t=this.get("type");return"v-Checkbox "+(this.get("value")?"is-checked":"is-unchecked")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","value","isDisabled"),draw:function(t,i,n){return[this._domControl=n("input",{className:"v-Checkbox-input",type:"checkbox",checked:this.get("value")}),e.parent.draw.call(this,t,i,n)]},checkboxNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("value"),redrawValue:function(){this._domControl.checked=this.get("value")},activate:function(){this.get("isDisabled")||this.toggle("value")},syncBackValue:function(t){var e="tap"===t.type;if((e||!t.originalType)&&t.targetView===this&&!this.get("isDisabled")){var i=this._domControl,n=i.checked;(e||t.target!==i)&&(t.preventDefault(),n=!n),this.set("value",n)}}.on("click","tap")});t.CheckboxView=e}(O),function(t,e){var i=FormData.isFake?null:"multiple",n=t.Class({Extends:t.ButtonView,acceptMultiple:!1,acceptOnlyTypes:"",layerTag:"label",type:"v-FileButton",draw:function(e,n,s){var r=this.get("icon");return[s("i",{className:r?"icon "+r:"u-hidden"}),this._domControl=s("input",{className:"v-FileButton-input",type:"file",accept:this.get("acceptOnlyTypes")||void 0,multiple:this.get("acceptMultiple")&&i}),t.AbstractControlView.prototype.draw.call(this,e,n,s)]},_activateOnClick:null,_activateOnEnter:null,activate:function(){this._domControl.click()},_fileWasChosen:function(e){var n,s,r,o,a=this._domControl;e.target===a&&(a.parentNode.replaceChild(this._domControl=t.Element.create("input",{className:"v-FileButton-input",type:"file",disabled:this.get("isDisabled"),tabIndex:this.get("tabIndex"),accept:this.get("acceptOnlyTypes")||void 0,multiple:this.get("acceptMultiple")&&i}),a),n=!FormData.isFake&&a.files?Array.prototype.slice.call(a.files):[{name:(s=a.value.replace(/\\/g,"/")).slice(s.lastIndexOf("/")+1),size:0,type:"",file:a}],this.get("isDisabled")||(r=this.get("target")||this,(o=this.get("action"))?r.fire(o,{originView:this,files:n}):(o=this.get("method"))&&r[o](n,this),this.fire("button:activate")))}.on("change")});t.FileButtonView=n}(O),function(t){var e=t.Class({Extends:t.View,layerTag:"span",value:"",tooltip:"",draw:function(t){t.title=this.get("tooltip"),t.textContent=this.get("value")},labelNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("tooltip","value"),redrawTooltip:function(t){t.title=this.get("tooltip")},redrawValue:function(t){t.textContent=this.get("value")}});t.LabelView=e}(O),function(t){var e=t.Class({Extends:t.ButtonView,type:"v-MenuButton",popOverView:null,popOverOptions:{},menuView:null,alignMenu:"left",isInMenu:function(){return this.get("parentView")instanceof t.MenuOptionView}.property("parentView"),didCreateLayer:function(t){t.setAttribute("aria-expanded","false")},ariaNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,"aria",i)}.observes("isActive"),redrawAria:function(t){t.setAttribute("aria-controls",this.getFromPath("menuView.id")),t.setAttribute("aria-expanded",this.get("isActive")+"")},activate:function(){if(!this.get("isActive")&&!this.get("isDisabled")){this.set("isActive",!0);var e,i,n,s=this,r=t.extend({view:this.get("menuView"),alignWithView:s,alignEdge:this.get("alignMenu"),onHide:function(){s.set("isActive",!1),i&&i.removeObserverForKey("isFocussed",e,"hide")}},this.get("popOverOptions"));this.get("isInMenu")?(e=this.getParent(t.PopOverView),i=this.get("parentView"),n=s.getParent(t.RootView),r.alignWithView=e,r.atNode=this.get("layer"),r.positionToThe=s.getPositionRelativeTo(n).left+s.get("pxWidth")+180<n.get("pxWidth")?"right":"left",r.alignEdge="top",r.offsetTop=r.view.get("showFilter")?-35:-5):e=this.get("popOverView"),e=e.show(r),i&&i.addObserverForKey("isFocussed",e,"hide")}},_activateOnMousedown:function(t){t.button||t.metaKey||t.ctrlKey||this.activate()}.on("mousedown")});t.MenuButtonView=e}(O),function(t){var e=t.Class({Extends:t.Object,options:[],canSelect:function(t){return!t.get("isHidden")&&!t.get("isDisabled")},focussedOption:null,getAdjacentOption:function(t){var e,i=this.get("options"),n=i.get("length"),s=i.indexOf(this.get("focussedOption"));s<0&&t<0&&(s=n),e=s.mod(n);do{s=(s+t).mod(n)}while(n&&!this.canSelect(i.getObjectAt(s))&&s!==e);return i.getObjectAt(s)},focusPrevious:function(t){return t&&t.preventDefault(),this.focusOption(this.getAdjacentOption(-1))},focusNext:function(t){return t&&t.preventDefault(),this.focusOption(this.getAdjacentOption(1))},focusOption:function(t){var e=this.get("focussedOption");return e!==t&&(e&&e.set("isFocussed",!1),t&&(this.canSelect(t)?t.set("isFocussed",!0):t=null),this.set("focussedOption",t)),this},blurOption:function(t){return this.get("focussedOption")===t&&this.focusOption(null),this},selectFocussed:function(t){t&&t.preventDefault();var e=this.get("focussedOption");return e&&this.canSelect(e)&&e.activate(this),this},filter:"",filterDidChange:function(){for(var e=this.get("filter"),i=e?t.i18n.makeSearchRegExp(e):null,n=this.get("options"),s=n.get("length"),r=this.get("focussedOption");s--;)n.getObjectAt(s).filter(i);r&&this.canSelect(r)||this.focusOption(null).focusNext()}.observes("filter"),keyBindings:{esc:"onEscape",enter:"selectFocussed",up:"focusPrevious",down:"focusNext",left:"closeIfSub",right:"activateIfMenu"},triggerKeyBinding:function(e){var i=t.DOMEvent.lookupKey(e),n=this.get("keyBindings");n[i]&&(e.stopPropagation(),this[n[i]](e,i))}.on("keydown"),onEscape:function(t){t.preventDefault(),this.get("filter")?this.set("filter",""):this.get("view").hide()},closeIfSub:function(){var e,i=this.get("view");!i.get("showFilter")&&(e=i.getParent(t.PopOverView))&&e.get("parentPopOverView")&&i.hide()},activateIfMenu:function(){var e=this.get("focussedOption");e&&e.get("button")instanceof t.MenuButtonView&&this.selectFocussed()}}),i=t.Class({Extends:t.View,isHidden:!1,isDisabled:function(){return this.getFromPath("button.isDisabled")}.property("button.isDisabled"),isFocussed:!1,isFocussable:function(){return!this.get("isHidden")&&!this.get("isDisabled")}.property("isHidden","isDisabled"),layerTag:"li",className:function(){return"v-MenuOption"+(this.get("isFocussed")?" is-focussed":"")+(this.get("isHidden")?" u-hidden":"")}.property("isFocussed","isHidden"),init:function(t,e){this.childViews=[t],this.button=t,this.controller=e,i.parent.init.call(this)},scrollIntoView:function(){if(this.get("isFocussed")){var e=this.getParent(t.ScrollView);if(e){var i=e.get("pxHeight"),s=e.get("scrollTop"),r=this.getPositionRelativeTo(e).top,o=this.get("pxHeight");r<s?e.scrollTo(0,r-(o>>1),!0):r+o>s+i&&e.scrollTo(0,r+o-i+(o>>1),!0)}this.getParent(n).get("showFilter")||this.button.focus()}}.observes("isFocussed"),_focusTimeout:null,takeFocus:function(){this.get("isInDocument")&&this.get("controller").focusOption(this).activateIfMenu()},mouseMove:function(){if(!this.get("isFocussed")&&!this._focusTimeout){var e=this.getParent(t.PopOverView);e&&e.hasSubView()?this._focusTimeout=t.RunLoop.invokeAfterDelay(this.takeFocus,75,this):this.takeFocus()}}.on("mousemove"),mouseOut:function(){this._focusTimeout&&(t.RunLoop.cancel(this._focusTimeout),this._focusTimeout=null),this.get("button").get("isActive")||this.get("controller").blurOption(this)}.on("mouseout"),filter:function(t){var e=this.get("button").get("label");this.set("isHidden",!!t&&!t.test(e))},activate:function(){var t=this.get("button");t.activate&&t.activate()}}),n=t.Class({Extends:t.View,className:"v-Menu",showFilter:!1,closeOnActivate:!0,didCreateLayer:function(t){n.parent.didCreateLayer.call(this,t),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseout",this,!1)},willDestroyLayer:function(t){t.removeEventListener("mouseout",this,!1),t.removeEventListener("mousemove",this,!1),n.parent.willDestroyLayer.call(this,t)},didEnterDocument:function(){n.parent.didEnterDocument.call(this);var e,i,s,r,o=this._scrollView;return o&&(e=(this.getParent(t.ScrollView)||this.getParent(t.RootView)).get("pxHeight"),i=this.get("layer").getBoundingClientRect().bottom-e,o.set("layout",{maxHeight:Math.max(o.get("pxHeight")-i-10,e/2)}).redraw()),this.get("showFilter")&&(s=this.get("controller"),r=this._input,s.get("focussedOption")||s.focusNext(),t.RunLoop.invokeInNextFrame(function(){r.focus().set("selection",{start:0,end:r.get("value").length})})),this},didLeaveDocument:function(){var t=this.get("controller");return this.get("showFilter")?t.set("filter",""):t.focusOption(null),n.parent.didLeaveDocument.call(this)},mayHaveResized:function(){this.parentViewDidResize()}.queue("after").observes("controller.filter"),nextEventTarget:function(){return this.get("controller")}.property("controller"),controller:function(){return new e({view:this})}.property(),ItemView:i,draw:function(e,i,n){var s=this.get("controller"),r=this.get("ItemView"),o=this.get("options").map(function(t){return new r(t,s)});return s.set("options",o),[this.get("showFilter")?n("div.v-Menu-filter",[this._input=new t.SearchTextView({blurOnKeys:{},value:t.bindTwoWay("filter",this.get("controller"))})]):null,this._scrollView=new t.ScrollView({positioning:"relative",layout:{},layerTag:"ul",childViews:o})]},hide:function(){var e=this.get("parentView");e&&t.RunLoop.invokeInNextFrame(e.hide,e)},hideAll:function(){if(this.get("closeOnActivate")){var e,i=this.getParent(t.PopOverView)||this.get("parentView");if(i){for(;e=i.get("parentPopOverView");)i=e;t.RunLoop.invokeInNextFrame(i.hide,i)}}}.on("button:activate"),fireShortcut:function(e){if(!this.get("showFilter")){var i,n,s,r=t.DOMEvent.lookupKey(e),o=t.ViewEventsController.kbShortcuts.getHandlerForKey(r);if(o&&(i=n=o[0],s=o[1],n instanceof t.View)){for(;i&&i!==this;)i=i.get("parentView");i&&(n[s](e),e.preventDefault())}}}.on("keypress")});t.MenuController=e,t.MenuOptionView=i,t.MenuView=n}(O),function(t){var e=t.Class({Extends:t.AbstractControlView,type:"",className:function(){var t=this.get("type");return"v-Radio "+(this.get("value")?"is-checked":"is-unchecked")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","value","isDisabled"),draw:function(t,i,n){return[this._domControl=n("input",{className:"v-Radio-input",type:"radio",checked:this.get("value")}),e.parent.draw.call(this,t,i,n)]},radioNeedsRedraw:t.CheckboxView.prototype.checkboxNeedsRedraw,redrawValue:t.CheckboxView.prototype.redrawValue,activate:function(){this.get("isDisabled")||this.set("value",!0)}.on("click")});t.RadioView=e}(O),function(t,e,i,n){var s=function(t){return function(e){var i=this.get("editor");return i&&i[t](e),this}},r=function(t){var e=new RegExp("(?:^|>)"+t+"\\b");return function(){var i=this.get("path");return"(selection)"===i?this.get("editor").hasFormat(t):e.test(i)}.property("path")},o=RegExp.email,a=/^(?:https?:\/\/)?[\w.]+[.][a-z]{2,4}(?:\/[^\s()<>]+|\([^\s()<>]+\))*/i,h=new t.PopOverView,c=t.ButtonView,l=t.Transform.isEqualToValue,u=t.UA,d=t.Class({Extends:t.View,prompt:"",placeholder:"",confirm:"",value:"",className:"v-UrlPicker",draw:function(e,i,n){return[n("h3.u-bold",[this.get("prompt")]),this._input=new t.TextView({value:t.bindTwoWay(this,"value"),placeholder:this.get("placeholder")}),n("p.u-alignRight",[new c({type:"v-Button--destructive v-Button--size13",label:t.loc(1),target:h,method:"hide"}),new c({type:"v-Button--constructive v-Button--size13",label:this.get("confirm"),target:this,method:"add"})])]},autoFocus:function(){this.get("isInDocument")&&(this._input.set("selection",this.get("value").length).focus(),this._input.fire("focus"))}.nextFrame().observes("isInDocument"),addOnEnter:function(e){"enter"===t.DOMEvent.lookupKey(e)&&this.add()}.on("keyup")}),f=t.Class({Extends:t.View,Mixin:t.DropTarget,isFocussed:!1,isDisabled:!1,tabIndex:void 0,label:void 0,allowTextSelection:!0,showToolbar:!u.isIOS,fontFaceOptions:[["Default",null],["Arial","arial, sans-serif"],["Georgia","georgia, serif"],["Helvetica","helvetica, arial, sans-serif"],["Monospace","menlo, consolas, monospace"],["Tahoma","tahoma, sans-serif"],["Times New Roman",'"Times New Roman", times, serif'],["Trebuchet MS",'"Trebuchet MS", sans-serif'],["Verdana","verdana, sans-serif"]],fontSizeOptions:function(){return[[t.loc(806),"10px"],[t.loc(805),null],[t.loc(804),"16px"],[t.loc(1186),"22px"]]}.property(),editor:null,editorClassName:"",styles:null,blockDefaults:null,_value:"",value:function(t){var e=this.get("editor");return e?void 0!==t?e.setHTML(t):t=e.getHTML():void 0!==t?this._value=t:t=this._value,t}.property().nocache(),destroy:function(){var t=this.get("editor");t&&t.destroy(),f.parent.destroy.call(this)},willEnterDocument:function(){return this.set("path",""),f.parent.willEnterDocument.call(this),this.get("layer").appendChild(this._editingLayer),this},didEnterDocument:function(){var e=this.getParent(t.ScrollView);return e&&(this.get("showToolbar")&&e.addObserverForKey("scrollTop",this,"_calcToolbarPosition"),t.UA.isIOS&&e.addObserverForKey("scrollTop",this,"redrawIOSCursor")),f.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e=this.getParent(t.ScrollView);return e&&(this.get("showToolbar")&&(e.removeObserverForKey("scrollTop",this,"_calcToolbarPosition"),this._setToolbarPosition(e,this.get("toolbarView"),!1)),t.UA.isIOS&&e.removeObserverForKey("scrollTop",this,"redrawIOSCursor")),f.parent.willLeaveDocument.call(this)},didLeaveDocument:function(){return i.createDocumentFragment().appendChild(this._editingLayer),f.parent.didLeaveDocument.call(this)},className:function(){return"v-RichText"+(this.get("isFocussed")?" is-focussed":"")+(this.get("isDisabled")?" is-disabled":"")+(this.get("showToolbar")?"":" v-RichText--noToolbar")}.property("isFocussed","isDisabled"),draw:function(e,n,s){var r=this.get("editorClassName"),o=this._editingLayer=s("div",{role:"textbox","aria-multiline":"true","aria-label":this.get("label"),tabIndex:this.get("tabIndex"),className:"v-RichText-input"+(r?" "+r:"")});i.createDocumentFragment().appendChild(o);var a=new Squire(o,this.get("blockDefaults"));return a.setHTML(this._value).addEventListener("input",this).addEventListener("select",this).addEventListener("cursor",this).addEventListener("pathChange",this).addEventListener("undoStateChange",this).addEventListener("dragover",this).addEventListener("drop",this).didError=t.RunLoop.didError,this.set("editor",a).set("path",a.getPath()),this.get("isDisabled")&&this.redrawIsDisabled(),[s("style",{type:"text/css"},[this.get("styles")]),this.get("showToolbar")?this.get("toolbarView"):null]},viewNeedsRedraw:function(t,e,i){this.propertyNeedsRedraw(t,e,i)}.observes("isDisabled","tabIndex"),redrawIsDisabled:function(){this._editingLayer.setAttribute("contenteditable",this.get("isDisabled")?"false":"true")},redrawTabIndex:function(){this._editingLayer.set("tabIndex",this.get("tabIndex"))},redrawIOSCursor:function(){if(this.get("isFocussed")){var t=this.get("editor");t.setSelection(t.getSelection())}}.nextFrame(),scrollIntoView:function(){if(this.get("isFocussed")){var n=this.getParent(t.ScrollView);if(n){var s=this.get("editor"),r=s&&s.getCursorPosition();if(r){var o=n.get("layer").getBoundingClientRect().top,a=r.top-o,h=r.bottom-o,c=n.get("pxHeight"),l=0;t.UA.isIOS&&(c-=i.body.offsetHeight-e.innerHeight),a-15<0?l=a-15:h+15>c&&(l=h+15-c),l&&n.scrollBy(0,Math.round(l),!0)}}}}.queue("after").on("cursor"),_calcToolbarPosition:function(t,e,i,n){var s,r=this.get("toolbarView"),o=this._offsetHeight,a=this._offsetTop,h=Date.now(),c=r.get("parentView")!==this;(!a||this._offsetExpiry<h)&&(this._offsetHeight=o=this.get("layer").offsetHeight,this._offsetTop=a=Math.floor(this.getPositionRelativeTo(t).top)),this._offsetExpiry=h+500,(s=n>a&&n<a+o-(t.get("pxHeight")>>2))!==c&&this._setToolbarPosition(t,r,s)},_setToolbarPosition:function(t,e,i){if(i){var n=t.get("parentView"),s=e.getPositionRelativeTo(n),r=t.getPositionRelativeTo(n);e.set("layout",{top:t.get("pxTop"),left:s.left-r.left,width:e.get("pxWidth")}),n.insertView(e)}else e.set("layout",{top:0,left:0,right:0}),this.insertView(e,null,"top")},toolbarConfig:{left:["bold","italic","underline","strikethrough","-","font","size","-","colour","bgcolour","-","image","-","link","-","ul","ol","-","quote","unquote","-","left","centre","right","justify","-","ltr","rtl","-","unformat"],right:[]},toolbarView:function(){var e=t.bind,i=this;return new t.ToolbarView({className:"v-Toolbar v-RichText-toolbar",positioning:"absolute",layout:{overflow:"hidden",zIndex:1,top:0,left:0,right:0},preventOverlap:!0}).registerViews({bold:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-bold",isActive:e("isBold",this),label:t.loc(248),tooltip:t.loc(248)+"\n"+t.formatKeyForPlatform("cmd-b"),activate:function(){i.get("isBold")?i.removeBold():i.bold(),this.fire("button:activate")}}),italic:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-italic",isActive:e("isItalic",this),label:t.loc(249),tooltip:t.loc(249)+"\n"+t.formatKeyForPlatform("cmd-i"),activate:function(){i.get("isItalic")?i.removeItalic():i.italic(),this.fire("button:activate")}}),underline:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-underline",isActive:e("isUnderlined",this),label:t.loc(250),tooltip:t.loc(250)+"\n"+t.formatKeyForPlatform("cmd-u"),activate:function(){i.get("isUnderlined")?i.removeUnderline():i.underline(),this.fire("button:activate")}}),strikethrough:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-strikethrough",isActive:e("isStriked",this),label:t.loc(336),tooltip:t.loc(336)+"\n"+t.formatKeyForPlatform("cmd-shift-7"),activate:function(){i.get("isStriked")?i.removeStrikethrough():i.strikethrough(),this.fire("button:activate")}}),size:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-font-size",label:t.loc(91),tooltip:t.loc(91),target:this,method:"showFontSizeMenu"}),font:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-font",label:t.loc(90),tooltip:t.loc(90),target:this,method:"showFontFaceMenu"}),colour:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-palette",label:t.loc(92),tooltip:t.loc(92),target:this,method:"showTextColourMenu"}),bgcolour:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-highlight",label:t.loc(247),tooltip:t.loc(247),target:this,method:"showTextHighlightColourMenu"}),link:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-link",isActive:e("isLink",this),label:t.loc(243),tooltip:t.loc(243)+"\n"+t.formatKeyForPlatform("cmd-k"),activate:function(){i.get("isLink")?i.removeLink():i.showLinkOverlay(this),this.fire("button:activate")}}),image:new t.FileButtonView({tabIndex:-1,type:"v-FileButton v-Button--iconOnly",icon:"icon-image",label:t.loc(65),tooltip:t.loc(65),acceptMultiple:!0,acceptOnlyTypes:"image/jpeg, image/png, image/gif",target:this,method:"insertImagesFromFiles"}),remoteImage:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-image",label:t.loc(65),tooltip:t.loc(65),target:this,method:"showInsertImageOverlay"}),left:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-paragraph-left",isActive:e("alignment",this,l("left")),label:t.loc(242),tooltip:t.loc(242),activate:function(){i.setTextAlignment("left"),this.fire("button:activate")}}),centre:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-paragraph-centre",isActive:e("alignment",this,l("center")),label:t.loc(240),tooltip:t.loc(240),activate:function(){i.setTextAlignment("center"),this.fire("button:activate")}}),right:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-paragraph-right",isActive:e("alignment",this,l("right")),label:t.loc(246),tooltip:t.loc(246),activate:function(){i.setTextAlignment("right"),this.fire("button:activate")}}),justify:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-paragraph-justify",isActive:e("alignment",this,l("justify")),label:t.loc(241),tooltip:t.loc(241),activate:function(){i.setTextAlignment("justify"),this.fire("button:activate")}}),ltr:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-lefttoright",isActive:e("direction",this,l("ltr")),label:t.loc(286),tooltip:t.loc(286),activate:function(){i.setTextDirection("ltr"),this.fire("button:activate")}}),rtl:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-righttoleft",isActive:e("direction",this,l("rtl")),label:t.loc(287),tooltip:t.loc(287),activate:function(){i.setTextDirection("rtl"),this.fire("button:activate")}}),quote:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-quotes-left",label:t.loc(245),tooltip:t.loc(245)+"\n"+t.formatKeyForPlatform("cmd-]"),target:i,method:"increaseQuoteLevel"}),unquote:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-quotes-right",label:t.loc(252),tooltip:t.loc(252)+"\n"+t.formatKeyForPlatform("cmd-["),target:i,method:"decreaseQuoteLevel"}),ul:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-list",isActive:e("isUnorderedList",this),label:t.loc(251),tooltip:t.loc(251)+"\n"+t.formatKeyForPlatform("cmd-shift-8"),activate:function(){i.get("isUnorderedList")?i.removeList():i.makeUnorderedList(),this.fire("button:activate")}}),ol:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-numbered-list",isActive:e("isOrderedList",this),label:t.loc(244),tooltip:t.loc(244)+"\n"+t.formatKeyForPlatform("cmd-shift-9"),activate:function(){i.get("isOrderedList")?i.removeList():i.makeOrderedList(),this.fire("button:activate")}}),unformat:new c({tabIndex:-1,type:"v-Button--iconOnly",icon:"icon-clear-formatting",label:t.loc(100),tooltip:t.loc(100),activate:function(){i.removeAllFormatting(),this.fire("button:activate")}})}).registerConfig("standard",this.get("toolbarConfig"))}.property(),fontSizeMenuView:function(){var e=this;return new t.MenuView({showFilter:!1,options:this.get("fontSizeOptions").map(function(t){var i=t[1];return new c({layout:i?{fontSize:i}:null,label:t[0],method:"setFontSize",setFontSize:function(){e.setFontSize(i)}})})})}.property(),showFontSizeMenu:function(e){e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),h.show({view:this.get("fontSizeMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},fontFaceMenuView:function(){var e=this;return new t.MenuView({showFilter:!1,options:this.get("fontFaceOptions").map(function(t){var i=t[1];return new c({layout:i?{fontFamily:i}:null,label:t[0],method:"setFontFace",setFontFace:function(){e.setFontFace(i)}})})})}.property(),showFontFaceMenu:function(e){e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),h.show({view:this.get("fontFaceMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},_colourText:!0,textColourMenuView:function(){var e=this;return new t.MenuView({className:"v-ColourMenu",showFilter:!1,options:"000000 b22222 ff0000 ffa07a fff0f5 800000 a52a2a ff8c00 ffa500 faebd7 8b4513 daa520 ffd700 ffff00 ffffe0 2f4f4f 006400 008000 00ff00 f0fff0 008080 40e0d0 00ffff afeeee f0ffff 000080 0000cd 0000ff add8e6 f0f8ff 4b0082 800080 ee82ee dda0dd e6e6fa 696969 808080 a9a9a9 d3d3d3 ffffff".split(" ").map(function(t){return new c({layout:{backgroundColor:t="#"+t},label:t,method:"setColour",setColour:function(){e._colourText?e.setTextColour(t):e.setHighlightColour(t)}})})})}.property(),showTextColourMenu:function(e){this._colourText=!0,e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),h.show({view:this.get("textColourMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},showTextHighlightColourMenu:function(e){this._colourText=!1,e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),h.show({view:this.get("textColourMenuView"),alignWithView:e,alignEdge:"centre",showCallout:!0,offsetTop:2})},linkOverlayView:function(){var e=this;return new d({prompt:t.loc(1185),placeholder:"e.g. www.example.com",confirm:t.loc(1184),add:function(){var t,i=this.get("value").trim();/^(?:javascript|data):/i.test(i)||(/[a-z][\w\-]+:/i.test(i)||(i=(t=o.exec(i))?"mailto:"+t[0]:"http://"+i),e.makeLink(i),h.hide(),e.focus())}})}.property(),showLinkOverlay:function(e){var i=this.get("linkOverlayView"),n=this.getSelectedText().trim();a.test(n)||o.test(n)||(n=""),i.set("value",n),e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),h.show({view:i,alignWithView:e,showCallout:!0,offsetTop:2,offsetLeft:-4})},insertImageOverlayView:function(){var e=this;return new d({prompt:t.loc(965),placeholder:"e.g. https://example.com/path/to/image.jpg",confirm:t.loc(65),add:function(){var t=this.get("value").trim();if(!/^https?:/i.test(t)){if(/^[a-z]:/i.test(t))return;t="http://"+t}e.insertImage(t),h.hide(),e.focus()}})}.property(),showInsertImageOverlay:function(e){var i=this.get("insertImageOverlayView");i.set("value",""),e.getParent(t.MenuView)&&(e=this.get("toolbarView").getView("overflow")),h.show({view:i,alignWithView:e,showCallout:!0,offsetTop:2,offsetLeft:-4})},focus:function(){var t=this.get("editor");return t&&t.focus(),this},blur:function(){var t=this.get("editor");return t&&t.blur(),this},undo:s("undo"),redo:s("redo"),bold:s("bold"),italic:s("italic"),underline:s("underline"),strikethrough:s("strikethrough"),removeBold:s("removeBold"),removeItalic:s("removeItalic"),removeUnderline:s("removeUnderline"),removeStrikethrough:s("removeStrikethrough"),makeLink:s("makeLink"),removeLink:s("removeLink"),setFontFace:s("setFontFace"),setFontSize:s("setFontSize"),setTextColour:s("setTextColour"),setHighlightColour:s("setHighlightColour"),setTextAlignment:s("setTextAlignment"),setTextDirection:s("setTextDirection"),increaseQuoteLevel:s("increaseQuoteLevel"),decreaseQuoteLevel:s("decreaseQuoteLevel"),makeUnorderedList:s("makeUnorderedList"),makeOrderedList:s("makeOrderedList"),removeList:s("removeList"),increaseListLevel:s("increaseListLevel"),decreaseListLevel:s("decreaseListLevel"),removeAllFormatting:s("removeAllFormatting"),insertImage:s("insertImage"),insertImagesFromFiles:function(t){e.FileReader&&t.forEach(function(t){var e=this.get("editor").insertImage(),i=new FileReader;i.onload=function(){e.src=i.result,i.onload=null},i.readAsDataURL(t)},this)},getSelectedText:function(){var t=this.get("editor");return t?t.getSelectedText():""},kbShortcuts:function(e){var i=u.isMac;switch(t.DOMEvent.lookupKey(e)){case i?"meta-k":"ctrl-k":e.preventDefault(),this.showLinkOverlay(this.get("toolbarView").getView("link"));break;case"pagedown":if(!i){var n=this.getParent(t.ScrollView);n&&n.scrollToView(this,{y:32+this.get("pxHeight")-n.get("pxHeight")},!0)}}}.on("keydown"),_forEachBlock:s("forEachBlock"),canUndo:!1,canRedo:!1,setUndoState:function(t){this.set("canUndo",t.canUndo).set("canRedo",t.canRedo),t.stopPropagation()}.on("undoStateChange"),path:"",setPath:function(t){this.set("path",t.path),t.stopPropagation()}.on("pathChange"),onSelect:function(){this.propertyDidChange("path")}.on("select"),isBold:r("B"),isItalic:r("I"),isUnderlined:r("U"),isStriked:r("S"),isLink:r("A"),alignment:function(){var t,e=this.get("path"),i=/\.align\-(\w+)/.exec(e);return"(selection)"===e?(t="",this._forEachBlock(function(e){var i=e.style.textAlign||"left";return t&&i!==t?(t="",!0):(t=i,!1)})):t=i?i[1]:"left",t}.property("path"),direction:function(){var t,e=this.get("path"),i=/\[dir=(\w+)\]/.exec(e);return"(selection)"===e?(t="",this._forEachBlock(function(e){var i=e.dir||"ltr";return t&&i!==t?(t="",!0):(t=i,!1)})):t=i?i[1]:"ltr",t}.property("path"),isUnorderedList:r("UL"),isOrderedList:r("OL"),handleEvent:function(e){var i=e.type;("dragover"!==i&&"drop"!==i||!e.stopPropagation)&&t.ViewEventsController.handleEvent(e,this)},_onFocus:function(){this.set("isFocussed",!0)}.on("focus"),_onBlur:function(){this.set("isFocussed",!1)}.on("blur"),blurOnEsc:function(t){27===(t.keyCode||t.which)&&this.blur()}.on("keydown"),dropAcceptedDataTypes:{"image/gif":!0,"image/jpeg":!0,"image/png":!0,"image/tiff":!0},dropEffect:t.DragEffect.COPY,drop:function(t){var e,i=this.get("dropAcceptedDataTypes");for(e in i)if(t.hasDataType(e)){this.insertImagesFromFiles(t.getFiles(/^image\/.*/));break}}});f.isSupported="contentEditable"in i.body&&!u.operaMobile&&!u.isWinPhone&&(!u.msie||u.msie>8)&&(!u.isIOS||u.isWKWebView),t.RichTextView=f}(O,window,document),function(t,e){var i="placeholder"in document.createElement("input"),n=t.Class({Extends:t.AbstractControlView,init:function(t){n.parent.init.call(this,t),this._settingFromInput=!1},isMultiline:!1,isExpanding:!1,isValid:!0,isHighlighted:!1,inputType:"text",placeholder:"",value:"",inputAttributes:{autocomplete:"off"},selection:function(t){var e=this._domControl,i="number"==typeof t,n=t?i?t:t.start:0,s=t?i?t:t.end||n:n;if(void 0!==t){this.redraw();try{e.setSelectionRange(n,s)}catch(t){}}else try{n=e.selectionStart,s=e.selectionEnd}catch(t){}return t||{start:n,end:s}}.property().nocache(),blurOnKeys:{esc:!0},allowTextSelection:!0,type:"",layerTag:"span",className:function(){var t=this.get("type");return"v-Text"+(this.get("isExpanding")?" v-Text--expanding":"")+(this.get("isHighlighted")?" is-highlighted":"")+(this.get("isFocussed")?" is-focussed":"")+(this.get("isValid")?"":" is-invalid")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","isExpanding","isHighlighted","isFocussed","isValid","isDisabled"),layerStyles:function(){return t.extend({position:this.get("positioning"),display:this.get("isMultiline")?"block":"inline-block",cursor:"text",userSelect:"text"},this.get("layout"))}.property("layout","positioning"),draw:function(e,n,s){var r=this.get("value"),o=this.get("placeholder"),a=this.get("isMultiline"),h=this._domControl=s(a?"textarea":"input",{id:this.get("id")+"-input",className:"v-Text-input",rows:a?"1":void 0,name:this.get("name"),type:this.get("inputType"),disabled:this.get("isDisabled"),tabIndex:this.get("tabIndex"),value:r});return this.redrawInputAttributes(),o&&(i?h.placeholder=o:r||(this._placeholderShowing=!0,t.Element.addClass(h,"v-Text-input--placeholder"),h.value=o)),e.title=this.get("tooltip"),[h]},textNeedsRedraw:function(t,e,i){var n="value"===e;n&&this._settingFromInput||this.propertyNeedsRedraw(t,e,i),n&&this.get("isExpanding")&&this.propertyNeedsRedraw(t,"textHeight",i)}.observes("isExpanding","value","placeholder","inputAttributes"),redrawValue:function(){var t=this.get("value");this._domControl.value=t,i||this.get("isFocussed")||this._setPlaceholder()},redrawPlaceholder:function(){var t=this.get("placeholder"),e=this._domControl;i?e.placeholder=t:this._placeholderShowing&&(e.value=t)},redrawInputAttributes:function(){var t,e=this.get("inputAttributes"),i=this._domControl;for(t in e)i.set(t,e[t])},redrawTextHeight:function(){if(t.UA.firefox&&(this.get("value")||"").length>8192)this.set("isExpanding",!1);else{var e,i=this._domControl,n=i.style,s=this.getParent(t.ScrollView);n.height="auto",(e=i.scrollHeight)&&(n.height=e+"px"),s&&s.redrawScroll()}},redrawIsExpanding:function(){this.get("isExpanding")?this.redrawTextHeight():(this._domControl.style.height="auto",this.get("isFocussed")&&this.blur().focus())},redrawLabel:function(){},activate:function(){this.focus()},savedSelection:null,didEnterDocument:function(){if(n.parent.didEnterDocument.call(this),this.get("isMultiline")){this.get("isExpanding")&&this.redrawTextHeight();var t=this._domControl,e=this.get("scrollLeft"),i=this.get("scrollTop");e&&(t.scrollLeft=e),i&&(t.scrollTop=i),t.addEventListener("scroll",this,!1)}var s=this.get("savedSelection");return s&&(this.set("selection",s).focus(),this.set("savedSelection",null)),this},willLeaveDocument:function(){return this.get("isFocussed")&&(this.set("savedSelection",this.get("selection")),this.blur()),this.get("isMultiline")&&this._domControl.removeEventListener("scroll",this,!1),n.parent.willLeaveDocument.call(this)},_syncBackScrolls:function(t){var e=this._domControl,i=e.scrollLeft,n=e.scrollTop;this.beginPropertyChanges().set("scrollLeft",i).set("scrollTop",n).endPropertyChanges(),t.stopPropagation()}.on("scroll"),syncBackValue:function(){this._settingFromInput=!0,!i&&this._placeholderShowing||this.set("value",this._domControl.value),this._settingFromInput=!1}.on("input"),_setPlaceholder:i?null:function(e,i,n,s){var r,o=this._domControl;s?this._placeholderShowing&&(this._placeholderShowing=!1,t.Element.removeClass(o,"v-Text-input--placeholder"),o.value=""):(r=this.get("placeholder"))&&!this.get("value")&&(this._placeholderShowing=!0,t.Element.addClass(o,"v-Text-input--placeholder"),o.value=r)}.observes("isFocussed"),_onClick:function(t){t.target===this.get("layer")&&this.set("selection",this.get("value").length).focus()}.on("click"),_onKeypress:function(e){this.get("isMultiline")||"enter"!==t.DOMEvent.lookupKey(e,!0)||t.Element.nearest(this.get("layer"),"FORM")||e.preventDefault()}.on("keypress"),_blurOnKey:function(e){var i=t.DOMEvent.lookupKey(e,!0);this.get("blurOnKeys")[i]&&this.blur()}.on("keyup")});8<=t.UA.msie&&t.UA.msie<=9&&n.implement({_ieSyncBackValue:function(e){var i="cut"===e.type?"delete":t.DOMEvent.lookupKey(e);8!==t.UA.msie&&"backspace"!==i&&"delete"!==i||this.fire("input")}.on("keyup","cut")}),t.TextView=n}(O),function(t){var e=t.Class({Extends:t.TextView,type:"v-SearchText",draw:function(i,n,s){var r=e.parent.draw.call(this,i,n,s);return r.push(s("i.icon.icon-search"),new t.ButtonView({type:t.bind(this,"value",function(t){return t?"v-SearchText-reset v-Button--iconOnly":"u-hidden"}),icon:"icon-clear",positioning:"absolute",label:t.loc(487),shortcut:"ctrl-/",target:this,method:"reset"})),r},reset:function(){this.set("value","").blur()}});t.SearchTextView=e}(O),function(t){var e=t.isEqual,i=t.Class({Extends:t.AbstractControlView,options:[],type:"",className:function(){var t=this.get("type");return"v-Select"+(this.get("isFocussed")?" is-focussed":"")+(this.get("isDisabled")?" is-disabled":"")+(t?" "+t:"")}.property("type","isFocussed","isDisabled"),draw:function(t,e,n){var s=this._domControl=this._drawSelect(this.get("options"));return[i.parent.draw.call(this,t,e,n),s]},_drawSelect:function(i){var n=this.get("value"),s=t.Element.create;return s("select",{className:"v-Select-input",disabled:this.get("isDisabled")},i.map(function(t,i){return s("option",{text:t.text,value:i,selected:e(t.value,n),disabled:!!t.isDisabled})}))},selectNeedsRedraw:function(t,e,i){return this.propertyNeedsRedraw(t,e,i)}.observes("options","value"),redrawOptions:function(t,i){var n,s,r=this.get("options");e(r,i)||(s=this.get("isFocussed"),n=this._drawSelect(r),s&&this.blur(),t.replaceChild(n,this._domControl),this._domControl=n,s&&this.focus())},redrawValue:function(){for(var t=this.get("value"),i=this.get("options"),n=i.length;n--;)if(e(i[n].value,t))return void(this._domControl.value=n+"");this.get("isFocussed")&&this.blur().focus()},syncBackValue:function(){var t=this._domControl.selectedIndex;this.set("value",this.get("options").getObjectAt(t).value)}.on("change")});t.SelectView=i}(O),function(t){var e=t.Class({Extends:t.View,content:null,index:0,itemHeight:32,selection:null,isSelected:!1,animateIn:!1,init:function(t){var i=t.selection,n=t.content;i&&n&&(this.isSelected=i.isStoreKeySelected(n.get("storeKey"))),e.parent.init.call(this,t)},positioning:"absolute",layout:(t.UA.cssProps.transform3d?function(){var t=this.get("index"),e=this.get("itemHeight"),i=this.get("animateIn")&&!this.get("isInDocument");return{top:(t-(i?1:0))*e,opacity:i?0:1}}:function(){return{top:this.get("index")*this.get("itemHeight")}}).property("index","itemHeight"),resetLayout:function(){this.get("animateIn")&&this.computedPropertyDidChange("layout")}.nextFrame().observes("isInDocument")});t.ListItemView=e}(O),function(t,e){var i=t.Class({Extends:t.View,selection:null,singleSelection:null,index:t.bind("singleSelection*index"),record:t.bind("singleSelection*record"),itemHeight:32,keys:{j:"goNext",k:"goPrev",x:"select","shift-x":"select",o:"trigger",enter:"trigger",s:"star"},className:"v-ListKBFocus",positioning:"absolute",layout:function(){var t=this.get("itemHeight"),e=this.get("index"),i=this.get("singleSelection").get("content");return e>-1&&i&&i.getObjectAt(e)!==this.get("record")&&(e=-1),{top:t*e,height:e<0?0:t}}.property("itemHeight","index","record"),didEnterDocument:function(){var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.register(e,this,n[e]);return this.checkInitialScroll(),i.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.deregister(e,this,n[e]);return i.parent.willLeaveDocument.call(this)},checkInitialScroll:function(){this.get("distanceFromVisRect")&&this.scrollIntoView(0,!1)}.queue("after"),checkScroll:function(){var t=this.get("distanceFromVisRect");t&&this.scrollIntoView(t<0?-.6:.6,!0)}.queue("after"),distanceFromVisRect:function(){var e=this.getParent(t.ScrollView);if(e){var i=e.get("scrollTop"),n=this.get("layout"),s=n.top,r=s-i;if(r<0)return r;var o=e.get("pxHeight"),a=s+n.height-i-o;if(a>0)return a}return 0}.property().nocache(),scrollIntoView:function(e,i){var n=this.getParent(t.ScrollView);if(n){var s=n.get("pxHeight"),r=this.get("layout"),o=r.height,a=r.top;e&&-1<=e&&e<=1&&(e=e*(s-o)>>1),n.scrollTo(0,Math.max(0,a+(o-s>>1)+(e||0)),i)}},go:function(t){var e=this.get("index"),i=this.get("singleSelection"),n=i.get("content"),s=n&&n.get("length")||0;1===t&&e>-1&&n&&n.getObjectAt(e)!==this.get("record")&&(t=0),t?i.set("index",(e+t).limit(0,s-1)):i.propertyDidChange("index"),this.get("isInDocument")&&this.checkScroll()},goNext:function(){this.go(1)},goPrev:function(){this.go(-1)},select:function(t){var e=this.get("index"),i=this.get("selection"),n=this.get("record");i&&n&&i.selectIndex(e,!i.isStoreKeySelected(n.get("storeKey")),t.shiftKey)},trigger:function(){},star:function(){}});t.ListKBFocusView=i}(O),function(t){var e=function(t,e){return t.get("index")-e.get("index")},i=function(t,e){var i,n;for(i=0,n=t.length;i<n;i+=1)e[t[i]]=!0;return e},n=function(e,i,n){for(var s,r=e.length;n<r&&(!(s=e[n].get("content"))||!i[t.guid(s)]);)n+=1;return n},s=t.Class({Extends:t.View,content:null,contentLength:t.bind("content.length"),ItemView:null,itemHeight:0,init:function(t){this._added=null,this._removed=null,this._rendered={},this._renderRange={start:0,end:2147483647},this.selection=null,s.parent.init.call(this,t);var e=this.get("selection");e&&e.addObserverForKey("selectedStoreKeys",this,"redrawSelection")},destroy:function(){var t=this.get("selection");if(t&&t.removeObserverForKey("selectedStoreKeys",this,"redrawSelection"),this.get("isRendered")){var e=this.get("content");e&&(e.removeObserverForRange(this._renderRange,this,"viewNeedsRedraw"),e.off("query:updated",this,"contentWasUpdated"))}s.parent.destroy.call(this)},contentDidChange:function(t,e,i,n){if(this.get("isRendered")){var s=this._renderRange;i&&(i.removeObserverForRange(s,this,"viewNeedsRedraw"),i.off("query:updated",this,"contentWasUpdated")),n&&(n.addObserverForRange(s,this,"viewNeedsRedraw"),n.on("query:updated",this,"contentWasUpdated")),this.viewNeedsRedraw()}}.observes("content"),contentWasUpdated:function(t){this.get("isInDocument")&&(this._added=i(t.added,this._added||{}),this._removed=i(t.removed,this._removed||{}))},layout:function(){var e=this.get("itemHeight"),i=e*(this.get("contentLength")||0);return t.UA.firefox&&i>16777216&&(i=16777216),e?{height:i}:{}}.property("itemHeight","contentLength"),draw:function(t,e){var i=s.parent.draw.call(this,t),n=this.get("content");i&&e.appendChildren(t,i),n&&(n.addObserverForRange(this._renderRange,this,"viewNeedsRedraw"),n.on("query:updated",this,"contentWasUpdated"),this.redrawLayer(t))},viewNeedsRedraw:function(){this.propertyNeedsRedraw(this,"layer")},isCorrectItemView:function(t,e){return t.get("content")===e},createItemView:function(t,e,i,n){return new(this.get("ItemView"))({parentView:this,content:t,index:e,list:i,isAdded:n,selection:this.get("selection")})},destroyItemView:function(t){t.destroy()},redrawLayer:function(i){var s,r,o,a,h,c,l,u,d,f=this.get("content")||[],g=this.get("childViews"),p=this.get("isInDocument"),v=this._renderRange,m=Math.max(0,v.start),y=Math.min(f.get("length"),v.end),w=this._rendered,_=this._rendered={},b=this._added,S=this._removed,D=[],T=null;for(o=m,a=y;o<a;o+=1)(l=w[c=(h=f.getObjectAt(o))?t.guid(h):"null:"+o])&&this.isCorrectItemView(l,h,o)&&(_[c]=l);for(c in this.beginPropertyChanges(),w)_[c]||(l=w[c],d=!(!S||!(h=l.get("content")))&&S[h.get("storeKey")],l.detach(d),this.destroyItemView(l));for(s=n(g,_,0),o=m,a=y;o<a;o+=1){if(l=_[c=(h=f.getObjectAt(o))?t.guid(h):"null:"+o]){if((r=g[s]===l)||(p&&l.willLeaveDocument(),i.removeChild(l.get("layer")),p&&l.didLeaveDocument()),l.set("index",o).set("list",f),r){T&&(i.insertBefore(T,l.get("layer")),T=null),s=n(g,_,s+1);continue}}else{if(u=!(!b||!h)&&b[h.get("storeKey")],!(l=this.createItemView(h,o,f,u)))continue;_[c]=l,g.push(l)}T||(T=i.ownerDocument.createDocumentFragment()),T.appendChild(l.render().get("layer")),p&&(l.willEnterDocument(),D.push(l))}if(T&&i.appendChild(T),p&&D.length)for(o=0,a=D.length;o<a;o+=1)D[o].didEnterDocument();g.sort(e),this._added=null,this._removed=null,this.propertyDidChange("childViews"),this.endPropertyChanges()},redrawSelection:function(){for(var t,e,i=this.get("selection"),n=this.get("childViews"),s=n.length;s--;)(e=(t=n[s]).getFromPath("content.storeKey"))&&t.set("isSelected",i.isStoreKeySelected(e))},insertView:null,replaceView:null});t.ListView=s}(O),O.TrueVisibleRect={visibleRect:function(){if(!this.get("isInDocument"))return{x:0,y:0,width:0,height:0};var t=this.get("pxLeft"),e=this.get("pxTop"),i=this.get("pxWidth"),n=this.get("pxHeight"),s=this.get("parentView").get("visibleRect"),r=Math.max(t,s.x),o=Math.min(t+i,s.x+s.width),a=Math.max(e,s.y),h=Math.min(e+n,s.y+s.height),c=Math.max(o-r,0),l=Math.max(h-a,0);return{x:r-t+this.get("scrollLeft"),y:a-e+this.get("scrollTop"),width:c,height:l}}.property("scrollTop","scrollLeft","pxLayout","parentView.visibleRect","isInDocument")},function(t){var e=t.Class({Extends:t.ListView,Mixin:t.TrueVisibleRect,batchSize:10,triggerInPx:200,init:function(t){e.parent.init.call(this,t),this._renderRange.end=0},contentWasUpdated:function(i){var n=this.getParent(t.ScrollView);if(n){var s,r,o,a,h=this.get("itemHeight"),c=~~(Math.max(this.get("visibleRect").y,0)/h),l=i.removedIndexes,u=i.addedIndexes,d=this._rendered,f=0;if(c>2){for(s=0,r=l.length;s<r&&l[s]<c;s+=1)f-=1;for(c+=f,s=0,r=u.length;s<r&&u[s]<=c;s+=1)f+=1}if(f){for(o in d)(a=d[o]).set("animateLayer",!1).set("index",a.get("index")+f).redraw().set("animateLayer",!0);n.scrollBy(0,f*h),n.redraw()}}return e.parent.contentWasUpdated.call(this,i)},_simulateScroll:function(e,i,n,s){s||(s=0),s<n&&t.RunLoop.invokeInNextEventLoop(this.fire.bind(this,"scroll",null,null))}.observes("contentLength"),visibleRectDidChange:function(){if(this.get("isInDocument")){var t=this.get("visibleRect"),e=this.get("triggerInPx"),i=this.get("batchSize"),n=this.get("itemHeight")*i,s=t.y,r=Math.max(0,~~((s-e)/n)*i),o=~~((s+t.height+e)/n)*i+i,a=this._renderRange;r===a.start&&o===a.end||(a.start=r,a.end=o,this.viewNeedsRedraw())}}.queue("middle").observes("visibleRect","itemHeight")});t.ProgressiveListView=e}(O),function(t){var e=t.View,i=t.Element,n=function(t,i,n){for(var s,r=t?t.length:0;r--;)(s=t[r])instanceof e&&!s.isDestroyed&&(n?s[i].apply(s,n):s[i]())},s=function(t,e){return e instanceof Array?e.reduce(s,t):e&&t.push(e),t},r=t.Class({Extends:e,init:function(t){this._oldView=null,this._index=-1,this.index=0,this.views=[],this.subViews=[],r.parent.init.call(this,t),this.isRendered=!0;for(var e,i=this.get("views"),n=i.length;n--;)!(e=i[n])||e instanceof Array||(i[n]=[e])},destroy:function(){for(var t=this.get("views"),e=t.length;e--;)n(t[e],"destroy");for(e=(t=this.get("subViews")).length;e--;)n(t[e],"destroy");r.parent.destroy.call(this)},layer:function(){return document.createComment("SwitchView "+this.get("id"))}.property(),willEnterDocument:function(){return this.resumeBindings(),this.redraw(),this},didEnterDocument:function(){return this.get("index")!==this._index&&this.switchNeedsRedraw(),this.set("isInDocument",!0)},willLeaveDocument:function(){return this.set("isInDocument",!1)},didLeaveDocument:function(){return this.suspendBindings()},redraw:function(){var t,e=this._index,i=this.get("index");!this.isDestroyed&&e>-1&&e!==i&&(t=this.get("parentView"))&&(this._remove(t),this._add())},switchNeedsRedraw:function(){this.get("isInDocument")&&t.RunLoop.queueFn("render",this.redraw,this)}.observes("index"),parentViewDidChange:function(t,e,i,n){i&&(i.removeObserverForKey("childViews",this,"_add"),this._remove(i)),n&&(n.get("childViews").contains(this)?this._add():n.addObserverForKey("childViews",this,"_add"))}.observes("parentView"),_add:function(){var t,i,s,r=this.get("index"),o=this.get("views")[r],a=this.get("subViews")[r],h=this.get("parentView"),c=h.get("isInDocument"),l=this.get("layer"),u=l.parentNode;if(h.removeObserverForKey("childViews",this,"_add"),-1===this._index){for(this._index=r,a&&(n(a,"set",["parentView",h]),c&&n(a,"willEnterDocument")),t=o?o.length:0;t--;)(i=o[t])instanceof e?h.insertView(i,this,"after"):("object"!=typeof i&&(i=o[t]=document.createTextNode(i)),(s=l.nextSibling)?u.insertBefore(i,s):u.appendChild(i));a&&(c&&n(a,"didEnterDocument"),Array.prototype.push.apply(h.get("childViews"),a),h.propertyDidChange("childViews"))}},_remove:function(t){var i,s,r,o,a,h,c=this._index,l=this.get("views")[c],u=this.get("subViews")[c],d=t.get("isInDocument");for(d&&u&&n(u,"willLeaveDocument"),i=l?l.length:0;i--;)(s=l[i])instanceof e?t.removeView(s):s.parentNode.removeChild(s);if(u){for(d&&n(u,"didLeaveDocument"),n(u,"set",["parentView",null]),r=t.get("childViews"),i=u.length;i--;)if(o=u[i],h=1,(a=r.lastIndexOf(o))>-1){for(;i>0&&a>0&&u[i-1]===r[a-1];)i-=1,a-=1,h+=1;r.splice(a,h)}t.propertyDidChange("childViews")}this._index=-1},insertView:function(t,e){this.childViews.push(t);var i=t.get("parentView");return i&&i.removeView(t),e.appendChild(t.render().get("layer")),this},_addCondition:function(t,e){t=t?t instanceof Array?t:[t]:null,this.views[e]=t&&t.reduce(s,[]);var i=this.childViews;return i.length&&(this.subViews[e]=i,this.childViews=[]),this},show:function(t){return this._addCondition(t,0)},otherwise:function(t){return this._addCondition(t,1)},end:function(){return i.forView(this._oldView),this._oldView=null,this}});t.SwitchView=r;var o=function(t){return t?0:1},a=function(t){return t?1:0},h=function(e,n,s){var o=new r({index:t.bind(e,n,s)});return o._oldView=i.forView(o),o};i.when=function(t,e,i){return h(t,e,i?function(t,e){return o(i(t,e))}:o)},i.unless=function(t,e,i){return h(t,e,i?function(t,e){return a(i(t,e))}:a)}}(O),function(t){var e=function(e){return"-"===e?t.Element.create("span.v-Toolbar-divider"):this._views[e]},i=t.Class({Extends:t.MenuButtonView,didEnterDocument:function(){return i.parent.didEnterDocument.call(this),this.setShortcuts(null,"",{},this.get("shortcuts")),this},willLeaveDocument:function(){return this.setShortcuts(null,"",this.get("shortcuts"),{}),i.parent.willLeaveDocument.call(this)},shortcuts:function(){var t=this.getFromPath("menuView.options");return t?t.reduce(function(t,e){var i=e.get("shortcut");return i&&i.split(" ").forEach(function(i){t[i]=e}),t},{}):{}}.property("menuView"),setShortcuts:function(e,i,n,s){if(this.get("isInDocument")){var r,o=t.ViewEventsController.kbShortcuts;for(r in s||(s=this.get("shortcuts")),n)o.deregister(r,this,"activateButton");for(r in s)o.register(r,this,"activateButton")}}.observes("shortcuts"),activateButton:function(e){var i=t.DOMEvent.lookupKey(e),n=this.get("shortcuts")[i];n instanceof t.MenuButtonView&&this.activate(),n.activate()}}),n=t.Class({Extends:t.View,className:"v-Toolbar",config:"standard",minimumGap:20,preventOverlap:!1,init:function(e){n.parent.init.call(this,e),this._views={overflow:new i({label:t.loc(70),popOverView:e.popOverView||new t.PopOverView})},this._configs={standard:{left:[],right:[]}},this._measureView=null,this._widths={}},registerView:function(t,e,i){return this._views[t]=e,!i&&this.get("isInDocument")&&this.get("preventOverlap")&&this.preMeasure().postMeasure(),this},registerViews:function(t){for(var e in t)this.registerView(e,t[e],!0);return this.get("isInDocument")&&this.get("preventOverlap")&&this.preMeasure().postMeasure(),this},registerConfig:function(t,e){return this._configs[t]=e,this.get("config")===t&&this.computedPropertyDidChange("config"),this},registerConfigs:function(t){for(var e in t)this.registerConfig(e,t[e]);return this},getView:function(t){return this._views[t]},leftConfig:function(){var t=this._configs,e=t[this.get("config")];return e&&e.left||t.standard.left}.property("config"),rightConfig:function(){var t=this._configs,e=t[this.get("config")];return e&&e.right||t.standard.right}.property("config"),left:function(){var i,n,s=this.get("leftConfig"),r=this.get("rightConfig"),o=this.get("pxWidth"),a=this._widths;if(a&&o&&this.get("preventOverlap")){for(o-=this.get("minimumGap"),i=0,n=r.length;i<n;i+=1)o-=a[r[i]];for(i=0,n=s.length;i<n;i+=1)o-=a[s[i]];if(o<0){for(o-=a["-"],o-=a.overflow;o<0&&n--;)o+=a[s[n]];n<0&&(n=0),this._views.overflow.set("menuView",new t.MenuView({showFilter:!1,options:s.slice(n).map(e,this).filter(function(e){return e instanceof t.View})})),n>0?("-"===s[n-1]&&(n-=1),(s=s.slice(0,n)).push("-"),s.push("overflow")):(s=["overflow"],n=0)}}return s.map(e,this)}.property("leftConfig","rightConfig","pxWidth"),right:function(){return this.get("rightConfig").map(e,this)}.property("rightConfig"),preMeasure:function(){return this.insertView(this._measureView=new t.View({className:"v-Toolbar-section v-Toolbar-section--measure",layerStyles:{},childViews:Object.values(this._views).filter(function(t){return!t.get("parentView")}),draw:function(e,i,n){return[n("span.v-Toolbar-divider"),t.View.prototype.draw.call(this,e,i,n)]}}),this.get("layer").lastChild,"before"),this},postMeasure:function(){var t,e,i=this._widths,n=this._views,s=this._measureView,r=s.get("childViews"),o=s.get("layer").getBoundingClientRect(),a=r.length?r[0].get("layer"):null;for(t in n)i[t]=n[t].get("pxWidth")||i[t];for(i["-"]=(a?a.getBoundingClientRect().left:o.right)-o.left,this.removeView(s),e=r.length;e--;)s.removeView(r[e]);return s.destroy(),this._measureView=null,this},willEnterDocument:function(){return this.get("preventOverlap")&&this.preMeasure(),n.parent.willEnterDocument.call(this)},didEnterDocument:function(){return this.beginPropertyChanges(),n.parent.didEnterDocument.call(this),this.get("preventOverlap")&&this.postMeasure(),this.endPropertyChanges(),this},draw:function(t,e,i){return[i("div.v-Toolbar-section.v-Toolbar-section--left",this.get("left")),i("div.v-Toolbar-section.v-Toolbar-section--right",this.get("right"))]},toolbarNeedsRedraw:function(t,e,i){i&&this.propertyNeedsRedraw(t,e,i)}.observes("left","right"),redrawLeft:function(t,e){this.redrawSide(t.firstChild,e,this.get("left"))},redrawRight:function(t,e){this.redrawSide(t.lastChild,e,this.get("right"))},redrawSide:function(e,i,n){var s,r,o,a,h=t.View,c=0,l=!0;for(s=c,r=i.length;s<r;s+=1)(o=i[s])instanceof h?l&&o===n[s]?c+=1:(l=!1,o.get("layer").parentNode===e&&this.removeView(o)):!l||n[s]instanceof h?e.removeChild(o):(c+=1,n[s]=o);for(s=c,r=n.length;s<r;s+=1)(o=n[s])instanceof h?((a=o.get("parentView"))&&a.removeView(o),this.insertView(o,e)):e.appendChild(o)}});t.ToolbarView=n}(O),function(t){var e=t.Class({Extends:t.Animation,duration:250,prepare:function(e){var i=this.object,n=this.startX=i.get("scrollLeft"),s=this.startY=i.get("scrollTop"),r=this.endX=e.x||0,o=this.endY=e.y||0,a=this.deltaX=r-n,h=this.deltaY=o-s;return t.Element.setStyle(i.get("layer"),"will-change","scroll-position"),!(!a&&!h)},drawFrame:function(e){var i=e<1,n=this.object,s=i?this.startX+e*this.deltaX:this.endX,r=i?this.startY+e*this.deltaY:this.endY;n._scrollTo(s,r),i||t.Element.setStyle(n.get("layer"),"will-change","auto")}}),i=t.Class({Extends:t.View,showScrollbarX:!1,showScrollbarY:!0,positioning:"absolute",layout:t.View.LAYOUT_FILL_PARENT,layerStyles:function(){var e=t.View.prototype.layerStyles.call(this);return e.overflowX=this.get("showScrollbarX")?"auto":"hidden",e.overflowY=this.get("showScrollbarY")?"auto":"hidden",e.WebkitOverflowScrolling="touch",e}.property("layout","allowTextSelection","positioning","showScrollbarX","showScrollbarY"),keys:{},didEnterDocument:function(){this.get("layer").addEventListener("scroll",this,!1);var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.register(e,this,n[e]);return i.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e,n=this.get("keys"),s=t.ViewEventsController.kbShortcuts;for(e in n)s.deregister(e,this,n[e]);return this.get("layer").removeEventListener("scroll",this,!1),i.parent.willLeaveDocument.call(this)},_restoreScroll:function(){if(this.get("isInDocument")){var t=this.get("layer");t.scrollLeft=this.get("scrollLeft"),t.scrollTop=this.get("scrollTop")}}.queue("render").observes("isInDocument"),scrollAnimation:function(){return new e({object:this})}.property(),isAnimating:!1,willAnimate:function(){this.set("isAnimating",!0)},didAnimate:function(){this.set("isAnimating",!1)},scrollToTop:function(){return this.scrollTo(0,0,!0)},scrollToBottom:function(){return this.scrollTo(0,this.get("layer").scrollHeight-this.get("pxHeight"),!0)},scrollPage:function(){return this.scrollBy(0,this.get("pxHeight")-50,!0)},reverseScrollPage:function(){return this.scrollBy(0,50-this.get("pxHeight"),!0)},scrollLine:function(){return this.scrollBy(0,40)},reverseScrollLine:function(){return this.scrollBy(0,-40)},scrollBy:function(t,e,i){var n=this.get("scrollLeft"),s=this.get("scrollTop");return t+=n,e+=s,this.scrollTo(t,e,i),s!==this.get("scrollTop")||n!==this.get("scrollLeft")},scrollToView:function(t,e,i){var n=t.getPositionRelativeTo(this);return this.scrollTo(n.left+(e&&e.x||0),n.top+(e&&e.y||0),i)},scrollTo:function(t,e,i){t=t<0?0:Math.round(t),e=e<0?0:Math.round(e);var n=this.get("scrollAnimation");return n.stop(),i&&this.get("isInDocument")?n.animate({x:t,y:e}):this.beginPropertyChanges().set("scrollLeft",t).set("scrollTop",e).propertyNeedsRedraw(this,"scroll").endPropertyChanges(),this},_scrollTo:function(t,e){this.set("scrollLeft",t).set("scrollTop",e),this.redrawScroll()},redrawScroll:function(){var e=this.get("layer"),i=this.get("scrollLeft"),n=this.get("scrollTop");e.scrollLeft=i,e.scrollTop=n,(i||n)&&t.RunLoop.queueFn("after",this.syncBackScroll,this)},syncBackScroll:function(e){if(!this._needsRedraw){var i=this.get("layer"),n=i.scrollLeft,s=i.scrollTop;this.beginPropertyChanges().set("scrollLeft",n).set("scrollTop",s).endPropertyChanges(),e&&(e.stopPropagation(),t.Tap&&t.Tap.cancel())}}.on("scroll")});t.UA.isIOS&&i.implement({isFixedDimensions:function(){var t=this.get("positioning");return"absolute"===t||"fixed"===t}.property("positioning"),draw:function(e,n,s){var r,o=this.get("isFixedDimensions"),a=1;r=i.parent.draw.call(this,e,n,s),o&&(t.UA.version<11||t.UA.safari)&&(a=2,e.appendChild(s("div",{style:"height:1px"}))),n.appendChildren(e,r),o&&(e.style.paddingBottom="constant(safe-area-inset-bottom)",e.appendChild(s("div",{style:"position:absolute;top:100%;left:0px;width:1px;height:"+a+"px;"})),this.on("scroll",this,"_setNotAtEnd").addObserverForKey("isInDocument",this,"_setNotAtEnd"))},_setNotAtEnd:function(){if(this.get("isInDocument")){var e=this.get("scrollTop"),i=this.get("scrollLeft");!e&&(t.UA.version<11||t.UA.safari)?this.scrollTo(i,1):e+this.get("pxHeight")===this.get("layer").scrollHeight&&this.scrollTo(i,e-1)}}.queue("after"),preventRootScroll:function(t){if(!this.get("isFixedDimensions")){var e=this.get("layer");e.scrollHeight<=e.offsetHeight&&t.preventDefault()}}.on("touchmove"),insertView:function(t,e,n){return!e&&this.get("isRendered")&&this.get("isFixedDimensions")&&(e=this.get("layer"),"top"===n?(e=e.firstChild,n="after"):n&&"bottom"!==n||(e=e.lastChild,n="before")),i.parent.insertView.call(this,t,e,n)}}),t.ScrollView=i}(O),function(t){var e="auto",i=t.Class({Extends:t.Object,direction:1,flex:4,staticPaneLength:200,minStaticPaneLength:0,maxStaticPaneLength:32767,topLeftLayout:function(t){var i=this.get("direction"),n=this.get("flex"),s=this.get("staticPaneLength");return t||{top:0,left:0,right:1===i&&4===n?s:e,width:2===i?"100%":4===n?e:s,bottom:2===i&&4===n?s:e,height:1===i?"100%":4===n?e:s}}.property("flex","direction","staticPaneLength"),bottomRightLayout:function(t){var i=this.get("direction"),n=this.get("flex"),s=this.get("staticPaneLength");return t||{bottom:0,right:0,left:1===i&&8===n?s:e,width:2===i?"100%":8===n?e:s,top:2===i&&8===n?s:e,height:1===i?"100%":8===n?e:s}}.property("flex","direction","staticPaneLength")});i.extend({VERTICAL:1,HORIZONTAL:2,TOP_LEFT:4,BOTTOM_RIGHT:8}),t.SplitViewController=i}(O),function(t){var e=t.SplitViewController.VERTICAL,i=t.SplitViewController.TOP_LEFT,n=t.Class({Extends:t.View,Mixin:t.Draggable,className:"v-SplitDivider",thickness:10,offset:t.bindTwoWay("controller.staticPaneLength"),min:t.bind("controller.minStaticPaneLength"),max:t.bind("controller.maxStaticPaneLength"),direction:t.bind("controller.direction"),flex:t.bind("controller.flex"),anchor:function(){var t=this.get("flex")===i;return this.get("direction")===e?t?"right":"left":t?"bottom":"top"}.property("flex","direction"),positioning:"absolute",layout:function(){var t,i=this.get("thickness");return(t=this.get("direction")===e?{top:0,bottom:0,width:i}:{left:0,right:0,height:i})[this.get("anchor")]=this.get("offset")-i/2,t}.property("direction","anchor","thickness","offset"),dragStarted:function(){this._offset=this.get("offset"),this._dir=this.get("direction")===e?"x":"y"},dragMoved:function(t){var e=this._dir,n=t.get("cursorPosition")[e]-t.get("startPosition")[e],s=this.get("flex")===i?-1:1;this.set("offset",(this._offset+s*n).limit(this.get("min"),this.get("max")))}});t.SplitDividerView=n}(O);
