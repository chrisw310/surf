LPVault={};
(function(d,c,na){var oa=Strings.translateString("Folder (a-z)"),pa=Strings.translateString("Folder (z-a)"),A=Strings.translateString("Name (a-z)"),B=Strings.translateString("Name (z-a)"),Q=Strings.translateString("Most Recent"),qa=Strings.translateString("Sender (a-z)"),ra=Strings.translateString("Sender (z-a)"),sa=Strings.translateString("Recipient (a-z)"),ta=Strings.translateString("Recipient (z-a)"),D=[oa,pa,A,B,Q],Qa=[A,B],Ra=[A,B,sa,ta,Q],Sa=[A,B,qa,ra,Q],Ta=[A,B],Ua=[A,B],q=function(a){this.options=a};
q.prototype.getAddElement=function(){void 0===this.addElement&&(this.addElement=LPTools.createElement("div","addMenuItem"),this.build(this.addElement,this.options.icon?this.options.icon:"images/vault_4.0/Add.png"));return this.addElement};q.prototype.build=function(a,b){a.appendChild(LPTools.createElement("span",null,Strings.Vault[this.options.text]));var c=LPTools.createElement("div"),f=LPTools.createElement("div");b=LPTools.createElement("img",{src:b});a.appendChild(c);c.appendChild(f);f.appendChild(b);
$(a).bind("click",this.options.func)};q.prototype.getMenuElement=function(){void 0===this.menuElement&&(this.menuElement=LPTools.createElement("li","addMenuItem"),this.build(this.menuElement,this.options.additionalIcon));return this.menuElement};var Va=new q({text:"ADD_SITE",icon:"images/vault_4.0/Sites_Active.png",func:function(){c.openSiteDialog({saveOptions:{source:"vault"}})}}),aa=new q({text:"ADD_NOTE",icon:"images/vault_4.0/Notes_Active.png",additionalIcon:"images/vault_4.0/Add_Secure_Note.png",
func:function(){c.openNoteDialog({saveOptions:{source:"vault"}})}}),Wa=new q({text:"ADD_FORM_FILL",icon:"images/vault_4.0/Form_Fills_Active.png",func:function(){c.openFormFillDialog({saveOptions:{source:"vault"}})}}),Xa=new q({text:"ADD_SHARED_FOLDER",func:function(){c.openCreateSharedFolderDialog()}}),Ya=new q({text:"ADD_IDENTITY",func:function(){c.openIdentityDialog()}}),Za=new q({text:"GIVE_EMER_ACCESS",func:function(){LPProxy.getUser().isFreeOrTrial()&&LPFeatures.restrictEmergencyAccessForFree()?
dialogs.restrictedEmergencyAccess.open():dialogs.addEmergencyAccess.open()}}),$a=new q({text:"ADD_CREDIT_MON",func:function(){c.openCreateCreditMonitoringDialog()}}),ba=new q({text:"ADD_FOLDER",additionalIcon:"images/vault_4.0/Add_Folder.png",func:function(){c.openFolderDialog()}}),I=new q({text:"SHARE_ITEMS",additionalIcon:"images/vault_4.0/Add_Share.png",func:function(){c.openShareDialog()}}),ab=Strings.translateString("search my vault"),u=null,ca=$("#advacedOptionsOverlay"),bb=$("#inProgressOverlay"),
R=$("#tools"),cb=$("#options"),r=$("#mainScroll"),x=$("#addMenu"),ua=$("#addMenuItems"),va=$("#addMenuButton"),wa=$("#addMenuButtonCustom"),xa=$("#gridButton"),ya=$("#listButton"),S=$("#collapseAllToggle"),T=$("#sizeToggle"),za=$("#orderOption"),Aa=$("#sortOrderMenu"),db=$("#sortOrderOption"),da=$("#userMenuItems"),E=$("#leftMenuMinimizeButton"),Ba=$("#moreActions"),Ca=d.getElementById("contextMenu").parentElement,k=$(d.body),ea=$("#advancedMenuItem"),fa=d.getElementById("sortOrderMenu").children[0],
v=$("#vaultSearch"),Da=$("#userMenuContainer"),eb=$("#pageTitle"),U=null,F=null,V=!0,n=null,w=null,g=null,Ea=function(a,b){g.getContainer()===b&&(g.removeBodyState(),g.addBodyState())},e=function(a){a=a||{};this.state=a.bodyState;this.menuElement=a.menuElement||null;this.emptyState=this.state+"Empty";this.container=null;this.sortOptions=a.sortOptions||null;this.persistent=LPTools.getOption(a,"persistent",!0);this.searchPlaceholder=LPTools.getOption(a,"searchPlaceholder",ab);this.title=a.title||"";
this.addMenu=a.addMenu;this.additionalOptionButtons=a.additionalOptionButtons;this.scrollParent=a.scrollParent;this.notificationCount=a.notificationCount;(function(b){Topics.get(Topics.CLEAR_DATA).subscribe(function(){b.clear()});a.menuElement&&a.menuElement.unbind("click.menu").bind("click.menu",function(){b.parent?b.parent.show(b):b.show()})})(this)};(function(){e.prototype.getElement=function(){return this.menuElement.get(0)};e.prototype.applyContainerFunction=function(a){var b=this.getContainer();
if(null!==b)switch(typeof a){case "string":var c=[];if(1<arguments.length)for(var f=1,t=arguments.length;f<t;++f)c.push(arguments[f]);return b[a].apply(b,c);case "function":return a(b)}};e.prototype.updateNotificationCount=function(a){var b=0,c=this.menuElement.find(".tabNotification");"undefined"!==typeof a?(b=parseInt(c.text()),W(c,b-a),this.parent&&this.parent.updateNotificationCount(a)):this.notificationCount&&(b=this.notificationCount(),W(c,b));return b};e.prototype.getSortOptions=function(){return this.sortOptions};
e.prototype.getContainer=function(){return this.container};e.prototype.setContainer=function(a,b){if(this.container=a)a._buildOptions.stateChangeCallback=Ea,LPTools.getOption(b,"checkForStateChange",!0)&&g===this&&Ea(a.isEmpty(),a),g===this&&""!==v.val()&&c.search(v.val())};e.prototype.openAll=function(){this.applyContainerFunction("openAll")};e.prototype.collapseAll=function(){this.applyContainerFunction("collapseAll")};e.prototype.createSelectionContextMenu=function(){return this.applyContainerFunction("createSelectionContextMenu")};
e.prototype.isEmpty=function(){return this.applyContainerFunction("isEmpty")};e.prototype.search=function(a){var b=this.applyContainerFunction("applySearch",a);a&&null===b&&!this.isEmpty()?k.addClass("searchEmpty"):k.removeClass("searchEmpty")};e.prototype.clearSelected=function(){this.applyContainerFunction("clearSelected")};e.prototype.getSelectedItems=function(){return this.applyContainerFunction("getSelectedItems")};e.prototype.getSortOrder=function(){void 0===this.sortOrder&&(this.sortOrder=
LPProxy.getPreference(this.state+"SortOrder",this.sortOptions?this.sortOptions[0]:null));return this.sortOrder};e.prototype.setSortOrder=function(a){this.sortOrder=a;LPProxy.setPreferences(this.state+"SortOrder",a)};e.prototype.addBodyState=function(){k.addClass(this.getState());var a=this.getContainer();null!==a&&a.isEmpty()&&0===oneMinuteSignup.getReminderCount()?k.addClass("empty"):k.removeClass("empty");setTimeout(function(){Topics.get(Topics.EMPTY_VAULT_STATE_CHANGE).publish()},400)};e.prototype.removeBodyState=
function(){k.removeClass(this.emptyState);k.removeClass(this.state)};e.prototype.hide=function(){null!==this.menuElement&&this.menuElement.removeClass("selected");this.parent&&null!==this.parent.menuElement&&this.parent.menuElement.removeClass("selected");this.removeBodyState();if(this.additionalOptionButtons)for(var a=0,b=this.additionalOptionButtons.length;a<b;++a)this.additionalOptionButtons[a].detach();this.persistent?this.applyContainerFunction("hide"):this.clear()};e.prototype.getAddMenuItems=
function(){var a=[];if(this.addMenu&&0<this.addMenu.length)for(var b=0,c=this.addMenu.length;b<c;++b){var f=this.addMenu[b];f===I&&!LPFeatures.allowIndividualSharing()||f===aa&&!LPFeatures.allowNotes()||a.push(f)}return a};e.prototype.show=function(){if(g!==this){null!==g&&(v.val(""),C(),g.hide());v.attr("placeholder",this.searchPlaceholder);null!==this.menuElement&&this.menuElement.addClass("selected");this.parent&&null!==this.parent.menuElement&&this.parent.menuElement.addClass("selected");eb.text(this.title);
this.addBodyState();this.scrollParent.scrollTop(0);var a=this.getSortOptions();if(null===g||g.getSortOptions()!==a)if(null!==a){LPTools.removeDOMChildren(fa);for(var b=0,h=a.length;b<h;++b){var f=d.createElement("li"),t=a[b];f.textContent=t;LPPlatform.addEventListener(f,"click",fb(t));fa.appendChild(f)}za.show()}else za.hide();g=this;(a=this.getSortOrder())&&c.sort(a);this.additionalOptionButtons&&cb.append(this.additionalOptionButtons);ua.children().detach();wa.children().detach();a=this.getAddMenuItems();
if(0<a.length){wa.append(a[0].getAddElement());for(b=a.length-1;0<b;--b)ua.append(a[b].getMenuElement());va.show()}else va.hide();LPProxy.getPreference("leftMenuMaximize")?c.maximizeLeftMenu():c.minimizeLeftMenu()}};e.prototype.getState=function(){return this.isEmpty()?this.emptyState:this.state};e.prototype.clear=function(){this.container&&(this.container.destruct(),this.container=null)}})();var m=function(a){a.bodyState=a.bodyState||a.contentID;e.call(this,a);this.contentElement=d.getElementById(a.contentID);
this.containerType=a.containerType;this.dataSource=a.dataFunction;this.buildOptions=a.buildOptions;this.filter=a.filter;(function(a){Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(b){a.refresh(b)});a.initializeCallback=function(b,c){b=new a.containerType(b,a.buildOptions);b.initialize(a.contentElement,a.scrollParent);a.filter&&b.applyFilter(a.filter,{checkForStateChange:!1});a.setContainer(b,{checkForStateChange:LPTools.getOption(c,"checkForStateChange",!1)});Topics.get(Topics.DIALOG_LOADED).publish()}})(this)};
m.prototype=Object.create(e.prototype);m.prototype.constructor=m;(function(){m.prototype.makeDataRequest=function(a,b){b.error=function(){Topics.get(Topics.DIALOG_LOADED).publish()};LPRequest.makeDataRequest(a,b)};m.prototype.initialize=function(a,b){null===this.container&&null!==this.containerType&&null!==this.dataSource&&(a=function(a,b){return b?function(c,h){a.initializeCallback(c,h);b()}:a.initializeCallback}(this,a),Topics.get(Topics.DIALOG_LOADING).publish(),this.dataSource.call(this,a,b))};
m.prototype.show=function(a){null===this.container?function(b){b.initialize(function(){a&&a();e.prototype.show.apply(b)})}(this):(e.prototype.show.apply(this),a&&a())};m.prototype.refresh=function(a){null!==this.container&&(this.container.destruct(),this.container=null,this.initialize(null,{identity:a,checkForStateChange:!0}))}})();var y=function(a){e.call(this,a);this.setContainer(a.container||null);this.filter=a.filter};y.prototype=Object.create(e.prototype);y.prototype.constructor=y;y.prototype.show=
function(){this.container.applyFilter(this.filter,{checkForStateChange:!1});e.prototype.show.apply(this,arguments)};var Fa=function(a){var b=null;if(a.views&&0<a.views.length){for(var c=0,f=a.views.length;c<f;++c)a.views[c].parent=this;this.show=function(c,h){c?(c.show(h),b=c):(null===b&&(b=a.defaultView()),b.show(h))};this.clear=function(){b=null};this.menuElement=a.menuElement;var t=a.menuElement.find(".notificationBubble");this.updateNotificationCount=function(a){W(t,parseInt(t.text())-a)};c=function(){for(var b=
0,c=0,h=a.views.length;c<h;++c)b+=a.views[c].updateNotificationCount();W(t,b)};Topics.get(Topics.LOGIN).subscribe(c);Topics.get(Topics.REFRESH_DATA).subscribe(c);(function(a){Topics.get(Topics.CLEAR_DATA).subscribe(function(){a.clear()})})(this)}},Ga=new m({containerType:IdentityContainer,dataFunction:function(a){for(var b=[],c=0,f=u._identities.length;c<f;++c)b.push(u._identities[c].newDisplayObject());a(b)},sortOptions:Ua,contentID:"identityContent",bodyState:"identity",scrollParent:r,searchPlaceholder:Strings.translateString("search my identities"),
buildOptions:{multiSelect:!1},title:Strings.translateString("Identities"),addMenu:[Ya]}),X=new m({containerType:CreditMonitoringContainer,dataFunction:function(){return function(a,b){this.makeDataRequest(LPProxy.getCreditMonitoringData,{success:function(c){for(var h=!0,t=[],d=0,e=c.length;d<e;++d){var l=c[d];"1"!==l.premium&&(h=!1);t.push(new CreditMonitoringProfile(l))}c=$("#creditMonitoring .viewExplanation");h?(c.hide(),X.title=Strings.translateString("Premium Credit Monitoring")):(c.show(),X.title=
Strings.translateString("Credit Monitoring"));a(t,b)}})}}(),persistent:!1,contentID:"creditMonitoring",scrollParent:r,title:Strings.translateString("Credit Monitoring"),addMenu:[$a]}),ha=new m({containerType:GridListContainer,dataFunction:function(a,b){this.makeDataRequest(LPProxy.getDeletedItems,{success:a})},filter:{showEmptyGroups:!1},sortOptions:D,contentID:"deletedItems",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search my deleted items"),buildOptions:{allowDrag:!1,
stickyFolders:!0,stickyFolderParent:d.getElementById("main")},title:Strings.translateString("Deleted Items"),additionalOptionButtons:[function(){var a=LPTools.createElement("div",{"class":"optionButton optionButtons",id:"purgeAllButton"},Strings.Vault.PURGE_ALL);LPPlatform.addEventListener(a,"click",function(){var a=ha.getContainer();a&&(a=a.getItemModelChildren(),0<a.length&&a[0].purge({itemsForAction:a}))});return $(a)}()]});ha.refresh=function(){};var J=new m({containerType:EmergencyAccessRecipientContainer,
dataFunction:function(a,b){this.makeDataRequest(LPProxy.getEmergencyAccessRecipientInfo,{success:a})},filter:{showEmptyGroups:!1},sortOptions:D,menuElement:$("#emergencyTrustedMenuItem"),contentID:"emergencyTrustedContainer",bodyState:"emergencyTrusted",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search people I trust"),buildOptions:{allowDrag:!1},title:Strings.translateString("People I Trust"),addMenu:[Za]}),K=new m({containerType:EmergencyAccessSharerContainer,dataFunction:function(a,
b){this.makeDataRequest(LPProxy.getEmergencyAccessSharerInfo,{success:a})},filter:{showEmptyGroups:!1},notificationCount:function(){var a=0,b=bg.get("g_emer_sharers");if(b)for(var c=0,f=b.length;c<f;++c)"0"===b[c].accepted&&++a;return a},sortOptions:D,menuElement:$("#emergencyTrustingMenuItem"),contentID:"emergencyTrusting",bodyState:"emergencyTrusting",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search people who trust me"),buildOptions:{allowDrag:!1},title:Strings.translateString("People Who Trust Me")}),
ia=new Fa({menuElement:$("#emergencyAccessMenuItem"),defaultView:function(){return 0<K.notificationCount()?K:J},views:[J,K]}),L=new m({containerType:IndividualShareContainer,sortOptions:Sa,menuElement:$("#receivedSharesMenuItem"),contentID:"receivedSharesContent",bodyState:"receivedShares",scrollParent:r,persistent:!1,notificationCount:function(){return bg.get("g_pendings").length},searchPlaceholder:Strings.translateString("search my received shares"),buildOptions:{multiSelect:!1},filter:{showEmptyGroups:!1,
multiSelect:!1},title:Strings.translateString("Shared with Me"),addMenu:[I],dataFunction:function(){return function(a,b){this.makeDataRequest(LPProxy.getReceivedShareData,{params:{url:document.location.href},success:function(b){for(var c=LPProxy.getAllModelItems(),h=[],d=0,e=c.length;d<e;++d){var l=c[d],g=b[l.getID()];g&&"1"===g.state&&l instanceof AccountBase&&h.push(new AcceptedReceivedSharedItem(l,g))}c=LPProxy.getPendingRecievedShares();d=!1;e=0;for(l=c.length;e<l;++e){g=c[e];var k=b[g._model.getID()];
k?g._model._shareData=k:d=!0}d&&LPProxy.refreshSites();a(h.concat(c))}})}}()}),M=new m({containerType:IndividualShareContainer,sortOptions:Ra,menuElement:$("#sentSharesMenuItem"),contentID:"sentSharesContent",bodyState:"sentShares",scrollParent:r,persistent:!1,searchPlaceholder:Strings.translateString("search my sent shares"),buildOptions:{multiSelect:!1},filter:{showEmptyGroups:!1,multiSelect:!1},title:Strings.translateString("Shared with Others"),addMenu:[I],dataFunction:function(){return function(a,
b){this.makeDataRequest(LPProxy.getSentShareData,{params:{},success:function(c){for(var h=LPProxy.getAllModelItems(),t=[],d=0,e=h.length;d<e;++d){var l=h[d];t=t.concat(LPTools.buildSentShareItems(l,c[l.getID()]))}a(t,b)}})}}()}),z=new m({containerType:SharedFolderContainer,dataFunction:function(){return function(a,b){this.makeDataRequest(LPProxy.getSharedFolderData,{params:{},success:function(b){for(var c=LPProxy.getAllSharedGroupModelsByID(),h=[],d=0,e=b.length;d<e;++d){var l=b[d];l.sharedata&&h.push(new SharedFolderItem(c[l.shareid],
l))}a(h)}})}}(),notificationCount:function(){return bg.get("g_pending_shares").length},sortOptions:Ta,menuElement:$("#sharedFoldersMenuItem"),contentID:"sharedFoldersContent",bodyState:"sharedFolders",scrollParent:r,searchPlaceholder:Strings.translateString("search my shared folders"),buildOptions:{multiSelect:!1},title:Strings.translateString("Shared Folders"),addMenu:[Xa],additionalOptionButtons:[function(){var a=$(LPTools.buildCheckbox(null,{text:Strings.translateString("View Deleted Shared Folders")}));
a.attr("id","showDeletedSharedFoldersButton");a.addClass("optionButtons");a.bind("click",function(){N?ja():ka()});return a}()]});z.initialize=function(a,b){a=function(a,b){return b?function(){var a={checkForStateChange:!1};N?ka(a):ja(a);b()}:function(){var a={checkForStateChange:!1};N?ka(a):ja(a)}}(this,a);m.prototype.initialize.call(this,a,b)};var O=new Fa({menuElement:$(".sharingMenuItem"),defaultView:function(){return 0<L.notificationCount()?L:LPProxy.getAccountClass()===Constants.USER_FREE||LPProxy.getAccountClass()===
Constants.USER_PREMIUM&&LPProxy.isPremiumAsAPerk()&&!LPProxy.isLegacyPremium()?M:LPFeatures.allowSharedFolders()?z:L},views:[z,M,L]});new e({menuElement:$("#newSettingsMenuItem"),bodyState:"newSettings",title:Strings.translateString("Settings"),addMenu:null,scrollParent:$(document.body)});var P=function(){LPTools.hideContextMenu(w);w=null},G=function(a){a.preventDefault();a.stopPropagation()},ma=function(){P();da.hide("fast");Da.removeClass("selected");la();Ha()},C=function(){g&&g.clearSelected()},
fb=function(a){return function(b){P();c.sort(a);G(b)}},la=function(){ea.removeClass("selected");R.hide("fast");ca.hide()},Ia=function(){x.addClass("open")},Ha=function(){x.removeClass("open")};c.initialize=function(a){var b=$("#showReminders");bg.get("g_one_minute_signup_enabled")?oneMinuteSignup.fetchReminders():b.addClass("hidden");bg.isOffline()?(b.attr("data-toggle","tooltip"),b.attr("title","You have to be online."),b.addClass("disabled")):(b.removeAttr("data-toggle"),b.removeAttr("title"),b.removeClass("disabled"));
oneMinuteSignup.setOpenTourFn(c.openTour);try{bg.sendLpImprove("user_vault_opened");d.body.removeAttribute("class");Topics.get(Topics.REFRESH_DATA).publish();$(".leftMenuItem").removeClass("selected");LPProxy.getPreference("gridView")||c.displayAsList();LPProxy.getPreference("compactView")&&c.displayCompact();this.firstTimeLogin();E.attr("title","Maximize Menu");if(LPFeatures.allowGift()){var h=$("#specialOfferMenu");h.show();h.bind("click",function(){bg.openURL(LPProxy.getBaseURL()+"gift.php")})}gb();
hb();bg.get_method_async(function(a){LPFeatures.safari_legacy_messaging()?dialogs.vaultInfoDialog.open({title:Strings.translateString("Safari extension update required"),contentText1:Strings.translateString("Due to new Apple requirements, you need to download the new LastPass app to continue using LastPass in your Safari browser."),contentText2:Strings.translateString("After download, simply login to your account again and use LastPass in Safari as you always have."),buttons:[{style:"btn-blue",sizeStyle:"col-2 btn-container-lg",
text:Strings.translateString("Update"),action:function(){bg&&bg.openURL&&bg.openURL("https://lastpass.com/safariAppExtension.php?source=vault")}},{style:"btn-link",sizeStyle:"col-1 btn-container-sm",text:Strings.translateString("Close"),action:"close"}]}):"undefined"===typeof a&&null===top.ext&&LPFeatures.isDownloadExtensionWebPromptEnabled()?dialogs.vaultInfoDialog.open({title:Strings.translateString("Download the LastPass browser extension"),segmentEvents:{show:{name:"download_extension_prompt_shown",
properties:{}},download:{name:"download_extension_prompt_clicked",properties:{action:"download"}},noThanks:{name:"download_extension_prompt_clicked",properties:{action:"no_thanks"}},close:{name:"download_extension_prompt_clicked",properties:{action:"close"}}},contentText1:Strings.translateString("Get the most out of LastPass so you can automatically save and fill your passwords, credit cards, addresses, and more."),contentText2:Strings.translateString("Install the LastPass browser extension for simple, quick access right from the LastPass icon in your browser toolbar."),
buttons:[{style:"btn-blue",sizeStyle:"col-2 btn-container-lg",text:Strings.translateString("Download Now"),action:function(){bg&&bg.openURL&&bg.openURL("https://lastpass.com/misc_download2.php")},segment:"download"},{style:"btn-link",sizeStyle:"col-1 btn-container-sm",text:Strings.translateString("No Thanks"),action:"close",segment:"noThanks"}]}):LPPlatform.showIntroTutorial()});ib();jb();LPFeatures.allowTryFamilies()&&$("#lp-try-families").show();LPFeatures.isUpgradeButtonTestEnabled()&&kb()}catch(t){LPPlatform.logException(t)}finally{var f=
$("#vaultLoadingOverlay");LPTools.getOption(a,"fadeIn",!1)?(f.addClass("fadeIn"),setTimeout(function(){f.addClass("loaded")},500)):f.addClass("loaded");k.addClass("loaded");bg.sendTimingEvent("loadVault","start",window.performance.timing.navigationStart);bg.sendTimingEvent("loadVault","stop",window.performance.timing.loadEventEnd,{numberOfItems:LPProxy.getSites().concat(LPProxy.getNotes()).concat(LPProxy.getApplications()).length})}};var hb=function(){bg.LPPartner&&bg.LPPartner.getPartnerInfo&&bg.LPPartner.getPartnerInfo(function(a){a?
($("#logoPartner").attr("src",a.logoWhiteUrl).addClass(a.classWhite),$("#logoPartnerContainer").show()):$("#logoPartnerContainer").hide()})},ib=function(){var a=!1,b=function(){a?($("#inProgressMigration").hide(),Topics.get(Topics.REFRESH_DATA).publish(),setTimeout(LPPlatform.openTour,1)):a=!0};if(bg.MigrationBackground&&bg.MigrationBackground.subscribeToStateOnce){var c=function(a){a?($("#inProgressMigration").show(),setTimeout(b,3E3)):b();bg.MigrationBackground.subscribeToStateOnce(c)};bg.MigrationBackground.subscribeToStateOnce(c);
if(!LPPlatform.lpIsExtension()){var f=$("#inProgressMigration").find(".progress-bar");Migrator.executeMigrations(function(a,b){f.css("width",Math.floor(a/b*100)+"%")})}}},Ja=function(){LPProxy.getPreference("leftMenuMaximize")&&c.toggleLeftMenu()},jb=function(){if(bg.get("g_one_minute_signup_menu_enabled")&&LPPlatform.lpIsExtension()){var a=bg.get("g_onemin_advert_app_threshold"),b=LPProxy.getAllModelItems().length;a&&b>a?$("#vaultFooter").addClass("disabled"):$("#vaultFooter").removeClass("disabled")}else $("#vaultFooter").addClass("disabled");
$("#linkToOnemin","#vaultFooter").click(function(a){bg.sendLpImprove("oneminute::notificationfromvaultomsstart");oneMinuteSignup.show(oneMinuteSignup.modes.normal);return!1})},kb=function(){"undefined"!==typeof bg&&function(){var a=LPProxy.getAccountClass();return a===Constants.USER_FREE||a===Constants.USER_PREMIUM_TRIAL}()&&$("#upgradeButton").addClass("headerButtonActive").click(function(){bg.sendLpImprove("upgrade_button_vault_click");LPPlatform.purchasePremium()})},gb=function(){var a=function(a){c.openReceivedShareCenter(function(){var b=
LPProxy.getPendingRecievedShare(a);b&&c.openAcceptShareDialog(b)})},b=function(a){c.openReceivedShareCenter(function(){var b=LPProxy.getPendingRecievedShare(a);b&&b.reject()})};return function(){var h=LPTools.getURLParams();LPPlatform.setIntroTutorialDisable(!1);for(var f in h){var d=h[f];"cmd"===f&&(f=d);switch(f){case "opengoogleauth":case "opensettings":Topics.get(Topics.EDIT_SETTINGS).publish();break;case "openhistory":LPProxy.openHistory();break;case "openbookmarklets":LPProxy.openBookmarklets();
break;case "linkpersonal":c.openLinkAccountDialog();break;case "unlinkpersonal":c.unlinkAccount();break;case "sharedfolder":case "sf":c.openSharingCenter();break;case "sfadd":c.openSharingCenter();c.openCreateSharedFolderDialog();break;case "addidentity":c.openManageIdentities();c.openIdentityDialog();break;case "showdeleted":c.openDeletedItems();break;case "viewcreditmon":c.openCreditMonitoring();break;case "share":var e=[];d=d.split(",");for(var k=0,l=d.length;k<l;++k){var m=d[k],n=LPProxy.getSiteModel(m);
n||(n=LPProxy.getNoteModel(m));n&&e.push(n)}0<e.length&&c.openShareDialog(e);break;case "ffid":case "edit":LPProxy.getSiteModel(d)?c.openSiteDialog({vaultItem:d}):LPProxy.getNoteModel(d)?c.openNoteDialog({vaultItem:d}):LPProxy.getFormFillModel(d)&&c.openFormFillDialog({vaultItem:d});break;case "acceptshare":a(d);break;case "rejectshare":b(d);break;case "omsstart":LPPlatform.setIntroTutorialDisable(!0),oneMinuteSignup.showWithProvider()}}if(null===g)switch(h.view){case "emergencyAccess":J.show();break;
case "emergencyAccessOthers":K.show();break;default:p.all.show()}}}(),Ka=function(a){if(a){a=a.getAllSubGroupsIncludingFavorites(!0);for(var b=[],c=0,d=a.length;c<d;++c){var e=a[c];e.isExpanded()&&b.push(e._model.getName())}LPPlatform.setOpenGroups(b)}},lb=function(a){var b=$(".securityScore");b.text(null!==a?Math.round(a)+"%":"");a?b.parents(".menuIcon").addClass("score"):b.parents(".menuIcon").removeClass("score")};c.toggleInProgressOverlay=function(){bb.toggle()};var W=function(a,b){0<b?(a.text(b),
a.show()):a.hide()},mb=function(){var a=!1;return function(){if(!a)for(var b=LPProxy.getEmergencyAccessRecipientModels(),c=0,d=b.length;c<d;++c){var e=b[c];if(e.allowedAccess()||e.hasRequestedAccess()){dialogs.denyEmergencyAccess.open({sharee:e});a=!0;break}}}}();c.openVault=function(){p.all.show()};c.openNotes=function(){p.notes.show()};c.openFormFills=function(){p.formFill.show()};c.toggleAdvancedMenu=function(a){ea.toggleClass("selected");R.toggle("fast");ca.toggle();G(a)};c.clear=function(){u&&
(u.destruct(),u=null);$(d.body).addClass("loggedout");LPPlatform.shouldShowVaultLoginButton()&&$(d.body).addClass(LPPlatform.canBackgroundOpenPopover()?"canopenpopover":"cannotopenpopover");$("#vaultLoadingOverlay").removeClass("loaded fadeIn");v.val("");C();w=n=F=U=g=null};c.maximizeLeftMenu=function(){k.addClass("maximized");E.addClass("opened");E.attr("title","Minimize Menu");LPProxy.setPreferences("leftMenuMaximize",!0);setTimeout(Topics.get(Topics.VAULT_LEFT_MENU_TOGGLE).publish,400)};c.minimizeLeftMenu=
function(){k.removeClass("maximized");E.removeClass("opened");E.attr("title","Maximize Menu");LPProxy.setPreferences("leftMenuMaximize",!1);setTimeout(Topics.get(Topics.VAULT_LEFT_MENU_TOGGLE).publish,400)};c.toggleLeftMenu=function(){k.hasClass("maximized")?c.minimizeLeftMenu():c.maximizeLeftMenu()};c.addSource=function(a){a?a.saveOptions&&a.saveOptions.source||(a.saveOptions={source:"vault"}):a={saveOptions:{source:"vault"}};return a};c.openSiteDialog=function(a){dialogs.site.open(c.addSource(a))};
c.openTour=function(a){"41"===(bg.get("LPContentScriptFeatures")?bg.get("LPContentScriptFeatures").tutorial_enabled:"40")?LPPlatform.openTour(a):a?H.show(a):LPProxy.getPreference("seenVault4.0")?(Ja(),v.focus()):H.show(a)};c.openNoteDialog=function(a){dialogs.note.open(c.addSource(a))};c.openFormFillDialog=function(a){dialogs.formFill.open(c.addSource(a))};c.openFolderDialog=function(a,b){dialogs.folder.open({vaultItem:a,defaultData:{groupParent:b?b.getName():""},groups:n.getAllSubGroups()})};c.openTryFamiliesDialog=
function(a,b){a=a||!1;bg.sendLpImprove("try_families_lightbox_shown",b?{origin:b}:{});dialogs.tryFamilies.open({forceAccepted:a})};c.openUpgradeFamiliesForFolderSharingDialog=function(a){a={forceAccepted:a||!1};bg.sendLpImprove("shared_folder_families_lightbox_shown");dialogs.upgradeFamiliesForFolderSharing.open(a)};c.openFamiliesInvitationDialog=function(a){LPProxy.getFamiliesInvitations({params:{},success:function(b){0<b.length?(b.sort(function(a,b){return new Date(b.date)-new Date(a.date)}),dialogs.familiesInvitation.open({invitations:b,
callback:a})):a(!1)},error:function(){a(!1)}})};var Y=function(){var a=LPProxy.getAccountClass();return a===Constants.USER_FREE||a===Constants.USER_PREMIUM_TRIAL||a===Constants.USER_PREMIUM},La=function(){var a=bg.localStorage_getItem("lp_families_dialog_snooze_timestamp"),b=bg.localStorage_getItem("lp_families_dialog_snooze_count");return a&&parseInt(a)>Date.now()&&b&&"1"===b},Ma=function(){var a=bg.localStorage_getItem("lp_try_families_dialog_declined"),b=bg.localStorage_getItem("lp_families_dialog_snooze_count");
b=b&&1<parseInt(b);return a||b};c.openCreateSharedFolderDialog=function(a,b){!LPProxy.isLegacyPremium()&&Y()&&LPFeatures.allowTryFamilies()&&!LPProxy.isFamiliesTrialStarted()?c.openUpgradeFamiliesForFolderSharingDialog(!1):LPProxy.isFamilyUser()&&bg.get("LPContentScriptFeatures").family_shared_folders_enabled?dialogs.familiesSharedFolder.open({group:a,children:b}):LPProxy.getAccountClass()===Constants.USER_FREE?(bg.sendLpImprove("upgrade_to_premium_lightbox_shown"),dialogs.upgradePremium.open({upgradeText:[LPTools.createElement("h1",
"upgradeDialogHeader",Strings.translateString("Need to share passwords with family or friends?")),LPTools.createElement("p","dialogText",Strings.translateString("Go Premium now to create a Shared Folder, invite family or friends, and fill the folder with passwords and notes. Give up to 5 people access to the Shared Folder. Changes are synced automatically, and you can assign read-only access. Go Premium now to create a Shared Folder!"))]})):dialogs.createSharedFolder.open({group:a,children:b})};c.openSettingsDialog=
function(){null===U&&(AccountSettingsService.call(function(a){U=a;c.openSettingsDialog()},function(){Notifications.displayErrorMessage("Could not retrieve account settings!")}),Topics.get(Topics.DIALOG_LOADING).publish());dialogs.settings.open(U)};c.openLinkAccountDialog=function(){LPProxy.callAcctsIFrameCommand("linkpersonal")};c.unlinkAccount=function(){var a=LPProxy.getLinkedAccount();a&&a.unlink()};c.toggleCollapseAll=function(){var a=!1;Topics.get(Topics.ALL_COLLAPSED).subscribe(function(){a=
!0;S.addClass("selected");S.attr("title",Strings.Vault.EXPAND_ALL)});Topics.get(Topics.ALL_EXPANDED).subscribe(function(){a=!1;S.removeClass("selected");S.attr("title",Strings.Vault.COLLAPSE_ALL)});return function(){a?(Topics.get(Topics.EXPAND_ALL).publish(),Topics.get(Topics.ALL_EXPANDED).publish()):(Topics.get(Topics.COLLAPSE_ALL).publish(),Topics.get(Topics.ALL_COLLAPSED).publish())}}();c.toggleSize=function(){var a=!1;c.displayLarge=function(){Topics.get(Topics.DISPLAY_LARGE).publish();a=!1;T.removeClass("selected");
T.attr("title",Strings.Vault.COMPACT_VIEW);LPProxy.setPreferences("compactView",!1)};c.displayCompact=function(){Topics.get(Topics.DISPLAY_COMPACT).publish();a=!0;T.addClass("selected");T.attr("title",Strings.Vault.LARGE_VIEW);LPProxy.setPreferences("compactView",!0)};return function(){a?(c.displayLarge(),bg.lpevent(V?"v_grd_lrg":"v_lst_lrg")):(c.displayCompact(),bg.lpevent(V?"v_grd_cmp":"v_lst_cmp"))}}();c.displayAsGrid=function(){Topics.get(Topics.DISPLAY_GRID).publish();xa.addClass("selected");
ya.removeClass("selected");LPProxy.setPreferences("gridView",!0);V=!0};c.displayAsList=function(){Topics.get(Topics.DISPLAY_LIST).publish();ya.addClass("selected");xa.removeClass("selected");LPProxy.setPreferences("gridView",!1);V=!1};c.search=function(a){g&&g.search(a)};var Na=function(a,b){switch(b){case A:a.sortByName(!0);break;case B:a.sortByName(!1);break;case oa:a.sortByFolder(!0);break;case pa:a.sortByFolder(!1);break;case Q:a.sortItemsByMostRecent();break;case qa:case sa:a.sortByEmail(!0);
break;case ra:case ta:a.sortByEmail(!1)}};c.sort=function(a){db.text(a);Na(g.getContainer(),a);g.setSortOrder(a)};c.showMoreOptionsMenu=function(){Ba.show("fast")};c.hideMoreOptionsMenu=function(){Ba.hide("fast")};c.openEmergencyAccess=function(){ia.show()};c.openEmergencyAccessTrusted=function(){ia.show(J)};c.openEmergencyAccessTrusting=function(){ia.show(K)};c.openSharingCenter=function(a){O.show()};c.openReceivedShareCenter=function(a){O.show(L,a)};c.openSentShareCenter=function(a){O.show(M,a)};
c.openSharedFolderCenter=function(a){O.show(z,a)};var N=!1,ja=function(a){z.getContainer().applyFilter({showEmptyGroups:!1,multiSelect:!1,func:function(a){return!a._model.isDeleted()}},a);N=!1},ka=function(a){z.getContainer().applyFilter({showEmptyGroups:!1,multiSelect:!1,func:function(a){return!0}},a);N=!0};c.openAcceptShareDialog=function(a){dialogs.acceptShare.open({vaultItem:a,groups:n.getAllSubGroups()})};c.openShareDialog=function(a){LPTools.openShareDialog(a)};c.openSharedFolderDialog=function(a,
b){LPProxy.isFamilyUser()&&a._shareInfo.cid!==Constants.UNAFFILIATED_COMPANY_ID&&bg.get("LPContentScriptFeatures").family_shared_folders_enabled?dialogs.familiesSharedFolder.open({folder:a,members:b}):dialogs.sharedFolder.open(a,b)};c.openSharedFolderAccessDialog=function(a){dialogs.sharedfolderAccess.open(a)};c.openRestrictedSharingDialog=function(){dialogs.restrictedSharing.open()};c.closeShareDialog=function(){dialogs.share.close(!0)};c.openManageIdentities=function(){Ga.show()};c.openIdentityDialog=
function(a){dialogs.identity.open(a)};c.enableIdentity=function(a){null!==F&&F!==a&&(F.disable(),LPProxy.enableIdentity(a));F=a;a=n?n._filter:null;null!==n&&(Ka(n),n.destruct());var b=LPProxy.getAllItems({identity:F});b=new GridListContainer(b,{separateItems:!0,separateFavorites:!0,stickyFolders:!0,ignoreFilterOnSearch:!0,keyboardNavigation:!0,stickyFolderParent:d.getElementById("main"),folderStateChange:Ka});var c=LPPlatform.getOpenGroups();if(null!==c){for(var f=!0,e=b.getAllSubGroupsIncludingFavorites(!0),
g=0,k=e.length;g<k;++g){var l=e[g];c[l._model.getName()]?(l.expand(),f=!1):l.collapse()}f&&Topics.get(Topics.ALL_COLLAPSED).publish()}Na(b,p.all.getSortOrder());b.initialize(d.getElementById("vaultContent"),r);b.applyFilter(a);Z(b);for(var m in p)p[m].setContainer(b);n=b};c.openCreditMonitoring=function(a){X.show()};c.openCreateCreditMonitoringDialog=function(){dialogs.createCreditMonitoring.open()};c.openDeletedItems=function(a){ha.show()};var H=function(){var a=0,b=null,c=null,f=d.getElementById("tourItems"),
e=$("#tourLeft"),g=$("#tourRight");e.hide();e.bind("click",function(){H.reverse()});g.bind("click",function(){H.advance()});var m=function(a){return function(){H.goTo(a)}};c=d.getElementById("tourSteps").children;for(var l=0,n=c.length;l<n;++l)LPPlatform.addEventListener(c[l],"click",m(l));c[0].setAttribute("class","tourStep selected");var p=function(d){if(d!==a&&0<=d&&d<c.length){c[a].setAttribute("class","tourStep");var h="tour"+(d+1);f.setAttribute("class",h);k.addClass(h);b&&k.removeClass(b);
b=h;a=d;c[a].setAttribute("class","tourStep selected");0===d?e.hide():e.show();d===c.length-1?g.hide():g.show()}},q=function(){p(a+1)},r=function(){p(a-1)};return{advance:q,reverse:r,goTo:function(a){p(a)},hide:function(){k.removeClass("tourState");k.removeClass(b);b=null;Topics.get(Topics.RIGHT_ARROW).unsubscribe(q);Topics.get(Topics.LEFT_ARROW).unsubscribe(r);bg.sendLpImprove&&bg.sendLpImprove("vaulttour::exit",{version:"40",page:a+1})},show:function(a){p(0);k.addClass("tourState");Topics.get(Topics.RIGHT_ARROW).subscribe(q);
Topics.get(Topics.LEFT_ARROW).subscribe(r);bg.sendLpImprove&&(bg.sendLpImprove("vaulttour",{version:"40"}),bg.sendLpImprove("vaulttour::start",{version:"40",source:a?"help":"welcome"}))}}}();c.showAdPane=function(){if("undefined"!==typeof bg.is_edge?bg.is_edge():-1!==navigator.userAgent.indexOf(" Edge/"))return!1;var a=bg.get("g_prompts").improve?1:0,b=d.getElementById("ad"),c=d.createElement("iframe");c.setAttribute("src",na.getPartnerURL(LPProxy.getBaseURL()+"ads.php?nobr=1&noga=1&rand="+Math.floor(1E3*
Math.random())+"&v="+LPProxy.getVersion())+"&g_lpImprove="+a);c.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups");b.appendChild(c);k.addClass("freeUser");setInterval(function(){c.setAttribute("src",na.getPartnerURL(LPProxy.getBaseURL()+"ads.php?v=4.0&nobr=1&noga=1&rand="+Math.floor(1E3*Math.random())+"&v="+LPProxy.getVersion())+"&g_lpImprove="+a)},3E5)};c.firstTimeLogin=function(){if(bg.get("g_first_time_login")){var a=LPTools.createElement("iframe",{"class":"displaynone",src:LPProxy.getBaseURL()+
"lppixel.php"});$("#main").after(a)}};k.bind("click",function(){ma()});$("#vault").bind("click",function(){C();ma()});$("#loginButton").bind("click",function(){bg.open_login()});LPPlatform.addEventListener(window,"unload",function(){Topics.get(Topics.CLEAR_DATA).publish()});v.LP_addSearchHandlers("inputLight",function(a){c.search(a)});v.bind("keydown",function(a){if(40===(a.keyCode||a.which)){var b=g.getContainer();b&&(b=b.getAllChildrenOrdered(),0<b.length&&(b[0].focus(),a.preventDefault(),a.stopPropagation()))}});
$("#orderOption").bind("click",function(a){Aa.toggle("fast");w=Aa;LPTools.addKeyBoardNavigation(fa.children);G(a)});$("#actions").bind("click",function(a){if(null===w||w.get(0).parentElement!==Ca){var b=g.createSelectionContextMenu();Ca.appendChild(b);b.removeAttribute("style");w=$(b);w.show("fast")}else P();G(a)});$(".sharingMenuItem").bind("click",function(){bg.sendLpImprove("sharing_center_vault_click");!LPProxy.isLegacyPremium()&&Y()&&LPFeatures.allowTryFamilies()&&!Ma()&&!La()&&LPProxy.isFamiliesTrialStarted()&&
c.openTryFamiliesDialog(!1,"sharing_menu_item");c.openSharingCenter()});ea.bind("click",c.toggleAdvancedMenu);ca.bind("click",la);E.bind("click",c.toggleLeftMenu);LPPlatform.addEventListener(d.getElementById("settingsMenuItem"),"click",function(){Topics.get(Topics.EDIT_SETTINGS).publish({source:"sidebar"})});$("#linkAccountMenuItem").bind("click",function(){c.openLinkAccountDialog()});R.on("click",".toolsMenuItem.subMenuOption",function(){return!1});R.on("click",".toolsMenuItem",la);x.bind("mouseenter",
Ia);x.bind("mouseleave",Ha);x.bind("touchstart",function(a){x.unbind("mousenter");x.unbind("mouseleave");x.hasClass("open")||(Ia(),a.preventDefault())});LPPlatform.addEventListener(d.getElementById("collapseAllToggle"),"click",function(){c.toggleCollapseAll()});LPPlatform.addEventListener(d.getElementById("showReminders"),"click",function(){oneMinuteSignup.show(oneMinuteSignup.modes.reminder)});LPPlatform.addEventListener(d.getElementById("sizeToggle"),"click",function(){c.toggleSize()});LPPlatform.addEventListener(d.getElementById("gridButton"),
"click",function(){c.displayAsGrid()});LPPlatform.addEventListener(d.getElementById("listButton"),"click",function(){c.displayAsList()});LPPlatform.addEventListener(d.getElementById("userMenuContainer"),"click",function(a){Da.toggleClass("selected");da.toggle("fast");G(a)});var Oa=function(){H.hide();LPProxy.getPreference("seenVault4.0")||LPProxy.setPreferences("seenVault4.0",!0);Ja()};LPPlatform.addEventListener(d.getElementById("skipTour"),"click",Oa);LPPlatform.addEventListener(d.getElementById("tourOpenMyVault"),
"click",Oa);LPPlatform.addEventListener(d.getElementById("manageIdentitiesMenuItem"),"click",function(){c.openManageIdentities()});LPPlatform.addEventListener(d.getElementById("creditMonitoringMenuItem"),"click",function(){c.openCreditMonitoring()});LPPlatform.addEventListener(d.getElementById("openTourMenuItem"),"click",function(){c.openTour(!0)});$(".toolsMenuItem.subMenuOption").bind("click",function(a){$(a.target.parentElement.nextElementSibling).toggle("fast");$(a.target).toggleClass("selected");
G(a)});LPPlatform.addEventListener(d.getElementById("toolsImport"),"click",function(){LPProxy["import"]()});LPPlatform.addEventListener(d.getElementById("toolsExport"),"click",function(){LPProxy["export"]()});LPPlatform.addEventListener(d.getElementById("toolsOpenFavorites"),"click",function(){LPProxy.openAllFavorites("vault")});LPPlatform.addEventListener(d.getElementById("bookmarkletsMenuItem"),"click",function(){LPProxy.openBookmarklets()});LPPlatform.addEventListener(d.getElementById("otpMenuItem"),
"click",function(){$(this).attr("href",bg.get("base_url")+"otp.php")});LPPlatform.addEventListener(d.getElementById("historyMenuItem"),"click",function(){LPProxy.openHistory()});LPPlatform.addEventListener(d.getElementById("deletedMenuItem"),"click",function(){c.openDeletedItems()});LPPlatform.addEventListener(d.getElementById("generateSharingKeys"),"click",function(){bg.lpevent("v_gsk");dialogs.sharingKey.open()});$("#generateSharingKeys").hide();LPPlatform.addEventListener(d.getElementById("featureManager"),
"click",function(){bg.openURL(window.location.origin+"/lastpass/index.html#/feature-manager")});LPPlatform.addEventListener(d.getElementById("generatePasswordMenuItem"),"click",function(){bg.lpevent("v_gpw");(bg.get("LPContentScriptFeatures").better_generate_password_enabled?dialogs.betterGeneratePassword:dialogs.generatePassword).open({fillGenerated:!1,saveOptions:{source:"vault"}})});$("#removedLinkedAccountMenuItem").bind("click",function(){c.unlinkAccount()});$("#tryEnterprise").bind("click",
function(){dialogs.enterpriseTrial.open()});$("#emergencyAccessMenuItem").bind("click",function(){var a=LPProxy.getUser(),b=bg.get("g_emer_sharers"),d=bg.get("g_emer_sharees");a.isFree()&&LPFeatures.restrictEmergencyAccessForFree()&&!b.length&&!d.length?dialogs.restrictedEmergencyAccess.open():(bg.sendLpImprove("emergency_access_vault_click"),c.openEmergencyAccess())});$(".securityMenuItem").bind("click",function(){bg.lpevent("v_sec");bg.openseccheck()});$("#adminConsoleMenuItem").bind("click",function(){bg.lpevent("v_oec");
bg.openentconsole()});$("#more-options-refer-a-friend").bind("click",function(){bg.sendLpImprove("refer_a_friend_more_options_click")});$("#more-options-go-premium").bind("click",function(){bg.sendLpImprove("go_premium_more_options_vault_click")});$("#familyAdminConsoleMenuItem").bind("click",function(){bg.lpevent("v_ofc");bg.openFamilyConsole();bg.sendLpImprove("families_manage_families_click")});$("#lp-try-families").bind("click",function(){Y()&&LPFeatures.allowTryFamilies()&&c.openTryFamiliesDialog(!1,
"try_families_submenu_item")});Topics.get(Topics.ITEMS_DESELECTED).subscribe(function(){c.hideMoreOptionsMenu()});Topics.get(Topics.ITEMS_SELECTED).subscribe(function(){c.showMoreOptionsMenu()});Topics.get(Topics.SELECT_COUNT_CHANGE).subscribe(function(a){0<a&&(a+=" selected",$("#selectedItemCounter").text(a))});Topics.get(Topics.CONTEXT_MENU).subscribe(function(a,b){b.parentElement!==d.body&&d.body.appendChild(b);w=LPTools.displayContextMenu(a,b)});Topics.get(Topics.CONTEXT_CLOSE).subscribe(function(){P()});
Topics.get(Topics.ITEM_SHARE).subscribe(function(a){LPFeatures.allowOmarDrawer()&&1===a.length?window.location.hash="/drawers/(drawer:edit-item/"+a[0]._data.aid+"/sharing)":c.openShareDialog(a)});Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(a){c.enableIdentity(a);Z(n)});Topics.get(Topics.CLEAR_DATA).subscribe(function(){c.clear();Dialog.prototype.closeAllDialogs(!0);bg.closeSettingsIframe()});Topics.get(Topics.LOGIN).subscribe(function(a){nb();c.initialize(a);Dialog.prototype.closeAllDialogs(!0)});
Topics.get(Topics.REQUEST_SUCCESS).subscribe(function(a){LPTools.getOption(a,"incrementAccountsVersion",!1)&&C()});(function(){var a=function(a,c,d){v.val("");C();n.addChild(a.newDisplayObject(),c,d);Z(n)};Topics.get(Topics.SITE_ADDED).subscribe(a);Topics.get(Topics.NOTE_ADDED).subscribe(a);Topics.get(Topics.FORM_FILL_ADDED).subscribe(a);Topics.get(Topics.APPLICATION_ADDED).subscribe(a)})();Topics.get(Topics.ITEM_REMOVED).subscribe(function(){Z(n)});Topics.get(Topics.EDIT_SHARED_FOLDER_ACCESS).subscribe(function(a){c.openSharedFolderAccessDialog(a)});
Topics.get(Topics.EDIT_SITE).subscribe(function(a){LPFeatures.allowOmarDrawer()?window.location.hash="/drawers/(drawer:edit-item/"+a.vaultItem._data.aid+")":c.openSiteDialog(a)});Topics.get(Topics.EDIT_NOTE).subscribe(function(a){LPFeatures.allowOmarDrawer()?window.location.hash="/drawers/(drawer:edit-item/"+a.vaultItem._data.aid+")":c.openNoteDialog(a)});Topics.get(Topics.EDIT_FORM_FILL).subscribe(function(a){c.openFormFillDialog(a)});Topics.get(Topics.EDIT_APPLICATION).subscribe(function(a){dialogs.application.open(a)});
Topics.get(Topics.EDIT_SETTINGS).subscribe(function(a){bg.sendLpImprove("viewvaultsettings",{source:a&&a.source?a.source:""});params={};bg.get("gRecovery")&&(params.recovery=bg.get("gRecovery"));LPProxy.callAcctsIFrameCommand("settings",null,params)});Topics.get(Topics.EDIT_IDENTITY).subscribe(function(a){c.openIdentityDialog(a)});Topics.get(Topics.ACCEPT_SHARE).subscribe(function(a){c.openAcceptShareDialog(a)});Topics.get(Topics.RENAME_FOLDER).subscribe(function(a){c.openFolderDialog(a)});Topics.get(Topics.CREATE_SUB_FOLDER).subscribe(function(a){c.openFolderDialog(null,
a)});Topics.get(Topics.GROUP_ADDED).subscribe(function(a,b){v.val("");C();n.addChild(a.newDisplayObject(),b);a instanceof SharedGroup&&(b=z.getContainer(),null!==b&&(a=new SharedFolderItem(a),b.addChild(a)))});Topics.get(Topics.ESCAPE).subscribe(function(a){(a=Dialog.prototype.getCurrentDialog())&&a.close();C();ma()});Topics.get(Topics.EDIT_SHARED_FOLDER).subscribe(function(a,b){c.openSharedFolderDialog(a,b)});Topics.get(Topics.IDENTITY_ADDED).subscribe(function(a){Ga.getContainer().addChild(a.newDisplayObject())});
Topics.get(Topics.REFRESH_DATA).subscribe(function(){LPProxy.initializeModel();mb();u=LPProxy.getUser();u.initialize(da,$("#userMenuText"));LPTools.parseUserSpecificMenu(d.getElementById("tools"),u._accountClass);LPTools.parseUserSpecificMenu(d.getElementById("leftMenu"),u._accountClass);var a=LPProxy.getAccountClass(),b=LPProxy.isPremiumAsAPerk(),e=LPProxy.isLegacyPremium(),f=d.getElementById("sharedFoldersMenuItem").parentElement;a===Constants.USER_FREE?($("#emptySharedFoldersIcon .tourText").append(LPTools.createElement("a",
{"class":"nbtn rbtn dynamicWidth",href:LPProxy.getBaseURL()+"go-premium",target:"_blank"},Strings.translateString("Upgrade to Premium"))),f.parentElement.appendChild(f)):a===Constants.USER_PREMIUM&&b&&!e&&d.getElementById("sharedFoldersMenuItem").remove();$(f.parentElement).children().last().addClass("last");VaultState.setIdentities(u._identities);LPProxy.enableCurrentIdentity(u._identities);u.isFreeOrTrial()?c.showAdPane():k.removeClass("freeUser");LPProxy.getSecurityChallengeScore(lb);Dialog.prototype.closeInProcessDialogs();
VaultItemDialog.prototype.refreshOpenDialogs();Topics.get(Topics.REFRESH_PREFERENCES).publish();P()});Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).subscribe(function(a){g&&g.updateNotificationCount("number"===typeof a?a:1)});Topics.get(Topics.ACCOUNT_LINKED).subscribe(function(a){$("#linkAccountMenuItem").LP_hide();$("#removedLinkedAccountMenuItem").LP_show()});Topics.get(Topics.ACCOUNT_UNLINKED).subscribe(function(a){$("#linkAccountMenuItem").LP_show();$("#removedLinkedAccountMenuItem").LP_hide()});
Topics.get(Topics.CREATE_SHARED_FOLDER).subscribe(function(a,b){c.openCreateSharedFolderDialog(a,b)});Topics.get(Topics.REPROMPT).subscribe(function(a){dialogs.reprompt.open({successCallback:a})});Topics.get(Topics.CONFIRM).subscribe(function(a){dialogs.confirmation.open(a)});Topics.get(Topics.EMERGENCY_RECIPIENT_ADDED).subscribe(function(a){J.getContainer().addChild(a.newDisplayObject())});Topics.get(Topics.EDIT_EMERGENCY_RECIPIENT).subscribe(function(a){dialogs.addEmergencyAccess.open({vaultItem:a})});
Topics.get(Topics.REAPPLY_SEARCH).subscribe(function(a,b){var c=v.val();c&&a.applySearch(c,b)});Topics.get(Topics.ENROLLED_CREDIT_MONITORING).subscribe(function(){X.refresh()});Topics.get(Topics.ITEM_SHARED).subscribe(function(a){M.refresh()});Topics.get(Topics.REFRESH_PREFERENCES).subscribe(function(){LPFeatures.updateFeatures({"import":!0,noexport:!1,share:!0,share_onlyfolders:!1,show_notes:!0,bookmarklets:!0,hideidentities:!1,showcredmon:!0,link_personal:!0,show_formfills:!0});LPProxy.hasReceivedShares()?
k.removeClass("noReceivedShares"):k.addClass("noReceivedShares");switch(g){case M:LPFeatures.allowIndividualSharing()||(O.clear(),p.all.show(),dialogs.alert.open({title:Strings.translateString("Policy Update"),text:Strings.translateString("Your enterprise has prohibited individual sharing.")}));break;case z:LPFeatures.allowSharedFolders()||(p.all.show(),dialogs.alert.open({title:Strings.translateString("Policy Update"),text:Strings.translateString("Your enterprise has prohibited sharing.")}))}});
Topics.get(Topics.INITIALIZED).subscribe(function(){Strings.translate(d.body);$("input,textarea").prop("spellcheck",!1);if(LPFeatures.allowNewSettings()){var a=document.getElementById("new-settings-iframe");a.src=LPProxy.getBaseURL()+"newvault/lp-vault/settings.html";a.addEventListener("load",function(){a.contentWindow.postMessage({localkey:parent.g_local_key},LPProxy.getBaseURL())})}});Topics.get(Topics.INTRO_TOURS_LOADED).subscribe(function(a){a=LPProxy.seenVaultPostFamilies();var b=LPProxy.predatesFamilies(),
d=LPFeatures.allowTryFamilies(),e=LPProxy.isFamiliesTrialStarted();!d||!b||a||Ma()||La()||!Y()||e||c.openTryFamiliesDialog(!1,"first_vault_entry")});LPPlatform.addEventListener(d,"DOMContentLoaded",function(){Notifications.initialize()});var ob=function(a,b,c){c=LPTools.createElement("div",$.extend(c,{"class":"leftMenuItem",id:c.id}));c.appendChild(b);c.appendChild(LPTools.createElement("span",{"class":"menuText"},a));return $(c)},Pa=function(a,b){if(a.types){var c=b.filter(function(b){return-1<a.types.indexOf(b.id)});
return function(a){for(var b=0;b<c.length;++b){var d=c[b];d=a instanceof GroupDisplay?!0:a._model.getRecordType()===d.recordType;if(d)return!0}return!1}}return function(a){return!(a instanceof FormFillDisplay)}},p={},Z=function(a){if(LPFeatures.allowOmarIA()){var b=document.getElementById("leftMenuItemsContainer");LPTools.removeDOMChildren(b);var c=LPProxy.getRecordConfig(),d=!1,e=!1,k=function(a){d&&(b.appendChild(LPTools.createElement("div","leftMenuItemsDivider")),d=!1);b.appendChild(p[a].getElement())},
m=function(b,f){if(Array.isArray(b))d=0<f,b.forEach(m);else if(f=LPProxy.getConfigViewObject(b),f.default)k(b);else{var h=Pa(f,c.types),l=a._filter;a.applyFilter({func:h},{checkForStateChange:!1});0<a.getItemChildren().length?k(b):p[f.id]===g&&(e=!0);a.applyFilter(l,{checkForStateChange:!1})}};d=!0;c.viewConfig.forEach(m);e&&p.all.show()}},pb=function(a){var b=LPProxy.getRecordConfig();return LPTools.createElement("i",{"class":["menuIcon",a.types&&0<a.types.length?b.icons[a.types[0]]:b.icons.all]})},
nb=function(){if(LPFeatures.allowOmarIA()){var a=LPProxy.getRecordConfig();a.views.forEach(function(b){p[b.id]=new y({filter:{showEmptyGroups:!1,func:Pa(b,a.types)},sortOptions:D,menuElement:ob(b.name,pb(b),{id:b.id}),bodyState:"vaultContent "+b.id,scrollParent:r,title:Strings.translateString(b.name),addMenu:[new q({text:"ADD_ITEM",func:function(){var c;b.types?a.types.forEach(function(d){if(d.id===b.types[0])switch(c=d.recordType,c){case a.TYPE.Password:dialogs.site.open();break;case a.TYPE.Custom:dialogs.addItem.open({isExpanded:!0});
break;default:dialogs.note.open({defaultData:{notetype:c,language:Note.prototype.isValidLanguage(navigator.language)?navigator.language:"en-US"}})}}):dialogs.addItem.open()}}),ba]})})}else p.all=new y({filter:{showEmptyGroups:!0,func:function(a){return a instanceof AccountBaseDisplay||a instanceof ApplicationDisplay||a instanceof GroupDisplay}},sortOptions:D,menuElement:$("#vaultMenuItem"),bodyState:"vaultContent site",scrollParent:r,title:Strings.translateString("Sites"),addMenu:[Va,aa,I,ba]}),p.notes=
new y({filter:{showEmptyGroups:!1,func:function(a){return a instanceof NoteDisplay||a instanceof GroupDisplay}},sortOptions:D,menuElement:$("#notesMenuItem"),bodyState:"vaultContent note",scrollParent:r,title:Strings.translateString("Secure Notes"),addMenu:[aa,I,ba]}),p.formFills=new y({filter:{showEmptyGroups:!1,multiSelect:!1,hasFolderView:!1,func:function(a){return a instanceof FormFillDisplay}},sortOptions:Qa,menuElement:$("#formFillMenuItem"),bodyState:"vaultContent formFill",scrollParent:r,
title:Strings.translateString("Form Fills"),addMenu:[Wa]});LPFeatures.isDogfood()||$("#featureManager").LP_hide()}})(document,LPVault,BuildVariables);
//# sourceMappingURL=newvault_vault_js.js.map