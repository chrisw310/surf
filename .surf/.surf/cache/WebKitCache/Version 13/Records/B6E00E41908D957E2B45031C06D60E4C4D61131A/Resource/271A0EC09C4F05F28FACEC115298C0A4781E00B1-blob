"use strict";FastMail.theme.imageDidLoad("all","avatar.png","data:image/png;base64,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"),FastMail.theme.imageDidLoad("all","pinboardOff.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAMAAAAz6Z0tAAAADFBMVEUAAAAAAADQ0NDqVknP4rvpAAAAAXRSTlMAQObYZgAAACZJREFUeAFjYMIBGIAAwqKfksEEGHEAkBwzGNBPySACgz+9jKYXAGruAzHPYqqQAAAAAElFTkSuQmCC"),FastMail.theme.imageDidLoad("all","pinboardOn.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAMAAAAz6Z0tAAAADFBMVEUAAAAAAADQ0NDqVknP4rvpAAAAAXRSTlMAQObYZgAAACVJREFUeAFjYMQBGICAGQzop2QQgdFwwQGYcACEHP2UYAWj4QIAfp8DMR5y10QAAAAASUVORK5CYII="),FastMail.theme.imageDidLoad("all","pinned_30x30.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAACAVBMVEUAAAAAAAAAAACAAACAgICqVVWAQEAAAABmAABmMzMAAABVAAAAAAAAAABGAAAAAAAAAAAAAAAwQFCAAAANDQ0AAAANDQ0AAAALCwsKCgoKCgoJCQkJCQkICAgICAhVAAAwBQU5AABvAAAEBAQEBAQmO0gpN0hhAABgAABEAAB1AAAtAwAvAgAAAAAAAABNAABNAABcAABbAAByAgICAgIlOEYnOEd1AgInN0coN0cLDhFkAgBlAgBuAQEvAAAuAAA6AQE7AQEqGB1oAQFpAQE/AQE+AQExAAAzAAAJDA+Wn6YXHyl0AQFIAAArEBQpEBQsAAAUHSUuAAAvAAAyAAAzAAA2AAA3AAA6AAA/AABAAABDAABEAABIAABJAABNAABOAABRAABXAABZAABcAABeAABgAABkAABmAABoAABpAABrAQBuAQBvAQBzAQB2BwYsAgJrCwaJGhSKGhRhGhRoHBZpHBZ+FAxzFQ6bKCIdKTWOGw6OGw8fKzaYNSksBQZeGhWyOCu4PS+4PjAcJzM2EBEdKTbLTj6LMSW8Szm9SzpRMTLMNBzVU0CyRTXWUDvcWETdWETaWkbkX0raWkVMJyfZOh/ZOyDePCDfPCDgPCHkPSHkPiHnPiLqPyLqQCPqQSTqQiXrSi/sTTLsUzntWkHtX0buYEjuYkvuY0zuZU7r2FTZAAAAlXRSTlMAAQICAgMEBQUFBgYKCwsODxAQEhMUFBUYGRodHh8hJzU2PEZISkpMTWFiZmdtbnp7fX6JkpaXl52hoqOkq6+wsLCytra3uLq6v7/AxMXMzdPV2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2Nja3t/g4OHh4eHi5Ofo6Orr7Ozs7u7x8vPz9PT19/f3+Pn5+fr7/e8lCV0AAAF0SURBVHgBY2BgYMQJgJL0khbWMvfxMdcSxirNZpwHBcZsmNKstjn5le2TJ7dX5ufasmJIK2UXT1wFBhOKspUwpJ2zGldBQWOmC4a0TUYzTLop3RpDWiM1rRci25uWqo4hzWyUUr502cqVy5aWpxgyY/F3ctL0WXPnzpqelITN3/KJhdPAoDBRHkOaQz8+vnrmDBCoTkgw4ECV5vaNi6uZM3sOGNTExvlyoEhrRlf0zIODnooYTRRpt8j+xfNhsgsW90e5okg7RNStWrFk0cJ58xYuWrJiVV2EI4q0YnjpJFCQLF8OIieVhSmiSDO7h5Z0wQK1syTEgxnVY3z2wcENHX1TpvR1NAQH2fGh+ZuJUyegoL516tTW+oIAbU4mdGkWFk4FJ7/ubn8nBU4WFkxpIFAz8/IyVQUysEsLWVhaWghhSnPxCIpJyqnoele1BJroqchIiQvwcgGloYCdR0BEQlZZ16q2zdNEV0VaQpSfh52BYgAAkYGOpsmivn4AAAAASUVORK5CYII="),FastMail.theme.imageDidLoad("all","unpinned_30x30.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAABtlBMVEUAAAAAAAD///8AAACAgIBVVVVAQEAzMzMcHBw5OTkzMzMrKytJSUk8PDxDQ0M9PT07OztCQkI+Pj5AQEAwMDAZGRkYGBg8PDwoKCgjIyMWFhY4ODg3NzctLS0sLCw4ODg5OTkmJiYlJSU4ODg4ODgbGxsbGxs5OTk4ODg4ODgyMjI4ODgvLy84ODhsbGxra2s5OTk4ODgTExMTExMpKSkoKCgmJiYfHx8mJiY4ODheXl4YGBgXFxc4ODg3NzcUFBQtLS0gICCtra0qKiq2trYREREZGRktLS0bGxsvLy8dHR0SEhITExMUFBQVFRUWFhYZGRkbGxscHBweHh4fHx8gICAiIiIjIyMmJiYnJycoKCgpKSksLCwtLS0uLi4SEhIjIyMkJCQlJSUtLS0yMjIzMzNFRUU5OTk9PT0+Pj5RUVFSUlJERERjY2NkZGRYWFhaWlpqampVVVVXV1dnZ2doaGh3d3d1dXV7e3t8fHyPj495eXmQkJCVlZWampr///////96enp7e3t8fHx/f3+CgoKDg4OFhYWGhoaIiIiLi4uRkZGUlJSWlpaYmJiampqdnZ2ioqK4UEUYAAAAgXRSTlMAAQECAgMEBQkJCgwOERMVGhshJCUpKi8/QUVJSlBRVllfYWVtcHF0en+AgIiJiYqQkpOVl5iam5ucnqKjpaapqa21t7m+v8LDxdXY2NjY2NjY2NjY2NjY2NjY2NjY2Nrc3N3d39/f4eHj4+Pl6Ojp6+zt7e3u8PLy8vn6+vr7+/6ACstiAAABbklEQVR4AWNgYGCEAhYRHc+4OE8dERaYCFASLs3lEBsbB0YOnJjSbO4xabl1EyfW5aXFurNhSMvFZNdOBIParBhZDGnn6LKJUFAW5YwhbRpZCJMujDTBkJaIiKiEyFZEREhgulwpPKO3f8KE/t6McEUsHmMMC2tsaW1taQoLw+ZvydD0ZjBID5XEkOY2Dw4pagGDopAQc25UaQ6voOTiNigoTg7y4kCRVgvMrG6Hg+rMQFUUabeAmp5OmGxnT02AG4q0jX/+xIl93V0dHV3dfRMn5vtbo0iL+aVWTYSDqhQ/UVSX2/smlsJkSxJ87dE8xm7s45OUU1BeXpCT5ONtxI4mzcwq5RoPBa5SrMzo0iwsPFpmjh4ejhZaPCwsWKRZpDX09fT0NGRYsEvzamrXN2hr8+GQZpHXdXLRVWBBlYaoYQICfgNDK0MBEAsigybNqGxpqcKIU5pJ0NZOmAm3NKO6NiMeaSYhcSa4NOUAALbieu2PKoUNAAAAAElFTkSuQmCC"),FastMail.theme.imageDidLoad("all","doc_32x32.png","data:image/png;base64,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"),FastMail.theme.imageDidLoad("all","file_32x32.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAgCAMAAAA/gEgKAAABQVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABCQkJRUVFHR0dJSUlLS0tNTU1KSkqCgoLGxsahoaHf39/c3Nzk5OTNzc3S0tLZ2dlOTk5QUFBiYmJsbGxycnJ1dXWBgYGEhISSkpKTk5OVlZWdnZ2enp6kpKSlpaWoqKirq6usrKyurq6vr6+0tLS1tbW2tra6urrBwcHCwsLDw8PExMTHx8fIyMjLy8vNzc3Pz8/Q0NDR0dHT09PU1NTV1dXW1tbX19fZ2dna2trb29vc3Nzd3d3f39/g4ODh4eHi4uLk5OTl5eXm5ubn5+fo6Ojq6urr6+vs7Ozt7e3v7+/w8PDx8fHy8vL09PT19fX29vb39/f5+fn6+vr7+/v8/Pz+/v7///9/BmBAAAAAI3RSTlMAChcfICEtOD9ATU9QU1RVVmRtcHJ3d3d3eOrq9Pn7+/z8/ERoEg0AAAEbSURBVHjafclnV4JQGADgq1GWLWzvvYe2t5VGIimIBoJgiiir//8DejkHDOUen68PGokHjQ4hX1zyVQWeWp0j/BiXGE+epl5u1pf8mYLw0Ln3JL257A0pF3xfeerq0dpYJELB0A8XdmcHxo1asavApFOOqW8vEG4oXBdbzKZ+HUPbmicg1NI/jrk+2N3bP1mbJSD4ADZzlzw9PjpcGUNkvRzEFai3p8vzswmIShDMZ+b5/nYSkQ2hR6VUzGVf09MQYq9vnqU/KBKRzWofocwyHIQm95HECi9AtJQQWaxB6GqIIv+4UQ9TNYh2A0OH6DQxOhBGC8NwQ8dww2xjmBCWgWFB2CaG7YaFMTAcrAERS8xgJGIoEh3GiEb+AGfp1CXHVEFWAAAAAElFTkSuQmCC"),FastMail.theme.imageDidLoad("all","image_32x32.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAXCAYAAABqBU3hAAAFpklEQVR42r2UaUwVZxSG+8+2SdtoY1P9UZPaxjRtaq2400bbanFfAbUuFa0gIiKIaJFFcQUXjCIuyKKioLiCqCiuuIEboOyIgFxAVtkvAk/PNxPHP21/NCmTvJl7zzf3PM+cb+a+ow4bb+/x1r6+Czsziilo/Zjm7W1PJx+KaQhM9vJyAOjo6OiUACjmWwFPT4d2WWhrb2egP0YGBcBgyZAtMFQybKucJVIz6j9ugxE7wGoXTNwL1iFgGwr2R8HnHARdh7A7EHIbDt5DYyiWYhoCkzw8FrVJsbWtjV93IdEbjguGSdLU5gD8Fg4zwmDKfhgbrGeawOYdgkVRsPQ4uMSAs35m/QU4nAyXs+BKNsSlw6UsNIZiKaYhMH7FCsdWMWt5/VpraHcYFkSCw1G94aozsDYefM+B2wlYHIVR33ARtlyGbYmwOQHWxMO687AvCRIFnFEKT0yQXAhpJWgMxVJMQ2CMq+tisxSbWlvxitObbEgAf2kceBX2Jul3c0iy5yYE3dBHGn4PQrXx6gmWte1XVPRx38iD7JeQVQ6ZZVBQhcZQLMU0BEYvW+bUIqNpaGkh6gHEPIIzaRD/FM49gTjJ+Qy4IImVz5cy4fYzuJWv10881n9zXKJ+H/0QYtP1a56W6vC8CjC9QmMolmIaAqOcnZc0yWheNTczPcgTx4OB+J2N4cTDPO49h5t5cC1HkivwjFZOJxUSfvI6AbuPcPG+Ca+tkQREXOXw5XyuPG0ipRAeFOkjzy6HHMnzKnhZj8ZQLMU0BH5evNi5QUZT09jIiLXzGbXRgbEBS5gc6MbGuFPcL0Jr+rAYHhVjNH5WCSGRsaSX6Oupcs6tUDB9LV9SWA1FktJXUNuExlAsxTQEhtvbL62TYmVDAwNW2TLYcyaWPnMMmejkNLJ0oOyjaiyp0L8LTEFlXWIycykplcDggyRnmLRz4q3HFFe1UCPw5lY0hmIp5luBBQtcas1myuvq6DnHki8cRvGt6yT6r7Bm8J8zsdroyKn7jyiuaZd9FGi1LvGsSt2hnpxSM7cfP+NBZglFNRB6NFa7Nj3nBcmp2ZRVN2BuQ2MolmIaApZ2dq7V8nCYamv52HYAn8wcrIn0th/J10vH893yKVh42GgyYzc74Rjqz6bYY4TduEpc6mPu5BfK61ZLrmxyXkU9JbVtlNdDdRPUtUC9GZpfI68fGkOxFNMQGDp3rlulPBwvamroat1fSzcbC7rPGESP2cP4fOEvfOMygX7uU7FYafN322Q8M7ZBq5i9z4f5Yetxid6B37kIIu4kyIP8VKTqNIZiKaYhMGjWrOUVTU0UVlXRbeRKult50mOcD59NXkdvm818NWs7fe2CGOCwn2HOEfzkHsXo1aeY5BePrX8ic3Yk8ceeFJzC0nA7ks2qmAJ8zpbIv2EF/om1bL/RyM7bZoKT2zWGYimmIWAxY4Z7uRQLKiuxsN/HwEUhDHEK4weXQwx3O8LIlccZ43WayevimR5wmXm7buJ4IAX3qCd4n8mVf8MigZQJoIrQ1DoOZzZxLN/MycI2Yk0dxJd3IC4kVKExFEsxDYF+NjYepfJ65L98+Y8C6o4nro3DelMCM7de4/edt1i4NwXniFRWRGfJHRewMaGEbdcr2H2vlrC0RiKzzMQUtHHmRbtI6AKKoViKaQj0nTp1pUlej9zy8n8VmLAmjqkbLsoUrjA78CZ2QXdx2P+QpQefiEQOXqef4xdvkrFXsCOpRkQaCHnUQnh6q8i0E52HxlAsxTQEvrSyWl0ixeyysv8ksCQ8HdfILDyO5bP6VBFr4krf7L9MpEFkmgm6+5o9KR0aQ7EU0xDoaWnpW1xfT2ZpaadEsRTTEOj6/ffry8xmimShM6JYivmG/1GXXr2c3uvTZ1NnRpiOwv5ACbwr+VDSXdJD0vN/zqdq6JL3JV3+AlWfwmpUFIRxAAAAAElFTkSuQmCC"),FastMail.theme.imageDidLoad("all","pdf_32x32.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAeCAMAAADjLDWuAAACOlBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAcHBwUFBQAAAB5eXkAAAATExMAAAAAAAAPDw8GBgYGBgbZ2dkAAAAAAADZ2dng4ODc3Nzo6Oji4uLj4+N4ABB4FiB+GCJ/AA+ADx6FGSSFhYWLAA6LGiWNDxyOAA6OHiuPj4+QDxyQGyeQkJCSGyeUHiqVAA2VHCiVlZWWAA2XAAyXKTWZAAyZHSmZHiuaHSmbm5ueHiqeHiugHiqhHiujHyynDhmnHy2oHiioIC2oPUipDhmqOkaqqqqsVF2tLTqtPUeuDhivDhiwIS+wLTaxPUayOEWzVl+0tLS2XWa4Dhe5HiW5XWW6AAi6V2G6urq7HiW8UVy8bHO/cnrBjJPCAAfCAgbCwsLDJyrFW2LFanTFe4LGc3vHc3XHx8fIe4HIyMjJAAbJeoDJfILJgYjJycnKysrLm6HLy8vMeoDNzc3Oi5DPAQbPeX7Pj5XRj5bRnKHS0tLTO0DTnaLUDhPV1dXWeHzW1tbXLDHYcXTY2NjZeHva2trbjY/bqq3dl5rerLHeubze3t7fu77fu7/f39/g4ODh4eHiur7i4uLjyczkyMrk5OTlx8nlyMrlzM7l5eXmxsjmx8rm5ubns7Xnyszn5+fo6Ojpw8Tp6enq2dvs7Ozt1tjt7e3u7u7v1tjv5eXv7+/w5eXw5+jw8PDx8fHy6Ony8vLz8/P05OX07O309PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7////mGeWCAAAAG3RSTlMAAgQICgwSEhkmKDU3P0ZGWXmMj7LV6vb5/v7A7LQ/AAAB80lEQVR4AW3NeXcLURjH8WsRS4ilFkWrtJa2atEo0ajaF1r7vlDUQmOvXS3UQkQJwpBaNISJKTOTmUnS57157r1zpjcn+Z5zz/PHZ878iJMrKkUi4XA4IknRTmlsf8Jbn7dQ24Qh3OsbsKYmfLsbnOqDzVDIP6itwwB+rAZ4jBfqaLVPmwEK2USNHwP/yyuw4+9R8PNqgugwrh96pQ+DFd/PgK+1FQB8tMrgCcDG9CWk1IsB3PCC98NeaGz00kpfXFhZMWenMqoPKZmNAX1wFS+vJPRg08KKKTPGDyBF5Xar5pc7FYW+BO9daznYNphMyltHLB6XuyKdw8jQ4XYjA4GWAHbuwKFjtyTkhKJ0e8jAQXYjQryOS3cfRr/JjFUPcfJ08WI373xEZayJHuPFr5/8zBQ5y+MsWb6/n6uq6broMiuRuL39EVNNTyZFT9AURdmya+svqsiG6Ej0v5fXvV97mKthit6NqerP5ee1N0s2tLefvvjJtERX6aZ2aunb4xurq+fNXbxt0fOU6Ii6/rqqas2RJ3+MZ5sXTJ35Li06Tv7eM22ZgbOmaVmp1L90RvSk8WpWWdlXhqjpdCbTI7ppTi8uPmsx5NoDolvW5In70BBthSxHsA2RabajoDmY45wEzHZ3weicCty97nJ7cnK7/gMZIEJwhk4MbwAAAABJRU5ErkJggg=="),FastMail.theme.imageDidLoad("all","ppt_32x32.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAbCAYAAAAdx42aAAAFnklEQVR42r2Ve0xTVxzHyZbsj8XtD+KSxWwxZlvCEt3Dx0Rhbhon2czcI8uIi1vmQB4iw82BykBlTtdo3LIFYVqBRmUTmWuwQAH7AGpbEFiRYXjEFkQqVcqjLYXSW/3u/A653W5shy6LN/mkt/f+zvl+z+/3O+dGnHsr6qPCdQtTj6x5fvv/xcFVUck5Mc9uePXJOU9EREQ8xAh/yRY9nhY4mQHvsRTcPLKZ4y1MQqA4HQEFo2Qbu9/KSEWgiHEiZQY5iznOOLaFkYhAIaMggcHG5yei79QB1J0tvTQvMvJpJvNwWAOZUY9lCyVp6N+9Gm6LDp4rJlw/mgZ39ioI+9dA+GY1hH2vMdj/PbEQcmMg5DC+Xglh9woIu6IhZC2HkLkc/q+WMZbCu30JbImLYDlTgEqVyrRgwYL5YU1kPDcnJyBPgTNzJa7tfQc35F/Cc1kPx45o+HNi4c+OgZ8J+ZmQfycTyVw2ww5iKfxfLIGfCXIyiMXwpb8Me8ILaDuQjIGBAahUKmNYE+nPPJojFCTCtuUl+Ae6MFItx/W9G+DKXMGEY5jwSiZMBhg7o2fIWgEvM+hMXw7ntldwM2UxbJ+8yLF+vBDWjVEwvjkfVZteh8fj+XcTaWTg5yTcyIzF5OV69Gatx3Deu3DseY/Tmx6H7q1rcDlpLSyJb6B58zqYPo2DecvbaEqPnyFjIy5lJ3GMaR/AkLAe2pT3UZ4aDwBBE1VVVea7TCQzA9ai79Gy73OYZTvRfvQgeot/gE15mjN4UcNxdFpws+cKnPZBjI6OzorD4UBbWxvpz2oizu12Y2xsLBT3IhZy3K1bt9DR0UHaIU1ERkY+JW7ROHoxPj4uwWq1orW1FU1NTbPS0tKCq1evSsaPjIzwZxqNBvn5+cjLy4NMJoNcLkdFRQXKy8srmXYkNzAxMQGXyyXCV2A0GjE5OYnbt2/Pis/ng8lkonGSOYaGhtDV1YXGxkZqQpSVlaG0tBQlJSXcBNNeyA14vV5QGURosEarhSAImJqaAhkMB72nuIaGBjidTnEOMiGWgtLOs9Hd3Y3Ozk60t7fDYrGQgdWiAaoPRyyHqroGfr8fWQo9kgtqQnNUjawSHaanpynVogEJNJ9oSDRF5RkeHiYD67gBlmrJqihQVaVGIBDA/jMNsI9PY8j1N1dsdhjbOqEzW5B2WMGbraioiMpA/SCBVtrf339X5kiTtLkBSiNlQYQcV7IMkIHvfmuEbXQKfaM+jtU5CbXhEiYmp+65P5qbmykTEg3SDBqgIHIkQsGV6hpeW9nvjTBcc+HigJvT2DeGE+fvqz+ooamsEg3SDBqgGlKwCA2uUtfywYcrDDDb3TBxyMQY8svVvD9STuiwdt+v2HqsDh9++wuSCqqRWlgbJEtRz+P0ej2VVaJBmhID5EiEUlRdU8cHlxlbcbqhOchJvRm5+XJens0/KdFhH4XD40fP4DBuuHwYck8T7H4a+882UBwZoLJKNCQGSIgeiFCKLlzQBP/39PSQGYK7V9dq+MS5p9ToH/dx2qx26hW6DyJTGnhcfX09lVWiQXMFDVCqRQGCHGq1WtoulDoaTL8EP3orKqt5eQ6cq4e+b4Sj0P8B4yCVaYJg9x4yIJ4RVFaJBj0PGmAu6YEEWrVSqURxcTFtMRF+lO7KyeUxnx2S48fzOhyvM6Hyzz6YHRNBmhiHVEEDVFbJ/KQZNEDbhR78A8oCdS6dZBLoeD2nPM9XcUprRlGtAQqtifdHqaFVwlmzheLoKKaySuYnTYmBe4Um1Gp1IfpDis1mE2PIAPWOZJ7/bIDSp9PpqBek/SFF8j2gXUDjwhq4c+cO7gf6sNDXTKFQ0JctLPSe+qi3tzfkPKKBWNzfRTWkpqIVzgrFUXyoi7TJwHxGPCPjARPPtdn1CGMuY94DZi5p/wVzgLLkaBECfwAAAABJRU5ErkJggg=="),FastMail.theme.imageDidLoad("all","txt_32x32.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAgCAMAAAA/gEgKAAABX1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABaWlpmZmZaWlpcXFxeXl5iYmJfX1+JiYnJycmkpKTOzs7T09PW1tbc3Nzh4eHk5ORERERMTExcXFxhYWFycnJ1dXV9fX2BgYGSkpKTk5OVlZWampqdnZ2enp6fn5+lpaWsrKyurq6vr6+ysrKzs7O0tLS3t7e4uLi6urq7u7u8vLy9vb2+vr6/v7/BwcHCwsLDw8PExMTFxcXHx8fIyMjJycnKysrLy8vNzc3Ozs7Pz8/Q0NDR0dHT09PU1NTV1dXW1tbX19fZ2dna2trb29vc3Nzd3d3f39/g4ODh4eHi4uLk5OTl5eXm5ubn5+fo6Ojq6urr6+vs7Ozt7e3v7+/w8PDx8fHy8vL09PT19fX29vb39/f5+fn6+vr7+/v8/Pz+/v7///8Smj2SAAAAI3RSTlMAChcfICEtOD9ATU9QU1RVVmRtg4SIiIiIifv7/f7+/v7+/vZl3QYAAAH5SURBVHjafdHZd5pAFMBhktqmTTfSfd/3LaZ7q5UimwqMwAwDsrqgQURB7f9/OpzEnvTEk999mIfv6d6hzmwf7ewpatV2b1U3cMDda6UVnO/pdVGAJEMH9U+Pb63kUg/KQIZFuibt6k9uHwrdNzkZSJLEKwLL7H2bP7pZWkHt5w9OZKtMlauUPyxmD68TITBAvzm+JjIMh03IlZd5+uBGIXRkY9vG2LZsbJqt8p9lltwvhB7av3i+KQJBEQWB2Xvx9Nnz1/eulgg4sqo6h1mtL7tv37x6eeccRY9cu4MRQlgzDRNBVeQrH9+/u0DA4+sS2+BFXhTFBsvXavWv3z9fpOg4EPhmS63LTZWXmgIrVisMx10mEHohySXTCdzQ8TDSVUBT9DhUTdkBSLI0zUCGaiDFgjaBpN9UAGgoQCavBBSFg54TEJhEx+qHAwJpxLYVYBhYMVUANajowOvvFzBqWQACaGnIhOQ0uq71hwmBaay6EJm2Qn6qhYCMEY7jlMAsbhhtaDeQ3/Odru/7QTgezwhkk2g/iofB5GhZAYkTdaNBOCRb+lEQOt00TQvIkza2rDa23Q6Geods6Y6mOYF5ZkAXY99yLIwHs+ksTabZnMAin+YHZfm/FgXMkedm8/87AMdFaHIclms7AbZ2rqxpZ4va2Dy9ps2Nv9O91swNoh/8AAAAAElFTkSuQmCC"),FastMail.theme.imageDidLoad("all","xls_32x32.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAgCAYAAAAIXrg4AAAEVUlEQVR4AZTS7UurdRzH8VH/wUBmM8l8EAwkWoQYFBEhCuL9tLHE7GbasDSyHpgXucsbmuWN5ioYOMssrWw5mJs34Fy5m6WGLlPH8ODRcwRFp2ye8/R9Li44Bw5HPXrB+8H3wfV5PfkpXrFkG14Tckwvf/rSx1ct+6MX67TG54tStakpCoXiCcVl37MmdX1PxMzQyje0hz6jN9xGr3QPRjsZiLZLtdG/JdIn1btppmejla9Xv2Ao9B2/To3/o1ar06WZJy8E0g2qz7/6twXvjRkmN8dY2JnFtKCncbmKhqW3+HDJQH1Yjyn8Jh+EKjAGdLzrK0HvyGfUa8fldgU0Gs0zFyLplSrhy9Vm6qb0bB7/h+BrxOjTyWO1QR3vB8p4z1/KO4vF1PxdRLWvkKr5AiqcuQiTTezu7uJyufwXImk6lWAOf8LvGyOMrw/jvzVPtaeQ2oAOY6BcAqQWJUSuFMNsAZVT+ZRNvMHbP1SQTCYvR9JKVIJlrZkWbwNN80Zq/iineOx1cn/J4dVhLdrB58jqyySjM1Uus1Mtl2F+ihcEDcADxO12Bx9B0opShG/9A3R4RPq93dgWv+e35XHcERe+LS//31wndjtGPB5n/2Cfv9YX5BzBCTp+FgEei+QdxA84OTm5VoeHh0QiEYBzEaVS+fT9J5yXSCSuDRwdHRGLxZibm8NqtSKKIhaLBZvNhtPpxOFwuKRtpQxIsvzTbGiG6aDnSnn8bpzeSUado1h/tNJltSB2i7R2tWK322VE2s6SgbOzM47jx8wEp0neTT7UytbKuXfiToLT5CmBtQB7+3ts72wTjUX56c8R7rVKLrtpA1EY3uUJuuqmL9JNN32FPEbfr+ECvjSxARMMTaWkWUcVcvDFM2MGw6l/qxr1FHcUK0H6FgdL3zfHnvliTlEUIfCpDQghKNkl7Qbu0mGMZsNG4hu6Zv/WI2/ptmCzp19PtN1uEfhsAs9/AlmZMVb3t3Q4HAx4nbYZDrjghJsFujYYz0fs4+K62ubOgJSSdukzXd18xbtlxPcrdkLcONsMB1xwmoBSinbZjgbBFfkrjzFZTHptAAdccJpAVVWU5mn7sJA5Y/0QU13XBpzYNsMBF5wmsN/vKSsyGoYD+hb7jGk0pTRNDTixbYYDLjjPA8GASlUyNg9rOh6PBtwaywxHdyAvcxqFQ7qOrxlOzw3ggIsFtNZUiKJ5OCJRCcbm56bXBnDABacJ4HqVsqRx8zCIbxhu5PTaAA644DQBfH2hBE1mY5KVYNw9fqfT6WTAiW0zHHDBeR4IxxSuA4YXueyeJ0lineE4C+DdyUq2daUV498NcO9tMxxwwckCaq9oOpvQbBMy/KXH3jFObJvhgOu/gUpXjB+Pd/T3Dye2zN0BrAaZM592EsbBi3EXTuuCkwX0QVMuM0qK5DXAARcLfMRq+KM+1qRr/SrggAs/uBH40HDZ8OWNuYQbgYuGdw3v3xg4L34D3BOkuh+iZpAAAAAASUVORK5CYII="),function(e,t){var i=40*(window.devicePixelRatio||1),n=O.Class({Extends:O.Object,init:function(e,t,i,s){var a=this.img=O.Element.create("img");this.requester=e,this.emails=t,this.avatarUrl=i||null,this.twitter=s||null,this.emailIndex=0,a.addEventListener("load",this,!1),a.addEventListener("error",this,!1),n.parent.init.call(this),this.tryNext()},destroy:function(){var e=this.img;e.removeEventListener("load",this,!1),e.removeEventListener("error",this,!1),n.parent.destroy.call(this)},handleEvent:function(e){this.fire(e.type,e)}.invokeInRunLoop(),tryNext:function(){var t=this.emailIndex,n=this.emails;if(this.avatarUrl)return this.src=this.img.src=e.auth.authenticateUrl(this.avatarUrl+"?width="+i+"&height="+i),void(this.avatarUrl=null);for(;t<n.length;)return this.src=this.img.src="https://secure.gravatar.com/avatar/"+n[t].trim().toLowerCase().md5()+"/?s="+i+"&d=404",void(this.emailIndex=t+1);if(this.twitter)return this.src=this.img.src="https://twitter.com/"+this.twitter+"/profile_image?size=bigger",void(this.twitter=null);this.destroy()}.on("error"),foundImage:function(){if(!this.img.complete)return this.tryNext();this.requester.avatarWasFound(this.src,this.emails),this.destroy()}.on("load")});e.AvatarFinder=n,e.AvatarManager=new O.Object({get:function(t){if(!t.contains("@"))return null;var i=this[t=t.replace(/⥷/g,".")];return void 0===i&&t&&"_"!==t&&e.preferences.get("showAvatar")&&(this[t]=null,new n(this,[t])),i},avatarWasFound:function(e,t){var i=t[0];this.set(i,e).propertyDidChange(i.replace(/\./g,"⥷"))}})}(FastMail),function(e,t,i){var n,s=(n=/[?&]u=(\w+)/.exec(t.search))?n[1]:"",a=function(){var e=/[?&]a=(u\w+)/.exec(t.search);return e?e[1]:""}(),o=function(){var e=/[?&]a=(c\w+)/.exec(t.search);return e?e[1]:""}(),r=t.search.replace(/[?&][ua]=\w+/g,"").slice(1),l=e.isApp&&O.UA.isIOS&&window.webkit.messageHandlers||null,c=new O.Object({isAuthenticated:!1,username:"",displayName:"",sessionKey:"",fileStorageHomeDir:"vfs",userId:s,actAsUserId:a,actAsCustomerId:o,accountType:"personal",isAdmin:!1,isReseller:!1,isStaff:!1,isVerified:!0,mayCalendarSync:!0,mayContactSync:!0,canWriteSharedContacts:!1,isFreeAccount:!1,trialDaysRemaining:-1,showAdminsExpired:!1,showAllExpired:!1,isLoginBlocked:!1,isSendBlocked:!1,isReceiveBlocked:!1,_firstCall:!0,urlParam:function(){var e=this.get("userId"),t=this.get("actAsUserId")||this.get("actAsCustomerId");return e?t?"u="+e+"&a="+t:"u="+e:""}.property("userId","actAsUserId","actAsCustomerId"),authHeader:function(){return"meauth "+this.get("sessionKey")}.property("sessionKey"),authenticateFormData:function(e){return e.append("userId",this.get("userId")),e.append("sessionKey",this.get("sessionKey")),e},authenticateUrl:function(e){var t,i,n,s=this.get("urlParam");return(t=e.indexOf("#"))>-1&&(n=e.slice(t+1),e=e.slice(0,t)),(t=e.indexOf("?"))>-1&&(i=e.slice(t+1),e=e.slice(0,t)),i=i?i+"&":"",i+=s,r&&(i+="&"+r),e+(i?"?"+i:"")+(n?"#"+n:"")},_isAuthenticating:!1,authenticate:function(){this._isAuthenticating||(this._isAuthenticating=!0,new O.HttpRequest({timeout:45e3,method:"GET",url:this.authenticateUrl("/authenticate/"),headers:{Accept:"application/json"},onSuccess:function(e){c.didFetchSessions(JSON.parse(e.data))}.on("io:success"),onEnd:function(){var t=c.get("isAuthenticated"),i=!this.get("status");if(i&&!t)return c._failedConnections.include(this),void c.retryIn(0);c._isAuthenticating=!1,!i&&c.get("isDisconnected")&&(c._timeToWait=1,c.set("isDisconnected",!1)),i||t||(O.require("login",function(){c._firstCall||e.login.restartLogin().set("authError",O.loc(1142)).set("username",c.get("username"))}),e.base.set("app","login"))}.on("io:end")}).send())},didFetchSessions:function(t){var i=c.get("userId"),n="login"===e.base.get("app"),s=i?t.find(function(e){return e.userId===i}):1===t.length?t[0]:null;s&&!n?c.didAuthenticate(s):t.length&&O.require("login",function(){e.login.set("sessions",t).goSessions()})},didAuthenticate:function(n,s){var o,u,d,h,g=this.get("userId"),p=this.get("username"),f="auth"===n.type,m=function(i){return e.base.useHash?c.authenticateUrl(t.protocol+"//"+t.host+t.pathname+"#/"+i):c.authenticateUrl("/"+i)},v=/redirect=([^&]+)/.exec(r);if(v)return r=r.replace(/&?redirect=[^&]+/,""),void e.base.forceReload("/go/"+v[1]+"?u="+n.userId+(r?"&"+r:""));if(f&&(n=n.data),s||(s=t.pathname&&t.pathname.slice(1)||"mail/"),u=n.userId,g&&g!==u||p&&p!==n.username)f||(this.set("userId",u),e.base.forceReload(m(s)));else{if(!e.isApp&&n.isJMAPEnabled&&!/[?&]ajax=1/.test(t.search))return this.set("userId",u),void e.base.forceReload(m(s));if(h=(d=new RegExp("lang_"+u+"=(.*?)(?:;|$)").exec(i.cookie))?d[1].toLowerCase():n.language||"",O.loader.languages[h]&&!a&&h!==O.i18n.activeLocaleCode){try{localStorage.setItem("app-language",h)}catch(e){}return this.set("userId",u),void e.base.forceReload(m(s))}for(o in this.beginPropertyChanges(),n)this.set(o,n[o]);this.set("isAuthenticated",!0),this.endPropertyChanges(),e.base.set("mayGoBack",!0),e.isApp&&(e.api.sendPushToken(),l&&l.didLogin?l.didLogin.postMessage({userId:this.get("userId"),sessionKey:this.get("sessionKey"),accountId:"u"+this.get("userId")}):window.app&&app.didLogin&&O.RunLoop.invokeInNextEventLoop(function(){app.didLogin("u"+this.get("userId"),this.get("userId"),this.get("sessionKey"))})),this._awaitingAuthentication.forEach(function(e){e.send()}),this._awaitingAuthentication.length=0,f||e.wc.broadcast("auth",{data:n})}},didLoseAuthentication:function(t,i,n,s){if(!s){for(var a=this._failedConnections;a.length;)this._awaitingAuthentication.push(a.pop());e.base.set("mayGoBack",!1),this.authenticate()}}.observes("isAuthenticated"),logout:function(t){if(this.get("isAuthenticated")){if(e.isApp)t=null;else if(!t){var i=e.localPrefs.get("loginDomain");t="/login/"+(i?"?domain="+i:"")}new O.HttpRequest({timeout:45e3,method:"DELETE",url:this.authenticateUrl("/authenticate/"),headers:{Authorization:c.get("authHeader")},didLogout:function(){l&&l.didLogout&&l.didLogout.postMessage({userId:this.get("userId")}),window.app&&app.didLogout&&app.didLogout(this.get("userId")),e.wc.broadcast("logout",{isBroadcast:!0}),e.base.forceReload(t)}.on("io:success","io:failure")}).send()}return this},isUnloading:!1,isRenaming:!1,isDisconnected:!1,timeToReconnect:0,_awaitingAuthentication:[],_failedConnections:[],_timeToWait:1,_time:0,connectionWillSend:function(e){var t=this.get("isAuthenticated");return!(!t||-1!==this._failedConnections.indexOf(e))||(t||this._awaitingAuthentication.include(e),!1)},connectionFailed:function(e,t,i){this.set("isRenaming",!!i),this.get("isAuthenticated")?(this._failedConnections.include(e),this.retryIn(t)):this._awaitingAuthentication.include(e)},connectionSucceeded:function(){this._firstCall=!1,this.get("isDisconnected")&&(this._timeToWait=1,this.set("isDisconnected",!1))},_tick:function(){var e=this.get("timeToReconnect")-1;this.set("timeToReconnect",e),e||this.retryConnections()},retryIn:function(e){this.get("timeToReconnect")||(e=this.get("isDisconnected")?Math.min(2*this._timeToWait,300):e||1,this.set("isDisconnected",!0).set("timeToReconnect",e+1),this._timeToWait=e,this._timer=O.RunLoop.invokePeriodically(this._tick,1e3,this),this._tick())},retryConnections:function(){var e=this._failedConnections;O.RunLoop.cancel(this._timer),this.set("timeToReconnect",0),this._timer=null,this._failedConnections=[],e.forEach(function(e){e.send()})},accountIsMultiUser:function(){var e=this.get("accountType");return"account"===e||"family"===e||"business"===e}.property("accountType"),globalBanner:function(){return this.get("isAdmin")&&this.get("showAdminsExpired")?"This account is overdue. Pay now to avoid losing access.":this.get("showAllExpired")?"This account is overdue. To avoid losing access your admin needs to renew now.":""}.property("isAdmin","showAdminsExpired","showAllExpired"),goStraightToPay:function(){this.get("isLoginBlocked")&&this.get("isAdmin")&&!this.get("actAsUserId")&&(O.require("settings",function(){e.settings.set("pane","plan")}),e.base.set("app","settings"))}.observes("isLoginBlocked")});O.RunLoop.invokePeriodically(c.authenticate,864e5,c),window.onbeforeunload=function(){return e.api.hasInFlightChanges()?O.loc(656):e.base.get("warnOnUnload")?O.loc(610):void c.set("isUnloading",!0)},e.auth=c}(FastMail,location,document),function(e,t){var i=e.wc=new O.WindowController({userId:new O.Binding({queue:null}).from(e.auth,"userId"),broadcastKey:function(){var t=e.auth;return"owm:"+(t.get("actAsUserId")||t.get("actAsCustomerId")||t.get("userId")||"")+":broadcast"}.property("userId")}),n=e.push=new O.EventSource({isAuthenticated:O.bind(e.auth,"isAuthenticated"),url:function(){return e.auth.authenticateUrl("/events/")}.property().nocache(),_didCloseOrOpen:function(t,n,s,a){if(a===O.EventSource.CLOSED){if(this.get("isAuthenticated")&&i.get("isMaster")){var o=e.mail&&e.mail.screens.mailbox,r=e.api&&e.api.mail;o?o.refresh():r&&r.refreshMailboxCounts(),this._tock=O.RunLoop.invokeAfterDelay(this.reconnect,3e4,this)}}else a===O.EventSource.OPEN&&e.api.sendPushToken()}.observes("readyState"),reconnect:function(){O.RunLoop.cancel(this._tock),this.get("isAuthenticated")&&this.get("readyState")===O.EventSource.CLOSED&&i.get("isMaster")&&(!t||e.isApp)&&this.open()}.observes("isAuthenticated"),_waiting:null,_event:null,_mailModSeq:0,_contactsModSeq:0,_calendarModSeq:0,_notesModSeq:0,_storageState:"",onPush:function(t){if(t&&!t.isBroadcast&&i.broadcast("push",{isBroadcast:!0,data:t.data}),t&&!i.get("isFocussed")&&!i.get("isMaster"))return this._waiting||(this._waiting=O.RunLoop.invokeAfterDelay(this.onPush,Math.floor(2e4*Math.random()),this)),void(this._event=t);if(this._waiting&&(O.RunLoop.cancel(this._waiting),this._waiting=null),t||(t=this._event)){var n,s,a,o,r,l,c,u;this._event=null;try{n=JSON.parse(t.data)}catch(e){O.RunLoop.didError({name:"FM.push#onPush",message:"Invalid JSON",details:"Arg:\n"+JSON.stringify(t)+"\n\n"})}if(n&&(s=n.clientId===e.api.clientId,o=n.mailModSeq||0,r=n.contactsModSeq||0,l=n.calendarModSeq||0,c=n.notesModSeq||0,u=n.storageState||"",a=n.type||"",(o>this._mailModSeq||!o&&("delivery"===a||"client"===a))&&(s||e.api.mail.refreshAllMailData(),e.isApp||e.newMailNotifications.refresh(),o>this._mailModSeq&&(this._mailModSeq=o)),(r>this._contactsModSeq||!r&&"contacts"===a)&&(s||e.store.sourceStateDidChange(e.ContactGroup,r+"").sourceStateDidChange(e.Contact,r+""),r>this._contactsModSeq&&(this._contactsModSeq=r)),(l>this._calendarModSeq||!l&&"calendar"===a)&&(!s&&e.calendar&&e.store.sourceStateDidChange(e.Calendar,l+"").sourceStateDidChange(e.CalendarEvent,l+""),l>this._calendarModSeq&&(this._calendarModSeq=l)),(c>this._notesModSeq||!c&&"client"===a)&&(!s&&e.notes&&e.store.sourceStateDidChange(e.Note,c+""),c>this._notesModSeq&&(this._notesModSeq=c)),u&&u!==this._storageState)){if(!s&&e.files&&e.files.models){for(var d,h=e.store.getAllRemoteQueries(),g=h.length;g--;)(d=h[g])instanceof e.files.models.StorageNodeList&&d.setObsolete();e.store.sourceStateDidChange(e.files.models.StorageNode,u),e.store.getRecord(e.files.models.StorageQuota,"storageQuota").refresh()}this._storageState=u}}}.on("push","files"),onProgress:function(t){t.isBroadcast||i.broadcast("progress",{isBroadcast:!0,data:t.data});try{var n=JSON.parse(t.data),s=e.api[n.connectionId],a=s&&s.get("inFlightRequest");a&&a.resetTimeout()}catch(e){O.RunLoop.didError({name:"FM.push#onProgress",message:"Invalid JSON",details:"Data:\n"+t.data+"\n\n"})}}.on("progress"),onAlert:function(t){if(!e.isApp){var i,n,s,a,o;try{i=JSON.parse(t.data)}catch(e){}if(i)if(n=Date.fromJSON(i.utcStart),s=6e4*Math.round((n-Date.now())/6e4),a=Date.formatDuration(s),o=s<0?i.summary+", "+a+" ago":i.summary+" in "+a,"Notification"in window&&"granted"===Notification.permission)try{new Notification(o,{icon:"/static/favicons/touch-icon-196x196.png",tag:i.eventId,body:i.location}).onclick=function(){this.close()}}catch(e){}else e.notifications.show(o,0,!0)}}.on("calendarAlert"),onRemoteLogout:function(t){t&&!t.isBroadcast&&i.broadcast("logout",{isBroadcast:!0});var n=e.localPrefs.get("loginDomain"),s=e.isApp?null:"/login/"+(n?"?domain="+n:"");e.base.forceReload(s)}.on("logout"),_ping:null,setupPing:function(e,t,i,n){n===O.EventSource.OPEN?this.onPing():O.RunLoop.cancel(this._ping)}.observes("readyState"),onPing:function(){O.RunLoop.cancel(this._ping),this._ping=O.RunLoop.invokeAfterDelay(this.pingLost,36e4,this)}.on("ping"),pingLost:function(){this.close().reconnect()},didFocus:function(e,t){e.get(t)&&this.onPush()},masterDidChange:function(){i.get("isMaster")&&e.auth.get("isAuthenticated")&&(!t||e.isApp)?e.push.open():e.push.close()}});i.on("push",n,"onPush").on("progress",n,"onProgress").on("auth",e.auth,"didAuthenticate").on("logout",n,"onRemoteLogout").addObserverForKey("isMaster",n,"masterDidChange").addObserverForKey("isFocussed",n,"didFocus"),n.masterDidChange()}(FastMail,"file:"===location.protocol),function(e){var t=e.wc.get("id"),i=O.Class({Extends:O.RPCSource,_prettyPrint:O.loader.debug,init:function(t){i.parent.init.call(this,t),e.push.on("push",this,"resetRepeatCount"),e.wc.on("push",this,"resetRepeatCount")},addCallback:function(e){return this._callbackQueue.push(["",e]),this},hasRequests:function(){var e;if(this._inFlightRemoteCalls||this._sendQueue.length)return!0;for(e in this._queriesToFetch)return!0;for(e in this._recordsToFetch)return!0;for(e in this._recordsToRefresh)return!0;return!1},_lastRequest:"",_didRepeat:0,resetRepeatCount:function(){this._didRepeat=0},url:function(){return e.auth.authenticateUrl("/api/")}.property().nocache(),send:function(){if(!this.get("inFlightRequest")&&e.auth.connectionWillSend(this)){var i,n,s,a=this._inFlightRemoteCalls,o=e.base.actAsCustomerId;if(!a){if(a=(i=this.makeRequest())[0],o&&(a=a.filter(function(e){return!/^getContact/.test(e[0])&&(e[1].customerId=o,!0)})),!a.length)return;this._inFlightRemoteCalls=a,this._inFlightCallbacks=i[1]}n=JSON.stringify(a,null,this._prettyPrint?2:0),5===(s=this._didRepeat=n===this._lastRequest?this._didRepeat+1:0)&&(e.api.mail.loopIsDetected=!0,O.RunLoop.didError({name:"APIConnection#send",message:"Repeated request loop detected",details:"Request:\n"+n+"\n\n"})),8!==s?(this._lastRequest=n,this.set("inFlightRequest",new O.HttpRequest({nextEventTarget:this,timeout:this.get("timeout"),method:"POST",url:this.get("url"),headers:{"Content-type":"application/json",Accept:"application/json","X-TrustedClient":"Yes",Authorization:e.auth.get("authHeader"),"X-ME-ClientVersion":e.version,"X-ME-ClientId":t,"X-ME-ConnectionId":this.id,"X-ME-LastActivity":""+Math.floor((Date.now()-e.lastActivity)/1e3)},data:n}).send())):e.base.forceReload()}}.queue("middle"),ioDidFail:function(t){var i=t.status,n=500<=i&&i<600;401===i||403===i?e.auth.set("isAuthenticated",!1).connectionWillSend(this):!n&&this.get("willRetry")?e.auth.connectionFailed(this,null,423===i):503===i?e.auth.connectionFailed(this,30,!1):(n&&alert(O.loc(742)),this._inFlightRemoteCalls=this._inFlightCallbacks=null)}.on("io:failure","io:abort"),ioDidEnd:function(e){i.parent.ioDidEnd.call(this,e),O.RunLoop.queueFn("middle",this.checkSending,this)}.on("io:end"),checkSending:function(){this.get("inFlightRequest")||(this._didRepeat=0,this._lastRequest="")},receive:function(t,n,s){e.auth.connectionSucceeded(this),i.parent.receive.call(this,t,n,s)},response:{showMessage:function(t){var i=e.api.serverNotifications;i.length||e.api.showServerNotifications(),i.push(t)},refresh:function(t){if(t.force)e.base.forceReload();else{try{localStorage.setItem("app-version",t.version),localStorage.setItem("app-version-date",Date.now())}catch(e){}e.isOutdated=!0}},error:function(e,t,i){var n=e.type,s="error_"+t+"_"+n,a=this.response;a[s]||(s="error_"+n),a[s]&&a[s].call(this,e,t,i)},error_generic:function(t){e.base.set("app","mail"),O.require("mail",function(){var t=e.systemFolderIds.get("inbox");t&&e.mail.beginPropertyChanges().set("mailboxId",t).set("search","").set("screen","mailbox").endPropertyChanges()}),console.log(t.type,t.message)},error_unknownMethod:function(e,t){console.log("Unknown API call made: "+t)},error_invalidArguments:function(e,t,i){console.log("API call to "+t+"made with invalid arguments: ",i)}}});e.APIConnection=i,e.api={clientId:t,hasInFlightChanges:function(){return e.source.sources.some(function(e){var t=e._inFlightRemoteCalls;return t&&t.some(function(e){return"get"!==e[0].slice(0,3)})})||!!this.upload.get("activeConnections")},serverNotifications:[],showServerNotifications:function(){var t=e.notifications.get("showing"),i=e.api.serverNotifications,n=i.map(function(e){return e.html||e.text.escapeHTML()}).join("<br>"),s=1===i.length&&i[0].timeout||0;t&&t.html===n||e.notifications.show(new e.NotificationView({allowTextSelection:!0,precedence:10,html:n,timeout:1e3*s})),i.length=0}.queue("render"),sendPushToken:function(){var t;try{O.UA.isIOS&&!O.getFromPath(window,"webkit.messageHandlers.didLogin")&&(t=localStorage.getItem("pushToken"))}catch(e){}t&&e.auth.get("isAuthenticated")&&this.peripheral.callMethod("registerDevicePushToken",{platform:"ios",token:t})}.invokeInRunLoop()},e.source=new O.AggregateSource({sources:[],fetchRecords:function(e,t,i){return this.get("sources").some(function(n){return n.fetchRecords(e,t,i)})}})}(FastMail),function(e){e.api.upload=new O.IOQueue({maxConnections:3});var t=O.Class({Extends:O.Object,nextEventTarget:e.api.upload,init:function(e){this.file=e,this.name=e.name,this.type=e.type,this.size=e.size,this.isUploaded=!1,this.progress=0,this._backoff=500,t.parent.init.call(this)},destroy:function(){var i=this._request;i&&e.api.upload.abort(i),t.parent.destroy.call(this)},upload:function(t,i){if(t&&i&&t.removeObserverForKey(i,this,"upload"),!this.isDestroyed){var n,s=new FormData,a=this.file;return e.auth.authenticateFormData(s),s.append("name",a.name),s.append("file",a),n=this._request=new O.HttpRequest({nextEventTarget:this,method:"POST",url:e.auth.authenticateUrl("/upload/"),contentType:"multipart/form-data",data:s}),e.api.upload.send(n),this}},_uploadDidProgress:function(){this.set("progress",this._request.get("uploadProgress"))}.on("io:uploadProgress"),_uploadDidSucceed:function(e){var t,i,n;try{t=JSON.parse(e.data)[0]}catch(e){}if(!t||"error"===t[0])return this.onFailure(e,t&&t[1]);for(n in i=t[1],this.beginPropertyChanges(),i)this.set(n,i[n]);this.set("progress",100).set("isUploaded",!0).endPropertyChanges().uploadDidSucceed()}.on("io:success"),_uploadDidFail:function(t,i){if(this.set("progress",0),!i)try{i=JSON.parse(t.data)[0][1]}catch(n){400===t.status&&/^video\/.*$/.test(this.type)&&(i={type:"invalidArguments"},e.notifications.show(new e.NotificationView({userMayClose:!0,text:O.loc(155,1,this.name)+"\n\n"+O.loc(276,O.loc(128)),precedence:-10})))}if(i){var n=i.type;"authentication"===n?e.auth.set("isAuthenticated",!1).addObserverForKey("isAuthenticated",this,"upload"):("sizeLimitExceeded"===n&&alert(O.loc(409,this.name)+" "+O.loc(414,"50MB")),this.uploadDidFail())}else O.RunLoop.invokeAfterDelay(this.upload,this._backoff,this),this._backoff=Math.min(2*this._backoff,3e4)}.on("io:failure"),_uploadDidEnd:function(e){var t=e.target;t.destroy(),this._request===t&&(this._request=null)}.on("io:end"),uploadDidSucceed:function(){},uploadDidFail:function(){}});e.LocalFile=t}(FastMail),function(e,t){e.api.peripheral=new e.APIConnection({id:"peripheral",willRetry:!1,timeout:45e3}),e.source.addSource(e.api.peripheral)}(FastMail,location),function(e){e.MailTransaction=O.Class({init:function(){this.id=O.guid(this),this.isDone=!1,this.isUndone=!1,this.undoWhenDone=!1,this._undoQueue=[],e.api.mail.addCallback(function(){this.isDone=!0,this.undoWhenDone&&this.undo()}.bind(this))},destroy:function(){},pushUndoCall:function(e){this._undoQueue.push(e)},rewriteMessageIds:function(e){var t,i,n,s,a,o,r=this._undoQueue;for(t=0,i=r.length;t<i;t+=1)if(a=r[t][1].messageIdList)for(n=0,s=a.length;n<s;n+=1)(o=e[a[n]])&&(a[n]=o.messageId)},undo:function(t){var i,n,s,a=e.api.mail,o=this._undoQueue;if(this.isUndone)t&&t();else if(t&&a.addCallback(t),this.isDone&&!this.isUndone){for(i=0,n=o.length;i<n;i+=1)s=o[i],a.callMethod(s[0],s[1]);a.refreshAllMailData(),this.isUndone=!0}else this.undoWhenDone=!0}})}(FastMail),function(e){var t=RegExp.email,i=function(e){return e.split(/[,;]/).map(function(e){var i="",n=e,s=t.exec(e);return s&&(n=s[1],i=e.replace(n,"").replace(/['"<>]/g,"").trim()),{name:i,email:n}})},n=e.APIConnection;e.api.mail=new n({id:"mail",_transaction:null,_isInTransaction:!1,startTransaction:function(){var t=new e.MailTransaction;return this._isInTransaction=!0,this.setTransaction(t),t},endTransaction:function(){this._isInTransaction=!1},setTransaction:function(e){var t=this._transaction;return t&&t.destroy(),this._transaction=e,this},getTransaction:function(e,t){var i=this._transaction;return i&&(t||(e?i.id===e:this._isInTransaction))?i:null},_mb_validityHash:"",_mb_generation:0,_mb_loading:!1,_mb_loaded:!1,_mb_counts:{},refreshMailboxCounts:function(){this.refreshRecords(e.Mailbox,[])},refreshAllMailData:function(){for(var e=this.get("store").getAllRemoteQueries(),t=e.length;t--;)e[t].setObsolete();this.refreshMailboxCounts()},sendMessage:function(t,i){var n=this.get("store");if(this.callMethod("saveOrSendMessage",O.extend(t,{action:"send",attachments:t.attachments.map(function(e){return e.id})})),i){var s=n.getQuery(i);s&&s.refresh(!0),e.preferences.get("enableConversations")&&this.refreshRecord(e.ConversationDetails,i)}["sent","drafts"].forEach(function(t){var i=n.getQuery(e.systemFolderIds.get(t));i&&i.setObsolete()}),e.mail.get("mailboxMessageList").refresh(!0),this.refreshMailboxCounts()},_draftsSaving:{},saveDraft:function(t,i,n){var s=this.get("store");if((this._draftsSaving[t.clientId]||(this._draftsSaving[t.clientId]=[])).push(t),this.callMethod("saveOrSendMessage",O.extend(O.clone(t),{action:n?"fullSave":"autoSave",attachments:t.attachments.map(function(e){return e.id})})),this.refreshMailboxCounts(),i){var a=s.getQuery(i);a&&a.refresh(!0)}var o=s.getQuery(e.systemFolderIds.get("drafts"));o&&o.setObsolete()},draftDidSave:function(t,n,s,a){var o=s.messageId,r=s.conversationId,l=e.systemFolderIds.get("drafts"),c=this.get("store");if(o){if(n)this.updateDraftIds(t,n,o,a);else if(e.preferences.get("enableConversations")){var u=c.getRecord(e.ConversationDetails,r);u.is(O.Status.READY)&&u.increment("total",1).increment("drafts",1)}a||(c.sourceDidFetchRecords(e.MessageHeader,[{messageId:o,conversationId:r,mailboxId:l,isUnread:!1,isFlagged:s.isFlagged,isAnswered:!1,isDraft:!0,hasAttachment:!!s.attachments.length,date:(new Date).toJSON(),subject:s.subject,from:i(s.from),to:i(s.to),size:0,preview:s.body.slice(0,120).replace(/\n/g,"")}]),c.sourceDidFetchRecords(e.MessageDetails,[{messageId:o,cc:i(s.cc),bcc:i(s.bcc),hasBlockedContent:!1,bodyIsHTML:s.bodyIsHTML,bodyStyles:s.bodyStyles,body:s.body,attachments:s.attachments,personalityId:s.personalityId,referenceTo:s.referenceTo,mode:s.mode,isHighPriority:s.isHighPriority,isReadReceiptRequested:s.isReadReceiptRequested}]))}},updateDraftIds:function(t,i,n,s){var a=e.mail.screens.compose.getInstanceByMsgId(i),o=this._draftsSaving[t],r=o?o.length:0,l=this.get("store"),c={};for(s||(c[i]={messageId:n},l.sourceDidFetchPartialRecords(e.MessageHeader,c),l.sourceDidFetchPartialRecords(e.MessageDetails,c));r--;)o[r].messageId=n;a&&a.get("id")!==t&&a.set("messageId",n)},addAttachmentToDrafts:function(e,t){for(var i=this._draftsSaving[e],n=i?i.length:0;n--;)i[n].attachments.push(t)}}),e.source.addSource(e.api.mail),e.api.mail.handle(null,{messagesDeleted:function(t){var i,n=this.get("store"),s=this.getTransaction(t.clientId),a=t.total,o=t.conversationTotal;t.permanently?(i=t.deleted,n.sourceDidDestroyRecords(e.MessageHeader,i),n.sourceDidDestroyRecords(e.MessageDetails,i)):(this.response.messagesMoved.call(this,t),o&&s&&s.notification&&s.notification.get("isShowing")&&e.notifications.show(new e.UndoableNotificationView({text:O.loc(1139,o,a,t.mailboxTotal)})))},messagesRestored:function(e){this.response.messagesMoved.call(this,e)},messagesReportedSpam:function(e){var t=this.getTransaction(e.clientId);t&&t.pushUndoCall(["notSpamMessages",{messageIdList:e.changed,applyToConversation:"no"}])},messagesNotSpam:function(){},messagesMoved:function(t){var i,n,s,a,o,r,l,c=this.get("store"),u=t.moved,d={},h=e.systemFolderIds.get("spam"),g=this.getTransaction(t.clientId);for(i in u)for(n in g&&(o=[],i===h&&g.pushUndoCall(["reportSpamMessages",{messageIdList:o.slice(0,500),applyToConversation:"no"}]),g.pushUndoCall(["moveMessages",{messageIdList:o,applyToConversation:"no",seaparateSentAndDraft:!1,destinationMailboxId:i}])),s=u[i])for(l in a=s[n])r=a[l],o&&o.push(r),d[l]={mailboxId:n,messageId:r};g&&g.rewriteMessageIds(d),c.sourceDidFetchPartialRecords(e.MessageDetails,d)},messagesCopied:function(e){var t,i,n,s,a,o=this.getTransaction(e.clientId),r=e.changed,l=[];for(t in r)for(i in n=r[t])for(a in s=n[i])l.push(s[a]);o&&o.pushUndoCall(["deleteMessages",{permanently:!0,messageIdList:l,applyToConversation:"no"}])},attachmentsDeleted:function(t){var i=this.get("store"),n={};n[t.messageId]={messageId:t.newMessageId},i.sourceDidFetchPartialRecords(e.MessageDetails,n),e.notifications.show(O.loc(720,t.attachmentIds.length),5e3)},attachmentsSaved:function(t){var i=t.path,n=i.indexOf("/"),s=n>-1?i.slice(0,n):i,a=0===s.indexOf("vfs:")?i.replace(/^.*\/files(\/|$)/,"/My Files$1"):e.store.getRecord(e.FSMetadata,i).get("name")?e.store.getRecord(e.FSMetadata,i).get("name"):e.store.getRecord(e.FSMetadata,i.slice(0,-1)).get("name");e.notifications.show(O.loc(741,t.attachmentIds.length,a),5e3);var o=e.store.getQuery(i);o&&o.refresh(!0),(o=e.store.getQuery(s+"recent"))&&o.refresh(!0)},newMessage:function(t){O.require("compose",function(){e.mail.screens.compose.sourceDidFetchNewMessage(t)})},messageSavedOrSent:function(t){if("send"===t.action)this.get("store").fetchAll(e.Contact,!0);else{var i=t.clientId,n=this._draftsSaving[i],s=n[0],a=s.messageId;s.messageId=t.messageId,s.conversationId=t.conversationId,n.length>1?n.shift():delete this._draftsSaving[i],this.draftDidSave(i,a,s,"fullSave"===t.action)}e.mail.screens.compose.sourceDidSaveOrSendMessage(t)},error_validity:function(t){var i,n=this.get("store"),s=t.mailboxes,a=!1,o=n.getAll(e.Mailbox),r=[];for(i in o.forEach(function(e){var t=e.get("mailboxId");t in s?e.set("uidValidity",s[t]):(r.push(t),a=!0),delete s[t]}),r.length&&n.sourceDidDestroyRecords(e.Mailbox,r),s){a=!0;break}this._mb_validityHash=t.validityHash,a&&this.callMethod("getMailboxes",{validityHash:""})},error_tooManyChanges:function(t){var i=this.get("store"),n=t.id,s=i.getQuery(n),a=O.Status.READY,o=i.getAll(e.MessageHeader);s&&s.reset(),o.forEach(function(e){if(e.get("mailboxId")===n){var t=e.get("conversation");t.is(a)&&t.setObsolete()}})},error_conversationNotFound:function(e){this.response.error_missingConversations.call(this,[e.conversationId])},error_referenceMessageNotFound:function(t){O.require("compose",function(){e.mail.screens.compose.referenceMessageNotFound(t)})},error_sendFailed:function(t){e.mail.screens.compose.sourceDidFailToSend(t)},error_deleteAttachmentsFailed:function(t){e.notifications.show(O.loc(721,t.arguments.attachmentIds.length)+" "+O.loc(269),5e3)},error_saveAttachmentsFailed:function(t){var i=t.arguments.path,n=0===i.indexOf("vfs:")?i.replace(/^.*\/files\//,"/My Files/"):e.store.getRecord(e.FSMetadata,i).get("name")?e.store.getRecord(e.FSMetadata,i).get("name"):e.store.getRecord(e.FSMetadata,i.slice(0,-1)).get("name"),s=t.reason,a="message"===s||"attachment"===s?O.loc(269):"quota"===s?O.loc(420):"path"===s?O.loc(96):"remoteUnavailable"===s?O.loc(156,e.fsServiceName[i.slice(0,i.indexOf("/"))]):"";e.notifications.show(O.loc(155,t.arguments.attachmentIds.length,n)+" "+a,5e3)},error_remoteServiceFailed:function(t){var i,n,s,a=t.reason,o=t.service.split("/");if("remoteAuthentication"===a){for(i=e.userPrefs.get("remoteServices"),n=0,s=o.length-1;n<s;n+=1)i=i[o[n]];i.erase(o[s])}},error_missingConversations:function(t){for(var i=this.get("store"),n=t.length;n--;){var s=t[n],a=i.getQuery(s);a&&a.destroy()}i.sourceCouldNotFindRecords(e.ConversationDetails,t)},error_missingMessages:function(t){t&&t.length&&this.get("store").sourceCouldNotFindRecords(e.MessageHeader,t)}})}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,conversationId:i(String,{isPrimaryKey:!0,noSync:!0}),drafts:i(Number,{noSync:!0}),flagged:i(Number,{noSync:!0}),unread:i(Number,{noSync:!0}),unreadInTrash:i(Number,{noSync:!0}),attachments:i(Number,{noSync:!0}),total:i(Number,{noSync:!0}),totalInTrash:i(Number,{noSync:!0}),senders:i(Array,{noSync:!0}),size:i(Number,{noSync:!0})});e.api.mail.handle(n,{fetch:function(e){this.callMethod("getConversationDetails",{conversationIdList:e,validityHash:this._mb_validityHash})},conversationDetails:function(e){for(var t=e.conversations,i=t.length;i--;)t[i].senders.reverse();this.get("store").sourceDidFetchRecords(n,t),e.missing&&this.response.error_missingConversations.call(this,e.missing)}}),e.ConversationDetails=n}(FastMail),function(e){O.extend(O.Locale.prototype.dateFormats,{shortDate:function(e){return e.getFullYear()===(new Date).getFullYear()?e.format(this.shortDayMonth):e.format(this.shortDayMonthYear)},shortDateOrTime:function(e,t){return e.isToday()?t.getFormattedDate(e,"time"):this.shortDate(e)}});var t=function(e,t){var i=t.name,n=t.email;return e&&(e+=", "),i&&(e+=/[,;<>@()]/.test(i)?'"'+i+'"':i,n&&(e+=" <")),n&&(e+=n,i&&(e+=">")),e},i=function(e,t,i){var n=t.name,s=t.email;return e+(i?", ":"")+(n||s.split("@")[0])},n=function(e,t,i){return e+(i?", ":"")+t.email},s=O.Record,a=s.attr,o=O.Class({Extends:s,messageId:a(String,{isPrimaryKey:!0}),conversationId:a(String),mailboxId:a(String),isUnread:a(Boolean),isFlagged:a(Boolean),isAnswered:a(Boolean),isDraft:a(Boolean),hasAttachment:a(Boolean),date:a(Date),subject:a(String),from:a(Array,{defaultValue:[{name:"",email:""}]}),to:a(Array,{defaultValue:[]}),replyTo:a(Array),size:a(Number,{defaultValue:0}),spamScore:a(Number,{defaultValue:0}),trustedSender:a(String,{defaultValue:null}),preview:a(String),mailbox:function(){var t=this.get("mailboxId");return t?this.get("store").getRecord(e.Mailbox,t):null}.property("mailboxId"),conversation:function(){var t=this.get("conversationId");return t?this.get("store").getRecord(e.ConversationDetails,t):null}.property("conversationId").nocache(),details:function(){return this.get("store").getRecord(e.MessageDetails,this.get("id"))}.property().nocache(),toName:function(){var e=this.get("to");return e?e.reduce(i,""):""}.property("to"),toEmail:function(){var e=this.get("to");return e?e.reduce(n,""):""}.property("to"),fullTo:function(){var e=this.get("to");return e?e.reduce(t,""):""}.property("to"),fromName:function(){var e=this.get("safeFrom");return e?e.reduce(i,""):""}.property("from"),fromEmail:function(){var e=this.get("from");return e?e.reduce(n,""):""}.property("from"),fullFrom:function(){var e=this.get("from");return e?e.reduce(t,""):""}.property("from"),safeFrom:function(){var e,t=this.get("from");return!this.get("trustedSender")&&t&&t[0]&&(e=t[0].name,/@(?!.+\[.+\])|[FfϜＦｆƑ]\W*[AaÀÁÂÃÄÅàáâãäåɑΑαаᎪＡａ]?\W*[SsЅѕՏႽᏚ𐐠Ｓｓ]\W*[TtΤτТᎢＴｔ]\W*[EeÈÉÊËéêëĒēĔĕĖėĘĚěΕЕеᎬＥｅ]?\W*(?:[MmΜϺМᎷⅯⅿＭｍNn]|rn)\W*[AaÀÁÂÃÄÅàáâãäåɑΑαаᎪＡａ]?\W*[IilɩΙІіᎥⅠÏïⅰＩｉ1]?\W*[LlʟιاᏞⅬⅼＬｌ!iI1]/.test(e))&&((t=O.clone(t))[0].name=""),t}.property("from"),displayDate:function(){var e=this.get("date");return O.i18n.date(e,"shortDateOrTime")}.property().nocache(),fullDate:function(){var e=this.get("date");return O.i18n.date(e,"fullDateAndTime")}.property("date"),relativeDate:function(){var e=this.get("date"),t=new Date;return e<t?e.relativeTo(t,!0):t.relativeTo(e,!0)}.property().nocache(),formattedSize:function(){return O.i18n.fileSize(this.get("size"),1)}.property("size"),permissions:function(){return this.get("mailbox").get("permissions")}.property("mailbox"),isInMailbox:function(e){var t=this.get("id");return e===t.slice(1,t.indexOf("u"))}}).extend({buildFullHeader:t});e.api.mail.handle(o,{fetch:function(t){this.callMethod("getMessageHeaders",{messageIdList:t,validityHash:this._mb_validityHash,fetchConversationDetails:e.preferences.get("enableConversations")})},refresh:function(e){this.callMethod("getMessageFlags",{messageIdList:e,validityHash:this._mb_validityHash})},update:function(e,t,i){for(var n,s,a,o,r=this.get("store"),l={},c=e.length,u=function(e){if(s[e]){var t=n[e],i=l[e]||(l[e]={});(i[""+t]||(i[""+t]=[])).push(n.messageId)}};c--;)n=t[c],s=i[c],["isFlagged","isUnread"].forEach(u);for(a in l)for(o in l[a])this.callMethod("setMessagesProperty",{property:a,value:"true"===o,messageIdList:l[a][o],applyToConversation:"no"});this.addCallback(function(){r.sourceDidCommitUpdate(e)})},messageHeaders:function(e){this.get("store").sourceDidFetchRecords(o,e.headersList),this.response.error_missingMessages.call(this,e.missing)},messageFlags:function(e){this.get("store").sourceDidFetchPartialRecords(o,e.flags),this.response.error_missingMessages.call(this,e.missing)},messagesPropertySet:function(e){var t=this.getTransaction(e.clientId);t&&t.pushUndoCall(["setMessagesProperty",{property:e.property,value:!e.value,messageIdList:e.changed,applyToConversation:"no"}]),"isUnread"===e.property&&this.refreshMailboxCounts()}}),e.MessageHeader=o}(FastMail),function(e){var t=e.MessageHeader.buildFullHeader,i=O.Record,n=i.attr,s=O.Class({Extends:i,messageId:n(String,{isPrimaryKey:!0}),cc:n(Array),bcc:n(Array),listId:n(String),listPost:n(String),extraHeaders:n(Array),isSuspicious:n(Boolean,{defaultValue:!1}),hasBlockedContent:n(Boolean),bodyIsHTML:n(Boolean),bodyStyles:n(String),body:n(String),attachments:n(Array),attachedMessages:n(Object),attachedInvites:n(Object),personalityId:n(String),referenceTo:n(String),mode:n(String),isHighPriority:n(Boolean),isReadReceiptRequested:n(Boolean),fullCc:function(){return this.get("cc")?this.get("cc").reduce(t,""):""}.property("cc"),fullBcc:function(){return this.get("bcc")?this.get("bcc").reduce(t,""):""}.property("bcc")});e.api.mail.handle(s,{fetch:function(t){var i={messageIdList:[],conversationIdList:[],unreadFlaggedDraftAndNewestOnly:!1,textOnly:e.preferences.get("viewTextOnly")||O.UA.isIOS&&O.UA.version<5,validityHash:this._mb_validityHash};t instanceof Array?i.messageIdList=t:O.extend(i,t),this.callMethod("getMessageDetails",i)},messageDetails:function(t){this.get("store").sourceDidFetchRecords(e.MessageDetails,t.detailsList),this.response.error_missingMessages.call(this,t.missing)}}),e.MessageDetails=s;var a={};e.api.mail.handle(a,{fetch:function(t){this.callMethod("getMessageDetails",{messageIdList:[],conversationIdList:t,unreadFlaggedDraftAndNewestOnly:!0,textOnly:e.preferences.get("viewTextOnly")||O.UA.isIOS&&O.UA.version<5,validityHash:this._mb_validityHash})}}),e.MessageDetailsByConversation=a}(FastMail),function(e){var t=O.sortByProperties("date"),i=O.Status.READY,n=O.Status.EMPTY,s=O.Class({Extends:O.RemoteQuery,Type:e.MessageHeader,className:"ConversationMessageList",sort:"dateAscending",init:function(a){s.parent.init.call(this,a);var o=a.id,r=a.store,l=a.source,c=r.getRecord(e.ConversationDetails,o).get("total"),u=r.findAll(e.MessageHeader,function(e){return e.conversationId===o},t),d=e.MessageDetails,h=e.MessageDetailsByConversation;if(c&&u.length===c){var g=[];u.forEach(function(e,t){var i,s=r.getIdFromStoreKey(e);r.getRecordStatus(d,s)===n&&((i=r.getData(e)).isUnread||i.isDraft||t+1===c)&&g.push(s)}),this._list=u,this.set("length",c).set("status",i),g.length&&l.fetchRecords(d,g)}else l.fetchRecord(h,a.id)},_lastMessageGone:function(){this.get("length")||this.destroy()}.observes("length"),_markAffectedMailboxes:function(t,n){for(var s,a,o,r={},l=t.length,c=this.get("store");l--;)(s=c.getRecord(e.MessageHeader,t[l]))&&s.is(i)&&(r[s.get("mailboxId")]=!0);for(a in n&&(r[e.systemFolderIds.get("trash")]=!0),r)(o=c.getQuery(a))&&o.setObsolete()},deleteMessages:function(t,n){var s=e.store.getRecord(e.ConversationDetails,this.get("id")),a=this.get("state"),o=this.get("sort"),r=this.get("filter"),l=e.store.getIdFromStoreKey.bind(e.store),c=this._list.map(l),u=e.api.mail.getTransaction();s.get("status")&i&&(s.increment("total",-t.length),n||s.increment("totalInTrash",t.length)),this._markAffectedMailboxes(t,!n),this.sourceDidFetchQuery({state:a,sort:o,filter:r,idList:c.filter(function(e){return-1===t.indexOf(e)})}),e.api.mail.callMethod("deleteMessages",{clientId:u?u.id:null,messageIdList:t,applyToConversation:"no",permanently:n}),e.api.mail.refreshMailboxCounts(),this.refresh(!0,function(){this.get("state")===a&&(this.sourceDidFetchQuery({state:a,sort:o,filter:r,idList:c}),s.is(i)&&s.refresh())}.bind(this))},setMessagesProperty:function(t,i,n){var s,a=this.get("store"),o=e.MessageHeader,r=a.getIdFromStoreKey.bind(a),l=O.Status.READY,c=e.store.getRecord(e.ConversationDetails,this.get("id")),u=i.slice(2).toLowerCase(),d=c.get(u)||0,h=n?1:-1;(t=t.filter(function(e){if(a.getRecordStatus(o,e)&l){if(!(s=a.getRecord(o,e)).get("permissions")["isUnread"===i?"mayUpdateSeen":"mayUpdateFlags"])return!1;s.get(i)!==n&&(s.stopSync().set(i,n).startSync(),d+=h)}return!0})).length&&(c.set(u,d),e.api.mail.callMethod("setMessagesProperty",{property:i,value:n,messageIdList:t,applyToConversation:"no"}),"isUnread"===i&&e.api.mail.refreshMailboxCounts(),this._markAffectedMailboxes(this._list.map(r)))},onUpdate:function(t){var i=t.removed.filter(function(e){return-1===t.added.indexOf(e)}),n=this.get("store");i.forEach(function(t){var i=n.getIdFromStoreKey(t);n.unloadRecord(t),t=n.getStoreKey(e.MessageDetails,i),n.unloadRecord(t)});var s={};s[this.get("id")]={total:this.get("length")},n.sourceDidFetchPartialRecords(e.ConversationDetails,s),t.added.forEach(function(t){var i=n.getIdFromStoreKey(t);n.getRecord(e.MessageDetails,i)})}.on("query:updated")});e.api.mail.handle(s,{query:function(t){var i,n,s=this.get("store"),a=this._sendQueue,o=a.length,r=e.MessageHeader,l=O.Status.READY,c=t.get("id"),u=t.get("state"),d=s.getIdFromStoreKey.bind(s),h=t._list.map(d).filter(function(e){return e&&s.getRecordStatus(r,e)&l});for(t.sourceWillFetchQuery();o--;)if("getConversationMessageLists"===(i=a[o])[0])return(n=i[1]).conversationIdList.push(c),n.stateList.push(u),void(n.headersKnown=n.headersKnown.concat(h));this.callMethod("getConversationMessageLists",{conversationIdList:[c],stateList:[u],headersKnown:h,restrictHeadersLength:!0,validityHash:this._mb_validityHash})},conversationMessageList:function(e){var t,i=e.conversationId,n=this.get("store").getQuery(i),s=e.messageIdList;if(n){if(t=n.get("state"),!s)return void(t===e.state&&n.set("status",O.Status.READY));n.sourceDidFetchQuery({sort:"dateAscending",filter:"",state:e.state,idList:s})}}}),e.ConversationMessageList=s}(FastMail),function(e,t){var i={inbox:O.loc(1179),archive:O.loc(1176),drafts:O.loc(1177),sent:O.loc(426),spam:O.loc(1182),trash:O.loc(1183)},n=O.Record,s=n.attr,a=O.ValidationError,o=a.REQUIRED,r=a.TOO_LONG,l=a.INVALID_CHAR,c=a.FIRST_CUSTOM_ERROR,u=O.Class({Extends:n,mailboxId:s(String,{isPrimaryKey:!0}),uidValidity:s(Number,{noSync:!0}),name:s(String,{defaultValue:"",validate:function(e,t,i){if(i.get("role"))return null;if(!e)return new a(o,O.loc(2));if(e.length>100)return new a(r,O.loc(407,100));if(/[\"\%\*\/\;<>\\\^\`\{\|\}\x00-\x1f\u0080-\u009F]/.test(e))return new a(l,O.loc(406,'% *  ^ ` " | ; / \\ < > { }'));if(!i.get("parent")&&"Notes"===e)return new a(c,O.loc(696));if(e){for(var n,s=i.get("parent"),d=s?s.get("subfolders"):i.get("store").getAll(u,function(e){return!e.parentId},O.sortByProperties(["precedence","name"])),h=d.get("length");h--;)if((n=d.getObjectAt(h))!==i&&n.get("name")===e)return d.destroy(),new a(c,O.loc(190,e));if(d.destroy(),!s&&"inbox"===e.toLowerCase())return new a(c,O.loc(190,"Inbox"))}return null},validityDependencies:["parent"]}),role:s(String,{defaultValue:""}),precedence:s(Number,{defaultValue:10}),parent:n.toOne({Type:u,key:"parentId",defaultValue:null}),isCollapsed:s(Boolean,{defaultValue:!1}),hidden:s(Number,{defaultValue:0}),sort:s(String,{defaultValue:"dateDescending"}),totalMessages:s(Number,{defaultValue:0,noSync:!0}),unreadMessages:s(Number,{defaultValue:0,noSync:!0}),totalConversations:s(Number,{defaultValue:0,noSync:!0}),unreadConversations:s(Number,{defaultValue:0,noSync:!0}),personality:n.toOne({Type:e.Personality,key:"personalityId"}),autoLearn:s(Boolean,{defaultValue:!1}),learnAsSpam:s(Boolean,{defaultValue:!0}),autoPurge:s(Boolean,{defaultValue:!1}),purgeOlderThanDays:s(Number,{defaultValue:31}),onlyPurgeDeleted:s(Boolean,{defaultValue:!1}),suppressDuplicates:s(Boolean,{defaultValue:!0}),isOwn:s(Boolean,{defaultValue:!0}),permissions:s(Object,{defaultValue:{mayRead:!0,mayUpdateSeen:!0,mayUpdateFlags:!0,mayInsert:!0,mayDelete:!0,mayCreateSub:!0,isDeletable:!0},noSync:!0}),init:function(){u.parent.init.apply(this,arguments),this._wasHidden=this.get("isHidden"),this._parent=null,this.parentDidChange()},useConversations:function(){return this.get("isOwn")&&"Templates"!==this.get("name")&&e.preferences.get("enableConversations")}.property("isOwn"),total:function(e){return void 0!==e?e:this.get("useConversations")?this.get("totalConversations"):this.get("totalMessages")}.property("useConversations","totalConversations","totalMessages"),unread:function(e){return void 0!==e?e:this.get("useConversations")?this.get("unreadConversations"):this.get("unreadMessages")}.property("useConversations","unreadConversations","unreadMessages"),displayName:function(){var e=this.get("role");return e?i[e]:this.get("name")}.property("name","role"),pathName:function(){var e=this.get("parent");return(e?e.get("pathName")+"/":"")+this.get("displayName")}.property("parent","displayName"),urlName:function(){var e=this.get("parent");return(e?e.get("urlName")+".":"")+this.get("displayName").replace(/ /g,"_")}.property("parent","displayName"),inheritedRole:function(){var e=this.get("parent");return e?e.get("inheritedRole"):this.get("role")}.property("parent","role"),isForSentAndDraft:function(){var e=this.get("inheritedRole");return"drafts"===e||"sent"===e}.property("inheritedRole"),subfolders:function(){var e=this.get("storeKey"),t=this.get("store");return e?t.getAll(u,function(t){return t.parentId===e},O.sortByProperties(["precedence","name"])):new O.RecordArray(t,u,[])}.property().nocache(),depth:function(){var e=this.get("parent");return e?e.get("depth")+1:0}.property("parent"),depthDidChange:function(e,t,i){i!==this.get("depth")&&this.get("subfolders").forEach(function(e){e.computedPropertyDidChange("depth")})}.observes("depth"),isDisabled:function(){return!this.get("permissions").mayRead}.property("permissions"),isHidden:function(e){if(void 0===e){var t=this.get("hidden");e=!(!t||1!==t&&("drafts"===this.get("role")?this.get("total"):this.get("unread")))}return e}.property("hidden","unread"),filter:function(e){this.set("isHidden",!!e&&!e.test(this.get("displayName")))},subfolderCount:0,visibleChildrenCount:0,unreadChildrenCount:0,isHiddenDidChange:function(){var e=this.get("isHidden"),t=this.get("parent");e!==this._wasHidden&&(this._wasHidden=e,t&&t.increment("visibleChildrenCount",e?-1:1))}.observes("isHidden"),unreadDidChange:function(e,t,i){var n=!!this.get("unread"),s=this.get("parent");n!==!!i&&s&&s.increment("unreadChildrenCount",n?1:-1)}.observes("unread"),childCountsDidChange:function(e,t,i,n){var s=this.get("parent");s&&s.increment(t,n-i)}.observes("subfolderCount","visibleChildrenCount","unreadChildrenCount"),parentDidChange:function(){var e=this._parent,t=this.is(O.Status.READY)?this.get("parent"):null;if(e!==t){var i=this instanceof u?this.get("subfolderCount")+1:0,n=this.get("visibleChildrenCount")+(this.get("isHidden")?0:1),s=this.get("unreadChildrenCount")+(this.get("unread")?1:0);e&&e.increment("subfolderCount",-i).increment("visibleChildrenCount",-n).increment("unreadChildrenCount",-s),t&&t.increment("subfolderCount",i).increment("visibleChildrenCount",n).increment("unreadChildrenCount",s),this._parent=t}}.observes("status","parent"),errorIfMovedTo:function(t,i){var n,s,a,o,r,l,c,u,d;if(t&&this.get("role"))return O.loc(408);if(t&&!t.get("permissions").mayCreateSub||!this.get("permissions").isDeletable)return O.loc(1122);if(!this.is(O.Status.NEW)){if((r=this.get("isOwn"))!==(l=!t||t.get("isOwn")))return O.loc(405);if(!r&&!l){for(c=this;d=c.get("parent");)c=d;for(u=t;d=u.get("parent");)u=d;if(c!==u)return O.loc(405)}}for(d=t;d;){if(d===this)return O.loc(1124);d=d.get("parent")}if(i)return!1;for(a=this.get("name"),o=!t,s=(n=t?t.get("subfolders"):this.get("store").getQuery("rootMailboxes",O.LiveQuery,{Type:e.Mailbox,filter:function(e){return!e.parentId},sort:["precedence","name"]})).get("length");s--;)if((t=n.getObjectAt(s))!==this&&t.get("name")===a)return o?O.loc(190,a):O.loc(1121,a);return!1},moveTo:function(t,i){var n,s,a,o,r="sub"===i,l=r?t:t.get("parent"),c=l?l.get("subfolders"):this.get("store").getQuery("rootMailboxes",O.LiveQuery,{Type:e.Mailbox,filter:function(e){return!e.parentId},sort:["precedence","name"]}),u=r?0:c.indexOf(t)+("next"===i?1:0),d=u?c.getObjectAt(u-1):null,h=c.getObjectAt(u),g=d?d.get("precedence"):0,p=h?h.get("precedence"):32*(u+2);if(p-g<2){for(n=0,s=32,a=c.get("length");n<a;n+=1,s+=32)(o=c.getObjectAt(n))!==this&&(o.set("precedence",s),o===d&&(s+=32));d&&(g=d.get("precedence")),h&&(p=h.get("precedence"))}this.set("parent",l||null).set("precedence",p+g>>1)},resetDependentRecords:function(){var t=this.get("store");if(!t.isNested){for(var i,n,s=this.get("mailboxId"),a=t.findAll(e.MessageHeader,function(e){return e.mailboxId===s}),o={},r=a.length;r--;)o[i=t.getData(a[r]).conversationId]||((n=t.getQuery(i))&&n.reset(),o[i]=!0);a.forEach(function(e){t.unloadRecord(e)}),(n=t.getQuery(s))&&n.reset()}}.observes("uidValidity"),destroy:function(){this.get("permissions").isDeletable&&(this.get("subfolders").forEach(function(e){e.destroy()}),u.parent.destroy.call(this))},statusDidChange:function(t,i,n,s){var a,o=this.get("store"),r=this.get("mailboxId"),l=O.Status.DESTROYED;!o.isNested&&s&l&&e.mail&&e.mail.get("mailboxId")===r&&(e.mail.beginPropertyChanges().set("search","").set("messageId","").set("conversationId","").set("mailboxId",e.systemFolderIds.get("inbox")).set("screen","mailbox").endPropertyChanges(),s===l&&(this.resetDependentRecords(),(a=o.getQuery(this.get("mailboxId")))&&a.destroy()))}.observes("status")});u.prototype.parent.Type=u,e.api.mail.handle(u,{precedence:0,fetch:function(){this._mb_loaded||this._mb_loading||(this.callMethod("getMailboxes",{validityHash:this._mb_validityHash},function(){this._mb_loading=!1}.bind(this)),this._mb_loading=!0,this._mb_generation=0,this.refreshMailboxCounts())},refresh:function(){var e=this._mb_generation;this.callMethod("getMailboxCounts",e?{lastGeneration:e}:{})},commit:function(e){var t=e.create,i=e.update,n=e.destroy;this.callMethod("setMailboxes",{validityHash:this._mb_validityHash,create:Object.zip(t.storeKeys,t.records),update:Object.zip(i.storeKeys,i.records.map(function(e,t){var n=Object.filter(e,i.changes[t]);return n.mailboxId=e.mailboxId,n})),destroy:Object.zip(n.storeKeys,n.ids)})},mailboxes:function(e){this._mb_loaded=!0,this._mb_validityHash=e.validityHash;var t=e.mailboxList;t&&this.get("store").sourceDidFetchRecords(u,t,null,!0)},mailboxCounts:function(e){if(e.validityHash!==this._mb_validityHash)return this._mb_loaded=!1,this._mb_counts={},void this.fetchAllRecords(u);this._mb_generation=e.currentGeneration,O.extend(this._mb_counts,e.counts),this._recordsToRefresh[O.guid(u)]||this.get("store").sourceDidFetchPartialRecords(u,this._mb_counts).getAll(u).forEach(function(e){e.unread()!==e.get("unread")&&e.computedPropertyDidChange("unread"),e.total()!==e.get("total")&&e.computedPropertyDidChange("total")})},mailboxesSet:function(e){e.validityHash&&(this._mb_validityHash=e.validityHash),this.didCommit(u,e)},updateMailboxes:function(e){this.get("store").sourceDidFetchPartialRecords(u,e)}}),e.Mailbox=u}(FastMail),function(e,t){var i=O.Status,n=i.EMPTY,s=i.READY,a=i.DESTROYED,o=i.OBSOLETE,r=function(e,t,i,n,s){var a,o,r,l,c,u;for(a=0,r=e.length;a<r;a+=1)if(c=s[e[a]])for(t.push(c),o=0,l=(u=n[c]).length;o<l;o+=1)i.push(u[o]);else i.push(e[a])},l=O.Class({Extends:O.WindowedRemoteQuery,Type:e.MessageHeader,isSearch:!1,useConversations:O.bind(null,"mailbox*useConversations",function(e){return e&&"drafts"!==this.fromObject.get("role")}),sort:O.bind("mailbox*sort"),sortDirection:function(e){var t=this.get("sortPinnedFirst");return void 0!==e?this.get("mailbox").set("sort",e+(t?"Flagged":"")):(e=this.get("sort"),t&&(e=e.slice(0,-7))),e}.property("sort"),sortPinnedFirst:function(e){var t=this.get("sort"),i=this.get("mailbox"),n="Flagged"===t.slice(-7);return void 0!==e&&(e&&!n?i.set("sort",t+"Flagged"):!e&&n&&i.set("sort",t.slice(0,-7)),n=!!e),n}.property("sort"),mailbox:function(){return this.get("store").getRecord(e.Mailbox,this.get("id"))}.property(),getObjectAt:function(t,i){var n=this.get("length");if(!(null===n||t<0||t>=n)){var s=this._list[t],o=this.get("store");return i||(o.getStatus(s)&a&&this.setObsolete(),this.fetchDataForObjectAt(t)),s?o.getRecord(e.MessageHeader,"#"+s):null}},checkIfWindowIsFetched:function(t){for(var i,a=this.get("store"),r=e.MessageHeader,l=this.get("windowSize"),c=this._list,u=t*l,d=Math.min(u+l,this.get("length")),h=this.get("useConversations");u<d;u+=1){if(a.getStatus(c[u])&(n|o))return!1;if(h&&(!(i=a.getRecord(r,"#"+c[u]).get("conversation"))||!i.is(s)||i.is(o)))return!1}return!0},sourceWillFetchQuery:function(){var t=l.parent.sourceWillFetchQuery.call(this),i=this.get("store"),n=this._list,s=this.get("length"),a=this.get("useConversations"),r=e.MessageHeader;return this.get("canGetDeltaUpdates")&&(t.records=t.records.filter(function(e){var t,l,c=e.start,u=c+e.count;for(s&&(u=Math.min(u,s));c<u;){var d=n[c];if(d)c+=1;else{if(!(d=n[u-1]))break;u-=1}(t=i.getRecord(r,"#"+d)).is(o)&&t.refresh(),a&&(l=t.get("conversation"))&&l.is(o)&&l.refresh()}return e.start=c,e.count=u-c,c!==u})),t},_deleteOrMove:function(t,i,n,a){var o,c,u,d,h,g,p,f,m,v,A,y=e.systemFolderIds.get("trash"),b=this.get("isSearch"),w=this.get("id")===y,S=e.store,C=this.get("useConversations"),x=C?e.ConversationDetails:e.MessageHeader,M=C?"unread":"isUnread",I=C?a&&a.applyToConversation||"mailbox":"no",T=[];if(C?b&&"mailbox"===I?(r(i,T,o=[],this._convIdToMsgIds,this._exemplarToConvId),c=!0,I="no"):c=function(t,i){var n,a,o,r=!0,l=e.store,c=e.MessageHeader;for(n=0,a=t.length;n<a;n+=1)o=t[n],l.getRecordStatus(c,o)&s?i.push(l.getRecord(c,o).get("conversationId")):r=!1;return r}(i,T):(o=i,c=!0),!b){for(d=0,h=0,g=(u=C?T:i).length;h<g;h+=1)f=u[h],S.getRecordStatus(x,f)&s&&S.getRecord(x,f).get(M)&&(d+=1);!function(e,t,i,n){e.set("unread",Math.max(e.get("unread")-i,0)),e.set("total",Math.max(e.get("total")-n,0)),t&&(t.set("unread",t.get("unread")+i),t.set("total",t.get("total")+n))}(this.get("mailbox"),n&&S.getRecord(e.Mailbox,n),d,i.length)}if(e.api.mail.refreshMailboxCounts(),this.clientDidGenerateUpdate({removed:i.map(S.getStoreKey.bind(S,e.MessageHeader))}),p={messageIdList:o||i,applyToConversation:I},(A=e.api.mail.getTransaction())&&(p.clientId=A.id),"moveMessages"===t&&(p.destinationMailboxId=n,p.separateSentAndDraft=C&&w),a&&O.extend(p,a),e.api.mail.callMethod(t,p),this.refresh(!0),c)for(h=0,g=T.length;h<g;h+=1)(v=S.getQuery(T[h]))&&v.setObsolete();if(g=(m=S.getAllRemoteQueries()).length,C&&("moveMessages"!==t||w||n===y))for(;g--;)(v=m[g])!==this&&(!c||v instanceof l)&&v.setObsolete();else if(n&&((v=S.getQuery(n))&&v.setObsolete(),!c))for(;g--;)(v=m[g])instanceof e.ConversationMessageList&&v.setObsolete()},archiveMessages:function(t){this.setMessagesProperty(t,"isUnread",!1),this.moveMessages(t,e.systemFolderIds.get("archive"))},moveMessages:function(t,i){var n=this.get("id"),s=this.get("useConversations"),a=e.systemFolderIds.get("spam"),o=e.systemFolderIds.get("trash"),r=e.systemFolderIds.get("archive"),l=e.api.mail.getTransaction();n!==i&&((n===a&&i!==o||i===r)&&e.api.mail.callMethod("notSpamMessages",{clientId:l?l.id:void 0,messageIdList:t.slice(0,500),applyToConversation:s?"mailbox":"no"}),i===a&&e.api.mail.callMethod("reportSpamMessages",{clientId:l?l.id:void 0,messageIdList:t.slice(0,500),applyToConversation:s?"mailbox":"no"}),this._deleteOrMove("moveMessages",t,i))},copyMessages:function(t,i){var n,s,a,o,l=this.get("isSearch"),c=this.get("useConversations"),u=e.api.mail.getTransaction(),d=this.get("store");if(l&&c&&r(t,[],n=[],this._convIdToMsgIds,this._exemplarToConvId),e.api.mail.callMethod("copyMessages",{clientId:u?u.id:void 0,applyToConversation:c&&!l?"mailbox":"no",messageIdList:l&&c?n:t,destinationMailboxId:i}),e.api.mail.refreshMailboxCounts(),l||c)for(this.refresh(!0),o=(s=d.getAllRemoteQueries()).length;o--;)(a=s[o])!==this&&a.setObsolete();else(a=d.getQuery(i))&&a.setObsolete()},discardDrafts:function(e){this._deleteOrMove("deleteMessages",e,null,{permanently:!0})},deleteMessages:function(t,i){var n=i?null:e.systemFolderIds.get("trash"),s=this.get("useConversations"),a=!e.preferences.get("deleteEntireConversation");i?this.get("id")===e.systemFolderIds.get("spam")&&(t.length<=10||t.length!==this.get("length"))&&e.api.mail.callMethod("reportSpamMessages",{messageIdList:t.slice(0,500),applyToConversation:s?"mailbox":"no"}):this.setMessagesProperty(t,"isUnread",!1,a),this._deleteOrMove("deleteMessages",t,n,{permanently:!!i,applyToConversation:s?a||i?"mailbox":"yes":"no"})},restoreMessages:function(e){this._deleteOrMove("restoreMessages",e)},reportSpamMessages:function(t){this.setMessagesProperty(t,"isUnread",!1),this.moveMessages(t,e.systemFolderIds.get("spam"))},reportPhishing:function(t){this.setMessagesProperty(t,"isUnread",!1),e.api.mail.callMethod("reportPhishing",{messageIdList:t,applyToConversation:"no"}),this.moveMessages(t,e.systemFolderIds.get("trash"))},setMessagesProperty:function(t,i,n,a){var o=this.get("mailbox"),r="isUnread"===i;if(o.get("permissions")[r?"mayUpdateSeen":"mayUpdateFlags"]){var c,u=this.get("store"),d=e.MessageHeader,h=e.ConversationDetails,g=this.get("useConversations"),p=g&&(!n||r),f=[],m=0,v=i.slice(2).toLowerCase(),A=!0,y=[],b=e.api.mail.getTransaction();if(t.forEach(function(e){u.getRecordStatus(d,e)&s?(c=u.getRecord(d,e),g&&f.push(c.get("conversationId")),y.push(c)):A=!1}),f.forEach(function(e){if(u.getRecordStatus(h,e)&s){var t=u.getRecord(h,e),i=!!t.get(v);t.get("unread")&&(m+=1),i!==n&&t.set(v,n?p?t.get("total")-t.get("drafts"):1:0)}}),(p?u.getAll(d,function(e){return f.indexOf(e.conversationId)>-1}):y).forEach(function(e){e.stopSync().set(i,n).startSync()}),r&&(o.set("unread",Math.max(0,o.get("unread")-m+(n?t.length:0))),e.api.mail.refreshMailboxCounts()),e.api.mail.callMethod("setMessagesProperty",{clientId:b?b.id:void 0,property:i,value:n,messageIdList:t,applyToConversation:p?a?"mailbox":"yes":"no"}),this.refresh(!0,null,!0),g)for(var O,w=u.getAllRemoteQueries(),S=w.length;S--;)(O=w[S])!==this&&(!A||O instanceof l)&&O.setObsolete()}}});e.api.mail.handle(l,{query:function(t){var i=t.get("id"),n=t.get("sort"),s=t.get("state"),a=t.get("filter"),o=t.get("useConversations"),r=t.sourceWillFetchQuery(),l=t.get("isSearch"),c=l?t.get("mailboxId"):i,u=l?"getSearchMessageList":"getMailboxMessageList",d=t._list,h=!1,g=function(t){return t?e.store.getIdFromStoreKey(t):void 0};if(l&&!a)return t.sourceDidFetchIdList({state:"",sort:n,filter:a,idList:[],position:0,total:0}),void(r.callback&&r.callback());if(!l&&s&&r.refresh){var p=d.length,f=p===t.get("length")?null:d[p-1];this.callMethod("getMailboxMessageListUpdates",{mailboxId:i,useConversations:o,sort:n,filter:a,state:s,uptoMessageId:g(f),fetchUpdates:!0,fetchNewIfLessThan:10})}if(r.callback&&this.addCallback(r.callback),n){var m=function(e,t,i,r,d){var g={mailboxId:c,useConversations:o,sort:n,position:e+1,limit:t,anchor:i,anchorOffset:r,fetchHeaders:d};l?(g.search=a,g.fetchSnippets=!1,g.timezoneSecondsOffset=60*(new Date).getTimezoneOffset()):(g.filter=a,g.state=s,this.loopIsDetected&&(g.bypassCache=!0)),h=!0,this.callMethod(u,g)}.bind(this);r.ids.forEach(function(e){m(e.start,e.count,g(d[e.start-1]),1,!1)}),r.records.forEach(function(e){m(e.start,e.count,g(d[e.start-1]),1,!0)}),r.indexOf.forEach(function(e){m(0,10,e[0],0,!1),this.addCallback(e[1])},this),(t.get("status")&O.Status.EMPTY&&!r.records.length||l&&!h&&r.refresh)&&m(0,30,null,1,!0)}},mailboxMessageList:function(t){var i=this.get("store"),n=t.mailboxId,s=i.getQuery(n,e.MailboxMessageList,{mailboxId:n});t.position-=1,t.idList=t.messageIdList,t.useConversations===s.get("useConversations")&&s.sourceDidFetchIdList(t)},updateMailboxMessageList:function(e){var t=this.get("store").getQuery(e.mailboxId),i=e.added,n=i.length;if(t&&e.useConversations===t.get("useConversations")){for(;n--;)i[n][0]-=1;e.upto=e.uptoMessageId,t.sourceDidFetchUpdate(e)}}}),e.MailboxMessageList=l}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.ValidationError,s=n.REQUIRED,a=n.FIRST_CUSTOM_ERROR,o=O.Status.READY,r=O.Status.NEW,l=O.Status.DIRTY,c=O.Class({Extends:t,isEnabled:i(Boolean,{defaultValue:!0}),isAutoFetched:i(Boolean,{defaultValue:!0}),fileIn:t.toOne({Type:e.Mailbox}),willLeaveCopy:i(Boolean,{defaultValue:!0}),lastFetch:i(Date,{defaultValue:null}),isWorking:i(Boolean,{defaultValue:!0}),identity:function(){var t=this.get("storeKey");return this.get("store").getOne(e.Personality,function(e){return e.popLinkId===t})}.property().nocache(),isAutoConfigured:i(Boolean),popServer:i(String,{validate:function(e){return e?/(?:[\w\-]+\.)+[a-z]{2,}/i.test(e)?null:new O.ValidationError(a,O.loc(41)):new n(s,O.loc(2))}}),popPort:i(Number,{validate:function(e){return e?/^(?:110|995|2[25]|143|1110|2110|2143|7110|8110)$/.test(e+"")?null:new O.ValidationError(a,O.loc(41)):new n(s,O.loc(2))}}),popSSL:i(String),popUser:i(String,{validate:function(e){return e?null:new n(s,O.loc(2))}}),popPassword:i(String,{validate:function(e,t,i){return e||i.get("popRemoteService")||i.get("status")!==(o|r|l)?null:new n(s,O.loc(2))},validityDependencies:["popRemoteService"]}),popRemoteService:i(String),fetch:function(t){var i=this.get("id");i&&e.api.peripheral.callMethod("fetchPopLink",{popLinkId:i},t)}});e.api.mail.handle(c,{precedence:1,fetch:"getPopLinks",commit:"setPopLinks",popLinks:function(e){this.didFetch(c,e,!0)},popLinksSet:function(e){this.didCommit(c,e)}}),e.PopLink=c}(FastMail),function(e,t){var i=O.Record,n=i.attr,s=O.ValidationError,a=s.REQUIRED,o=s.INVALID_CHAR,r=s.FIRST_CUSTOM_ERROR,l=O.Status.READY,c=O.Status.NEW,u=O.Status.DIRTY,d=O.Class({Extends:i,isDeletable:n(Boolean,{defaultValue:!0}),displayName:n(String,{defaultValue:""}),email:n(String),name:n(String,{defaultValue:"",validate:function(e){return/[\\"]/.test(e)?new s(o,O.loc(406,'\\"')):null}}),_textSignature:n(String,{key:"textSignature",defaultValue:""}),_htmlSignature:n(String,{key:"htmlSignature",defaultValue:""}),replyTo:n(String,{defaultValue:"",validate:function(e){return e&&!RegExp.email.test(e)?new s(r,O.loc(253)):null}}),autoBcc:n(String,{defaultValue:"",validate:function(e){return e&&!e.split(",").every(function(e){return RegExp.email.test(e)})?new s(r,O.loc(41)):null}}),addBccOnSMTP:n(Boolean,{defaultValue:!1}),saveSentTo:i.toOne({Type:e.Mailbox}),saveAttachments:n(Boolean,{defaultValue:!0}),saveOnSMTP:n(Boolean,{defaultValue:!1}),useForAutoReply:n(Boolean,{defaultValue:!0}),isAutoConfigured:n(Boolean,{defaultValue:!1}),enableExternalSMTP:n(Boolean,{defaultValue:!1}),smtpServer:n(String,{defaultValue:"",validate:function(e,t,i){if(e){if(!/(?:[\w\-]+\.)+[a-z]{2,}/i.test(e))return new O.ValidationError(r,O.loc(41))}else if(i.get("enableExternalSMTP"))return new s(a,O.loc(2));return null},validityDependencies:["enableExternalSMTP"]}),smtpPort:n(Number,{defaultValue:587,validate:function(e,t,i){if(e){if(!/^(?:2[256]|465|587|994|1025)$/.test(e+""))return new O.ValidationError(r,O.loc(41))}else if(i.get("enableExternalSMTP"))return new s(a,O.loc(2));return null},validityDependencies:["enableExternalSMTP"]}),smtpSSL:n(String,{defaultValue:"starttls"}),smtpUser:n(String,{defaultValue:"",validate:function(e,t,i){return!e&&i.get("enableExternalSMTP")?new s(a,O.loc(2)):null},validityDependencies:["enableExternalSMTP"]}),smtpPassword:n(String,{defaultValue:"",validate:function(e,t,i){return e||!i.get("enableExternalSMTP")||i.get("smtpRemoteService")||i.get("status")!==(l|c|u)?null:new s(a,O.loc(2))},validityDependencies:["smtpRemoteService","enableExternalSMTP"]}),smtpRemoteService:n(String,{defaultValue:""}),popLink:i.toOne({Type:e.PopLink,key:"popLinkId",defaultValue:null}),init:function(){d.parent.init.apply(this,arguments);var t=this.get("email");t&&(t=t.replace(/\*/g,"").replace(/\./g,"⥷"),this.registerBinding((new O.Binding).from(t,e.AvatarManager).to("avatar",this).connect()))},destroy:function(){this.get("store").getAll(e.Mailbox).forEach(function(e){e.get("personality")===this&&e.set("personality",null)},this),d.parent.destroy.call(this)},isDefault:function(t){var i=this.get("store"),n=i.getRecord(e.UserPreferences,"singleton"),s=n.get("defaultPersonality"),a=this.get("storeKey");return void 0!==t&&(t?s=this:s===this&&(s=i.getOne(d,function(e,t,i){return i!==a&&"*"!==e.email.charAt(0)})||this),n.set("defaultPersonality",s)),s===this}.property().doNotNotify(),nameAndEmail:function(){var e=this.get("name").replace(/["\\]/g,""),t=this.get("email");return e?(/[,;<>@()]/.test(e)&&(e='"'+e+'"'),e+" <"+t+">"):t}.property("name","email"),displayOrFull:function(){return this.get("displayName")||this.get("nameAndEmail")}.property("displayName","nameAndEmail"),textSignature:function(t){return void 0!==t?this.set("_textSignature",t).set("_htmlSignature",e.toHTML(t)):t=this.get("_textSignature")||"",t=t.trim()}.property("_textSignature"),htmlSignature:function(t){var i,n;if(void 0!==t?("<div><br></div>"===t&&(t=""),this.set("_textSignature",e.toPlainText(t)).set("_htmlSignature",t)):(t=this.get("_htmlSignature"),/<img /.test(t)||e.toPlainText(t).trim()||(t="")),t){for(n=(i=O.Element.create("div",{html:t})).firstChild;n;n=n.nextSibling)1===n.nodeType&&(n.className="signature");t=i.innerHTML}return t?'<div id="sig'+this.get("id")+'">'+t+"</div>":""}.property("_htmlSignature","id")});e.Mailbox.prototype.personality.Type=d,e.api.mail.handle(d,{precedence:2,fetch:"getPersonalities",commit:"setPersonalities",personalities:function(t){for(var i,n=t.list,s=n.length;s--;)!(i=n[s]).htmlSignature&&i.textSignature&&(i.htmlSignature=e.toHTML(i.textSignature));this.didFetch(d,t,!0)},personalitiesSet:function(e){this.didCommit(d,e)}}),e.Personality=d}(FastMail),function(e,t){var i=O.Record,n=i.attr,s=O.ValidationError,a=O.Class({Extends:i,type:n(String,{defaultValue:"fileinto"}),precedence:n(Number,{defaultValue:0}),isEnabled:n(Boolean,{defaultValue:!0}),combinator:n(String,{defaultValue:"all"}),conditions:n(Array,{defaultValue:[]}),discard:n(Boolean,{defaultValue:!1}),fileIn:i.toOne({Type:e.Mailbox,defaultValue:null}),markRead:n(Boolean,{defaultValue:!1}),markFlagged:n(Boolean,{defaultValue:!1}),redirectTo:n(String,{defaultValue:"",validate:function(e,t,i){if("redirect"===i.get("type")){if(!e)return new s(s.REQUIRED,O.loc(2));if(!e.split(",").every(function(e){return RegExp.email.test(e)}))return new O.ValidationError(s.FIRST_CUSTOM_ERROR,O.loc(191))}return null},validityDependencies:["type"]}),discardOnRedirect:function(e){var t="redirect"===this.get("type");return void 0!==e?t&&this.set("discard",e):e=t&&this.get("discard"),e}.property("type","discard")});e.api.mail.handle(a,{precedence:4,fetch:"getRules",commit:"setRules",rules:function(e){e.state||(e.state="TEMP"),this.didFetch(a,e,!0)},rulesSet:function(t){this.didCommit(a,t),e.settings&&e.settings.rules&&e.settings.rules.set("sieveError","")},error_sieve:function(t){e.base.restoreStateFromUrl("settings/rules"),O.require("settings+rules",function(){e.settings.rules.set("sieveError",t.description)})}}),e.Rule=a}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,name:i(String,{defaultValue:""}),search:i(String),mailboxId:i(String),init:function(){n.parent.init.apply(this,arguments),this._wasHidden=!1,this._parent=null,this.parentDidChange()},isGlobal:function(){return!this.get("mailboxId")}.property("mailboxId"),displayName:function(){return this.get("name")||this.get("search")}.property("name","search"),url:function(){return e.base.getUrlForState({app:"mail",screen:"mailbox",searchIsGlobal:this.get("isGlobal"),search:this.get("search"),mailboxId:this.get("mailboxId")})}.property("mailboxId","search","isGlobal"),messageList:function(){var t=this.get("search"),i=this.get("mailboxId"),n="s"+(i||"g")+":"+t;return this.get("store").getQuery(n,e.SearchMessageList,{filter:t,mailboxId:i,isGlobal:!i})}.property("search","mailboxId").nocache(),unread:0,visibleChildrenCount:0,unreadChildrenCount:0,isCollapsed:!1,isDisabled:!1,isHidden:!1,isHiddenDidChange:e.Mailbox.prototype.isHiddenDidChange,filter:function(e){this.set("isHidden",!!e&&!e.test(this.get("displayName")))},parent:function(){return this.get("store").getRecord(e.Mailbox,this.get("mailboxId"))}.property("mailboxId"),parentDidChange:e.Mailbox.prototype.parentDidChange,depth:function(){var e=this.get("parent");return e?e.get("depth")+1:0}.property("parent"),precedence:function(){return this.get("mailboxId")?-100:2147483647}.property("mailboxId")});e.api.mail.handle(n,{fetch:"getSavedSearches",commit:"setSavedSearches",savedSearches:function(e){this.didFetch(n,e,!0)},savedSearchesSet:function(e){this.didCommit(n,e)}}),e.SavedSearch=n}(FastMail),function(e){var t=O.Class({init:function(e,t,i){this.day=e||0,this.month=t||0,this.year=i||0},toJSON:function(){return"%'04n-%'02n-%'02n".format(this.year,this.month,this.day)},hasValue:function(){return!!(this.day||this.month||this.year)},yearsAgo:function(){if(!this.year)return-1;var e=new Date,t=e.getFullYear()-this.year,i=e.getMonth(),n=(this.month||1)-1;return(n>i||n===i&&this.day>e.getDate())&&(t-=1),t},prettyPrint:function(){var e=this.day,t=this.month,i=this.year,n=O.i18n.get("dateElementOrder"),s=e?e+(i&&"mdy"===n?", ":" "):"",a=t?O.i18n.get("monthNames")[t-1]+" ":"",o=i?i+" ":"";return("mdy"===n?a+s+o:"ymd"===n?o+a+s:s+a+o).trim()}}).extend({fromJSON:function(e){var i=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e||"");return i?new t(+i[3],+i[2],+i[1]):null}});e.AmbiguousDate=t}(FastMail),function(e){e.api.contacts=new e.APIConnection({id:"contacts"}),e.source.addSource(e.api.contacts)}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,contactId:i(String,{isPrimaryKey:!0}),groups:function(){var t=this.get("storeKey");return this.get("store").getAll(e.ContactGroup,function(e){var i=e.contactIds;return!!i&&i.contains(t)},O.sortByProperties(["name"]))}.property().nocache(),isShared:i(Boolean,{defaultValue:!1}),isFlagged:i(Boolean,{defaultValue:!1}),importance:i(Number,{defaultValue:0}),title:i(String,{defaultValue:""}),firstName:i(String,{defaultValue:""}),lastName:i(String,{defaultValue:""}),nickname:i(String,{defaultValue:""}),birthday:i(e.AmbiguousDate,{defaultValue:new e.AmbiguousDate(0,0,0)}),company:i(String,{defaultValue:""}),department:i(String,{defaultValue:""}),position:i(String,{defaultValue:""}),defaultEmailIndex:i(Number,{defaultValue:0}),emails:i(Array,{defaultValue:[]}),phones:i(Array,{defaultValue:[]}),online:i(Array,{defaultValue:[]}),addresses:i(Array,{defaultValue:[]}),notes:i(String,{defaultValue:""}),avatarUrl:i(String,{defaultValue:""}),destroy:function(){this.get("groups").forEach(function(e){e.get("contacts").remove(this)},this),n.parent.destroy.call(this)},isEditable:function(){return e.auth.get("canWriteSharedContacts")||!this.get("isShared")}.property(),name:function(){var e=(this.get("firstName")+" "+this.get("lastName")).trim();return e||(e=this.get("company")),e}.property("firstName","lastName","company"),emailName:function(){var e=this.get("name").replace(/["\\]/g,"");return/[,;<>@()]/.test(e)&&(e='"'+e+'"'),e}.property("name"),defaultEmail:function(){var e,t=this.get("emailName"),i=this.get("emails");return i&&i.length?(e=i[this.get("defaultEmailIndex")].value,t?t+" <"+e+">":e):""}.property("emailName","emails","defaultEmailIndex"),avatar:function(t){if(!t&&e.preferences.get("showAvatar")){var i,n=this.get("emails").map(function(e){return e.value}),s=this.get("defaultEmailIndex");s&&n.length&&(i=n[0],n[0]=n[s],n[s]=i),new e.AvatarFinder(this,n,this.get("avatarUrl"),function(e){var t,i;for(t=0,i=e.length;t<i;t+=1)if("twitter"===e[t].type)return e[t].value;return null}(this.get("online"))),t=null}return t}.property("avatarUrl","emails","defaultEmailIndex","online"),avatarWasFound:function(e){this.set("avatar",e)},getBirthdayEvent:function(t){var i=this.get("birthday").year,n=i?t.getUTCFullYear()-i:0;return n<0||n>120?null:new e.BirthdayEvent({__guid__:this.get("storeKey")+t.toJSON(),contact:this,summary:O.loc(1397,this.get("name"),n?O.i18n.ordinal(n):""),utcStart:t,utcEnd:new Date(t).add(1)})}});e.api.contacts.handle(n,{precedence:0,fetch:function(e){e||this.callMethod("getContacts")},refresh:function(e,t){e?this.callMethod("getContacts"):this.callMethod("getContactUpdates",{state:t})},commit:"setContacts",contacts:function(e){this.didFetch(n,e,!0)},contactUpdates:function(e){var t=this.get("store");e.added&&t.sourceDidFetchRecords(n,e.added),e.changed&&(t.sourceDidFetchPartialRecords(n,e.changed),e.changed=null),this.didFetchUpdates(n,e)},contactsSet:function(e){this.didCommit(n,e)}}),e.Contact=n}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.ValidationError,s=n.REQUIRED,a=n.FIRST_CUSTOM_ERROR,o=O.Class({Extends:t,groupId:i(String,{isPrimaryKey:!0}),isShared:i(Boolean,{defaultValue:!1}),name:i(String,{defaultValue:"",validate:function(t,i,o){if(!t)return new n(s,O.loc(2));var r=null,l=o.get("store").getAll(e.ContactGroup);return l.some(function(e){return e!==o&&e.get("name")===t})&&(r=new n(a,O.loc(1120,t))),l.destroy(),r}}),contacts:t.toMany({recordType:e.Contact,key:"contactIds",defaultValue:[],willSet:function(){return!0}}),contactIndex:function(){var e,t,i=this.contacts.getRaw(this,"contacts"),n={};for(e=0,t=i.length;e<t;e+=1)n[i[e]]=!0;return n}.property("contacts"),contains:function(e){return!!this.get("contactIndex")[e.get("storeKey")]},displayName:function(){return this.get("name")+" ("+O.loc(48)+")"}.property("name"),nameAndEmail:function(){return this.get("contacts").filter(function(e){return!!e.get("defaultEmail").trim()}).sort(function(e,t){var i=e.get("defaultEmail"),n=t.get("defaultEmail");return i<n?-1:i>n?1:0}).map(function(e){return e.get("defaultEmail")}).join(", ")}.property().nocache()});e.api.contacts.handle(o,{precedence:1,fetch:"getContactGroups",refresh:"getContactGroups",commit:"setContactGroups",contactGroups:function(e){e.list?this.didFetch(o,e,!0):this.didFetchUpdates(o,{oldState:e.state,newState:e.state})},contactGroupUpdates:function(e){var t=this.get("store");e.added&&t.sourceDidFetchRecords(o,e.added),e.changed&&(t.sourceDidFetchPartialRecords(o,e.changed),e.changed=null),this.didFetchUpdates(o,e)},contactGroupsSet:function(e){this.didCommit(o,e)}}),e.ContactGroup=o}(FastMail),function(e,t){var i=O.Record,n=i.attr,s=e.isApp&&O.UA.isIOS&&window.webkit.messageHandlers||null,a=function(e){s&&s.setPreferences&&s.setPreferences.postMessage({enableConversations:e.get("enableConversations")})},o=O.Class({Extends:i,useSystemFont:n(Boolean,{defaultValue:!1}),enableKBShortcuts:n(Boolean,{defaultValue:!0}),enableConversations:n(Boolean,{defaultValue:!0}),deleteEntireConversation:n(Boolean,{defaultValue:!0}),showDeleteWarning:n(Boolean,{defaultValue:!0}),_showSidebar:n(Boolean,{key:"showSidebar",defaultValue:!0}),_showReadingPane:n(Boolean,{key:"showReadingPane",defaultValue:!0}),_may2Pane:!O.UA.isIOS||O.bind(e,"views.mainWindow*pxWidth",function(e){return e>768}),_may3Pane:!O.UA.isIOS||O.bind(e,"views.mainWindow*pxWidth",function(e){return e>1024}),showSidebar:function(e){return void 0!==e?this.set("_showSidebar",e):e=this.get("_showSidebar"),e&&this.get("_may2Pane")&&(!O.UA.isIOS||!this.get("showReadingPane")||this.get("_may3Pane"))}.property("_showSidebar","_showReadingPane","_may2Pane","_may3Pane"),showReadingPane:function(e){return void 0!==e?this.set("_showReadingPane",e):e=this.get("_showReadingPane"),e&&this.get("_may2Pane")}.property("_showReadingPane","_may2Pane"),showPreview:n(Boolean,{defaultValue:!0}),showAvatar:n(Boolean,{defaultValue:!1}),afterActionGoTo:n(String,{defaultValue:"mailbox"}),viewTextOnly:n(Boolean,{defaultValue:!1}),allowExternalContent:n(String,{defaultValue:"always"}),extraHeaders:n(Array,{defaultValue:[]}),autoSaveContacts:n(Boolean,{defaultValue:!0}),replyFromDefault:n(Boolean,{defaultValue:!1}),defaultReplyAll:n(Boolean,{defaultValue:!0}),composeInHTML:n(Boolean,{defaultValue:!0}),replyInOrigFormat:n(Boolean,{defaultValue:!1}),defaultFont:n(String,{defaultValue:null}),defaultSize:n(Number,{defaultValue:null}),defaultColour:n(String,{defaultValue:null}),sigPositionOnReply:n(String,{defaultValue:"after"}),sigPositionOnForward:n(String,{defaultValue:"before"}),replyQuoteAs:n(String,{defaultValue:"quote"}),forwardQuoteAs:n(String,{defaultValue:"inline"}),replyAttribution:n(String,{defaultValue:""}),contactsSort:n(String,{defaultValue:"firstName"}),defaultStyle:function(){var t=this.get("defaultFont"),i=this.get("defaultSize"),n=this.get("defaultColour");return i&&"largefont"===e.userPrefs.get("theme")&&(i=Math.round(16/13*i)),(t?"font-family:"+t+";":"")+(i?"font-size:"+i+"px;":"")+(n?"color:"+n+";":"")}.property("defaultFont","defaultSize","defaultColour"),enableConversationsDidChange:function(){this.get("store").getAll(e.Mailbox).forEach(function(e){e.computedPropertyDidChange("useConversations")}),a(this)}.observes("enableConversations")});e.api.mail.handle(o,{precedence:3,fetch:"getClientPreferences",update:function(t,i,n){var s=Object.filter(i[0],n[0]);this.callMethod("setClientPreferences",s,function(){e.store.sourceDidCommitUpdate(t)})},clientPreferences:function(e){e.id="singleton";var t=this.get("store").sourceDidFetchRecords(o,[e]).getRecord(o,"singleton");a(t)},clientPreferencesSet:function(t){for(var i,n,s=t.changed,a=s.length,o=this.get("store");a--;)switch(s[a]){case"enableConversations":e.isOutdated=!0;break;case"viewTextOnly":case"extraHeaders":for(n=(i=o.findAll(e.MessageDetails)).length;n--;)o.unloadRecord(i[n])}}}),e.ClientPreferences=o}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,used:i(Number,{defaultValue:0}),total:i(Number,{defaultValue:1e3}),percentage:function(){return Math.round(100*this.get("used")/this.get("total"))}.property("used","total"),available:function(){return this.get("total")-this.get("used")}.property("used","total")});e.api.mail.handle(n,{fetch:"getMailboxQuota",mailboxQuota:function(e){e.id="mailQuota",this.get("store").sourceDidFetchRecords(n,[e])}}),e.Quota=n}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,remoteServices:i(Object,{defaultValue:{}}),displayName:i(String),language:i(String),timeZone:i(O.TimeZone,{defaultValue:null}),use24hClock:i(String,{defaultValue:""}),theme:i(String),enableNewsletter:i(Boolean),defaultPersonality:t.toOne({Type:e.Personality,key:"defaultPersonalityId"}),useDefaultFromOnSMTP:i(Boolean,{defaultValue:!1}),excludeContactsFromBlacklist:i(Boolean,{defaultValue:!0}),defaultPersonalityDidChange:function(e,t,i){i&&(i.computedPropertyDidChange("isDefault"),this.get("defaultPersonality").computedPropertyDidChange("isDefault"))}.observes("defaultPersonality"),checkDefaultPersonality:function(){var t=this.get("store"),i=this.get("defaultPersonality");i&&i.is(O.Status.READY)||this.set("defaultPersonality",t.getOne(e.Personality)||new e.Personality(t).set("isDeletable",!1).set("email",e.auth.get("username")).set("saveSentTo",t.getRecord(e.Mailbox,e.systemFolderIds.get("sent"))).saveToStore())}.queue("middle"),updateTimeFormat:function(){var e=O.i18n.getLocale(),t=this.get("use24hClock");"yes"===t&&(e.use24hClock=!0),"no"===t&&(e.use24hClock=!1)}.observes("use24hClock")});e.api.mail.handle(n,{precedence:3,fetch:"getUserPreferences",update:function(t,i,n){var s=Object.filter(i[0],n[0]);this.callMethod("setUserPreferences",s,function(){e.store.sourceDidCommitUpdate(t)})},userPreferences:function(e){e.id="singleton",this.get("store").sourceDidFetchRecords(n,[e]).getRecord(n,"singleton").checkDefaultPersonality()},userPreferencesSet:function(t){t.changed.contains("language")&&e.base.forceReload()}}),e.UserPreferences=n}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,isEnabled:i(Boolean,{defaultValue:!1}),fromDate:i(Date),toDate:i(Date),subject:i(String),textBody:i(String),htmlBody:i(String),isToContactsOnly:i(Boolean),hasDates:function(e){return!1===e?this.set("fromDate",null).set("toDate",null):void 0===e&&(e=!(!this.get("fromDate")&&!this.get("toDate"))),e}.property("fromDate","toDate"),isActive:function(){var e=Date.now(),t=this.get("fromDate"),i=this.get("toDate");return this.get("isEnabled")&&(!t||t<=e)&&(!i||i>e)}.property("isEnabled","fromDate","toDate"),checkIsActive:function(){this.get("isEnabled")?e.base.heartbeat.register(this):e.base.heartbeat.deregister(this)}.observes("isEnabled"),nowNeedsRedraw:function(){this.computedPropertyDidChange("isActive")}});e.api.mail.handle(n,{precedence:3,fetch:"getVacationResponse",update:function(t,i,n){var s=Object.filter(i[0],n[0]);this.callMethod("setVacationResponse",s,function(){e.store.sourceDidCommitUpdate(t)})},vacationResponse:function(e){e.id="singleton",this.get("store").sourceDidFetchRecords(n,[e]).getRecord(n,"singleton")},vacationResponseSet:function(){}}),e.VacationResponse=n}(FastMail),function(e){Date.prototype.toJSON=function(){var e=this.getUTCFullYear(),t=this.getUTCMonth()+1,i=this.getUTCDate(),n=this.getUTCHours(),s=this.getUTCMinutes(),a=this.getUTCSeconds();return(e<1e3?"0"+(e<100?"0"+(e<10?"0":""):"")+e:""+e)+"-"+(t<10?"0"+t:""+t)+"-"+(i<10?"0"+i:""+i)+"T"+(n<10?"0"+n:""+n)+":"+(s<10?"0"+s:""+s)+":"+(a<10?"0"+a:""+a)};var t=e.store=new O.Store({source:e.source});e.gc=new O.MemoryManager(t,[{Type:e.MessageHeader,max:1200,afterCleanup:function(e){var i={};e.forEach(function(e){var n,s=e.mailboxId;i[s]||(i[s]=!0,(n=t.getQuery(s))&&n.recalculateFetchedWindows())})}},{Type:e.MessageDetails,max:200},{Type:e.ConversationDetails,max:1e3},{Type:e.MailboxMessageList,max:5},{Type:e.ConversationMessageList,max:200}],6e4);var i=e.localPrefs=new O.LocalStorage("preferences");i.get("sidebarWidth")||(i.sidebarWidth=190),i.get("listPaneWidth")||(i.listPaneWidth=320),i.get("enableNotifications")||(i.enableNotifications=!1),i.get("notificationsFilter")||(i.notificationsFilter=""),e.userPrefs=t.getRecord(e.UserPreferences,"singleton"),e.preferences=t.getRecord(e.ClientPreferences,"singleton"),e.vacationResponse=t.getRecord(e.VacationResponse,"singleton"),e.personalities=e.store.getQuery("allPersonalities",O.LiveQuery,{Type:e.Personality,sort:function(e,t){var i=e.displayName||e.name,n=t.displayName||t.name;return O.i18n.compare(i,n)||O.i18n.compare(e.email,t.email)}}),e.sortFolders=function(e,t){if(e===t)return 0;if(e.get("parent")!==t.get("parent")){for(var i,n,s=[e],a=[t],o=e;o=o.get("parent");){if(o===t)return 1;s.push(o)}for(o=t;o=o.get("parent");){if(o===e)return-1;a.push(o)}for(i=s.length,n=a.length;i--&&n--&&(e=s[i])===(t=a[n]););}return e.get("precedence")-t.get("precedence")||O.i18n.compare(e.get("displayName"),t.get("displayName"))||(e.get("id")<t.get("id")?-1:1)},e.rootMailboxes=e.store.getQuery("rootMailboxes",O.LiveQuery,{Type:e.Mailbox,filter:function(e){return!e.parentId},sort:["precedence","name"]}),e.allMailboxes=new O.ObservableArray(null,{content:e.store.getQuery("allFolders",O.LiveQuery,{Type:e.Mailbox}),contentDidChange:function(){var t=this.get("content").get("[]");return t.sort(e.sortFolders),this.set("[]",t)}}).contentDidChange(),e.allSavedSearches=new O.LiveQuery({store:e.store,Type:e.SavedSearch,sort:["name","search"]}),e.allMailboxesAndSearches=new O.ObservableArray(null,{contentDidChange:function(){var t=e.store.getQuery("allFolders"),i=e.allSavedSearches,n=t.get("[]").concat(i.get("[]"));return n.sort(e.sortFolders),this.set("[]",n)}.queue("before")}).contentDidChange(),e.store.on(e.Mailbox,e.allMailboxes,"contentDidChange").on(e.Mailbox,e.allMailboxesAndSearches,"contentDidChange").on(e.SavedSearch,e.allMailboxesAndSearches,"contentDidChange"),e.systemFolderIds=new O.Object({foldersDidChange:function(){e.rootMailboxes.forEach(function(e){var t=e.get("role");t&&this.set(t,e.get("id"))},this)}}),e.rootMailboxes.addObserverForKey("[]",e.systemFolderIds,"foldersDidChange");var n=new O.Object({index:null,clearIndex:function(){this.index=null},buildIndex:function(){var i,n,s,a,o,r=this.index={},l=e.Contact,c=t.findAll(l);for(i=0,n=c.length;i<n;i+=1)for(o=(a=(s=t.materialiseRecord(c[i],l)).get("emails")).length;o--;)r[a[o].value.toLowerCase()]=s;return r},getIndex:function(){return this.index||this.buildIndex()}});t.on(e.Contact,n,"clearIndex"),e.getContactFromEmail=function(e){return n.getIndex()[e.toLowerCase()]||null}}(FastMail),function(e,t){var i=O.UA.cssProps.transform3d?{transform:"translate3d(0,100%,0)"}:{marginTop:40},n=O.UA.cssProps.transform3d?{transform:"translate3d(0,0,0)"}:{marginTop:0},s=O.Class({Extends:O.View,Mixin:O.AnimatableView,init:function(e){this._timer=null,this._controller=null,s.parent.init.call(this,e)},animateLayerDuration:200,ariaAttributes:{live:"polite"},className:function(){return"v-Notification"+(this.get("userMayClose")?" v-Notification--closable":"")}.property("userMayClose"),positioning:"absolute",destroyOnClose:!0,isShowing:!1,userMayClose:!0,precedence:0,timeout:0,text:"",html:"",show:function(e){this._controller=e,this.get("isShowing")&&this.hide(!0),e.get("rootView").insertView(this),this._show();var t=this.get("timeout");return t&&(this._timer=O.RunLoop.invokeAfterDelay(this.hide,t,this)),this.set("isShowing",!0)},_show:function(){this.get("isShowing")&&this.set("layout",n)}.nextLoop(),hide:function(e){if(this.get("isShowing")){var t=O.meta(this).cache.layerAnimation;!1!==e&&t&&this.get("layout")!==i?(t.stop(),this.set("layout",i)):this.detach(),this._timer&&(O.RunLoop.cancel(this._timer),this._timer=null),this.set("isShowing",!1)}return this},didAnimate:function(){this.increment("animating",-1),this.get("animating")||(this.get("isShowing")?O.RunLoop.queueFn("render",this.redraw,this):this.detach())},detach:function(){var e=this._controller;return e.get("rootView").removeView(this),e.notificationDidHide(this),this._controller=null,this.get("destroyOnClose")&&this.destroy(),this},layout:i,draw:function(e,t,i){return i("div.v-Notification-content",[this.drawNotification(e,t,i),this.get("userMayClose")?this._close=i("a.v-Notification-close",[i("i.icon.icon-close"),O.loc(29)]):null])},drawNotification:function(e,t,i){var n=this.get("text"),s=this.get("html");if(n||s)return this._textNode=i("span",{text:n||void 0,html:n?void 0:s})},redraw:function(){if(!this.get("animating"))return s.parent.redraw.call(this)},notificationNeedsRedraw:function(e,t,i){return this.propertyNeedsRedraw(e,t,i)}.observes("text","html"),redrawText:function(){this.redrawHTML()},redrawHTML:function(){var e=this.get("text"),t=this.get("html");this._textNode.set(t?"html":"text",t||e)},hideOnClick:function(e){this.get("userMayClose")&&O.Element.contains(this._close,e.target)&&(e.preventDefault(),this.hide())}.on("click")}),a=O.Class({Extends:O.Object,init:function(e){this._waiting=null,this.showing=null,a.parent.init.call(this,e)},willShow:function(e){var t=this.get("showing"),i=this._waiting;return!t||(e!==t&&(e.get("precedence")<t.get("precedence")?e.get("destroyOnClose")&&e.destroy():e!==i&&(this._waiting=e,i&&i.get("destroyOnClose")&&i.destroy(),this.hide(t))),!1)},show:function(e,t,i){var n=e instanceof s?e:new s({text:e,timeout:t||0,userMayClose:!!i});return this.willShow(n)&&(this.set("showing",n),n.show(this)),n},hide:function(e){var t=this.get("showing"),i=this._waiting;return!t||e&&e!==t?e&&e===i&&(this._waiting=null,i.get("destroyOnClose")&&i.destroy()):t.hide(),this},notificationDidHide:function(e){if(e===this.get("showing")){this.set("showing",null);var t=this._waiting;t&&(this._waiting=null,this.show(t))}}});e.NotificationsController=a,e.NotificationView=s}(FastMail),function(e){var t=O.Class({Extends:e.NotificationView,init:function(e){t.parent.init.call(this,e);var i=this.undoTarget;i&&i.on("input",this,"hide").on("undo",this,"hide").on("redo",this,"hide")},destroy:function(){var e=this.undoTarget;e&&e.off("input",this,"hide").off("undo",this,"hide").off("redo",this,"hide"),t.parent.destroy.call(this)},timeout:2e4,drawNotification:function(e,t,i){return[this._textNode=i("span",{text:this.get("text")+". "}),this._undo=i("a",{title:O.loc(0,O.formatKeyForPlatform("z")),text:O.loc(285)})]},undoTarget:null,undo:function(t){t.target===this._undo&&(t.preventDefault(),(this.undoTarget||e.mail.actions).undo(),e.notifications.hide(this))}.on("click")});e.UndoableNotificationView=t}(FastMail),function(e){var t=e.auth,i=function(e){return O.bind(t,"urlParam",function(){return t.authenticateUrl(e)})},n=function(){e.base.set("revealSidebar",!1)},s=e.isApp&&O.UA.isIOS&&window.webkit.messageHandlers||null,a=new O.View({draw:function(n,a,o){var r=a.when,l=a.unless,c=O.bind,u=O.Transform.isEqualToValue,d=e.isApp,h=u("pobox");return[!d&&t.get("mayUseJMAP")?o("div.v-MainMenu-banner",[o("a",{href:new O.Binding({transform:function(){return location.href.replace("&ajax=1","")+"&jmap=1"},queue:"after"}).from(e.base,"currentPath"),text:"Switch to beta JMAP UI"})]):null,d?null:r(t,"isFreeAccount").show([o("div.v-MainMenu-banner",[o("span",{html:c(t,"trialDaysRemaining",function(e){return O.loc(759,e)})}),r(t,"isAdmin").show([" ",this._upgrade=o("a",{href:i("/settings/plan")},[O.loc(832)]),"."]).end()])]).end(),o("ul.v-MainMenu-apps",[o("li",[this._mail=o("a",{title:O.loc(0,O.formatKeyForPlatform("m")),className:c(e.base,"app",function(e){return"s-nav-mail"+("mail"===e?" is-selected":"")}),href:e.base.getUrlForState({app:"mail"})},[o("i.icon.icon-envelope"),O.loc(18)])]),o("li",[this._contacts=o("a",{title:O.loc(0,O.formatKeyForPlatform("a")),className:c(e.base,"app",function(e){return"s-nav-contacts"+("contacts"===e?" is-selected":"")}),href:e.base.getUrlForState({app:"contacts"})},[o("i.icon.icon-address-book"),O.loc(17)])]),o("li",[this._calendar=o("a",{title:O.loc(0,O.formatKeyForPlatform("c")),className:c(e.base,"app",function(e){return"s-nav-calendar"+("calendar"===e?" is-selected":"")}),href:e.base.getUrlForState({app:"calendar"})},[o("i.icon.icon-calendar"),O.loc(27)])]),o("li",[this._notes=o("a",{title:O.loc(0,O.formatKeyForPlatform("n")),className:c(e.base,"app",function(e){return"s-nav-notes"+("notes"===e?" is-selected":"")}),href:e.base.getUrlForState({app:"notes"})},[o("i.icon.icon-file",{style:"font-size:18px"}),O.loc(21)])]),o("li",[this._files=o("a.s-nav-files",{title:O.loc(0,O.formatKeyForPlatform("f")),href:e.base.getUrlForState({app:"files"})},[o("i.icon.icon-cloud"),O.loc(20)])]),o("li",[this._settings=o("a",{title:O.loc(0,O.formatKeyForPlatform("s")),className:c(e.base,"app",function(e){return"s-nav-settings"+("settings"===e?" is-selected":"")}),href:e.base.getUrlForState({app:"settings"})},[o("i.icon.icon-settings"),O.loc(53)])]),d?null:r(t,"isStaff").show([o("li",[o("a",{href:i("/go/admin"),target:"_blank"},[o("i.icon.icon-users"),O.loc(47)])])]).end()]),o("ul.v-MainMenu-admin",[d&&O.UA.isIOS?null:r(t,"isAdmin").show([o("li",[this._account=o("a.s-nav-account",{title:O.loc(0,O.formatKeyForPlatform("b")),href:i("/settings/plan")},[o("i.icon.icon-credit"),O.loc(87)])])]).end(),l(t,"accountType",h).show([o("li",[this._security=o("a.s-nav-security",{href:i("/settings/security")},[o("i.icon.icon-key"),O.loc(291)])])]).end(),d?null:o("li",[this._importexport=o("a.s-nav-importexport",{href:i("/importexport/")},[o("i.icon.icon-sort"),O.loc(201)+" & "+O.loc(193)])]),d?null:r(t,"accountType",h).show([o("li",[o("a",{href:t.authenticateUrl("/go/pobox?to=/home"),target:"_blank"},[o("i.icon.icon-atom"),"Pobox"])])]).end(),d&&(O.UA.isAndroid||s&&s.showNotificationSettings)?o("li",[this._notifications=o("a",{href:"/godevice/settings"},[o("i.icon.icon-settings"),O.loc(309)])]):null,d?null:o("li",[this._help=o("a.s-nav-help",{title:O.loc(0,O.formatKeyForPlatform("?")),target:"_blank",href:c(t,"accountType",function(e){return h(e,!0)?"https://www.pobox.com/helpspot":t.authenticateUrl("/go/help")})},[o("i.icon.icon-question"),O.loc(61)])]),d||t.get("actAsUserId")?null:o("li",[this._login=o("a",{href:"/login/"},[o("i.icon.icon-users"),O.loc(69)])]),o("li",[this._logout=o("a.s-nav-logout",{title:O.loc(0,O.formatKeyForPlatform("l")),href:"/login/"},[o("i.icon.icon-switch"),t.get("actAsUserId")?O.loc(29):O.loc(430)+(/beta\./.test(e.baseDomain)?" (of beta)":/qa\./.test(e.baseDomain)?" (of qa)":"")])])])]},_linkClicked:function(i){var a,o="",r=i.target;if("I"===r.nodeName&&(r=r.parentNode),a="A"===r.nodeName,O.DOMEvent.isClickModified(i))a&&O.RunLoop.invokeInNextFrame(e.popOver.hide,e.popOver);else{if(a)switch(e.popOver.hide(),O.RunLoop.invokeInNextFrame(n),i.preventDefault(),r){case this._mail:o="mail";break;case this._contacts:o="contacts";break;case this._calendar:o="calendar";break;case this._notes:o="notes";break;case this._settings:o="settings";break;case this._files:o="files";break;case this._upgrade:case this._account:t.get("isAdmin")&&(o="settings",O.require("settings",function(){e.settings.set("pane","plan")}));break;case this._importexport:O.require("importexport",function(){e.importexport.show()});break;case this._security:o="settings",O.require("settings",function(){e.settings.set("pane","security")});break;case this._login:o="login",O.require("login",function(){e.login.getSessions().goSessions()});break;case this._logout:t.get("actAsUserId")?window.close():t.logout();break;case this._notifications:if(O.UA.isIOS){s.showNotificationSettings.postMessage({});break}default:r.target?window.open(r.href):location.href=r.href}o&&(e.base.set("app",o),e.isOutdated&&e.views.mainWindow.interceptLinks(i))}}.on("click"),keyboardShortcuts:function(e){var t;switch(O.DOMEvent.lookupKey(e)){case"m":t=this._mail;break;case"a":t=this._contacts;break;case"c":t=this._calendar;break;case"n":t=this._notes;break;case"f":t=this._files;break;case"b":t=this._account;break;case",":case"s":t=this._settings;break;case"?":t=this._help;break;case"l":t=this._logout}t&&(this.fire("click",{target:t}),e.stopPropagation())}});a=new O.ScrollView({positioning:"relative",layout:{},className:"v-MainMenu",childViews:[a],keypress:function(t){e.preferences.get("enableKBShortcuts")&&this.get("childViews")[0].keyboardShortcuts(t)}.on("keypress")});var o=O.Class({Extends:O.View,actAsUserId:O.bind(t,"actAsUserId"),selected:"",allowTextSelection:!0,className:function(){return"app-toolbar"+(this.get("actAsUserId")?" is-overridden":"")}.property("actAsUserId"),positioning:"absolute",username:O.bind(t,"username",function(e){return e.replace(/\*/g,"").replace(/\./g,"⥷")}),showAvatar:O.bind(e.preferences,"showAvatar"),updateBinding:function(){var t=this._imgBinding;t&&t.disconnect().from(e.AvatarManager,this.get("showAvatar")&&this.get("username")||"_").connect()}.observes("username","showAvatar"),name:O.bind(e.userPrefs,"displayName"),draw:function(t,i,n){var s=this.get("showAvatar")&&this.get("username")||"_";return[new O.MenuButtonView({className:"v-MainNavToolbar",positioning:"absolute",menuView:a,popOverView:e.popOver,popOverOptions:{alignEdge:"left",offsetTop:5,offsetLeft:10,showCallout:!0,inParent:this},label:[n("img.v-MainNavToolbar-avatar",{alt:"",src:this._imgBinding=O.bind(e.AvatarManager,s,function(t){return t?t.replace(/s=([48])0/,"s=$1$1"):"minimal"===e.theme.get("theme")?"/static/images/logo-icon-blue.png":"/static/images/logo-icon-white.png"})}),n("div.v-MainNavToolbar-appName",{text:O.bind(e.base,"appController.appName")}),n("div.v-MainNavToolbar-userName",{text:O.bind(this,"name")})],shortcut:"shift-g",tooltip:O.loc(822)+" \n"+O.loc(0,O.formatKeyForPlatform("shift-g"))})]},showScrollbarY:!0});e.MainNavToolbar=o}(FastMail),function(e,t,i){var n=e.auth,s=e.baseDomain;!e.isApp&&O.UA.isWKWebView&&O.require("workarounds+iossafari"),e.views={mainWindow:new O.RootView(t,{className:O.bind(e.preferences,"useSystemFont",function(e){var t=e?"t-font-system":"";return e&&(O.UA.isIOS||/OS X 10_1\d/.test(navigator.userAgent))&&(t+=" t-font-sanfrancisco"),t}),blurActive:function(){try{t.activeElement.blur()}catch(e){}},cancelSelection:(O.UA.isIOS?function(){var e,i=t.body;t.activeElement===i&&window.getSelection().rangeCount&&((e=t.createElement("input")).style.cssText="position:absolute;right:0;bottom:100%;",i.appendChild(e),e.focus(),e.blur(),i.removeChild(e))}:function(){var e=window.getSelection();e.rangeCount&&t.activeElement===t.body&&e.removeAllRanges()}).queue("after").on("tap"),userWasActive:function(){e.lastActivity=Date.now()}.on("click","keydown"),interceptLinks:function(t){if(!O.DOMEvent.isClickModified(t)){for(var a,o,r,l,c=t.target;c&&"A"!==c.nodeName;)c=c.parentNode;if(c){if(a=c.href,/^mailto:/.test(a))return t.preventDefault(),void e.base.restoreStateFromUrl("mail/compose:"+a);if(r=(o=a.indexOf("#"))>-1?a.slice(o+2):a.slice(s.length).replace(/\?.*/,""),"_blank"===c.target&&(c.rel="noreferrer"),(!c.getAttribute("href")||/^file:/.test(a)||0===a.indexOf(s)&&e.base.pathIsAjax(r))&&("_blank"!==c.target&&t.preventDefault(),e.isOutdated&&!e.base.get("warnOnUnload")&&!e.api.hasInFlightChanges()&&(!(l=O.getFromPath(e,"mail.screens.compose"))||!l.get("instanceCount")))){var u,d=O.RunLoop._queues;for(u in d)d[u].length=0;e.base.useHash?(a=n.authenticateUrl(i.protocol+"//"+i.host+i.pathname+"#/"+r),i.assign(a),i.reload()):i.assign(a)}}}}.on("click")})};var a=O.RichTextView.prototype.fontSizeOptions(),o=a.map(function(e){var t=e[1];return t?(t=Math.round(16/13*parseInt(t,10))+"px",[e[0],t]):e}),r=O.RichTextView.prototype.fontSizeMenuView;O.RichTextView.implement({fontSizeOptions:function(){var t="largefont"===e.theme.get("theme"),i=t?o:a,n=e.preferences.get("defaultSize");return n&&this instanceof O.RichTextView&&(t&&(n=Math.round(16/13*n)),i=i.map(function(e){var i=e[1],s=i?parseInt(i,10):t?16:13;return i=s===n?null:s+"px",[e[0],i]})),i}.property().nocache(),fontSizeMenuView:function(){var t=r.call(this),i=e.preferences.get("defaultSize");return i&&t.set("layout",{fontSize:i+"px"}),t}.property(),editorClassName:"u-article",stopClick:function(e){e.stopPropagation()}.on("click")},!0),e.AriaHiddenIfOffScreen=null;var l=e.theme.queue,c=e.defaultTheme;e.theme=new O.ThemeManager({theme:c,_theme:c,_themeDidChange:function(t,i,n,s){var a,o,r,l,u,d,h=function(e){return/-/.test(e)?s+"-"+e.split("-")[1]:e},g=O.loader.modules,p=[];if(s===c||!g[s+"-base"])return this.set("theme",c);for(a in g)o=g[a],/-/.test(a)?(u=a.split("-"))[0]===c&&(d=o.callbacks,g[s+"-"+u[1]].callbacks=d,o.callbacks=null):(r=o.dependencies,o.dependencies=r&&r.map(h),l=s+"-"+a,o.status&&g[l]&&p.push(l));e.Calendar&&e.store.getAll(e.Calendar).forEach(function(e){e.computedPropertyDidChange("foregroundColour").computedPropertyDidChange("backgroundColour")}),c=s,O.require(p,function(){var e=this._theme;e!==s&&this.get("theme")===s&&(this.changeTheme(e,s),this._theme=s)},this)}.observes("theme"),getSVG:function(e){var t=this.getImageSrc(e);try{return(new DOMParser).parseFromString(t,"image/svg+xml").getElementsByTagName("svg")[0]}catch(e){}return null},unloadUnused:function(){var e,t=this._styles,i=this._images,n=this.get("theme"),s=O.loader.modules;for(e in this._styles={},this._styles[n]=t[n],this._images={all:i.all},this._images[n]=i[n],s)/-/.test(e)&&e.split("-")[0]!==n&&(s[e].status=0)},stylesheetDidLoad:function(e,t,i){return O.UA.isIOS&&(i=i.replace(/:hover/g,":active")),O.ThemeManager.prototype.stylesheetDidLoad.call(this,e,t,i)}}),l.forEach(function(t){e.theme[t[0]?"stylesheetDidLoad":"imageDidLoad"](t[1],t[2],t[3])}),e.theme.registerBinding(O.bind(e.userPrefs,"theme").to("theme",e.theme).connect()),e.theme.addStylesheet("base"),8===O.UA.msie?O.require("iconseot"):O.UA.safari&&O.UA.safari<5.1?O.require("iconsttf"):O.require("iconswoff"),e.canSetFocus=!O.UA.isWKWebView||e.isApp;var u,d,h,g,p,f="";O.UA.cssProps["box-shadow"]||(f+=" noBoxShadow"),O.UA.isIOS&&(f+=" iOS",(e.isApp||navigator.standalone)&&(f+=" iOS-hasStatusBar",t.body.appendChild(O.Element.create("div#iOS-statusBar")))),O.UA.isAndroid&&(f+=" android"),t.documentElement.className+=f,O.UA.isWin&&O.UA.chrome&&(t.body.style.textRendering="auto"),e.views.mainWindow.insertView(O.Element.when(n,"globalBanner").show([new O.View({className:"v-GlobalBanner",positioning:"absolute",layerTag:"a",text:O.bind(n,"globalBanner"),draw:function(e){return e.href=n.get("isAdmin")?n.authenticateUrl("/settings/plan"):n.authenticateUrl("/help/account/accountexpired.html"),[this.get("text")]},viewNeedsRedraw:function(){this.propertyNeedsRedraw(this,"layer")}.observes("text"),click:function(t){t.preventDefault(),n.get("isAdmin")?(O.require("settings",function(){e.settings.set("pane","plan")}),e.base.set("app","settings")):O.WindowController.openExternal(this.get("layer").href)}.on("click")})]).end(),null,"top"),e.notifications=new e.NotificationsController({rootView:e.views.mainWindow}),u=new e.NotificationView({userMayClose:!1,destroyOnClose:!1,timeToReconnect:0,drawNotification:function(e,t,i){return[i("span",[i("span",{text:O.bind(n,"isRenaming",function(e){return e?O.loc(1390):O.loc(50)})})," ",i("span",{role:"timer",text:O.bind(this,"timeToReconnect",function(e){return O.loc(1164,e)})})," "]),this._retry=i("a",{text:O.loc(1095)}),"."]},retry:function(e){e.target===this._retry&&n.retryConnections()}.on("click")}),d=new e.NotificationView({userMayClose:!1,destroyOnClose:!1,text:O.loc(1128)}),new O.Object({isDisconnected:O.bind(n,"isDisconnected"),timeToReconnect:O.bind(n,"timeToReconnect"),showHide:function(){var t,i=this.get("isDisconnected"),s=this.get("timeToReconnect"),a=n.get("isUnloading");i&&!a?(s?(t=u,u.set("timeToReconnect",s)):t=d,e.notifications.show(t)):e.notifications.hide(d).hide(u)}.observes("isDisconnected","timeToReconnect")}),g=0,p={account:!0,deletewarning:!0,filestorage:!0,importexport:!0,searchbuilder:!0,verify:!0},O.loader.on("loader:willLoadModule",function(t){p[t.module]&&(g||h||(h=new e.NotificationView({userMayClose:!1,text:O.loc(13)+"…",precedence:-10}),e.notifications.show(h)),g+=1)}).on("loader:didLoadModule",function(t){p[t.module]&&!(g-=1)&&h&&(e.notifications.hide(h),h=null)}),e.popOver=new O.PopOverView({adjustPositionAfter:function(){if(this.get("isVisible")){var e=this.get("layout").top,t=this._deltaTop||0;this.adjustPosition(0,-t),this._deltaTop=this.get("layout").top-e+t}}.queue("after"),willEnterDocument:function(){return e.views.mainWindow.addObserverForKey("pxHeight",this,"adjustPositionAfter"),O.PopOverView.prototype.willEnterDocument.call(this)},willLeaveDocument:function(){return e.views.mainWindow.removeObserverForKey("pxHeight",this,"adjustPositionAfter"),O.PopOverView.prototype.willLeaveDocument.call(this)}})}(FastMail,document,location),function(e,t,i){var n=e.auth.get("actAsCustomerId");e.keyboardShortcuts=new O.GlobalKeyboardShortcuts({isEnabled:O.bind(e.preferences,"enableKBShortcuts")}),e.loading=new O.Object({app:"loading",title:O.loc(13)+"…",layer:t.getElementById("bootstrap-page"),enter:function(){t.body.appendChild(this.layer)},exit:function(){var e=this.layer;e.parentNode.removeChild(e)},goUp:function(){return!1},_loadingTemplate:t.querySelector("#bootstrap-page .LoadingAnimation"),createLoadingEl:function(){return this._loadingTemplate.cloneNode(!0)}}),e.LoadingView=O.Class({Extends:O.View,className:"fill-parent",positioning:"absolute",draw:function(){return e.loading.createLoadingEl()}}),e.appName=t.getElementById("appname").getAttribute("content");var s,a=new O.Router({title:O.bind(null,"appController.title",function(i){return i=i?i+" | ":"",(i+=e.appName||"")||t.title}),actAsCustomerId:n,routes:n?[{url:/^settings\/(.*)/,handle:function(t,i){O.require("settings",function(){e.settings.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","settings")}},{url:/.*/,handle:function(){this.set("replaceState",!0),this.set("app","settings")}}]:[{url:/^login/,handle:function(){this.closeModals(),this.set("app","login")}},{url:/^mail\/(.*)/,handle:function(t,i){O.require("mail",function(){e.mail.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","mail")}},{url:/^contacts\/(.*)/,handle:function(t,i){O.require("contacts",function(){e.contacts.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","contacts")}},{url:/^calendar\/(.*)/,handle:function(t,i){O.require("calendar",function(){e.calendar.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","calendar")}},{url:/^notes\/(.*)/,handle:function(t,i){O.require("notes",function(){e.notes.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","notes")}},{url:/^settings\/(.*)/,handle:function(t,i){O.require("settings",function(){e.settings.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","settings")}},{url:/^importexport\//,handle:function(){"loading"===this.get("app")&&this.set("app","mail"),O.require("importexport",function(){e.importexport.show()})}},{url:/^verify\//,handle:function(){"loading"===this.get("app")&&this.set("app","mail"),O.require("verify",function(){e.verify.show()})}},{url:/^account\//,handle:function(){this.set("replaceState",!0),O.require("settings",function(){e.settings.set("pane","plan")}),this.closeModals(),this.set("app","settings")}},{url:/^security\//,handle:function(){this.set("replaceState",!0),O.require("settings",function(){e.settings.set("pane","security")}),this.closeModals(),this.set("app","settings")}},{url:/^files\/(.*)/,handle:function(t,i){this.set("replaceState",!0),O.require("files",function(){e.files.restoreStateFromUrl(i)}),this.closeModals(),this.set("app","files")}},{url:/.*/,handle:function(){this.set("replaceState",!0),this.set("app","mail")}}],getUrlForState:function(t){return e.auth.authenticateUrl((this.useHash?"#/":this.baseUrl)+this.encode(t))},getUrlForEncodedState:function(t){return e.auth.authenticateUrl(this.baseUrl+t)},encode:function(t){var i,n=t.app,s="";return"loading"!==n&&(s=n+"/",(i=e[n])&&(s+=i.encode(t))),s},appEncodedState:O.bind("appController.encodedState"),encodedState:function(){var t=this.get("appController");return t===e.loading?this.get("currentPath"):this.encode(t)}.property("appController","appEncodedState"),pathIsAjax:function(e){var t,i,n=this.routes;for(t=0,i=n.length-1;t<i;t+=1)if(n[t].url.test(e))return!0;return!1},app:"loading",revealSidebar:!1,showSidebar:function(){this.set("revealSidebar",!0)},hideSidebar:function(){this.set("revealSidebar",!1)},sidebarEventHandler:new O.ModalEventHandler({view:null}),setHandler:function(t,i,n,s){var a=this.get("sidebarEventHandler"),o=O.ViewEventsController;s?(a.set("view",e.views[this.get("app")+"Sidebar"]),o.addEventTarget(a,10)):(a.set("view",null),o.removeEventTarget(a))}.observes("revealSidebar"),warnOnUnload:0,forceReload:function(t){setTimeout(function(){e.base.set("warnOnUnload",0),t?i.assign(t):i.reload()},0)},closeModals:function(){for(var e=this.get("appControllerStack");e.get("length")>1;)e.last().hide()},appControllerStack:new O.ObservableArray([e.loading]),appController:function(){return this.get("appControllerStack").last()}.property("appControllerStack.[]"),appDidChange:function(t,i,n,s){if("login"!==n||e.auth.get("isAuthenticated")){if("settings"!==s&&e.auth.get("isAdmin")&&!e.auth.get("actAsUserId")&&e.auth.get("isLoginBlocked"))return O.require("settings",function(){e.settings.set("pane","plan")}),void this.set("app","settings");O.require(s,function(){this.get("app")===s&&this.switchToApp(s)},this)||this.switchToApp("loading")}else this.set("app",n)}.observes("app"),goUp:function(){var e,t;return this.get("revealSidebar")?(this.hideSidebar(),e=!0):(t=this.get("appControllerStack")).get("length")>1?(t.last().hide(),e=!0):e=t.last().goUp(),O.RunLoop.invoke(function(){}),e},switchToApp:function(t){var i=e[t],n=this.get("appControllerStack"),s=n.getObjectAt(0);s!==i&&(s.exit(),i.enter(),n.setObjectAt(0,i))},notifyAppChanged:e.isApp&&O.UA.isWKWebView?function(){window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.urlStateChange&&window.webkit.messageHandlers.urlStateChange.postMessage({url:this.getUrlForEncodedState(this.get("encodedState"))})}.observes("encodedState"):null});if(e.base=a,!/^\/signup\//.test(i.pathname)){try{var o=JSON.parse(t.getElementById("bootstrap-page").getAttribute("data-sessions"));o&&e.auth.didFetchSessions(o)}catch(e){}e.auth.get("isAuthenticated")||e.auth.authenticate()}new O.Object({go:function(t,i){t&&t.removeObserverForKey(i,this,"go"),e.auth.get("isAuthenticated")?this.preload():e.auth.addObserverForKey("isAuthenticated",this,"go")},preload:function(){e.auth.get("isVerified")||(O.loader.prefetch("verify"),e.country||e.api.peripheral.callMethod("getCountryFromIP",{},function(t){e.country=t[0][1].country})),this.destroy()}}).go(),s=Date.now(),e.api.mail.addCallback(function(){var t={ua:navigator.userAgent,isMobile:!1,url:i.href,user:e.auth.get("username"),version:e.version,firstApiStart:s,firstApiEnd:Date.now(),screenWidth:screen.width,screenHeight:screen.height,availableWidth:window.innerWidth,availableHeight:window.innerHeight};window.performance&&O.extend(t,performance.timing),(new O.XHR).send("POST","/log/performance/",JSON.stringify(t),{"X-TrustedClient":"Yes","Content-type":"application/json"})})}(FastMail,document,location),function(e){e.base.heartbeat={_views:[],_timer:null,register:function(e){var t=this._views;t.length||this.start(),t.push(e)},deregister:function(e){var t=this._views;t.erase(e),t.length||this.stop()},start:function(){this._timer=O.RunLoop.invokeAfterDelay(this.beat,61e3-1e3*(new Date).getUTCSeconds(),this)},stop:function(){this._timer&&(O.RunLoop.cancel(this._timer),this._timer=null)},beat:function(){this._views.forEach(function(e){e.nowNeedsRedraw()}),this.start()}},e.RedrawOnMinute={register:function(){this.get("isInDocument")?e.base.heartbeat.register(this):(e.base.heartbeat.deregister(this),this.nowNeedsRedraw())}.observes("isInDocument")}}(FastMail),FastMail.AnimatedListView=O.Class({Extends:O.ListView,Mixin:O.AnimatableView,_setAnimateLayer:function(){this.set("animateLayer",!1),O.RunLoop.invokeInNextEventLoop(this.set.bind(this,"animateLayer",!0))}.observes("content")}),FastMail.AppPaneView=O.Class({Extends:O.View,className:"app",positioning:"absolute"}),function(e){var t=O.UA,i=!!t.cssProps.transform&&(!t.opera||t.isWin)&&(!t.safari||t.safari>=5.1),n=t.cssProps.transform3d,s={role:"main",live:"polite",hidden:"false"},a={role:"none",live:"off",hidden:"true"},o=O.Class({Extends:O.View,Mixin:O.AnimatableView,className:"app-main",init:function(e){o.parent.init.call(this,e),this.setLayout()},ariaAttributes:function(){return this.get("showSidebar")||!this.get("revealSidebar")?s:a}.property("showSidebar","revealSidebar"),animateLayer:function(){return!this.get("showSidebar")}.property("showSidebar"),positioning:"absolute",splitLayout:O.bind("splitController*bottomRightLayout"),showSidebar:O.bind(e.preferences,"showSidebar"),revealSidebar:O.bind(e.base,"revealSidebar"),setLayout:function(){var t=this.get("showSidebar"),s=t?this.get("splitLayout"):O.clone(O.View.LAYOUT_FILL_PARENT),a=t||!this.get("revealSidebar")?0:e.localPrefs.get("sidebarWidth");return i?s.transform=n?"translate3d("+a+"px,0,0)":"translate("+a+"px,0)":(s.left+=a,s.right-=a),this.set("layout",s)}.observes("splitLayout","showSidebar","revealSidebar")});e.MainPaneView=o}(FastMail),function(e){var t=O.Class({Extends:O.View,className:"v-ContactCard",allowTextSelection:!0,draw:function(t,i,n){var s=this.get("name").replace(/["\\]/g,""),a=this.get("email").toLowerCase(),o=this.contact=e.getContactFromEmail(a);return[n("div.v-ContactCard-content",[n("h2.v-ContactCard-name",[s]),a?n("h3.v-ContactCard-email",[n("a",{href:"mailto:"+encodeURI(a),text:a})]):null,n("img",{className:"v-ContactCard-avatar app-avatar u-bgcolour"+a.toLowerCase().hash().mod(7),src:a?O.bind(a.replace(/\*/g,"").replace(/\./g,"⥷"),e.AvatarManager,function(t){return t||e.theme.getImageSrc("avatar.png")}):e.theme.getImageSrc("avatar.png"),alt:""})]),n("div.v-ContactCard-actions",[o?new O.ButtonView({type:"v-Button--standard v-Button--size13",label:O.loc(217),target:this,method:"view"}):new O.ButtonView({type:"v-Button--constructive v-Button--size13",label:O.loc(537),target:this,method:"add"})])]},mailto:function(t){var i,n;"A"===t.target.nodeName&&(t.preventDefault(),t.stopPropagation(),e.base.restoreStateFromUrl("mail/compose:to="+encodeURI((i=this.get("name"),n=this.get("email"),(i=i.replace(/["\\]/g,"").trim())?(/[,;<>@()]/.test(i)&&(i='"'+i+'"'),i+" <"+n+">"):n))))}.on("click"),view:function(){var t=this.contact;e.popOver.hide(),e.base.set("app","contacts"),O.require("contacts",function(){e.contacts.set("groupId","").set("search","").set("shared","").set("screen","content").visibleContact.set("record",t)})},add:function(t){var i=this.contact=new e.Contact(e.store),n=this.get("name").trim(),s=this.get("name").lastIndexOf(" "),a=s>-1?n.slice(0,s):n,o=s>-1?n.slice(s+1):"";i.set("firstName",a).set("lastName",o).set("emails",[{type:"personal",value:this.get("email")}]).saveToStore(),t.set("type","v-Button--standard v-Button--size13").set("label",O.loc(217)).set("method","view")}});e.ContactCardView=t}(FastMail),function(e,t){var i=/^(\s*)((?:[a-z0-9\!\#\$\%\&\'\*\+\-\/\=\?\^\_\`\{\|\}\~]+\.)*[a-z0-9\!\#\$\%\&\'\*\+\-\/\=\?\^\_\`\{\|\}\~]+|"(?:\\"|[^"])*")(\@(?:[a-zA-Z0-9_\-]+\.)+[a-zA-Z]{2,})(\s*[,;]?)$/i,n=/^(\s*((?:"(?:\\"|[^"])*?"\s*)|[^,;"<@]*)<)([^>]*[^,;])(>(?:\s+\(.*?\))*\s*[,;]?)$/,s=/[,;"\(\)]/g,a=["","u-pageTextColour","","u-pageTextColour"],o=["u-error"],r=function(e){var t,s,r,l,c,u=e.length;return i.test(e)?{parts:(t=i.exec(e)).slice(1),classes:a,length:u,data:{name:"",email:t[2]+t[3]}}:n.test(e)&&(t=n.exec(e),i.test(t[3]))?(r=(s=t[1]).indexOf('"')+1,(l=s.lastIndexOf('"'))<0&&(l=s.length-1),c=t[1].length+t[3].length+1,{parts:[s.slice(0,r),s.slice(r,l),e.slice(l,c),e.slice(c)],classes:a,length:u,data:{name:s.slice(r,l).trim(),email:t[3]}}):{parts:[e],classes:o,length:u,data:null}},l=O.Class({Extends:O.TextView,layerTag:"div",type:"v-EmailText",currentIndex:-1,init:function(){l.parent.init.apply(this,arguments),this._emailStore={}},parsedEmails:[],_parseEmails:function(e){var t,i,n,a,o=!1,l=0,c=0,u=[],d=this._emailStore;for(s.lastIndex=0;t=s.exec(e);)switch(i="\\"===e[(n=t.index)-1],t[0]){case",":case";":o||l||(a=e.slice(c,n+1),u.push(d[a]||(d[a]=r(a))),c=n+1);break;case"(":o||i||(l+=1);break;case")":o||i||(l-=1);break;case'"':l||i||(o=!o)}return u.push(r(e.slice(c))),u},fixInput:function(){var e,t,i,n,s,a,l,c,u,d=this.get("value"),h=!1,g=0;for(/\s{2,}|[\u0000-\u001f]/.test(d)&&(e=this.get("selection").start,t=0,d=d.replace(/\s+/g,function(i,n){var s=i.length;return e>n&&(t+=(e<n+s?e-n:s)-1)," "}).replace(/[\u0000-\u001f]/g,function(i,n){return e>n&&(t+=1),""}),e-=t),n=0,s=(i=d?this._parseEmails(d):[]).length;n<s;n+=1){if((a=i[n]).classes===o&&(l=a.parts[0],c=RegExp.email.exec(l))){for(u=c.index+c[0].length;/[\w\-\.]/.test(l.charAt(u));)u+=1;">"===l.charAt(u)&&(u+=1),"("!==l.charAt(u)&&"("!==l.charAt(u+1)||(u=l.indexOf(")",u)+1||u),u<l.length&&!/[,;]/.test(l.charAt(u))&&(i.splice(n,1,r(l.slice(0,u)+","),r(l.slice(u))),s+=1,h=!0,void 0===e&&(e=this.get("selection").start),e>g+u&&(e+=1))}g+=i[n].length}void 0!==e&&(h&&(d=i.reduce(function(e,t){return e+t.parts.join("")},"")),this._inFixInput=!0,this.set("value",d).set("selection",e),this._inFixInput=!1),this.set("parsedEmails",i),void 0!==e&&this._updateCurrentIndex()},_reparse:function(){this._inFixInput||O.RunLoop.invokeInNextEventLoop(this.fixInput,this)}.observes("value"),draw:function(e,t,i){var n=this.get("value");t.appendChildren(e,[this._pre=i("pre.v-EmailText-ghost",[i("span"),i("br")]),this._domControl=i("textarea",{id:this.get("id")+"-input",className:"v-Text-input v-EmailText-input",spellcheck:"false",autocomplete:"off",autocorrect:"off",autocapitalize:"off",placeholder:this.get("placeholder"),disabled:this.get("isDisabled"),tabIndex:this.get("tabIndex"),value:n})]),n&&this.fixInput()},_drawAll:function(e,t,i){for(var n=document.createDocumentFragment(),s=this.get("currentIndex"),a=this._pre,o=a.childNodes[t];t<i;t+=1)this._drawNode(e[t],n,t===s);o?a.insertBefore(n,o):a.appendChild(n)},_drawNode:function(e,t,i){var n=O.Element.create;t.appendChild(n("span",{className:i?"v-EmailText-focussed":""},e.parts.map(function(t,i){return n("span",{className:e.classes[i],text:t})})))},emailTextNeedsRedraw:function(e,t,i){this.propertyNeedsRedraw(e,t,i)}.observes("parsedEmails","currentIndex"),redrawParsedEmails:function(e,t){var i,n,s,a,o=this.get("parsedEmails"),r=o.length,l=this._pre;for(i=0;i<r&&o[i]===t[i];i+=1);if(n=i,t.length!==r)a=t.length,s=r;else{for(;r--&&o[r]===t[r];);a=s=r+1}for(;n<a;)a-=1,l.removeChild(l.childNodes[a]);this._drawAll(o,n,s)},redrawCurrentIndex:function(e,t){var i,n=this.get("currentIndex");n>-1&&(i=this._pre.childNodes[n])&&O.Element.addClass(i,"v-EmailText-focussed"),t>-1&&(i=this._pre.childNodes[t])&&O.Element.removeClass(i,"v-EmailText-focussed")},_updateCurrentIndex:function(){var e,t,i=this.get("selection").start,n=this.get("parsedEmails"),s=0;for(e=0,t=n.length-1;e<t&&!((s+=n[e].length)>i);e+=1);this.set("currentIndex",e)}.on("click","keyup","focus"),_updateCurrentIndexOnBlur:function(){this.set("currentIndex",-1)}.on("blur")});e.EmailTextView=l}(FastMail),function(e){var t=O.Class({init:function(e){this.selection=e,this.activatedAt=0},fire:function(e,t){if(Date.now()-this.activatedAt>1e3)O.ViewEventsController.removeEventTarget(this);else if("keypress"===e){var i=O.DOMEvent.lookupKey(t),n=this.selection;"a"===i?(n.selectAll(!0),this.activatedAt=0):"n"===i&&(n.selectAll(!1),this.activatedAt=0),t.propagationStopped=!0}else"keydown"===e&&(t.propagationStopped=!0)}}),i=O.Class({Extends:O.CheckboxView,selectionController:null,shortcut:"* '",tooltip:function(){return this.get("value")?O.loc(345)+" \n"+O.loc(0,"* n"):O.loc(344)+" \n"+O.loc(0,"* a")}.property("value"),label:function(){return this.get("value")?O.loc(345):O.loc(344)}.property("value"),isDisabled:O.bind(null,"selectionController.content.length",O.Transform.invert),listSelectionLength:O.bind("selectionController.length"),className:function(){var e=this.get("listSelectionLength"),t=this.get("selectionController").getFromPath("content.length");return"v-SelectAllCheckbox"+(e&&e!==t?" is-semiActive":"")}.property("listSelectionLength"),selectionLengthDidChange:function(){var e=this.get("listSelectionLength");this._ignore=!0,this.set("value",!!e),this._ignore=!1}.observes("listSelectionLength"),triggerSelect:function(){this._ignore||this.get("selectionController").selectAll(this.get("value"))}.observes("value"),kbController:function(){return new t(this.get("selectionController"))}.property(),activate:function(){var e=this.get("kbController");e.activatedAt=Date.now(),O.ViewEventsController.addEventTarget(e,50)}});e.SelectAllCheckboxView=i}(FastMail),function(e){var t=O.Record.attr,i=O.ValidationError,n=i.REQUIRED,s=i.TOO_SHORT,a=i.TOO_LONG,o=i.INVALID_CHAR,r=i.FIRST_CUSTOM_ERROR,l=r<<1,c=r<<2,u=r<<3,d=r<<4,h={isAlias:!1,email:t(String,{defaultValue:"",validate:function(t,h,g){var p,f,m,v,A=t.slice(0,t.indexOf("@")),y=g.get("isAlias"),b=g.get("isCustomDomain"),w=b?y?O.loc(227,1,40):O.loc(453,1,40):y?O.loc(227,2,40):O.loc(453,3,40);if(!A)return new i(n,w);if(A.length>40)return new i(a,O.loc(407,40));if(b){if(/^(?:master|archive)user/.test(A))return new i(c,O.loc(263));if(!y||"*"!==A){if(y&&!/^[a-z_0-9]/.test(A))return new i(u,O.loc(691,"a-z, 0-9 "+O.loc(10)+" _"));if(y&&/[^a-z_0-9\.\-]/.test(A))return new i(o,O.loc(94,"a-z, 0-9, _, - "+O.loc(10)+" ."));if(!y&&!/^[a-z]/.test(A))return new i(u,O.loc(262));if(!y&&/[^a-z_0-9\.]/.test(A))return new i(o,O.loc(94,"a-z, 0-9, _ "+O.loc(10)+" ."));if(/\.\./.test(A))return new i(o,O.loc(259));if(/\.$/.test(A))return new i(d,O.loc(261))}if(f=function(e){return e.get("email")===t},(m=e.store.getQuery("users").find(f))&&m.get("storeKey")!==g.get("storeKey"))return new i(c,O.loc(697));if((v=e.store.getQuery("aliases").find(f))&&v.get("storeKey")!==g.get("storeKey"))return new i(c,O.loc(667));if(!y&&"admin"===A)return new i(c,O.loc(692,"admin@"))}else{if(!/^[a-z]/.test(A))return new i(u,O.loc(262));if(y){if(A.length<2)return new i(s,O.loc(192,2));if(/[^a-z_0-9\.]/.test(A))return new i(o,O.loc(94,"a-z, 0-9, _ "+O.loc(10)+" ."));if(/\.\./.test(A))return new i(o,O.loc(259));if(/\.$/.test(A))return new i(d,O.loc(261))}else{if(A.length<3)return new i(s,O.loc(192,3));if(/[^a-z_0-9]/.test(A))return new i(o,O.loc(94,"a-z, 0-9 "+O.loc(10)+" _"))}if((p=g.get("availability"))===r)return new i(r,w);if(p===l)return new i(l,O.loc(669,t));if(p===c)return new i(c,O.loc(698,t))}return null},validityDependencies:["availability","isCustomDomain"]}),username:function(e){var t,i;return void 0!==e?((t=e.indexOf("@"))>-1&&(e=e.slice(0,t)),this.set("email",e+"@"+this.get("domain"))):e=(i=this.get("email")).slice(0,i.indexOf("@")),e}.property("email"),domain:function(e){if(void 0!==e)e=e.slice(e.indexOf("@")+1),this.set("email",this.get("username")+"@"+e);else{var t=this.get("email");e=t.slice(t.indexOf("@")+1)}return e}.property("email"),isCustomDomain:function(){return!e.domainsIndex[this.get("domain")]}.property("domain"),availability:0,setInitialAvailability:function(){this.is(O.Status.NEW)||this.get("email")!==this.getDoppelganger(e.store).get("email")?(this.set("availability",r),this._timeout=O.RunLoop.cancel(this._timeout).invokeAfterDelay(this.checkAvailability,1e3,this)):this.set("availability",0)}.observes("email"),checkAvailability:function(){var t=this.get("errorForAttribute").get("email");t&&t.type===r&&(this.set("availability",l),e.api.peripheral.callMethod("getEmailAvailability",{email:this.get("email")},function(e){var t=e[0],i=t[0],n=t[1];"emailAvailability"===i&&this.get("email")===n.email&&this.set("availability",n.isAvailable?0:c)}.bind(this)))}};e.EmailAttribute=h}(FastMail),function(e){var t=O.Record.attr,i=O.ValidationError,n=i.REQUIRED,s=i.TOO_SHORT,a=i.FIRST_CUSTOM_ERROR,o=a<<1,r={password:t(String,{defaultValue:"",validate:function(e,t,o){return e?e.length<6?new i(s,O.loc(192,6)):o.get("email").toLowerCase().indexOf(e.toLowerCase())>-1||!o.get("passwordStrength")?new i(a,O.loc(465)):null:new i(n,O.loc(2))},validityDependencies:["zxcvbn","email"]}),zxcvbn:function(){return{guesses_log10:0}},passwordStrength:function(){var e,t=this.get("password"),i=this.get("zxcvbn");return t.length>100&&(t=t.slice(0,100)),(e=i(t).guesses_log10)?e<6?0:e<8?1:e<10?2:e<12?3:4:5}.property("password","zxcvbn")};e.DOES_NOT_MATCH=o,e.PasswordAttribute=r}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,name:i(String),tagline:i(String),mailMegabytes:i(Number),fileMegabytes:i(Number),mayHaveMultipleUsers:i(Boolean,{defaultValue:!0}),mayContactSync:i(Boolean,{defaultValue:!1}),mayCalendarSync:i(Boolean,{defaultValue:!1}),mayUseOwnDomain:i(Boolean,{defaultValue:!1}),mayArchive:i(Boolean,{defaultValue:!1}),subscriptions:i(Array),isDeprecated:i(Boolean),isTrial:i(Boolean),mailBytes:function(){return 1e6*this.get("mailMegabytes")}.property("mailMegabytes"),fileBytes:function(){return 1e6*this.get("fileMegabytes")}.property("fileMegabytes"),pricePer:function(e){for(var t=this.get("subscriptions"),i=t.length;i--;)if(t[i].months===e)return t[i].costInCents;return 0},calculateCostForUsers:function(e,t,i){var n,s;return this.get("isDeprecated")?n=e.reduce(function(e,i){var n=i.get("serviceLevel");return n&&(e+=n.pricePer(t)),e},0)||this.pricePer(t):(n=this.pricePer(t),(s=e.get("length"))>1&&e.some(function(e){return e.get("isMaster")})&&(s-=1),n*=s+(i?e.reduce(function(e,t){return e+t.get("extraQuotaUnits")},0):0)),n}});e.api.peripheral.handle(n,{fetch:"getServiceLevels",serviceLevels:function(e){e.state||(e.state="TEMP"),this.didFetch(n,e,!0)}}),e.ServiceLevel=n}(FastMail),function(e){var t=O.Record,i=t.attr,n=O.Class({Extends:t,Mixin:[e.EmailAttribute,e.PasswordAttribute],init:function(){var e=this;n.parent.init.apply(e,arguments),O.require("zxcvbn",function(){e.set("zxcvbn",zxcvbn)})},accessId:i(String),serviceLevel:t.toOne({Type:e.ServiceLevel,key:"serviceLevelId"}),isMaster:i(Boolean),name:i(String,{defaultValue:""}),is2FAEnabled:i(Boolean,{defaultValue:!1}),lockState:i(String,{defaultValue:""}),lockReason:i(String,{defaultValue:""}),isPrivate:i(Boolean,{defaultValue:!1}),isAdmin:i(Boolean,{defaultValue:!1}),enableArchiving:i(Boolean,{defaultValue:!1}),keepArchiveFor:i(String,{defaultValue:"forever"}),isArchiveVisibleToUser:i(Boolean,{defaultValue:!1}),archiveCompleteSince:i(Date,{noSync:!0}),extraQuotaUnits:i(Number,{defaultValue:0}),mailUsage:i(Number,{noSync:!0}),mailQuota:i(Number,{defaultValue:0}),fileUsage:i(Number,{noSync:!0}),fileQuota:i(Number,{defaultValue:0}),displayName:function(){return this.get("nameAndEmail")}.property("nameAndEmail"),nameAndEmail:function(){var e=this.get("email")||"",t=this.get("name")||"";return t=t.replace(/["\\]/g,""),/[,;<>@()]/.test(t)&&(t='"'+t+'"'),t?t+" <"+e+">":e}.property("name","email"),inboxHref:function(){return"/mail/Inbox/?u="+e.auth.get("userId")+"&a="+this.get("accessId")}.property("accessId")});e.api.peripheral.handle(n,{fetch:"getUsers",commit:function(t){var i=t.create,n=t.update,s=t.destroy;this.callMethod("setUsers",{token:e.settings.get("securityToken"),state:t.state,create:Object.zip(i.storeKeys,i.records),update:Object.zip(n.storeKeys,function(e,t){var i,n,s,a=e.records,o=e.changes,r=a.length,l=new Array(r);for(i=0;i<r;i+=1)n=a[i],(s=Object.filter(n,o[i]))[t]=n[t],l[i]=s;return l}(n,t.primaryKey)),destroy:Object.zip(s.storeKeys,s.ids)})},users:function(e){this.didFetch(n,e,!0)},updateUsers:function(e){this.get("store").sourceDidFetchPartialRecords(n,e)},usersSet:function(e,t,i){this.didCommit(n,e);var s=this.get("store");Object.keys(e.created||{}).concat(e.updated||[]).forEach(function(e){O.getFromPath(i,"update."+e+".serviceLevelId")&&s.fetchData(e),s.updateData(e,{password:""},!1)})}}),e.User=n}(FastMail),function(e){e.newMailNotifications=new O.Object({inboxId:O.bind(e.systemFolderIds,"inbox"),isMaster:O.bind(e.wc,"isMaster"),enableNotifications:O.bind(e.localPrefs,"enableNotifications"),showing:[],idToNotification:{},maxConcurrent:3,_state:0,_mailboxState:null,shouldNotify:function(){return!!this.get("inboxId")&&this.get("isMaster")&&this.get("enableNotifications")}.property("inboxId","isMaster","enableNotifications"),startStopNotifying:function(){return this.get("shouldNotify")?this.start():this._state=0,this}.observes("shouldNotify"),start:function(){if(0===this._state)return this._mailboxState=null,this._state=1,e.api.mail.callMethod("getMailboxMessageList",{mailboxId:this.get("inboxId"),useConversations:!1,sort:"uidDescending",filter:"",position:1,limit:5,fetchHeaders:!1},function(e){var t=e[0],i=t[0],n=t[1];1===this._state&&("mailboxMessageList"===i?(this._mailboxState=n.state,this._state=2):this._state=0)}.bind(this)),this},refresh:function(){if(!(this._state<2)){if(2===this._state)return this._state=3,e.api.mail.callMethod("getMailboxMessageListUpdates",{mailboxId:this.get("inboxId"),useConversations:!1,sort:"uidDescending",filter:"",state:this._mailboxState,uptoMessageId:null,fetchUpdates:!1,fetchNewIfLessThan:30},this.didRefresh.bind(this)),this;this._state=4}},didRefresh:function(t){var i,n,s,a,o,r,l,c,u,d,h,g=t[0],p=g[0],f=g[1],m=this._state,v=this.showing,A=e.localPrefs.get("notificationsFilter");if(!(m<3)){if("updateMailboxMessageList"!==p)return this._state=0,v.forEach(function(e){e.close()}),void this.start();if(this._mailboxState=f.newState,this._state=2,v.length)for(h=(r=f.removed).length;h--;)(d=this.idToNotification[r[h]])&&d.close();if(h=(l=f.added).length)for((c=FastMail.store.getQuery(this.get("inboxId")))&&c.refresh(),A&&(n=function(e){return e.value.toLowerCase()===i},s=function(e){return e.get("emails").some(n)},a=e.store.getQuery("contactsWithEmails"));h--;)(u=e.store.getRecord(e.MessageHeader,l[h][1])).get("isUnread")&&(A&&(i=u.get("fromEmail"),!(o=a.find(s))||"pinned"===A&&!o.get("isFlagged"))||this.showNotification(u));4===m&&this.refresh()}},showNotification:function(t){if("granted"!==(Notification.permission||"granted"))return this;var i,n=this.showing,s=this.idToNotification,a=t.get("id");try{i=new Notification(t.get("fromName")||t.get("fromEmail"),{icon:"/static/favicons/touch-icon-196x196.png",body:t.get("subject")})}catch(e){return this}return i.onclick=function(){O.require("mail",function(){e.mail.beginPropertyChanges().set("mailboxId",t.get("mailboxId")).set("search","").set("conversationId",t.get("conversationId")).set("messageId",t.get("messageId")).set("screen","conversation").endPropertyChanges()}),e.base.set("app","mail"),window.focus(),this.close()}.invokeInRunLoop(),i.onclose=function(){t.removeObserverForKey("isUnread",this,"close"),n.erase(this),O.RunLoop.cancel(null),delete s[a],this.onclick=null,this.onclose=null},t.addObserverForKey("isUnread",i,"close"),O.UA.chrome&&!/OPR/.test(navigator.userAgent)&&O.RunLoop.invokeAfterDelay(i.close,1e4,i),n.length===this.maxConcurrent&&n.shift().close(),n.push(i),s[a]=i,this}}).startStopNotifying()}(FastMail),"undefined"==typeof u2f?window.u2f=function(){var e,t={};return t.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd",t.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_SIGN_RESPONSE:"u2f_sign_response",U2F_GET_API_VERSION_REQUEST:"u2f_get_api_version_request",U2F_GET_API_VERSION_RESPONSE:"u2f_get_api_version_response"},t.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5},t.U2fRequest,t.U2fResponse,t.Error,t.Transport,t.Transports,t.SignRequest,t.SignResponse,t.RegisterRequest,t.RegisterResponse,t.RegisteredKey,t.GetJsApiVersionResponse,t.getMessagePort=function(e){if("undefined"!=typeof chrome&&chrome.runtime){var i={type:t.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]};chrome.runtime.sendMessage(t.EXTENSION_ID,i,function(){chrome.runtime.lastError?e(null):t.getChromeRuntimePort_(e)})}else t.isAndroidChrome_()?t.getAuthenticatorPort_(e):t.isIosChrome_()?t.getIosPort_(e):e(null)},t.isAndroidChrome_=function(){var e=navigator.userAgent;return-1!=e.indexOf("Chrome")&&-1!=e.indexOf("Android")},t.isIosChrome_=function(){return["iPhone","iPad","iPod"].indexOf(navigator.platform)>-1},t.getChromeRuntimePort_=function(e){var i=chrome.runtime.connect(t.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){e(new t.WrappedChromeRuntimePort_(i))},0)},t.getAuthenticatorPort_=function(e){setTimeout(function(){e(new t.WrappedAuthenticatorPort_)},0)},t.getIosPort_=function(e){setTimeout(function(){e(new t.WrappedIosPort_)},0)},t.WrappedChromeRuntimePort_=function(e){this.port_=e},t.formatSignRequest_=function(i,n,s,a,o){if(void 0===e||e<1.1){for(var r=[],l=0;l<s.length;l++)r[l]={version:s[l].version,challenge:n,keyHandle:s[l].keyHandle,appId:i};return{type:t.MessageTypes.U2F_SIGN_REQUEST,signRequests:r,timeoutSeconds:a,requestId:o}}return{type:t.MessageTypes.U2F_SIGN_REQUEST,appId:i,challenge:n,registeredKeys:s,timeoutSeconds:a,requestId:o}},t.formatRegisterRequest_=function(i,n,s,a,o){if(void 0===e||e<1.1){for(var r=0;r<s.length;r++)s[r].appId=i;var l=[];for(r=0;r<n.length;r++)l[r]={version:n[r].version,challenge:s[0],keyHandle:n[r].keyHandle,appId:i};return{type:t.MessageTypes.U2F_REGISTER_REQUEST,signRequests:l,registerRequests:s,timeoutSeconds:a,requestId:o}}return{type:t.MessageTypes.U2F_REGISTER_REQUEST,appId:i,registerRequests:s,registeredKeys:n,timeoutSeconds:a,requestId:o}},t.WrappedChromeRuntimePort_.prototype.postMessage=function(e){this.port_.postMessage(e)},t.WrappedChromeRuntimePort_.prototype.addEventListener=function(e,t){var i=e.toLowerCase();"message"==i||"onmessage"==i?this.port_.onMessage.addListener(function(e){t({data:e})}):console.error("WrappedChromeRuntimePort only supports onMessage")},t.WrappedAuthenticatorPort_=function(){this.requestId_=-1,this.requestObject_=null},t.WrappedAuthenticatorPort_.prototype.postMessage=function(e){var i=t.WrappedAuthenticatorPort_.INTENT_URL_BASE_+";S.request="+encodeURIComponent(JSON.stringify(e))+";end";document.location=i},t.WrappedAuthenticatorPort_.prototype.getPortType=function(){return"WrappedAuthenticatorPort_"},t.WrappedAuthenticatorPort_.prototype.addEventListener=function(e,t){if("message"==e.toLowerCase()){window.addEventListener("message",this.onRequestUpdate_.bind(this,t),!1)}else console.error("WrappedAuthenticatorPort only supports message")},t.WrappedAuthenticatorPort_.prototype.onRequestUpdate_=function(e,t){var i=JSON.parse(t.data),n=(i.intentURL,i.errorCode,null);i.hasOwnProperty("data")&&(n=JSON.parse(i.data)),e({data:n})},t.WrappedAuthenticatorPort_.INTENT_URL_BASE_="intent:#Intent;action=com.google.android.apps.authenticator.AUTHENTICATE",t.WrappedIosPort_=function(){},t.WrappedIosPort_.prototype.postMessage=function(e){var t=JSON.stringify(e),i="u2f://auth?"+encodeURI(t);location.replace(i)},t.WrappedIosPort_.prototype.getPortType=function(){return"WrappedIosPort_"},t.WrappedIosPort_.prototype.addEventListener=function(e,t){"message"!==e.toLowerCase()&&console.error("WrappedIosPort only supports message")},t.EXTENSION_TIMEOUT_SEC=30,t.port_=null,t.waitingForPort_=[],t.reqCounter_=0,t.callbackMap_={},t.getPortSingleton_=function(e){t.port_?e(t.port_):(0==t.waitingForPort_.length&&t.getMessagePort(function(i){if(i)for(t.port_=i,t.port_.addEventListener("message",t.responseHandler_);t.waitingForPort_.length;)t.waitingForPort_.shift()(t.port_);else e(null)}),t.waitingForPort_.push(e))},t.responseHandler_=function(e){var i=e.data,n=i.requestId;if(n&&t.callbackMap_[n]){var s=t.callbackMap_[n];delete t.callbackMap_[n],s(i.responseData)}else console.error("Unknown or missing requestId in response.")},t.sign=function(i,n,s,a,o){void 0===e?t.getApiVersion(function(r){e=void 0===r.js_api_version?0:r.js_api_version,console.log("Extension JS API Version: ",e),t.sendSignRequest(i,n,s,a,o)}):t.sendSignRequest(i,n,s,a,o)},t.sendSignRequest=function(e,i,n,s,a){t.getPortSingleton_(function(o){var r=++t.reqCounter_;t.callbackMap_[r]=s;var l=void 0!==a?a:t.EXTENSION_TIMEOUT_SEC,c=t.formatSignRequest_(e,i,n,l,r);o.postMessage(c)})},t.register=function(i,n,s,a,o){void 0===e?t.getApiVersion(function(r){e=void 0===r.js_api_version?0:r.js_api_version,console.log("Extension JS API Version: ",e),t.sendRegisterRequest(i,n,s,a,o)}):t.sendRegisterRequest(i,n,s,a,o)},t.sendRegisterRequest=function(e,i,n,s,a){t.getPortSingleton_(function(o){var r=++t.reqCounter_;t.callbackMap_[r]=s;var l=void 0!==a?a:t.EXTENSION_TIMEOUT_SEC,c=t.formatRegisterRequest_(e,n,i,l,r);o.postMessage(c)})},t.getApiVersion=function(e,i){t.getPortSingleton_(function(n){if(n&&!n.getPortType){var s=++t.reqCounter_;t.callbackMap_[s]=e;var a={type:t.MessageTypes.U2F_GET_API_VERSION_REQUEST,timeoutSeconds:void 0!==i?i:t.EXTENSION_TIMEOUT_SEC,requestId:s};n.postMessage(a)}else{var o=0;switch(n&&n.getPortType()){case"WrappedIosPort_":case"WrappedAuthenticatorPort_":o=1.1}e({js_api_version:o})}})},t}():u2f.getApiVersion=function(e){e({js_api_version:4===u2f.register.length?1:1.1})},function(e){e.isApp?O.UA.canU2F=!1:u2f.getApiVersion(function(e){O.UA.canU2F=e.js_api_version>0},5);var t={x:"b",j:"c",e:"d",".":"e",u:"f",i:"g",d:"h",c:"i",h:"j",t:"k",n:"l",b:"n",p:"r",y:"t",g:"u",k:"v"},i=function(e){return t[e]||e},n=new O.Object({view:null,code:"",lastTime:0,fire:function(e,t){if("keydown"===e&&1===this.view.state){var n=t.key||O.DOMEvent.lookupKey(t),s=Date.now(),a=this.code;/^[a-z.]$/.test(n)?(t.propagationStopped=!0,t.preventDefault(),a=s-this.lastTime>100?n:a+n,this.lastTime=s):a="",44===a.length&&("j"===a.charAt(0)&&(a=a.split("").map(i).join("")),/^[b-lnrtuv]{44}$/.test(a)&&this.view.set("response",a).set("state",2)),this.code=a}}}),s=O.Class({Extends:O.View,isForYubikey:!1,isForU2F:!1,state:0,challenge:null,response:null,setupWatcher:function(){var e=this.get("isForYubikey"),t=O.ViewEventsController;this.get("isInDocument")?(e&&(n.set("view",this),t.addEventTarget(n,1e3)),this.activate()):(this.set("state",0),e&&(t.removeEventTarget(n),n.set("view",null)))}.observes("isInDocument"),className:"v-SecurityKeyInput",draw:function(e,t,i){var n=[i("div.v-SecurityKeyInput-container",[new O.ButtonView({type:"v-Button--constructive v-Button--size13",label:O.loc(526),target:this,method:"activate"})]),i("div.v-SecurityKeyInput-text",{text:O.bind(this,"error")})],s=[i("div.v-SecurityKeyInput-container",[i("div.v-SecurityKeyInput-animationDot",[i("div.v-SecurityKeyInput-animationPulse")])]),i("div.v-SecurityKeyInput-text",[O.loc(1389)])],a=[i("div.v-SecurityKeyInput-done.icon.icon-ok"),i("div.v-SecurityKeyInput-text",[O.loc(476)])];return[new O.SwitchView({index:O.bind(this,"state"),views:[n,s,a]})]},activate:function(){if(1!==this.get("state"))if(this.get("isForU2F")){var e=this.get("challenge"),t=location.origin;e?(this.set("state",1),e.registerRequest?u2f.register(t,[e.registerRequest],e.registeredKeys,this.didFinish.bind(this,!0)):u2f.sign(t,e.signChallenge,e.registeredKeys,this.didFinish.bind(this,!1))):this.set("state",0).set("error",O.loc(350))}else this.set("state",1)}.observes("challenge"),didFinish:function(e,t){var i=t.errorCode;i?this.didError(i,e):this.set("response",t).set("state",2)}.invokeInRunLoop(),didError:function(e,t){var i;switch(e){case 3:i=O.loc(979);break;case 4:i=t?O.loc(976):O.loc(978);break;case 5:i=O.loc(1341);break;default:i=O.loc(350)}this.set("state",0).set("error",i)}});e.SecurityKeyInputView=s}(FastMail),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DOMPurify=t()}(this,function(){var e=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"],t=["svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern"],i=["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence"],n=["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"],s=["#text"],a=["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"],o=["accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan"],r=["accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset"],l=["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"];function c(e,t){for(var i=t.length;i--;)"string"==typeof t[i]&&(t[i]=t[i].toLowerCase()),e[t[i]]=!0;return e}function u(e){var t={},i=void 0;for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};return function h(){var g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Function("return this")(),p=function(e){return h(e)};if(p.version="0.9.0",p.removed=[],!g||!g.document||9!==g.document.nodeType)return p.isSupported=!1,p;var f=g.document,m=!1,v=!1,A=g.document,y=g.DocumentFragment,b=g.HTMLTemplateElement,O=g.Node,w=g.NodeFilter,S=g.NamedNodeMap,C=void 0===S?g.NamedNodeMap||g.MozNamedAttrMap:S,x=g.Text,M=g.Comment,I=g.DOMParser,T=g.XMLHttpRequest,E=void 0===T?g.XMLHttpRequest:T,R=g.encodeURI,D=void 0===R?g.encodeURI:R;if("function"==typeof b){var F=A.createElement("template");F.content&&F.content.ownerDocument&&(A=F.content.ownerDocument)}var _=A,N=_.implementation,P=_.createNodeIterator,V=_.getElementsByTagName,L=_.createDocumentFragment,k=f.importNode,U={};p.isSupported=N&&void 0!==N.createHTMLDocument&&9!==A.documentMode;var B=null,H={};c(H,e),c(H,t),c(H,i),c(H,n),c(H,s);var q=null,Q={};c(Q,a),c(Q,o),c(Q,r),c(Q,l);var W=null,j=null,Y=!0,z=!0,G=!1,K=!1,J=!1,X=/\{\{[\s\S]*|[\s\S]*\}\}/gm,Z=/<%[\s\S]*|[\s\S]*%>/gm,$=!1,ee=!1,te=!1,ie=!1,ne=!1,se=!1,ae=!0,oe=!0,re=c({},["audio","head","math","script","style","template","svg","video"]),le=c({},["audio","video","img","source","image"]),ce=c({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),ue=null,de=A.createElement("form"),he=function(e){"object"!==(void 0===e?"undefined":d(e))&&(e={}),B="ALLOWED_TAGS"in e?c({},e.ALLOWED_TAGS):H,q="ALLOWED_ATTR"in e?c({},e.ALLOWED_ATTR):Q,W="FORBID_TAGS"in e?c({},e.FORBID_TAGS):{},j="FORBID_ATTR"in e?c({},e.FORBID_ATTR):{},Y=!1!==e.ALLOW_ARIA_ATTR,z=!1!==e.ALLOW_DATA_ATTR,G=e.ALLOW_UNKNOWN_PROTOCOLS||!1,K=e.SAFE_FOR_JQUERY||!1,J=e.SAFE_FOR_TEMPLATES||!1,$=e.WHOLE_DOCUMENT||!1,ie=e.RETURN_DOM||!1,ne=e.RETURN_DOM_FRAGMENT||!1,se=e.RETURN_DOM_IMPORT||!1,te=e.FORCE_BODY||!1,ae=!1!==e.SANITIZE_DOM,oe=!1!==e.KEEP_CONTENT,J&&(z=!1),ne&&(ie=!0),e.ADD_TAGS&&(B===H&&(B=u(B)),c(B,e.ADD_TAGS)),e.ADD_ATTR&&(q===Q&&(q=u(q)),c(q,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&c(ce,e.ADD_URI_SAFE_ATTR),oe&&(B["#text"]=!0),Object&&"freeze"in Object&&Object.freeze(e),ue=e},ge=function(e){p.removed.push({element:e});try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}},pe=function(e,t){p.removed.push({attribute:t.getAttributeNode(e),from:t}),t.removeAttribute(e)},fe=function(e){var t=void 0,i=void 0;if(te&&(e="<remove></remove>"+e),v){try{e=D(e)}catch(e){}var n=new E;n.responseType="document",n.open("GET","data:text/html;charset=utf-8,"+e,!1),n.send(null),t=n.response}if(m)try{t=(new I).parseFromString(e,"text/html")}catch(e){}return t&&t.documentElement||((i=(t=N.createHTMLDocument("")).body).parentNode.removeChild(i.parentNode.firstElementChild),i.outerHTML=e),V.call(t,$?"html":"body")[0]};p.isSupported&&(fe('<svg><g onload="this.parentNode.remove()"></g></svg>').querySelector("svg")||(v=!0),fe('<svg><p><style><img src="</style><img src=x onerror=alert(1)//">').querySelector("svg img")&&(m=!0));var me=function(e){return P.call(e.ownerDocument||e,e,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT,function(){return w.FILTER_ACCEPT},!1)},ve=function(e){return"object"===(void 0===O?"undefined":d(O))?e instanceof O:e&&"object"===(void 0===e?"undefined":d(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},Ae=function(e,t,i){U[e]&&U[e].forEach(function(e){e.call(p,t,i,ue)})},ye=function(e){var t,i=void 0;if(Ae("beforeSanitizeElements",e,null),!((t=e)instanceof x||t instanceof M||"string"==typeof t.nodeName&&"string"==typeof t.textContent&&"function"==typeof t.removeChild&&t.attributes instanceof C&&"function"==typeof t.removeAttribute&&"function"==typeof t.setAttribute))return ge(e),!0;var n=e.nodeName.toLowerCase();if(Ae("uponSanitizeElement",e,{tagName:n,allowedTags:B}),!B[n]||W[n]){if(oe&&!re[n]&&"function"==typeof e.insertAdjacentHTML)try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(e){}return ge(e),!0}return!K||e.firstElementChild||e.content&&e.content.firstElementChild||!/</g.test(e.textContent)||(p.removed.push({element:e.cloneNode()}),e.innerHTML=e.textContent.replace(/</g,"&lt;")),J&&3===e.nodeType&&(i=(i=(i=e.textContent).replace(X," ")).replace(Z," "),e.textContent!==i&&(p.removed.push({element:e.cloneNode()}),e.textContent=i)),Ae("afterSanitizeElements",e,null),!1},be=/^data-[\-\w.\u00B7-\uFFFF]/,Oe=/^aria-[\-\w]+$/,we=/^(?:(?:(?:f|ht)tps?|mailto|tel):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Se=/^(?:\w+script|data):/i,Ce=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,xe=function(e){var t=void 0,i=void 0,n=void 0,s=void 0,a=void 0,o=void 0,r=void 0;if(Ae("beforeSanitizeAttributes",e,null),o=e.attributes){var l={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:q};for(r=o.length;r--;){if(i=(t=o[r]).name,n=t.value.trim(),s=i.toLowerCase(),l.attrName=s,l.attrValue=n,l.keepAttr=!0,Ae("uponSanitizeAttribute",e,l),n=l.attrValue,"name"===s&&"IMG"===e.nodeName&&o.id)a=o.id,o=Array.prototype.slice.apply(o),pe("id",e),pe(i,e),o.indexOf(a)>r&&e.setAttribute("id",a.value);else{if("INPUT"===e.nodeName&&"type"===s&&"file"===n&&(q[s]||!j[s]))continue;"id"===i&&e.setAttribute(i,""),pe(i,e)}if(l.keepAttr&&(!ae||"id"!==s&&"name"!==s||!(n in g||n in A||n in de))){if(J&&(n=(n=n.replace(X," ")).replace(Z," ")),z&&be.test(s));else if(Y&&Oe.test(s));else{if(!q[s]||j[s])continue;if(ce[s]);else if(we.test(n.replace(Ce,"")));else if("src"!==s&&"xlink:href"!==s||0!==n.indexOf("data:")||!le[e.nodeName.toLowerCase()])if(G&&!Se.test(n.replace(Ce,"")));else if(n)continue}try{e.setAttribute(i,n),p.removed.pop()}catch(e){}}}Ae("afterSanitizeAttributes",e,null)}},Me=function e(t){var i=void 0,n=me(t);for(Ae("beforeSanitizeShadowDOM",t,null);i=n.nextNode();)Ae("uponSanitizeShadowNode",i,null),ye(i)||(i.content instanceof y&&e(i.content),xe(i));Ae("afterSanitizeShadowDOM",t,null)};return p.sanitize=function(e,t){var i=void 0,n=void 0,s=void 0,a=void 0,o=void 0;if(e||(e="\x3c!--\x3e"),"string"!=typeof e&&!ve(e)){if("function"!=typeof e.toString)throw new TypeError("toString is not a function");e=e.toString()}if(!p.isSupported){if("object"===d(g.toStaticHTML)||"function"==typeof g.toStaticHTML){if("string"==typeof e)return g.toStaticHTML(e);if(ve(e))return g.toStaticHTML(e.outerHTML)}return e}if(ee||he(t),p.removed=[],e instanceof O)1===(n=(i=fe("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===n.nodeName?i=n:i.appendChild(n);else{if(!ie&&!$&&-1===e.indexOf("<"))return e;if(!(i=fe(e)))return ie?null:""}te&&ge(i.firstChild);for(var r=me(i);s=r.nextNode();)3===s.nodeType&&s===a||ye(s)||(s.content instanceof y&&Me(s.content),xe(s),a=s);if(ie){if(ne)for(o=L.call(i.ownerDocument);i.firstChild;)o.appendChild(i.firstChild);else o=i;return se&&(o=k.call(f,o,!0)),o}return $?i.outerHTML:i.innerHTML},p.setConfig=function(e){he(e),ee=!0},p.clearConfig=function(){ue=null,ee=!1},p.addHook=function(e,t){"function"==typeof t&&(U[e]=U[e]||[],U[e].push(t))},p.removeHook=function(e){U[e]&&U[e].pop()},p.removeHooks=function(e){U[e]&&(U[e]=[])},p.removeAllHooks=function(){U={}},p}()}),function(e){var t=O.Element,i=t.create,n=t.hasClass,s=function(e){return i("div",{"aria-hidden":"true",className:e?"u-quote u-quote--topPost":"u-quote"})},a=function(e){return i("div",{className:e?"u-quote-topPostToggle":"u-quote-toggle"},[i("a.u-quote-link",{href:"",title:O.loc(0,'"'),text:O.loc(73)})])},o=function(e){return"BLOCKQUOTE"===e.nodeName||n(e,"u-quote")},r=function(e,n){var r,l,c,u,d,h,g,p,f,m,v,A,y;c=e.querySelectorAll("HR");e:for(h=0,l=c.length;h<l;h+=1)for(u=[y=c[h]],d=!1;y=y.nextSibling;)if(u.push(y),3!==y.nodeType||/\S/.test(y.data)){if(!(d||1===y.nodeType&&/divRplyFwdMsg$/.test(y.id))){u=null;continue e}if(d){1===y.nodeType&&t.nearest(y,o,e)&&(u=null);break e}d=!0}if(u){for(m=s(!0),v=a(!0),(p=(y=u[0]).parentNode).insertBefore(v,y),p.insertBefore(m,y),h=0,l=u.length;h<l;h+=1)m.appendChild(u[h]);m.appendChild(i("div"))}for(l=(r=e.querySelectorAll("BLOCKQUOTE")).length;l--;)if(p=(g=r[l]).parentNode,!t.nearest(p,o,e)&&(g.querySelectorAll("DIV~DIV,DIV~P,P~DIV,P~P").length>n-1||g.querySelectorAll("BR").length>n)){f=!0,y=g.nextSibling;do{if(!y)break;if(y.nodeType<4&&/\S/.test(y.textContent)){f=!1;break}}while(y=y.nextSibling);if(m=s(f),v=a(f),"yes"===p.getAttribute("data-gmailquote")){if((A=p.querySelectorAll("BLOCKQUOTE").length)>1&&(A-=g.querySelectorAll("BLOCKQUOTE").length),1===A)for(p=(g=p).parentNode;(y=g.lastChild)&&"BLOCKQUOTE"!==y.nodeName;)p.insertBefore(y,g.nextSibling)}else{for(y=g.previousSibling;y&&(y.nodeType>3||!/\S/.test(y.textContent));)m.insertBefore(y,m.firstChild),y=g.previousSibling;y&&1===y.nodeType&&y.querySelectorAll("BR").length<2&&":"===y.textContent.trim().slice(-1)&&m.insertBefore(y,m.firstChild)}p.replaceChild(m,g),m.appendChild(g),m.appendChild(i("div")),p.insertBefore(v,f?m:m.nextSibling)}},l=0,c="",u=!1,d=!1,h=!1,g=!1,p=function(e,t){for(var i=t.length;i--;)e[t[i]]=!0;return e}({},["background","background-","border","border-","outline","outline-","margin","margin-","padding","padding-","list-style","list-style-type","list-style-image","list-style-position","font","font-","color","opacity","direction","letter-spacing","line-break","line-height","overflow-wrap","text-","vertical-align","white-space","word-spacing","word-wrap","word-break","box-sizing","display","position","visibility","overflow","overflow-x","overflow-y","z-index","zoom","top","right","bottom","left","width","height","min-width","min-height","max-width","max-height","float","clear","clip","clip-path","object-fit","object-position","border-collapse","border-spacing","caption-side","empty-cells","table-layout","content","quotes","orphans","page-break-after","page-break-before","page-break-inside","widows","box-shadow","text-shadow","animation","animation-","transform","transform-origin","transform-style","perspective","perspective-origin","transition","transition-","align-","flex","flex-","justify-content","order","columns","column-"]),f=function(e){return c+"-"+e},m=function(e){var t,i,n,s,a,o,r="";for(t=0,i=e.length;t<i;t+=1)if(n=e[t],/-value$/.test(n)&&(n=n.slice(0,-6)),/background-repeat-/.test(n)&&(n="background-repeat"),s=e.getPropertyValue(n),a=e.getPropertyPriority(n),o="-"===n.charAt(0)?n.slice(n.indexOf("-",1)+1):n,s&&(p[o]||p[o.slice(0,o.indexOf("-")+1)])){if("position"===n&&("fixed"===s&&(s="absolute"),!/^(?:absolute|relative|static)$/.test(s)))continue;"animation-name"===n&&(s=s.split(",").map(f).join(",")),r+=n,r+=":",r+=s,a&&(r+=" !"+a),r+=";"}return r},v=function(e,t){var i,n,s,a,o,r=e.cssRules;if(!r)return t;for(i=0,n=r.length;i<n;i+=1){switch(a=!1,(s=r[i]).type){case 1:o=s.selectorText||"",t.push(u?o.split(",").map(function(e){return/^(?:html|body)(?![\w\-])/.test(e)&&(e=e.slice(4).trim()),/^\*\s+[^\s>+~]/.test(e)&&(e=e.slice(1).trim()),"#"+c+" "+e.replace(/([#.]|\[\s*(?:id|class|for)\s*[~|^]?=\s*["'])/gi,"$1"+c+"-")}).join(","):o),t.push("{"),t.push(m(s.style)),t.push("}\n");break;case 4:t.push("@media "),t.push(s.media.mediaText),a=!0;break;case 7:t.push("@keyframes "),t.push(c+"-"+s.name),a=!0;break;case 8:t.push(s.keyText),t.push("{"),t.push(m(s.style)),t.push("}\n")}a&&(t.push("{\n"),v(s,t),t.push("}\n"))}return t},A=/^(?:https?:\/\/www\.fastmail\.(?:com|fm))?\/(?:html|mail|contacts|calendar|notes|settings|account|security|help)\//,y=/[?&;]u=/,b="file:"===location.protocol,w=function(e,t){"style"===t.tagName&&(e.textContent=v(e.sheet,[]).join(""))},S=function(t,i){var n=i.attrName,s=i.attrValue;if("style"===n&&(i.attrValue=m(t.style)),!u||"id"!==n&&"for"!==n||(i.attrValue=c+"-"+s),u&&"class"===n&&("gmail_quote"===s&&t.setAttribute("data-gmailquote","yes"),i.attrValue=s.trim().split(/\s+/).map(function(e){return c+"-"+e}).join(" ")),d&&"href"===n&&!b&&s&&A.test(s)&&!y.test(s)&&(i.attrValue=e.auth.authenticateUrl(s.slice(s.indexOf("/",8)))),!h||"src"!==n&&"background"!==n||/^data:/.test(s)||/^\/[^\/]/.test(s)||0===s.indexOf(e.baseDomain)||(i.keepAttr=!1,t.setAttribute("defang_"+n,s)),O.UA.isIOS&&("alt"===n||"title"===n)&&"IMG"===t.nodeName){s.length>30&&(t.setAttribute("defang_"+n,s),i.attrValue=s.slice(0,29)+"…")}},C=function(e){g&&"A"===e.nodeName&&(e.rel="noopener noreferrer",e.target="_blank")},x={FORBID_TAGS:"audio blink content decorator element marquee nobr template shadow spacer svg video".split(" "),FORBID_ATTR:"action method tabindex xmlns".split(" "),ADD_ATTR:["defang_src","defang_background","original_src","original_background"],ALLOW_DATA_ATTR:!1,ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!0,RETURN_DOM:!0},M=function(t,i,n){var s,a,o,p,f,m;if(c="defanged"+(l+=1),u=!!n.rewriteIds,d=!!n.rewriteInternalLinks,h=!!n.blockExternalImages,g=!!n.removeReferrer,s="<!DOCTYPE html><html><head><title></title>"+(i?'<style type="text/css">'+i+"</style>":"")+"</head><body>"+t+"</body></html>",DOMPurify.addHook("uponSanitizeElement",w),DOMPurify.addHook("uponSanitizeAttribute",S),DOMPurify.addHook("afterSanitizeAttributes",C),a=DOMPurify.sanitize(s,x),DOMPurify.removeAllHooks(),(m=document.createElement("div")).id=c,m.className="u-article",m.style.cssText="z-index:0;height:auto !important",!a)return m;if(n.isForCompose)return a.id=c,e.inlineStyles(a),a.lastElementChild;for(a=document.adoptNode(a),p=0,f=(o=Array.prototype.slice.call(a.getElementsByTagName("style"))).length;p<f;p+=1)m.appendChild(o[p]);for(p=0,f=(o=Array.prototype.slice.call(a.lastElementChild.childNodes)).length;p<f;p+=1)m.appendChild(o[p]);return n.collapseQuotes&&r(m,n.quoteComplexityMinCount),m};DOMPurify.isSupported||(M=function(t,i,n){var s=document.createElement("div");return s.innerHTML=t,e.inlineStyles(s,i),n.collapseQuotes&&r(s,n.quoteComplexityMinCount),s.className="u-article",s.style.cssText="z-index:0",s}),e.drawHTML=M}(FastMail),function(e){var t=/(\s|\b|^)((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,4}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s`!()\[\]{};:'".,<>?«»“”‘’]|\([^\s()<>]+\))|<(?:https?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,4}\/).*?>)|([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,4}\b)|(\*\S+\*(?:\s|$))|(\_\S+\_\b)/gi,i=/^https?:\/\/www\.fastmail\.(?:com|fm)\/(?:html|mail|contacts|calendar|notes|settings|account|security|help)\//,n=/[?&;]u=/,s="file:"===location.protocol?function(e){return e}:function(t){return i.test(t)&&!n.test(t)?e.auth.authenticateUrl(t.slice(t.indexOf("/",8))):t},a=function(i){var n,a,o,r,l,c=i.parent,u=i.data,d=[],h=0,g=e.auth.get("isVerified");for(t.lastIndex=0;n=t.exec(u);){if(a=n.index+(n[1]?1:0),o=n[2])"<"===o.charAt(0)&&(o=o.slice(1,-1),a+=1,t.lastIndex-=1),g||o!==e.baseDomain+"verify/"?r=s(/^(?:ht|f)tps?:\/\//i.test(o)?o:"http://"+o):(r=e.auth.authenticateUrl("/verify/"),o="[verify account to view link]"),l={isText:!1,type:"a",props:{href:r,text:o,rel:"noopener noreferrer",target:"_blank"},parent:c,children:[]};else if(o=n[3])l={isText:!1,type:"a",props:{href:"mailto:"+encodeURI(o),text:o},parent:c,children:[]};else if(o=n[4])l={isText:!1,type:"b",props:{text:o},parent:c,children:[]};else{if(!(o=n[5]))continue;l={isText:!1,type:"u",props:{text:o},parent:c,children:[]}}a!==h&&d.push({isText:!0,parent:c,data:u.slice(h,a)}),d.push(l),h=t.lastIndex}return d.length?(h<u.length&&d.push({isText:!0,parent:c,data:u.slice(h)}),d):null},o=O.Class({init:function(){this.root=this.current={isText:!1,type:"pre",props:{class:"u-article"},parent:null,children:[]}},addText:function(e){var t=this.current,i={isText:!0,parent:t,data:e};return t.children.push(i),i},addElem:function(e,t){var i=this.current,n={isText:!1,type:e,props:t,parent:i,children:[]};return i.children.push(n),n},addNodes:function(e){var t,i,n=this.current,s=n.children,a=s.length,o=e.length;for(t=0;t<o;t+=1)(i=e[t]).parent=n,s[a+t]=i;return this},addAndGoElem:function(e,t){return this.current=this.addElem(e,t),this},goRoot:function(){return this.current=this.root,this},goParent:function(){return this.current=this.current.parent,this},getCurrentChildren:function(){return this.current.children}}),r=/^(?:\s*>\s?)+/,l=/^(?:\-\-\s|_{47})\s*$/,c=function(e,t){var i=e.getCurrentChildren(),n=i.length-1,s=1,a=!0,o=i,r=n-1,l=o[r],c=l&&"footer"===l.type,u=function(e){return e&&e.isText&&!/\S/.test(e.data)};for(c&&(l=(o=l.children)[r=o.length-1]),u(l)&&(t?s+=1:(o.splice(r,1),n-=1),l=o[r-=1]),l&&l.isText&&/:\s*$/.test(l.data)?(s+=1,l=o[r-=1]):a=!1,a&&l&&l.isText&&/\d/.test(l.data)&&(s+=1,l=o[r-=1]),a&&l&&!u(l)&&!/^On /.test(o[r+1].data)&&(a=!1);t&&u(l);)s+=1,l=o[r-=1];a||(o=i,s=1,r=n-1),r+=1,t&&(e.addAndGoElem("div.u-quote-topPostToggle"),e.addElem("a.u-quote-link",{href:"",title:O.loc(0,'"'),text:O.loc(73)}),e.goParent()),e.addAndGoElem(t?"div.u-quote.u-quote--topPost":"div.u-quote",{"aria-hidden":"true"}),c&&a?(e.addNodes(o.splice(r,s-1)),e.addNodes(i.splice(n,1))):e.addNodes(o.splice(r,s)),e.addElem("div"),e.goParent(),t||(e.addAndGoElem("div.u-quote-toggle"),e.addElem("a.u-quote-link",{href:"",title:O.loc(0,'"'),text:O.loc(73)}),e.goParent())},u=function(e){var t,i,n=null,s=e.children,a=e.children=[];for(t=0,i=s.length;t<i;t+=1)(e=s[t]).isText?n?n.data+=e.data:(a.push(e),n=e):(a.push(e),n=null,u(e))},d=function(e){var t;return e.isText?t=document.createTextNode(e.data):(t=O.Element.create(e.type,e.props),h(t,e.children)),t},h=function(e,t){var i,n,s;for(i=0,n=t.length;i<n;i+=1)(s=t[i])instanceof Array?h(e,s):e.appendChild(d(t[i]))};e.drawPlainText=function(e,t){var i=function(e,t){var i,n,s,u,d,h,g,p,f,m=e.trim().split("\n"),v=new o,A=[],y=0,b=0,O=!1,w=!1;for(s=0,d=m.length;s<d;s+=1){if(h=m[s],i=0,n=r.exec(h)){if(n=n[0],!y&&/^\s*>>>\s/.test(n))for(u=s+1;u<d;u+=1){if(">"!==m[u].charAt(0)){n="";break}if(!/^\s*>>>\s/.test(m[u]))break}if(h=h.slice(n.length),(i=n.replace(/\s/g,"").length)!==y&&!/\S/.test(h))continue}if(y!==i){for(O&&(v.goParent(),O=!1);y<i;)y+=1,v.addAndGoElem("blockquote");for(;y>i;)v.goParent(),y-=1}w||i||0===s||!/^\-{2,}\s*original message\s*\-{2,}\s*$/i.test(h)||/^>/.test(m[s+1]||"")||(O&&(v.goParent(),O=!1),v.addAndGoElem("div"),w=!0),y?b+=1:(!w&&t&&b>5&&c(v,!1),b=0),!O&&l.test(h)&&(v.addAndGoElem("footer.signature"),O=!0),s+1!==d&&(h+="\n"),A.push(v.addText(h)),y+=0}for(t&&(b||w)&&(v.goRoot(),c(v,!0)),s=0,d=A.length;s<d;s+=1)g=A[s],(p=a(g))&&(f=g.parent.children,p.unshift(f.indexOf(g),1),f.splice.apply(f,p));return v.root}(e,t);return u(i),d(i)}}(FastMail),function(e){var t=document.implementation.createHTMLDocument?null:O.Element.create("iframe",{style:"visibility:hidden;position:absolute;top:0;left:0;width:1px;height:1px;"}),i=t?null:document.implementation.createHTMLDocument("");t&&(t.addEventListener("load",function(){var e,n=t.contentDocument;n&&("CSS1Compat"!==n.compatMode&&(n.open(),n.write("<!DOCTYPE html><title></title>"),n.close()),(e=n.documentElement)&&e.firstChild&&(i=n))},!1),document.body.appendChild(t));var n={float:"cssFloat","margin-left-value":"marginLeft","margin-left-ltr-source":"","margin-left-rtl-source":"","margin-right-value":"marginRight","margin-right-ltr-source":"","margin-right-rtl-source":"","padding-right-value":"paddingRight","padding-right-ltr-source":"","padding-right-rtl-source":"","padding-left-value":"paddingLeft","padding-left-ltr-source":"","padding-left-rtl-source":""},s=function(t){/^only /.test(t)&&(t=t.slice(5));for(var i,n,s=t.split(" and "),a=s.length;a--;)if("all"!==(i=s[a])&&"screen"!==i){if(n=/^\(m(in|ax)\-(.*?):\s*(\d+)px\s*\)/.exec(i)){var o=n[2],r="device-width"===o?screen.width:"device-height"===o?screen.height:"width"===o?e.views.mainWindow.get("pxWidth"):"height"===o?e.views.mainWindow.get("pxHeight"):void 0,l=+n[3];if("in"===n[1]?r>=l:r<=l)continue}return!1}return!0},a=function(e,t){var i,o,r,l,c,u,d,h,g,p,f,m=t.cssRules,v=t.media,A=v?v.length:0,y=e.nodeName.toLowerCase();for(p=0;p<A;p+=1)s(v[p]||v.mediaText||"")&&(A=0);if(!A&&m)for(f=m.length;f--;)if(1===(i=m[f]).type){if(A=(o=i.style)&&o.length,r=i.selectorText,!A||!r)continue;try{l=r===y?[e]:e.querySelectorAll(r)}catch(e){continue}for(c=l.length;A--;)if(d=o[A],u="important"===o.getPropertyPriority(d),d=n[d]||d.camelCase())for(h=o[d],p=0;p<c;p+=1)g=l[p].style,!u&&g[d]||(g[d]=h)}else 4===i.type&&a(e,i)},o=function(e){e.removeAttribute("id"),e.removeAttribute("class");var t,i,n,s=e.childNodes;if(s)for(i=0,n=s.length;i<n;i+=1)1===(t=s[i]).nodeType&&o(t)},r=7!==O.UA.msie&&8!==O.UA.msie;e.inlineStyles=function(e,t){for(var n,s=e.getElementsByTagName("style"),l=s.length;l--;)n=s[l],r&&n.sheet&&a(e,n.sheet),n.parentNode.removeChild(n);r&&t&&function(e,t){var n,s,o=i;o&&(n=o.documentElement.firstChild,(s=o.createElement("style")).type="text/css",s.appendChild(o.createTextNode(t)),n.appendChild(s),a(e,s.sheet),s.parentNode.removeChild(s))}(e,t),o(e)}}(FastMail),FastMail.toHTML=function(e,t){var i="<div"+(t?' style="'+t.replace(/"/g,"'")+'"':"")+">";return i+e.split("\n").map(function(e){return e.escapeHTML().replace(/ (?= )/g,"&nbsp;")||"<br>"}).join("</div>"+i)+"</div>"},function(e){var t=function(e,i,n,s){var a,o,r,l,c,u,d,h,g,p=s;for(a=0,o=i.length;a<o;a+=1){switch(l=(r=i[a]).childNodes,c=r.nodeName,u="",!n.length&&/^(?:P|H[1-6]|DIV|LI)$/.test(c)&&(h=(d=e.last())?d.charAt(d.length-1):"")&&"\n"!==h&&e.push("\n"),c){case"NOSCRIPT":case"SCRIPT":case"STYLE":case"#comment":continue;case"I":case"EM":case"B":case"STRONG":u="*";break;case"U":u="_";break;case"UL":n.push("*");break;case"OL":n.push(1);break;case"LI":var f=Math.max(0,n.length-1),m=n[f]||"*";u=" ".repeat(2*f+1),u+=m,"number"==typeof m&&(u+=".",n[f]=m+1),u+=" ";break;case"BLOCKQUOTE":p=s?">"+s:"> ";break;case"BR":u="\n";break;case"IMG":u=r.alt||"";break;case"#text":u=r.data}switch(u&&(s&&((h=(d=e.last())?d.charAt(d.length-1):"")&&"\n"!==h||e.push(s)),e.push(u)),l&&t(e,l,n,p),c){case"A":"/"===(g=(g=r.href).slice(g.indexOf(":")+1)).charAt(0)&&"/"===g.charAt(1)&&(g=g.slice(2)),"/"===g.charAt(g.length-1)&&(g=g.slice(0,-1)),r.textContent.indexOf(g)<0&&e.push("["+r.href+"]");break;case"I":case"EM":case"B":case"STRONG":e.push("*");break;case"U":e.push("_");break;case"UL":case"OL":n.pop();break;case"BLOCKQUOTE":p=s;break;case"DIV":case"LI":"\n"!==(h=(d=e.last())?d.charAt(d.length-1):"")&&e.push("\n");break;default:/^(?:P|H[1-6])$/.test(c)&&e.push("\n\n")}}};FastMail.toPlainText=function(e){var i,n,s=DOMPurify.sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,SANITIZE_DOM:!0}),a=[];return s?(t(a,s.childNodes,[],""),"\n"===((n=(i=a.length)?a[i-1]:"")&&n.charAt(n.length-1))&&(a[i-1]=n.slice(0,-1)),a.join("")):""}}(),function(e){var t=O.Class({Extends:O.MenuController,init:function(e){t.parent.init.call(this,e),this.setOptions(),this.filterDidChange()},setOptions:function(){var e=this.getFromPath("view.collection.childViews");this.set("options",e?e.slice():[])}.observes("view.collection.childViews"),selectFirst:function(e,t,i,n){this.focusOption(n[0]||null)}.observes("options"),hasSuggestions:!1,suggestions:function(){return new O.ObservableArray}.property(),filter:O.bind("view.inputView.value"),filterDidChange:function(){var e,t,i,n,s,a,o,r,l,c,u=this.get("filter")||"",d=this.getFromPath("view.sources"),h=[];if(u.length>=this.getFromPath("view.minChars"))for(e=0,t=d.length;e<t;e+=1)for(n=0,s=(i=d[e]).get("maxResults"),a=i.get("suggestions"),o=i.getTestFn(u),r=0,l=a.get("length");r<l&&n<s;r+=1)o(c=a.getObjectAt(r))&&(h.push({controller:this,source:i,suggestion:c,current:u}),n+=1);this.get("suggestions").set("[]",h),this.set("hasSuggestions",!!h.length)}.observes("filter"),onEscape:function(e){e.preventDefault(),this.set("hasSuggestions",!1)},keyBindings:{esc:"onEscape",tab:"selectFocussed",enter:"selectFocussed",up:"focusPrevious",down:"focusNext"}});e.AutoCompleteController=t}(FastMail),function(e){var t=O.Class({Extends:O.View,isFocussed:!1,isFocussable:!0,layerTag:"li",className:function(){return"v-AutoCompleteOption"+(this.get("isFocussed")?" is-focussed":"")}.property("isFocussed"),takeFocus:function(){this.get("content").controller.focusOption(this)}.on("mousemove"),loseFocus:function(){this.get("content").controller.blurOption(this)}.on("mouseout"),draw:function(e){var t=this.get("content"),i=t.source,n=t.suggestion,s=t.current;e.innerHTML=i.renderSuggestion(n,s)},activate:function(){var e=this.get("content"),t=e.controller.getFromPath("view.inputView"),i=t.get("value"),n=e.source.acceptSuggestion(e.suggestion,i);n!==i&&t.set("value",n).set("selection",{start:n.length}).fire("autocomplete")},activateOnClick:function(e){e.preventDefault(),this.activate()}.on("mousedown","tap")});e.AutoCompleteOptionView=t}(FastMail),function(e){var t=O.Class({Extends:O.Object,maxResults:10,suggestions:[],getTestFn:function(e){var t=O.i18n.makeSearchRegExp(e);return t.test.bind(t)},renderSuggestion:function(e){return e.escapeHTML()},acceptSuggestion:function(e){return e}});e.AutoCompleteSource=t}(FastMail),function(e){var t=O.Class({Extends:O.MenuView,isActive:!1,hasSuggestions:O.bind(null,"controller*hasSuggestions"),minChars:1,sources:[],controller:function(){return new e.AutoCompleteController({view:this})}.property(),init:function(e){t.parent.init.call(this,e);var i,n=this.get("inputView");n&&this.inputViewDidChange(i,i,i,n)},inputView:null,inputViewDidChange:function(e,t,i,n){i&&(delete i.blurOnKeys,i.off("focus",this,"inputDidReceiveFocus"),i.off("blur",this,"inputDidLoseFocus"),i.off("keydown",this,"inputDidKeydown")),n&&(n.blurOnKeys={},n.on("focus",this,"inputDidReceiveFocus"),n.on("blur",this,"inputDidLoseFocus"),n.on("keydown",this,"inputDidKeydown"),n.get("isFocussed")&&this.inputDidReceiveFocus())}.observes("inputView"),inputDidReceiveFocus:function(){this.set("isActive",!0)},inputDidLoseFocus:function(){this.set("isActive",!1)},inputDidKeydown:function(e){this.get("isActive")&&this.get("hasSuggestions")?this.get("controller").triggerKeyBinding(e):"esc"===O.DOMEvent.lookupKey(e)&&this.get("inputView").blur()},collection:null,ItemView:e.AutoCompleteOptionView,className:function(){return this.get("isActive")&&this.get("hasSuggestions")?"v-AutoComplete":"u-hidden"}.property("isActive","hasSuggestions"),positioning:"absolute",draw:function(){var e=new O.ListView({content:this.get("controller").get("suggestions"),layerTag:"ul",ItemView:this.get("ItemView")});return this.set("collection",e),e},fireShortcut:function(){}});e.AutoCompleteView=t}(FastMail),function(e){var t=O.LocaleController.letterAlternatives,i=function(e){return t[e.toUpperCase()]},n={},s=function(e){return n[e]||(n[e]=new RegExp('(?:^|["\\s<@\\(])'+e.escapeRegExp().replace(/[A-Z]/gi,i)+".*\\b","i"))},a={},o=function(e){return a[e]||(a[e]=new RegExp('(^|"|\\s|&lt;|@|\\()('+e.escapeHTML().escapeRegExp().replace(/[A-Z]/gi,i)+")","gi"))},r=O.Class({Mixin:O.ComputedProps,contact:null,index:0,init:function(e,t){this.contact=e,this.index=t},displayName:function(){var e=this.contact,t=e.get("name"),i=e.get("nickname"),n=this.get("email");return(t?t+" ":"")+(i?"("+i+") ":"")+(t||i?"<"+n+">":n)}.property(),nameAndEmail:function(){var e=this.contact.get("emailName"),t=this.get("email");return e?e+" <"+t+">":t}.property(),email:function(){return this.contact.get("emails")[this.index].value}.property()}),l=function(e){var t=this.get("divider");if(!(e=e.slice(e.lastIndexOf(t)+t.length).trim()))return function(){return!1};var i=e.split(" ").map(s);return function(e){var t=e.get("displayName");return i.every(function(e){return e.test(t)})}},c=function(e,t){var i=e.get("displayName").escapeHTML(),n=this.get("divider");return t.slice(t.lastIndexOf(n)+n.length).trim().split(" ").map(o).forEach(function(e){i=i.replace(e,"$1<em>$2</em>")}),i},u=function(e,t){var i=e.get("nameAndEmail"),n=this.get("divider");return i?(t=t.slice(0,t.lastIndexOf(n)+n.length||null))+(t?" ":"")+i+", ":t},d=new e.AutoCompleteSource({divider:",",contacts:e.store.getQuery("contactsWithEmails",O.LiveQuery,{Type:e.Contact,filter:function(e){return!(!e.emails||!e.emails.length)},sort:["isFlagged","importance"],storeDidChangeRecords:function(e){var t=O.LiveQuery.prototype.storeDidChangeRecords.call(this,e);return t||this.computedPropertyDidChange("[]"),t}}),suggestions:function(){return this.get("contacts").reduce(function(e,t){var i,n=t.get("emails"),s=n.get("length"),a=t.get("defaultEmailIndex");if(s)for(/^\*@/.test(n[a].value)||e.push(new r(t,a)),i=0;i<s;i+=1)i===a||/^\*@/.test(n[i].value)||e.push(new r(t,i));return e},[])}.property("contacts.[]"),getTestFn:l,renderSuggestion:c,acceptSuggestion:u});e.EmailAutoCompleteSource=d,e.ContactGroupAutoCompleteSource=new e.AutoCompleteSource({divider:",",suggestions:e.store.getQuery("contactGroups",O.LiveQuery,{Type:e.ContactGroup,sort:"name"}),getTestFn:l,renderSuggestion:c,acceptSuggestion:u})}(FastMail),function(e){var t=O.Class({Extends:O.SelectView,className:function(){return"v-CustomSelect "+this.get("type")+(this.get("isDisabled")?" is-disabled":"")}.property("type","isDisabled"),type:"v-CustomSelect--link",label:function(){var e=this.get("value"),t=this.get("options"),i=t&&(t.find(function(t){return t.value===e})||t.first()),n=i?i.text:"";return n.replace(/\s*\(.*/g,"")||n}.property("options","value")});e.CustomSelectView=t}(FastMail),function(e,t){var i=O.Class({Extends:O.TextView,init:function(e){i.parent.init.call(this,e),this._maySyncValue=!0,this.get("value")||this.setValueFromNumber()},mayBeFloating:!1,decimalPlaces:void 0,number:0,minValue:0,maxValue:2147483647,type:"v-NumberText",inputAttributes:function(){return this.get("mayBeFloating")?{pattern:"[0-9]*[.][0-9]*"}:{pattern:"[0-9]*"}}.property("mayBeFloating"),setValueFromNumber:function(){if(this._maySyncValue){var e=this.get("decimalPlaces"),t=this.get("number"),i=void 0===e?t+"":t.toFixed(e);this.set("value",i)}}.observes("number"),enforceChars:function(){var e=this.get("mayBeFloating"),t=this.get("minValue")<0?e?/[^\-\.\d]/g:/[^\-\d]/g:e?/[^\.\d]/g:/\D/g;this.set("value",this.get("value").replace(t,""))}.queue("before").on("input"),syncNumber:function(){var e=this.get("value"),t=this.get("mayBeFloating")?parseFloat(e):parseInt(e,10);isNaN(t)||(t=t.limit(this.get("minValue"),this.get("maxValue")),this._maySyncValue=!1,this.set("number",t),this._maySyncValue=!0),this.get("isFocussed")||this.setValueFromNumber()}.observes("value","isFocussed"),upDown:function(e){var t=O.DOMEvent.lookupKey(e,!0);if("up"===t||"down"===t){var i=this.get("selection"),n=i.start;if(n!==i.end)return;e.preventDefault();var s=parseFloat(this.get("value"))||0;"up"===t?s<this.get("maxValue")&&(s+=1):s>this.get("minValue")&&(s-=1),this.set("number",s).set("selection",n).fire("input")}}.on("keydown")});e.NumberTextView=i}(FastMail),function(e){var t=O.Class({Extends:O.View,isHidden:!0,alignWithView:null,alignToThe:"top",text:"",positioning:"absolute",syncOnlyInDocument:!1,className:function(){return"v-InfoBubble v-InfoBubble--"+this.get("alignToThe")}.property("alignToThe"),insertOrRemove:function(){var e=!this.get("isHidden")&&!!this.get("alignWithView"),t=this.get("isInDocument"),i=this.get("rootView");e&&!t&&i.insertView(this),!e&&t&&i.removeView(this)}.queue("render").observes("isHidden","alignWithView"),monitorScrolls:function(){var e=this.get("alignWithView"),t=this._scrollAncestors;if(t&&t.forEach(function(e){e.off("scroll",this,"parentViewDidResize")},this),t=null,e)for(t=[];e=e.getParent(O.ScrollView);)e.on("scroll",this,"parentViewDidResize"),t.push(e);this._scrollAncestors=t}.observes("alignWithView"),layout:function(){var e=this.get("alignWithView");if(!e)return{};var t=this.get("alignToThe"),i=e.get("layer").getBoundingClientRect(),n={top:parseInt(i.top,10),left:parseInt(i.left,10)};return"right"===t?n.left+=parseInt(i.right-i.left,10):"bottom"===t&&(n.top+=parseInt(i.bottom-i.top,10)),n}.property("alignWithView","alignToThe"),draw:function(e,t,i){return[i("span.v-InfoBubble-content",[i("span",{text:O.bind(this,"text")}),i("b.v-InfoBubble-callout")])]},parentViewDidResize:function(){this.computedPropertyDidChange("layout")}});e.InfoBubbleView=t}(FastMail),function(e){e.Inspector={ScrollView:O.Class({Extends:O.ScrollView,positioning:"relative",setHeight:function(t){var i=this.getParent(O.ScrollView),n=O.UA.isIOS?e.iOSKeyboard.keyboardHeight:0;this.set("layout",{zIndex:1,maxHeight:(i?i.get("pxHeight")-106:e.views.mainWindow.get("pxHeight")-(O.UA.isIOS?90:124))-n}),t&&this.redraw()},setHeightBefore:function(){this.setHeight()}.queue("before"),willEnterDocument:function(){return this.setHeight(),e.views.mainWindow.addObserverForKey("pxHeight",this,"setHeightBefore"),O.UA.isIOS&&e.iOSKeyboard.addObserverForKey("keyboardHeight",this,"setHeightBefore"),O.ScrollView.prototype.willEnterDocument.call(this)},willLeaveDocument:function(){return e.views.mainWindow.removeObserverForKey("pxHeight",this,"setHeightBefore"),O.UA.isIOS&&e.iOSKeyboard.removeObserverForKey("keyboardHeight",this,"setHeightBefore"),O.ScrollView.prototype.willLeaveDocument.call(this)}}),scrollIntoView:function(){var e,t,i,n,s;this.get("isInDocument")&&(e=this.getParent(O.ScrollView))&&(i=(t=(s=this.getParent(O.PopOverView)).get("layout").top-10-26)+s.get("pxHeight")+10+26+10,t<(n=e.get("scrollTop"))?e.scrollTo(0,t,!0):i>n+e.get("pxHeight")&&e.scrollTo(0,Math.min(t,i-e.get("pxHeight")),!0))}.queue("after").observes("isInDocument")}}(FastMail),function(e){var t=O.Class({Extends:O.View,className:"v-ModalOverlay",positioning:"absolute",layout:O.extend({zIndex:100},O.View.LAYOUT_FILL_PARENT),rootView:null,eventHandler:function(){return new O.ModalEventHandler({view:this})}.property(),didEnterDocument:function(){return O.ViewEventsController.addEventTarget(this.get("eventHandler"),10),e.views.mainWindow.blurActive(),t.parent.didEnterDocument.call(this)},willLeaveDocument:function(){return O.ViewEventsController.removeEventTarget(this.get("eventHandler")),t.parent.willLeaveDocument.call(this)},stopEvents:function(e){e.stopPropagation()}.on("click","mousedown","mouseup","keypress","keydown","keyup","tap"),show:function(){this.get("rootView").insertView(this)},hide:function(){this.get("rootView").removeView(this)}});e.ModalOverlayView=t}(FastMail),function(e,t){var i=O.Class({Extends:O.View,options:[],className:"v-PushSelect",draw:function(e,t,i){var n=this.get("value");return i("div.v-PushSelect-content",this.get("options").reduce(function(e,t,s){return s&&e.push("​"),e.push(i("a",O.extend({className:"v-PushSelect-option"+(t.className?" "+t.className:"")+(t.value===n?" is-selected":""),href:"","data-index":s},t,!0))),e},[]))},pushSelectNeedsRedraw:function(e,t,i){return this.propertyNeedsRedraw(e,t,i)}.observes("options","value"),redrawOptions:function(e){var t=O.Element;e.replaceChild(this.draw(e,t,t.create),e.firstChild)},redrawValue:function(e,t){var i=O.Element,n=this.get("value"),s=e.firstChild.childNodes;this.get("options").forEach(function(e,a){e.value===t&&i.removeClass(s[2*a],"is-selected"),e.value===n&&i.addClass(s[2*a],"is-selected")})},_selectOption:function(e){var t=e.target.get("data-index");null!=t&&(this.set("value",this.get("options").getObjectAt(t).value),e.preventDefault())}.on("click")});e.PushSelectView=i}(FastMail),function(e){var t=O.Class({Extends:O.Animation,isDecelerating:!1,startX:0,startY:0,endX:0,endY:0,prepare:function(e){if(!e)return this.isDecelerating=!0,!0;this.isDecelerating=!1;var t=this.object,i=this.startX=t.get("scrollLeft"),n=this.startY=t.get("scrollTop"),s=this.endX=e.x||0,a=this.endY=e.y||0,o=this.deltaX=s-i,r=this.deltaY=a-n;return!(!o&&!r)},drawFrame:function(e,t){var i,n,s=this.object;return this.isDecelerating?s.drawDecelerationFrame(t)||this.stop():(i=e<1?this.startX+e*this.deltaX:this.endX,n=e<1?this.startY+e*this.deltaY:this.endY,s._scrollTo(Math.round(i),Math.round(n))),this}}),i=function(e,t){for(var i=0,n=e.length;i<n;i+=1)if(e[i].identifier===t)return e[i];return null},n=O.ScrollView.prototype,s=O.Class({Extends:O.View,keys:{},init:function(e){this._scrollContents=null,this._initialTouchLeft=0,this._initialTouchTop=0,this._initialTouchTime=0,this._lastTouchLeft=0,this._lastTouchTop=0,this._lastTouchTime=0,this._enableScrollX=!1,this._enableScrollY=!1,this._trackingId=null,this._isDragging=!1,this._positions=[],this._times=[],this._velocityX=0,this._velocityY=0,this._lastFrameTime=0,this.allowDefaultTouch=!1,this.showScrollbarX=!1,this.showScrollbarY=!0,this.isInfinite=!1,this.allowBounce=!1,this.scrollLeft=0,this.scrollTop=0,s.parent.init.call(this,e)},didEnterDocument:function(){var e,t=this.get("keys"),i=O.ViewEventsController.kbShortcuts;for(e in t)i.register(e,this,t[e]);return s.parent.didEnterDocument.call(this)},willLeaveDocument:function(){var e,t=this.get("keys"),i=O.ViewEventsController.kbShortcuts;for(e in t)i.deregister(e,this,t[e]);return s.parent.willLeaveDocument.call(this)},positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,layerStyles:function(){var e=O.View.prototype.layerStyles.call(this);return e.overflow="hidden",e}.property("layout","allowTextSelection","positioning"),draw:function(e,t,i){var n=i("div",{style:"position:relative;min-height:100%;min-width:100%"},[s.parent.draw.call(this,e,t,i)]);return this._scrollContents=n,this.redrawScroll(),[n]},insertView:function(e,t,i){return!t&&this.get("isRendered")&&"before"!==i&&"after"!==i&&(t=this.get("layer").firstChild),s.parent.insertView.call(this,e,t,i)},scrollPage:n.scrollPage,reverseScrollPage:n.reverseScrollPage,scrollLine:n.scrollLine,reverseScrollLine:n.reverseScrollLine,scrollBy:n.scrollBy,scrollToView:n.scrollToView,scrollAnimation:function(){return new t({object:this})}.property(),scrollWidth:function(){return this.get("layer").scrollWidth}.property("isInDocument"),scrollHeight:function(){return this.get("layer").scrollHeight}.property("isInDocument"),maxScrollX:function(){return this.get("showScrollbarX")?Math.max(0,this.get("scrollWidth")-this.get("pxWidth")):0}.property("scrollWidth","pxWidth"),maxScrollY:function(){return this.get("showScrollbarY")?Math.max(0,this.get("scrollHeight")-this.get("pxHeight")):0}.property("scrollHeight","pxHeight"),scrollTo:function(e,t,i){if(this.isInfinite||(e&&(e=Math.min(e,this.get("maxScrollX")))<0&&(e=0),t&&(t=Math.min(t,this.get("maxScrollY")))<0&&(t=0)),e!==this.get("scrollLeft")||t!==this.get("scrollTop")){var n=this.get("scrollAnimation").stop();i?n.animate({x:e,y:t},250,O.Easing.ease):this.beginPropertyChanges().set("scrollLeft",e).set("scrollTop",t).endPropertyChanges().propertyNeedsRedraw(this,"scroll")}return this},_scrollTo:function(e,t){this.set("scrollLeft",e).set("scrollTop",t),this.redrawScroll()},redrawScroll:function(){var e=this.get("scrollLeft"),t=this.get("scrollTop");O.Element.setStyle(this._scrollContents,"transform","translate3d("+-e+"px,"+-t+"px,0)")},onTouchStart:function(e){var t=e.touches,i=t[0],n=i.screenX,s=i.screenY,a=e.timeStamp||Date.now(),o=this.get("scrollAnimation");t.length>1||(o.isRunning&&(o.stop(),this.get("allowDefaultTouch")||e.preventDefault(),O.Tap.cancel()),this._initialTouchLeft=n,this._initialTouchTop=s,this._initialTouchTime=a,this._lastTouchLeft=n,this._lastTouchTop=s,this._lastTouchTime=a,this._enableScrollX=!1,this._enableScrollY=!1,this._trackingId=i.identifier,this._isDragging=!1)}.on("touchstart"),onTouchMove:function(e){var t,n,s,a,o,r,l,c=e.timeStamp||Date.now(),u=this.scrollLeft,d=this.scrollTop,h=this.isInfinite,g=i(e.changedTouches,this._trackingId);g&&(t=g.screenX,n=g.screenY,this.get("allowDefaultTouch")||e.preventDefault(),this._isDragging?(e.stopPropagation(),o=t-this._lastTouchLeft,r=n-this._lastTouchTop,this._enableScrollX?(u-=o,h||(u>(s=this.get("maxScrollX"))||u<0)&&(this.allowBounce?u+=o>>1:u=u>s?s:0)):o=0,this._enableScrollY?(d-=r,h||(d>(a=this.get("maxScrollY"))||d<0)&&(this.allowBounce?d+=r>>1:d=d>a?a:0)):r=0,this.set("scrollLeft",u).set("scrollTop",d).propertyNeedsRedraw(this,"scroll"),this._positions.push(t,n),this._times.push(c)):(o=Math.abs(t-this._initialTouchLeft),r=Math.abs(n-this._initialTouchTop),(o>=5||r>=5)&&(l=this._enableScrollX=this.get("showScrollbarX")&&o>=3,l=(this._enableScrollY=this.get("showScrollbarY")&&r>=3)||l,this._isDragging=l,l&&(O.Tap.cancel(),O.ViewEventsController.addEventTarget(this,100)))),this._lastTouchLeft=t,this._lastTouchTop=n,this._lastTouchTime=c)}.on("touchmove"),onTouchEnd:function(e){if(i(e.changedTouches,this._trackingId)&&(this._trackingId=null,this._isDragging)){var t=this._lastTouchTime,n=this._times,s=this._positions,a=s.length,o=n.binarySearch(t-100),r=t-n[o],l=r&&this.get("showScrollbarX")?-(s[a-2]-s[2*o])/r*(1e3/60):0,c=r&&this.get("showScrollbarY")?-(s[a-1]-s[2*o+1])/r*(1e3/60):0;c*this._velocityY>0&&Math.abs(c)>30&&t-this._initialTouchTime<100&&(c+=this._velocityY),e.stopPropagation(),this._isDragging=!1,(this.allowBounce||Math.abs(l)>1||Math.abs(c)>1)&&(this._velocityX=l,this._velocityY=c,this._lastFrameTime=0,this.get("scrollAnimation").animate(null,6e4,O.Easing.linear)),n.length=0,s.length=0,O.ViewEventsController.removeEventTarget(this)}}.on("touchend","touchcancel"),drawDecelerationFrame:function(e){for(var t=e?Math.round((e-(this._lastFrameTime||e))/(1e3/60))-1:0;t-- >0;)this.drawDecelerationFrame(0);var i,n,s=this.scrollLeft,a=this.scrollTop,o=this._velocityX,r=this._velocityY,l=0,c=0;return s+=o,a+=r,o*=.95,r*=.95,this.isInfinite||(i=this.get("maxScrollX"),n=this.get("maxScrollY"),this.allowBounce?(s<0&&(l=-s),s>i&&(l=i-s),a<0&&(c=-a),a>n&&(c=n-a),l<-.01||.01<l?l*o<=0?o+=.08*l:o=.15*l:(l=0,s=Math.round(s)),c<-.01||.01<c?c*r<=0?r+=.08*c:r=.15*c:(c=0,a=Math.round(a))):(s<0&&(s=0,o=0),s>i&&(s=i,o=0),a<0&&(a=0,r=0),a>n&&(a=n,r=0))),e?(this._scrollTo(s,a),this._lastFrameTime=e):(this.scrollLeft=s,this.scrollTop=a),this._velocityX=o,this._velocityY=r,!(!l&&!c)||Math.abs(o)>=.1||Math.abs(r)>=.1}});e.TouchScrollView=s}(FastMail);
