"use strict";FastMail.theme.imageDidLoad("all","arrowdown.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAMAAABl5a5YAAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAACVJREFUeAFjgABGIICwBq8AIxpAF0FXg6oLYS6CjyqC1x0McD4APG4AcTuYeksAAAAASUVORK5CYII="),FastMail.theme.imageDidLoad("all","arrowleft.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQCAMAAAAs2N9uAAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAAC1JREFUeAFtzKERADAMgEDYf+maiF4I8gVMsjNkyJAhQ+4iN9XO/Rg1atRIHz1EJABxtk/TOQAAAABJRU5ErkJggg=="),FastMail.theme.imageDidLoad("all","arrowup.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAMAAABl5a5YAAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAAClJREFUeAFjgAJGRgiN4KOKMIIBOh8hwggHMD4CIPgIEUY0gGHtoBUAAEvWAHFn0x5LAAAAAElFTkSuQmCC"),FastMail.theme.imageDidLoad("all","collapsedavatar.png","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAAAAACpleexAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAfElEQVQ4y+3SQQuCYBCE4fn//+tFDQqMDG8RhEIRXcWD4+FTuuTiNXRvz+7cZsXK0XaDxe3ZXOfNAgRcett+ZxBAcOht235AAME9yUNGAMFroksCCNqZRwII6kkdBBDwSawggIC8td2l0yJSM/n59O3gNzb8j3twD/5bcAQf6fmbCezMdwAAAABJRU5ErkJggg=="),function(e){e.searchMailbox=new O.Object({mailboxId:"search",search:O.bind(e,"mail*search"),sort:"dateDescending",unread:0,total:0,role:"",inheritedRole:"",searchMailbox:O.bind(e,"mail*mailboxId",function(t){return t?e.store.getRecord(e.Mailbox,t):null}),savedSearchName:O.bind(e,"mail*savedSearch.displayName",O.Transform.defaultValue("")),searchIsGlobal:O.bind(e,"mail*searchIsGlobal"),enableConversations:O.bind(e.preferences,"enableConversations"),useConversations:function(){return this.get("enableConversations")&&(this.get("searchIsGlobal")||this.getFromPath("searchMailbox.isOwn"))}.property("searchMailbox","searchIsGlobal","enableConversations"),displayName:function(){return this.get("savedSearchName")||O.loc(1305)+": "+this.get("search")}.property("search","savedSearchName"),personality:function(){return this.getFromPath("searchMailbox.personality")}.property("searchMailbox"),permissions:function(){return this.getFromPath("searchMailbox.permissions")}.property("searchMailbox")});var t={body:" "},i=O.Class({Extends:e.MailboxMessageList,isSearch:!0,isGlobal:!1,canGetDeltaUpdates:!1,mailbox:e.searchMailbox,init:function(e){this._snippets={},this._snippetsNeeded=[],this._convIdToMsgIds={},this._exemplarToConvId={},i.parent.init.call(this,e)},sourceDidFetchSnippets:function(t){var i,s=e.store,n=e.MessageHeader,o=O.Status.READY;for(i in O.extend(this._snippets,t),t)s.getRecordStatus(n,i)&o&&s.getRecord(n,i).propertyDidChange("snippet")},getSnippet:function(e){var i=this._snippets[e];return i||(this._snippetsNeeded.push(e),this._snippets[e]=i=t,this.fetchSnippets()),i},fetchSnippets:function(){e.api.mail.callMethod("getSearchSnippets",{search:this.get("filter"),mailboxId:this.get("mailboxId"),messageIdList:this._snippetsNeeded}),this._snippetsNeeded=[]}.queue("middle"),sourceDidFetchConversationMatches:function(e){for(var t in O.extend(this._convIdToMsgIds,e),e)this._exemplarToConvId[e[t][0]]=t},getMatches:function(e){return this._convIdToMsgIds[e]||null}});e.api.mail.getSearchList=function(e){var t="s"+(e.mailboxId||"g")+":"+e.search;return this.get("store").getQuery(t)},e.api.mail.handle(i,{query:e.api.mail.queryFetchers[O.guid(e.MailboxMessageList)],searchMessageList:function(e){var t=this.getSearchList(e);t&&(e.position-=1,e.idList=e.messageIdList,e.filter=e.search,t.sourceDidFetchIdList(e))},searchSnippets:function(e){var t=this.getSearchList(e);t&&t.sourceDidFetchSnippets(e.snippets)},searchConversationMatches:function(e){var t=this.getSearchList(e);t&&t.sourceDidFetchConversationMatches(e.matches)}}),e.SearchMessageList=i}(FastMail),function(e,t){var i=O.Status,s=i.EMPTY|i.OBSOLETE,n=i.DESTROYED|i.NON_EXISTENT,o=i.LOADING,a={to:1,cc:1,bcc:1,subject:1,body:1},r=function(t){return!e.preferences.get("showReadingPane")||"conversation"!==t&&"mailbox"!==t?t:"mailboxconv"},l=e.mail=new O.Object({app:"mail",appName:O.loc(18),title:O.bind("screenController.title"),_isActive:!1,isReady:!!e.systemFolderIds.get("inbox"),becameReady:function(){this.set("isReady",!0),e.systemFolderIds.removeObserverForKey("inbox",this,"becameReady"),this.restoreStateFromUrl(this._url||""),delete this._url,this._isActive&&(e.loading.exit(),this.enter())},enter:function(){this._isActive=!0,this.get("isReady")?(e.views.mainWindow.insertView(e.views.mail),this.actions.setupKB()):e.loading.enter()},exit:function(){this._isActive=!1,this.get("isReady")?(this.actions.teardownKB(),e.views.mainWindow.removeView(e.views.mail)):e.loading.exit()},routes:[{url:/^compose(?::(.*))?$/,handle:function(t,i){i&&"mailto"===i.slice(0,6)&&(i="to="+i.slice(7).replace("?","&"));var s=i?Object.filter(Object.fromQueryString(i),a):null;i&&t===e.base.get("currentPath").slice(5)&&e.base.set("replaceState",!0),this.set("composeDetails",s).set("screen","compose"),this.get("mailboxId")||this.set("mailboxId",e.systemFolderIds.get("inbox"))}},{url:/^search:([^\/]+)\/$/,handle:function(t,i){this.beginPropertyChanges(),this.get("mailboxId")||this.set("mailboxId",e.systemFolderIds.get("inbox")),this.set("searchIsGlobal",!0).set("search",decodeURIComponent(i.replace(/\+/g,"%20"))).set("screen","mailbox"),this.endPropertyChanges()}},{url:/^search:(.*?)\/(.*?)$/,handle:function(t,i,s){var n=s.indexOf("-"),o=n>-1?s.slice(n+1):s,a=n>-1?s.slice(0,n):"";this.beginPropertyChanges(),this.get("mailboxId")||this.set("mailboxId",e.systemFolderIds.get("inbox")),this.set("searchIsGlobal",!0).set("search",decodeURIComponent(i.replace(/\+/g,"%20"))).set("messageId",o).set("conversationId",a).set("screen","conversation"),this.endPropertyChanges()}},{url:/^([^\/]+)\/search:([^\/]+)\/$/,handle:function(e,t,i){this.beginPropertyChanges(),this.set("mailboxId",this._getMailboxIdFromUrl(t)).set("searchIsGlobal",!1).set("search",decodeURIComponent(i.replace(/\+/g,"%20"))).set("screen","mailbox"),this.endPropertyChanges()}},{url:/^([^\/]+)\/search:(.*?)\/(.*?)$/,handle:function(e,t,i,s){var n=s.indexOf("-"),o=n>-1?s.slice(n+1):s,a=n>-1?s.slice(0,n):"";this.beginPropertyChanges(),this.set("mailboxId",this._getMailboxIdFromUrl(t)).set("searchIsGlobal",!1).set("search",decodeURIComponent(i.replace(/\+/g,"%20"))).set("messageId",o).set("conversationId",a).set("screen","conversation"),this.endPropertyChanges()}},{url:/^([^\/]+)\/?$/,handle:function(e,t){this.beginPropertyChanges().set("mailboxId",this._getMailboxIdFromUrl(t)).set("search","").set("screen","mailbox").endPropertyChanges()}},{url:/^(.*?)\/(.*?)$/,handle:function(e,t,i){var s=i.indexOf("-"),n=s>-1?i.slice(s+1):i,o=s>-1?i.slice(0,s):"";this.beginPropertyChanges().set("mailboxId",this._getMailboxIdFromUrl(t)).set("search","").set("messageId",n).set("conversationId",o).set("screen","conversation").endPropertyChanges()}},{url:/.*/,handle:function(){e.base.set("replaceState",!0),this.beginPropertyChanges().set("mailboxId",e.systemFolderIds.get("inbox")).set("search","").set("screen","mailbox").endPropertyChanges()}}],_getMailboxIdFromUrl:function(t){var i,s=e.store.getAll(e.Mailbox),n=s.get("length");for(t=decodeURIComponent(t);n--&&(!(i=s.getObjectAt(n)).get("permissions").mayRead||i.get("urlName")!==t););return n>-1?i.get("mailboxId"):e.systemFolderIds.get("inbox")},restoreStateFromUrl:function(e){this.get("isReady")?O.Router.prototype.restoreStateFromUrl.call(this,e):this._url=e},screen:null,mailboxId:"",conversationId:"",messageId:"",search:"",searchIsGlobal:!0,userTriggeredRefresh:!1,encode:function(t){if(t===this&&!this.get("isReady"))return this._url||"";var i,s="",n=t.screen;if("compose"===n)s="compose";else{if(!t.search||!t.searchIsGlobal){if((i=t.mailboxRecord||t.mailboxId&&e.store.getRecord(e.Mailbox,t.mailboxId))||(i=e.store.getRecord(e.Mailbox,e.systemFolderIds.get("inbox"))),!i)return"";s=encodeURIComponent(i.get("urlName"))+"/"}t.search&&(s+="search:"+encodeURIComponent(t.search).replace(/%20/g,"+")+"/"),"conversation"===n&&(t.conversationId&&(s+=t.conversationId,s+="-"),s+=t.messageId)}return s},encodedState:function(){return this.encode(this)}.property("screen","mailboxId","conversationId","messageId","search","searchIsGlobal"),screenController:null,setReadingPaneScreen:function(){"mailboxconv"===r(this.get("screen"))&&this.set("screen",l.selection.get("length")||!this.get("conversationMessageList")?"mailbox":"conversation")}.observes("screen","selection.length","conversationMessageList"),screenDidChange:function(){var e=this.get("screen");e&&O.require("compose"===e?e:"mail",function(){this.get("screen")===e&&this.updateScreen()},this)}.observes("screen"),updateScreen:function(){var t,i,s=r(this.get("screen")),n=this.screens,o=n[s],a=this.get("screenController"),l=e.views.mailScreen;o&&a!==o&&(o===n.mailbox&&a===n.conversation&&this.get("search")&&this.selectedMessage._indexDidChange(),a&&a.deactivate(),o.activate(a),this.set("screenController",o),(t=l.get("childViews")[0])!==(i=e.views[s])&&l.removeView(t).insertView(i))}.queue("render"),mailbox:function(){var t=this.get("mailboxId");return this.get("search")?e.searchMailbox:t?e.store.getRecord(e.Mailbox,t):null}.property("mailboxId","search"),inGlobalSearch:function(){return!!this.get("search")&&this.get("searchIsGlobal")}.property("search","searchIsGlobal"),setGlobal:function(){var t=this.get("search");if(t)if(/\b(?:in|folder):/.test(t))this.set("searchIsGlobal",!0);else{var i=this.get("mailboxId"),s=e.systemFolderIds;i!==s.get("trash")&&i!==s.get("spam")||this.get("savedSearch")||this.set("searchIsGlobal",!1)}else this.get("mailbox").get("isOwn")||this.set("searchIsGlobal",!1)}.observes("mailboxId","search"),mailboxMessageList:function(){var t=e.store,i=this.get("mailboxId"),s=this.get("search"),n=this.get("searchIsGlobal"),o=s?"s"+(n?"g":i)+":"+s:i,a=o&&t.getQuery(o);return a?a.refresh(!0):o?s?t.getQuery(o,e.SearchMessageList,{filter:s,mailboxId:n?null:i,isGlobal:n}):t.getQuery(o,e.MailboxMessageList,{}):null}.property("mailboxId","search","searchIsGlobal"),mboxStatus:O.bind("mailboxMessageList.status"),mboxStatusDidChange:function(e,t,i,n){n&s&&!(n&o)&&(this.set("userTriggeredRefresh",!0),this.get("mailboxMessageList").refresh(!1,function(){l.set("userTriggeredRefresh",!1)}))}.observes("mboxStatus"),conversationMessageList:function(){var t=this.get("conversationId"),i=this.get("messageId"),s=t&&e.store.getQuery(t);return s?s.refresh(!0):t?e.store.getQuery(t,e.ConversationMessageList,{conversationId:t}):i?new O.ObservableArray([e.store.getRecord(e.MessageHeader,i)]):null}.property("conversationId","messageId"),convStatus:O.bind("conversationMessageList.status"),convStatusDidChange:function(e,t,i,a){a&&(a&n?"conversation"===this.get("screen")&&this.set("screen","mailbox"):a&s&&!(a&o)&&this.get("conversationMessageList").refresh())}.observes("convStatus"),savedSearch:function(){var t,i=this.get("search"),s=null;return i&&(t=this.get("searchIsGlobal")?null:this.get("mailboxId"),s=e.store.getOne(e.SavedSearch,function(e){return e.search===i&&e.mailboxId===t})),s}.property("search","searchIsGlobal","mailboxId"),refindSavedSearch:function(){this.computedPropertyDidChange("savedSearch")},goUp:function(){var t,i=this.get("screen");return"compose"===i?(e.mail.screens.compose.exit(),!0):"conversation"===i?(this.set("screen","mailbox"),!0):this.get("search")?(this.set("search",""),!0):(t=e.systemFolderIds.get("inbox"),this.get("mailboxId")!==t&&(this.set("mailboxId",t),!0))},screens:{}});l.addObserverForKey("mailboxId",e.base,"hideSidebar").addObserverForKey("search",e.base,"hideSidebar").addObserverForKey("screen",e.base,"hideSidebar"),e.preferences.addObserverForKey("showReadingPane",l,"screenDidChange"),e.store.on(e.SavedSearch,l,"refindSavedSearch"),l.selectedMessage=new O.SingleSelectionController({content:O.bind(l,"mailboxMessageList"),record:new O.Binding({isTwoWay:!0,transform:function(t,i){return i?t?e.store.getRecord(e.MessageHeader,t):null:t?t.get("id"):""}}).from("messageId",l),updateConvId:function(){var e=this.get("record");e?e.is(O.Status.READY)&&l.set("conversationId",e.get("mailbox").get("useConversations")?e.get("conversationId"):""):l.set("conversationId","")}.observes("record.status"),inMailbox:O.bind(l,"screen",O.Transform.isEqualToValue("mailbox")),_queuedUpdates:null,contentWasUpdated:function(e){this._queuedUpdates=e,this._updateContent()},_updateContent:function(){var t,i,s,n,o,a,r,l,c=this._queuedUpdates,d=this.get("content"),h=this.get("record"),g=this.get("index");if(this._queuedUpdates=null,h)if((t=d?d.indexOfStoreKey(h.get("storeKey")):-1)>-1)this.set("index",t);else{if(e.preferences.get("enableConversations"))for(i=h.get("conversationId"),a=e.MessageHeader,o=e.store,s=c.added,n=c.addedIndexes,r=0,l=s.length;r<l;r+=1)if((h=o.getRecord(a,"#"+s[r])).get("conversationId")===i)return void((t=n[r])===g?this.set("record",h):this.set("index",t));this.get("inMailbox")&&O.SingleSelectionController.prototype.contentWasUpdated.call(this,c)}}.queue("before"),checkSelection:function(){this.get("inMailbox")&&!this._queuedUpdates&&this._indexDidChange()}.observes("inMailbox")}),l.set("selection",new O.SelectionController({content:O.bind(l,"mailboxMessageList"),onSortChange:function(){this.selectAll(!1)}.observes("content.sort")})),l.get("isReady")||e.systemFolderIds.addObserverForKey("inbox",l,"becameReady"),l.restoreStateFromUrl("")}(FastMail),function(e){var t=e.store,i=t.getIdFromStoreKey.bind(t),s=new O.Object({setupKB:function(){e.keyboardShortcuts.register("c",s,"goCompose").register("%",s,"deletePermanently").register("z",s,"undo")},teardownKB:function(){e.keyboardShortcuts.deregister("c",s,"goCompose").deregister("%",s,"deletePermanently").deregister("z",s,"undo")},goCompose:function(){e.mail.set("screen","compose")},mayMove:O.bind(e.mail,"mailbox.permissions",function(e){return!e||e.mayDelete}),mayDelete:function(){return this.get("mayMove")}.property("mayMove"),forwardAsAttachment:function(){if(e.auth.get("isVerified")){var t=e.mail,s=t.get("screenController"),n=(this._messages||(s?s.get("selectedConversations"):[])).map(i),o=t.get("mailboxMessageList").get("useConversations");n.length?t.set("composeDetails",{referenceTo:n,mode:"forwardMultipleAttached"}).set("screen","compose"):e.notifications.show(new e.NotificationView({userMayClose:!1,text:o?O.loc(418):O.loc(419),timeout:5e3}))}else O.require("verify",function(){e.verify.show()})},undo:function(){var t,i=e.api.mail.getTransaction("",!0);i&&(t=e.notifications.show(O.loc(13)),i.undo(function(){e.notifications.hide(t)}))},deleteToTrash:function(){var i=e.mail.get("screenController"),s=e.preferences;if(i&&s.get("enableConversations")&&s.get("deleteEntireConversation")&&s.get("showDeleteWarning")){var n,o,a,r,l=this._messages||i.get("selectedConversations"),c=!0,d=0,h=l.length,g=e.MessageHeader,u=e.ConversationDetails,p=O.Status.READY;for(r=0;r<h;r+=1){if(n=l[r],!(a=(o=t.getStatus(n)&p?t.getRecord(g,"#"+n).get("conversationId"):"")&&t.getRecordStatus(u,o)&p?t.getRecord(u,o):null)){c=!1;break}d+=a.get("total"),d-=a.get("totalInTrash")}if(!c||d>h)return void O.require("deletewarning",function(){e.deleteWarning.show(c,d,h)})}this.doAction("deleteMessages")},deletePermanently:function(){"compose"!==e.mail.get("screen")&&s.get("mayDelete")&&this.doAction("deleteMessages",null,!0)},discardDrafts:function(){this.doAction("discardDrafts")},restore:function(){this.doAction("restoreMessages")},reportSpam:function(){this.doAction("reportSpamMessages")},reportPhishing:function(){this.doAction("reportPhishing")},flag:function(){this.doAction("setMessagesProperty",null,"isFlagged",!0,!0)},unflag:function(){this.doAction("setMessagesProperty",null,"isFlagged",!1,!0)},read:function(){this.doAction("setMessagesProperty",null,"isUnread",!1,!0)},unread:function(){var t=e.mail.get("screenController");t.markUnread?t.markUnread():this.doAction("setMessagesProperty",null,"isUnread",!0,!0)},archive:function(){this.doAction("archiveMessages")},move:function(e){this.doAction("moveMessages",null,e)},copy:function(e){this.doAction("copyMessages",null,e)},moveToInbox:function(){this.move(e.systemFolderIds.get("inbox"))},_messages:null,setMessages:function(e){return this._messages=e,this},doAction:function(s,n,o,a,r){var l,c,d,h,g,u=e.mail,p=e.api.mail,m=u.get("mailboxMessageList"),v=u.get("screenController"),f=u.navigationController,b=(n||(n=this._messages)||(n=v?v.get("selectedConversations"):[])).length,w="conversation"===u.get("screen"),y=w?e.preferences.get("afterActionGoTo"):"mailbox",x=m.get("useConversations"),S=!1;this._messages=null,b?((S=("deleteMessages"!==s||!o)&&"discardDrafts"!==s)&&(l=p.startTransaction()),w&&"discardDrafts"===s?(d=e.mail.screens.compose)&&d.discardAll():m[s](n.map(i),o,a),S&&p.endTransaction(),r||"prev"===y&&f&&f.goPrev()||"next"===y&&f&&f.goNext()||w&&(u.set("screen","mailbox"),u.selectedMessage._indexDidChange()),"moveMessages"!==s&&"copyMessages"!==s||(h=t.getRecord(e.Mailbox,o).get("displayName")),c="setMessagesProperty"===s?"isFlagged"===o?a?x?O.loc(1155,b):O.loc(1156,b):x?O.loc(1170,b):O.loc(1171,b):a?x?O.loc(422,b):O.loc(423,b):x?O.loc(1157,b):O.loc(1158,b):"moveMessages"===s?x?O.loc(1150,b,h):O.loc(1151,b,h):"copyMessages"===s?x?O.loc(1134,b,h):O.loc(1135,b,h):"archiveMessages"===s?x?O.loc(1125,b):O.loc(1126,b):"deleteMessages"===s?o?x?O.loc(1138,b):O.loc(411,b):x?e.preferences.get("deleteEntireConversation")?"":O.loc(1136,b):O.loc(412,b):"discardDrafts"===s?x?O.loc(1140,b):O.loc(413,b):"restoreMessages"===s?x?O.loc(1162,b):O.loc(1163,b):"reportSpamMessages"===s?x?O.loc(1160,b):O.loc(1161,b):"reportPhishing"===s?O.loc(272):""):c=x?O.loc(418):O.loc(419),g=c?S?new e.UndoableNotificationView({text:c}):new e.NotificationView({userMayClose:!1,text:c,timeout:5e3}):new e.NotificationView({userMayClose:!1,text:O.loc(154)+"…",timeout:25e3}),l&&(l.notification=g),e.notifications.show(g),this.fire("didAction")}});e.mail.actions=s}(FastMail),function(e){var t,i=e.store;e.views.mailSearchBox=new O.SearchTextView({placeholder:O.loc(1331),value:O.bind(e.mail,"search"),inputAttributes:{autocomplete:"off",autocapitalize:"off",autocorrect:"off"},listPaneWidth:O.bindTwoWay(e.localPrefs,"listPaneWidth"),hasReadingPane:O.bind(e.preferences,"showReadingPane"),showSidebar:O.bind(e.preferences,"showSidebar"),layout:function(){var e=250;return this.get("hasReadingPane")&&(e=this.get("listPaneWidth"),e-=this.get("showSidebar")?20:50),{width:e}}.property("listPaneWidth","hasReadingPane","showSidebar"),setupExtras:function(){var s=this;this.insertView(new e.AutoCompleteView({minChars:0,sources:[new e.AutoCompleteSource({maxResults:1,suggestions:[!0],getTestFn:function(e){return function(){return!!e}},renderSuggestion:function(){return O.loc(1098,"<em>"+s.get("value").escapeHTML()+"</em>")},acceptSuggestion:function(e,t){return s.doSearch(),t}}),new e.AutoCompleteSource({maxResults:5,suggestions:e.allSavedSearches,getTestFn:function(e){var t={},i=e.split(/\s+/).map(O.i18n.makeSearchRegExp);return e?function(e){var s=e.get("search");if(!t[s])return t[s]=!0,i.every(function(e){return e.test(s)})}:function(){return!1}},renderSuggestion:function(e,t){var i=e.get("search").escapeHTML();return t.trim().split(" ").map(function(e){return new RegExp("(^|\\W|:)("+e.escapeHTML().escapeRegExp()+")","i")}).forEach(function(e){i=i.replace(e,"$1<em>$2</em>")}),i},acceptSuggestion:function(e){return s.doSearch(),e.get("search")}}),new e.AutoCompleteSource({maxResults:5,divider:" ",suggestions:O.bind(e.EmailAutoCompleteSource,"suggestions"),getTestFn:e.EmailAutoCompleteSource.getTestFn,renderSuggestion:e.EmailAutoCompleteSource.renderSuggestion,acceptSuggestion:function(e){return s.doSearch(),e.get("email")}}),t=new e.AutoCompleteSource({maxResults:6,suggestions:[],getTestFn:function(e){return function(){return!e}},renderSuggestion:function(e){var t=e.name,i=e.email;return(e.isList?t:t?t+" <"+i+">":i).escapeHTML()},acceptSuggestion:function(e){return s.doSearch(),e.email}}),new e.AutoCompleteSource({maxResults:1,suggestions:[!0],getTestFn:function(){return function(){return!0}},renderSuggestion:function(){return O.loc(539)+"…"},acceptSuggestion:function(t,i){return s.blur(),O.require("searchbuilder",function(){e.searchBuilder.show()}),i}})],inputDidReceiveFocus:function(s){e.AutoCompleteView.prototype.inputDidReceiveFocus.call(this,s);var n=e.mail,o={},a=[];"conversation"===n.get("screen")&&n.get("conversationMessageList").reduce(function(t,s){var n=s.get("from")[0],a=s.get("id"),r=i.getRecordStatus(e.MessageDetails,a)&O.Status.READY?i.getRecord(e.MessageDetails,a):null,l=r&&r.get("listId");return n&&!o[n.email]&&(o[n.email]=!0,t.push(n)),l&&!o[l]&&(o[l]=!0,t.unshift({isList:!0,name:l,email:"list:"+l})),t},a),t.suggestions=a,this.get("controller").filterDidChange()},inputView:this})),O.require("searchbuilder"),this.removeObserverForKey("isFocussed",null,"setupExtras")}.observes("isFocussed"),reset:function(){e.mail.get("search")?(e.mail.beginPropertyChanges().set("search","").set("screen","mailbox").endPropertyChanges(),this.blur()):(this.set("value",""),this.focus())},doSearch:function(){e.mail.beginPropertyChanges().set("search",this.get("value")).set("screen","mailbox").endPropertyChanges(),this.blur()}.queue("before"),_search:function(t){switch(O.DOMEvent.lookupKey(t)){case"shift-enter":e.mail.set("searchIsGlobal",!0),this.doSearch();break;case"alt-enter":e.mail.set("searchIsGlobal",!1);case"enter":this.doSearch()}}.on("keydown"),shortcut:"/"})}(FastMail),function(e){var t,i,s=O.Transform.invert,n=e.mail.actions,o=[],a=O.Class({Extends:O.MenuOptionView,className:function(){return"v-MenuOption"+(this.getFromPath("button.mailbox")?"":" v-MenuOption--create")+(this.get("isFocussed")?" is-focussed":"")+(this.get("isHidden")?" u-hidden":"")}.property("isFocussed","isHidden"),filter:function(e){var t=this.get("button"),i=t.get("mailbox");if(i){var s=i.get("depth"),n=!!o[s],a=!e||e.test(t.get("label")),r=a||n;s&&r&&(o[s-1]=!0),o.length=s,this.set("isHidden",!r),t.set("isDisabled",!a&&r||!i.get("permissions").mayInsert)}}}),r=O.Class({Extends:O.ButtonView,isDisabled:O.bind(null,"mailbox*permissions",function(e){return!e.mayInsert}),layout:function(){return{textIndent:this.getFromPath("mailbox.depth")+"ex"}}.property("mailbox.depth"),label:O.bind("mailbox*displayName"),method:"move",move:function(){var e=this.getFromPath("mailbox.id");n.get("mayMove")?n.move(e):n.copy(e)}}),l={standard:{left:["-","archive","-","delete","-","spam","-","move","-","mark"]},archive:{left:["-","toInbox","-","delete","-","spam","-","move","-","mark"]},drafts:{left:["-","discardDrafts","-","move","-","mark"]},draftsNotDiscard:{left:["-","move","-","mark"]},sent:{left:["-","delete","-","move","-","mark"]},spam:{left:["-","deleteForever","-","notSpam","-","move","-","mark"]},trash:{left:["-","deleteForever","-","restore","-","move","-","mark"]},compose:{left:["-","send","-","saveDraft","-","discard"]},_compose:{left:["-","send","-","saveDraft","-","discard"],right:["search"]}};e.views.mailToolbar=(i=new O.ToolbarView(O.extend({className:"v-Toolbar app-toolbar",positioning:"absolute",allowTextSelection:!0,inGlobalSearch:O.bind(e.mail,"inGlobalSearch"),mailboxId:O.bind(e.mail,"mailboxId"),screen:O.bind(e.mail,"screen"),inCompose:!1,hasReadingPane:O.bind(e.preferences,"showReadingPane"),showSidebar:O.bind(e.preferences,"showSidebar"),updateConfigs:function(){var e,t,i=O.clone(l),s=this.get("hasReadingPane"),n=this.get("showSidebar"),o=[],a=Array.prototype.splice;if(e=s?n?[]:["compose"]:["search"],i.standard.right=e,s&&o.unshift("search","-"),n||(o.unshift("sidebar"),i._compose.left.unshift("-","sidebar")),o.length)for(t in o.unshift(1,0),i)"_"!==t.charAt(0)&&a.apply(i[t].left,o);return this.registerConfigs(i)}.queue("before").observes("hasReadingPane","showSidebar"),preventOverlap:!0,config:function(){var t=this.get("mailboxId"),i=t&&e.store.getRecord(e.Mailbox,t),s=this.get("screen"),n=this.get("hasReadingPane"),o=i?i.get("inheritedRole")||"standard":"blank";return!this.get("inCompose")||n&&"mailbox"===s?"inbox"===o||this.get("inGlobalSearch")?o="standard":"drafts"===o&&"conversation"===s&&(o="draftsNotDiscard"):o="compose",n&&"compose"===o&&"compose"===s&&(o="_compose"),o}.property("inCompose","inGlobalSearch","mailboxId","hasReadingPane","screen")},t)).registerViews({sidebar:new O.ButtonView({type:"s-reveal-sidebar v-Button--iconOnly",icon:"icon-menu",isActive:O.bind(e.base,"revealSidebar"),layout:{margin:"0 9px 0 -11px"},label:O.bind(e.base,"revealSidebar",function(e){return e?O.loc(22):O.loc(23)}),target:e.base,method:"showSidebar"}),compose:new O.ButtonView({type:"s-new-message",icon:"icon-compose",label:O.loc(71),target:n,method:"goCompose"}),search:e.views.mailSearchBox,archive:new O.ButtonView({type:"s-archive",icon:"icon-box",isDisabled:O.bind(n,"mayMove",s),label:O.loc(365),target:n,method:"archive",shortcut:"y"}),delete:new O.ButtonView({type:"s-delete",icon:"icon-remove",isDisabled:O.bind(n,"mayMove",s),label:O.loc(4),target:n,method:"deleteToTrash",shortcut:"# d delete"}),spam:new O.ButtonView({type:"s-report-spam",icon:"icon-shield",isDisabled:O.bind(n,"mayMove",s),label:O.loc(1094),target:n,method:"reportSpam",shortcut:"!"}),move:new O.MenuButtonView({type:"s-move-to v-MenuButton",icon:"icon-folder-download",label:O.bind(n,"mayMove",function(e){return e?O.loc(1091):O.loc(1080)}),shortcut:"m",popOverView:e.popOver,menuView:function(){var t=e.allMailboxes.map(function(e){return new r({mailbox:e})});return t.push(new O.ButtonView({label:O.loc(45)+"…",method:"create",create:function(){var t=e.views.createFolderView,s=this.getParent(O.MenuView).getFromPath("controller.filter"),n=O.loc(45).toLowerCase(),o=i.getView("move");n.indexOf(s.toLowerCase())&&t.get("mailbox").set("name",s),o.getParent(O.MenuView)&&(o=i.getView("overflow")),e.popOver.show({view:t,alignWithView:o,alignEdge:"centre",offsetTop:5,showCallout:!0})}})),new O.MenuView({showFilter:!0,ItemView:a,controller:function(){return new O.MenuController({view:this,filterDidChange:function(){o=[],O.MenuController.prototype.filterDidChange.call(this),this.getFromPath("focussedOption.button.mailbox")||this.focusNext()}.observes("filter")})}.property(),options:t})}.property(),foldersDidChange:function(){this.computedPropertyDidChange("menuView")}.queue("middle"),cleanupMenuView:function(t,i,s){s&&(s.get("parentView")&&e.popOver.hide(),s.destroy())}.observes("menuView")}),mark:new O.MenuButtonView({type:"s-mark v-MenuButton",label:O.loc(70),shortcut:".",popOverView:e.popOver,menuView:function(){var t=e.mail.get("mailbox").get("permissions"),i=!t.mayUpdateSeen,s=!t.mayUpdateFlags,o=e.mail.get("mailboxId")===e.systemFolderIds.get("drafts")?[]:[new O.ButtonView({isDisabled:i,label:O.loc(373),shortcut:"r",target:n,method:"read"}),new O.ButtonView({isDisabled:i,label:O.loc(374),shortcut:"u",target:n,method:"unread"})];return o.push(new O.ButtonView({isDisabled:s,label:O.loc(32),shortcut:"p",target:n,method:"flag"}),new O.ButtonView({isDisabled:s,label:O.loc(74),shortcut:"n",target:n,method:"unflag"}),new O.ButtonView({label:O.loc(368),target:n,method:"forwardAsAttachment"})),new O.MenuView({showFilter:!1,options:o})}.property().nocache()}),discardDrafts:new O.ButtonView({type:"s-discard-drafts",icon:"icon-blocked",label:O.loc(1083),shortcut:"# delete",target:n,method:"discardDrafts"}),deleteForever:new O.ButtonView({type:"s-delete-permanently",icon:"icon-blocked",isDisabled:O.bind(n,"mayDelete",s),label:O.loc(108),tooltip:"# "+O.loc(10)+" %",shortcut:"# delete",target:n,method:"deletePermanently"}),notSpam:new O.ButtonView({type:"s-not-spam",icon:"icon-thumbs-up",isDisabled:O.bind(n,"mayMove",s),label:O.loc(378),shortcut:"i",target:n,method:"moveToInbox"}),toInbox:new O.ButtonView({type:"s-move-inbox",icon:"icon-move-inbox",isDisabled:O.bind(n,"mayMove",s),label:O.loc(375),shortcut:"i",target:n,method:"moveToInbox"}),restore:new O.ButtonView({type:"s-undelete",icon:"icon-move-inbox",isDisabled:O.bind(n,"mayMove",s),label:O.loc(379),shortcut:"i",target:n,method:"restore"})}).registerConfig("blank",{left:[],right:[]}).updateConfigs(),e.allMailboxes.addObserverForRange({},i.getView("move"),"foldersDidChange"),i)}(FastMail),function(e,t){var i=function(e){return e?"v-FolderSource-badge":"v-FolderSource-badge u-hidden"},s=O.Transform.toBoolean,n=function(){var e=O.Element.create;return e("b.v-FolderSource-expando",{title:O.loc(382)},[e("span.icon.icon-expando")])},o={inbox:"icon-drawer",archive:"icon-box",drafts:"icon-file",sent:"icon-paper-plane",spam:"icon-shield",trash:"icon-remove"},a=O.DragEffect,r=O.Class({Extends:O.ListItemView,Mixin:O.DropTarget,depth:O.bind("content.depth"),isFocussed:!1,isDisabled:O.bind("content.isDisabled"),isHidden:O.bind("content.isHidden"),isCollapsed:O.bind("content.isCollapsed"),hasUnreadChildren:O.bind(null,"content.unreadChildrenCount",s),hasSubfolders:O.bind(null,"content.visibleChildrenCount",s),badgeIsShowing:!1,userRefresh:!1,messageList:null,status:O.bind("messageList.status"),init:function(e){r.parent.init.call(this,e);var t=this.get("content"),i=t.get("role"),n="drafts"===i?"totalMessages":"archive"===i||"sent"===i||"trash"===i?null:"unread";n&&this.registerBinding(new O.Binding({transform:s}).from(n,t).to("badgeIsShowing",this).connect())},layerTag:"a",className:function(){var e=this.get("content").get("role"),t=!this.get("hasSubfolders")||this.get("isCollapsed");return"v-FolderSource app-source app-source--depth"+this.get("depth")+(e?" v-FolderSource--"+e:"")+(this.get("isSelected")?" is-selected":"")+(this.get("isFocussed")?" is-focussed":"")+(this.get("isDisabled")?" is-disabled":"")+(this.get("isHidden")?" u-unimportant":"")+(t?"":" is-expanded")+(t&&this.get("hasUnreadChildren")?" u-bold":"")+(this.get("hasDragOver")?" is-underDrag":"")+(this.get("badgeIsShowing")?" is-badged":"")+(this.get("userRefresh")&&(this.get("status")||0)&O.Status.LOADING?" is-refreshing":"")}.property("depth","isSelected","isFocussed","isDisabled","isHidden","hasSubfolders","isCollapsed","hasUnreadChildren","hasDragOver","badgeIsShowing","userRefresh","status"),draw:function(t,s,a){var r,l=this.get("content"),c=l.get("role"),d="drafts"===c?"totalMessages":"sent"===c||"archive"===c?null:"unread";return s.setAttributes(t,{title:O.bind(l,"total",function(t){return t?e.preferences.get("enableConversations")?O.loc(439,t):O.loc(440,t):O.loc(117)}),href:O.bind(l,"urlName",function(){return l.get("permissions").mayRead?e.base.getUrlForState({app:"mail",screen:"mailbox",mailboxRecord:l}):void 0})}),r=[a("i.icon."+(o[c]||"icon-folder")),a("span.v-FolderSource-name",{text:O.bind(l,"displayName")}),this._badge=a("span",{className:O.bind(this,"badgeIsShowing",i),text:d?O.bind(d,l):""}),this.get("hasSubfolders")?this._expando=n():null],this.get("isSelected")&&this.isSelectedDidChange(),r},folderNeedsRedraw:function(e,t,i){this.propertyNeedsRedraw(e,t,i)}.observes("hasSubfolders"),redrawHasSubfolders:function(e,t){var i=this.get("hasSubfolders");i!==t&&(i?e.appendChild(this._expando=n()):(e.removeChild(this._expando),this._expando=null))},isSelectedDidChange:function(){var t,i=this._badge,s=this.get("content"),n=s.get("mailboxId");if(this.get("isSelected"))for(i&&(i.title=O.loc(0,"u")),this.set("messageList",e.store.getQuery(n,e.MailboxMessageList,{mailboxId:n})),t=(new O.Binding).from("userTriggeredRefresh",e.mail).to("userRefresh",this).connect(),this._userRefreshBinding=t,this.registerBinding(t),s.set("isHidden",!1);s=s.get("parent");)s.set("isCollapsed",!1);else i&&(i.title=""),this.set("messageList",null),t=this._userRefreshBinding,this._userRefreshBinding=null,this.deregisterBinding(t),t.destroy(),this.set("userRefresh",!1),s.computedPropertyDidChange("isHidden")}.observes("isSelected"),_onClick:function(t){if(!O.DOMEvent.isClickModified(t)){var i="click"===t.type,s=this._expando;if(i&&t.preventDefault(),s&&O.Element.contains(s,t.target))i&&this.get("content").toggle("isCollapsed");else if(this.get("content").get("permissions").mayRead)if(this.get("isSelected")&&("mailbox"===e.mail.get("screen")||e.preferences.get("showReadingPane"))){var n=e.mail.screens.mailbox;!n||i&&!t.originalType||n.refresh()}else e.mail.beginPropertyChanges().set("search","").set("mailboxId",this.get("content").get("id")).set("screen","mailbox").endPropertyChanges()}}.on("mousedown","click"),dropAcceptedDataTypes:{MessageStoreKeys:!0},springLoad:function(){this._springLoadTimeout=null,this.get("content").stopSync().set("isCollapsed",!1).startSync()},undoSpringLoad:function(){this.get("content").stopSync().set("isCollapsed",!0).startSync()},dropEntered:function(e){this.get("content").get("permissions").mayInsert&&(this.set("hasDragOver",!0),e.set("dropEffect",e.event.altKey?a.COPY:a.MOVE)),this.get("isCollapsed")&&!this._springLoadTimeout&&(this._springLoadTimeout=O.RunLoop.invokeAfterDelay(this.springLoad,500,this),e.on("dragEnded",this,"undoSpringLoad"))},dropMoved:function(e){e.set("dropEffect",e.event.altKey?a.COPY:a.MOVE)},dropExited:function(e){this._springLoadTimeout&&(O.RunLoop.cancel(this._springLoadTimeout),this._springLoadTimeout=null,e.off("dragEnded",this,"undoSpringLoad")),this.set("hasDragOver",!1),e.set("dropEffect",a.DEFAULT)},drop:function(t){this.get("content").get("permissions").mayInsert&&t.getDataOfType("MessageStoreKeys",function(i){i&&e.mail.actions.doAction(t.get("dropEffect")&a.COPY?"copyMessages":"moveMessages",i,this.get("content").get("id"))}.bind(this))}});e.FolderSourceView=r}(FastMail),function(e){var t={},i=function(e){var i=e.get("parent"),s=e.get("id");return i&&t[i.get("id")]?(t[s]=!0,!1):(e.get("isCollapsed")&&(t[s]=!0),!e.get("isHidden")||!!e.get("visibleChildrenCount"))},s=function(e){return!e.get("isHidden")||!!e.get("visibleChildrenCount")},n=new O.ObservableArray(null,{isFiltering:!1,contentDidChange:function(){var n=e.allMailboxesAndSearches.get("[]");return this.get("isFiltering")?n=n.filter(s):(n=n.filter(i),t={}),this.set("[]",n)}.queue("middle").observes("isFiltering"),focussedMailbox:null,_views:{},_toDestroy:{},getView:function(e){return this._views[e.get("storeKey")]||null},createView:function(t,i,s,n,o){var a,r=i.get("storeKey"),l=this._views[r],c=i instanceof e.Mailbox?e.FolderSourceView:e.SearchSourceView;return l?l.set("index",s).set("list",n).set("parentView",t):(a=this.get("selectedMailbox")===i,l=this._views[r]=new c({parentView:t,content:i,index:s,list:n,itemHeight:o,isFocussed:i===this.get("focussedMailbox"),isSelected:a}),a&&(this._view=l)),l},destroyView:function(e){var t=e.get("content").get("storeKey");this._toDestroy[t]&&(e.destroy(),delete this._views[t],delete this._toDestroy[t])},updateCache:function(e){for(var t,i,s=e.removed,n=e.added,o=s.length;o--;)t=s[o],n.indexOf(t)<0&&(i=this._views[t])&&(i.get("parentView")?this._toDestroy[t]=!0:i.destroy())},_view:null,_screen:O.bind(e.mail,"screen"),_mailbox:O.bind(e.mail,"mailbox"),_savedSearch:O.bind(e.mail,"savedSearch"),selectedMailbox:function(){return"compose"===this._screen?null:this._savedSearch||this._mailbox}.property("_screen","_mailbox","_savedSearch"),setSelectedView:function(){var e=this.get("selectedMailbox"),t=this._view,i=e&&this.getView(e);t!==i&&(t&&t.set("isSelected",!1),i&&i.set("isSelected",!0),this._view=i),this.contentDidChange()}.observes("selectedMailbox")}).contentDidChange();e.store.on(e.Mailbox,n,"contentDidChange").on(e.SavedSearch,n,"contentDidChange").getQuery("allFolders").on("query:updated",n,"updateCache"),e.allSavedSearches.on("query:updated",n,"updateCache"),e.folderTreeController=n}(FastMail),function(e){var t=O.Class({Extends:O.MenuController,options:e.allMailboxesAndSearches,isActive:!1,isFocussed:!1,checkActive:function(){var e=this.get("isActive");this.get("filter")||this.get("isFocussed")?e||this.setup():e&&this.teardown()}.observes("filter","isFocussed"),clearFilter:function(){this.set("filter","")},setup:function(){e.allMailboxes.forEach(function(e){e.set("isHidden",!1)}),this.get("treeController").set("isFiltering",!0),this.focusOption(e.allMailboxesAndSearches.first()),e.mail.addObserverForKey("screen",this,"clearFilter").addObserverForKey("mailboxId",this,"clearFilter").addObserverForKey("search",this,"clearFilter").addObserverForKey("searchIsGlobal",this,"clearFilter"),this.set("isActive",!0)},teardown:function(){this.set("isActive",!1),e.base.set("revealSidebar",!1),e.mail.removeObserverForKey("screen",this,"clearFilter").removeObserverForKey("mailboxId",this,"clearFilter").removeObserverForKey("search",this,"clearFilter").removeObserverForKey("searchIsGlobal",this,"clearFilter");var t=this.get("treeController"),i=t.get("selectedMailbox");t.set("isFiltering",!1),e.allMailboxes.forEach(function(e){e===i?e.set("isHidden",!1):e.computedPropertyDidChange("isHidden")}),this.focusOption(null)},notifyContentsChange:function(){this.get("treeController").contentDidChange()}.observes("filter"),focusOption:function(e){var t,i=this.get("focussedOption"),s=this.get("treeController");return i!==e&&(i&&(t=s.getView(i))&&t.set("isFocussed",!1),e&&(this.canSelect(e)?(t=s.getView(e))&&t.set("isFocussed",!0):e=null),this.set("focussedOption",e),s.set("focussedMailbox",e)),this},selectFocussed:function(t){t&&t.preventDefault();var i,s=this.get("focussedOption"),n=e.mail;return s&&this.canSelect(s)&&(this.clearFilter(),this.get("view").hide(),n.beginPropertyChanges(),s instanceof e.Mailbox?n.set("search","").set("mailboxId",s.get("mailboxId")):(i=s.get("isGlobal"),n.set("searchIsGlobal",i).set("search",s.get("search")),i||n.set("mailboxId",s.get("mailboxId"))),n.set("screen","mailbox").endPropertyChanges()),this}}),i=O.Class({Extends:O.View,controller:function(){return new t({view:this,treeController:this.get("treeController")})}.property(),nextEventTarget:function(){return this.get("controller")}.property(),ariaAttributes:{hidden:"true"},className:O.bind(null,"controller.isActive",function(e){return"v-FolderFilter"+(e?" is-filtering":"")}),positioning:"absolute",draw:function(){var e=this.get("controller"),t=this._input=new O.SearchTextView({blurOnKeys:{},isFocussed:O.bindTwoWay(e,"isFocussed"),shortcut:"g",tabIndex:-1,value:O.bindTwoWay(e,"filter")});return t.render().get("childViews").last().set("shortcut",""),t},show:function(){this._input.focus()},hide:function(){this._input.blur()},_onFocus:function(){e.base.set("revealSidebar",!0)}.on("focus")});e.FolderFilterView=i}(FastMail),function(e){var t=O.Class({Extends:O.ListItemView,itemHeight:31,depth:O.bind("content.depth"),isFocussed:!1,isHidden:O.bind("content.isHidden"),userRefresh:!1,messageList:null,status:O.bind("messageList.status"),className:function(){return"v-SearchSource"+(this.get("isHidden")?" u-hidden":"")+(this.get("isSelected")?" is-selected":"")+(this.get("userRefresh")&&(this.get("status")||0)&O.Status.LOADING?" is-refreshing":"")}.property("isHidden","isSelected","userRefresh","status"),linkClass:function(){return"app-source app-source--depth"+this.get("depth")+(this.get("isSelected")?" is-selected":"")+(this.get("isFocussed")?" is-focussed":"")}.property("depth","isSelected","isFocussed"),draw:function(t,i,s){var n=this.get("content");return this.get("isSelected")&&this.isSelectedDidChange(),[s("a",{className:O.bind(this,"linkClass"),title:O.bind(n,"search"),href:O.bind(n,"url")},[s("i.icon.icon-search"),s("span",{text:O.bind(n,"displayName")})]),new O.ButtonView({type:"v-Button--standard v-Button--size11",positioning:"absolute",label:n instanceof e.SavedSearch?O.loc(5):O.loc(3),target:this,method:"editSavedSearch"})]},isSelectedDidChange:function(){if(this.get("isRendered")){var t,i,s=this.get("layer");if(this.get("isSelected"))for(s.title=O.loc(0,"u"),t=this.get("content"),this.set("messageList",t.get("messageList")),i=(new O.Binding).from("userTriggeredRefresh",e.mail).to("userRefresh",this).connect(),this._userRefreshBinding=i,this.registerBinding(i);t=t.get("parent");)t.set("isCollapsed",!1);else s.title="",this.set("messageList",null),i=this._userRefreshBinding,this._userRefreshBinding=null,this.deregisterBinding(i),i.destroy(),this.set("userRefresh",!1)}}.observes("isSelected"),editSavedSearch:function(){var t=e.views.mail;e.popOver.show({view:e.views.editSavedSearch,alignWithView:this,positionToThe:"right",alignEdge:"top",offsetLeft:-6,inParent:t,showCallout:!0})},_onClick:function(t){if(!O.DOMEvent.isClickModified(t)&&t.targetView===this){var i="click"===t.type;if(i&&t.preventDefault(),this.get("isSelected")&&("mailbox"===e.mail.get("screen")||e.preferences.get("showReadingPane"))){var s=e.mail.screens.mailbox;!s||i&&!t.originalType||s.refresh()}else{var n=this.get("content"),o=n.get("isGlobal"),a=e.mail;a.beginPropertyChanges().set("screen","mailbox").set("searchIsGlobal",o).set("search",n.get("search")),o||a.set("mailboxId",n.get("mailboxId")),a.endPropertyChanges()}}}.on("mousedown","click")});e.SearchSourceView=t}(FastMail),function(e){var t,i=e.store;e.views.mailSidebarContent=new O.ScrollView({layout:{},screen:O.bind(e.mail,"screen"),hasReadingPane:O.bind(e.preferences,"showReadingPane"),className:function(){var e=this.get("hasReadingPane"),t=this.get("screen");return"app-belowToolbar "+("mailbox"===t||e&&"conversation"===t?"v-Sidebar--showRefresh":"")}.property("screen","hasReadingPane"),childViews:[new O.View({draw:function(t,i,s){return[s("a",{title:O.loc(0,"c"),className:new O.Binding({transform:function(e){return"app-source"+("compose"===e?" is-selected":"")}}).from("screen",e.mail),href:e.base.getUrlForState({app:"mail",screen:"compose"})},[s("i.icon.icon-compose"),O.loc(71)])]},showCompose:function(t){O.DOMEvent.isClickModified(t)||(e.mail.set("screen","compose"),t.preventDefault())}.on("click")}),new e.SearchSourceView({id:"v-SearchSource--unsaved",positioning:"relative",layout:{},content:new O.Object({name:"",search:O.bind(e.mail,"search"),mailboxId:O.bind(e.mail,"mailboxId"),isSaved:O.bind(e.mail,"savedSearch",O.Transform.toBoolean),isHidden:function(){return this.get("isSaved")||!this.get("search")}.property("isSaved","search"),isGlobal:O.bind(e.mail,"searchIsGlobal"),displayName:e.SavedSearch.prototype.displayName,url:e.SavedSearch.prototype.url,messageList:null}),isSelected:O.bind(e.mail,"screen",function(e){return"compose"!==e})}),new O.LabelView({layerTag:"h2",className:"app-sidebar-title",value:O.loc(51)}),t=e.views.folderFilter=new e.FolderFilterView({treeController:e.folderTreeController}),new O.ProgressiveListView({content:e.folderTreeController,ItemView:e.FolderSourceView,isCompact:!1,numFolders:O.bind(e.allMailboxes,"length"),setIsCompact:function(){var e=this.getFromPath("parentView.pxHeight"),t=this.get("numFolders"),i=!O.UA.isIOS&&(e-100)/t<24;this.set("isCompact",i)}.observes("numFolders","parentView.pxHeight"),className:function(){return"v-FolderTree"+(this.get("isCompact")?" is-compact":"")}.property("isCompact"),itemHeight:function(){return this.get("isCompact")?25:31}.property("isCompact"),itemHeightDidChange:function(){var t,i=this.get("itemHeight"),s=e.folderTreeController._views;for(t in s)s[t].set("itemHeight",i)}.observes("itemHeight"),informInfoUsageView:function(){var t=e.views.mailUsage;t&&O.RunLoop.queueFn("after",t.parentViewDidResize,t)}.observes("layout"),createItemView:function(t,i,s){return e.folderTreeController.createView(this,t,i,s,this.get("itemHeight"))},destroyItemView:function(t){return e.folderTreeController.destroyView(t)}}),new O.View({className:"v-Sidebar-editLink",draw:function(t,i,s){return[this._edit=s("a",{href:e.auth.authenticateUrl("/settings/folders"),text:O.loc(1112)})," | ",this._find=s("a",{href:e.base.getUrlForState({app:"mail"}),title:O.loc(0,"g"),text:O.loc(1175)})]},openSettings:function(i){i.preventDefault();var s=i.target;s===this._edit?(e.base.set("app","settings"),O.require("settings",function(){e.settings.set("pane","folders")})):s===this._find&&t.show()}.on("click")}),e.views.mailUsage=new O.View({positioning:"absolute",used:O.bind(i.getRecord(e.Quota,"mailQuota"),"used"),total:O.bind(i.getRecord(e.Quota,"mailQuota"),"total"),percentage:O.bind(i.getRecord(e.Quota,"mailQuota"),"percentage"),className:function(){var e=this.get("percentage");return"v-UsageInfo"+(e<50?"":e<80?" v-UsageInfo--51to80":e<90?" v-UsageInfo--81to90":" v-UsageInfo--91to100")}.property("percentage"),draw:function(t,s,n){var o=i.getRecord(e.Quota,"mailQuota"),a=/(\[_1\])/,r=n("span.v-UsageInfo-storage",[o.get("percentage")+""]),l=n("span.v-UsageInfo-usage",[o.get("used")+""]),c=O.loc(1326).split(a),d=O.loc(438,"[_1]",o.get("total")).split(a);return c[1]=r,d[1]=l,d=d.map(function(e){return"string"!=typeof e?e:e.replace(/(^|\d)\s/g,"$1 ")}),[n("p",c),n("p",d)]},viewNeedsRedraw:function(){this.propertyNeedsRedraw(this,"layer")}.observes("used","total"),parentViewDidResize:function(){if(this.get("isInDocument")){var e=this.get("layer"),t=e.previousElementSibling,i=e.parentNode,s=e.getBoundingClientRect(),n=s.top-t.getBoundingClientRect().bottom,o=i.getBoundingClientRect().bottom-s.bottom,a=(n>=21||o>=21)&&i.scrollHeight===i.offsetHeight;this.set("positioning",a?"absolute":"relative")}}.observes("isInDocument")})]})}(FastMail),function(e){e.theme.addStylesheet("mail");var t=new O.SplitViewController({flex:O.SplitViewController.BOTTOM_RIGHT,staticPaneLength:O.bindTwoWay(e.localPrefs,"sidebarWidth"),minStaticPaneLength:170,maxStaticPaneLength:500});e.views.mail=new e.AppPaneView({id:"mail",childViews:[new e.MainPaneView({splitController:t,childViews:[e.views.mailToolbar,e.views.mailScreen=new O.View({className:"app-belowToolbar",positioning:"absolute",childViews:[new e.LoadingView]})]}),e.views.mailSidebar=new O.View(e.AriaHiddenIfOffScreen,{className:"app-sidebar",positioning:"absolute",didCreateLayer:function(e){e.setAttribute("role","navigation")},layout:O.bind(t,"topLeftLayout"),clickedOutside:function(t){e.base.hideSidebar()},childViews:[new e.MainNavToolbar({selected:"mail"}),e.views.mailSidebarContent]}),new O.SplitDividerView({className:O.bind(e.preferences,"showSidebar",function(e){return e?"v-SplitDivider":"u-hidden"}),controller:t})]}),/beta\./.test(e.baseDomain)&&O.require("beta")}(FastMail),function(e){var t=new O.View({className:"v-EditSavedSearch u-smallDialog",search:"",name:"",mailboxId:null,updateData:function(){var t=e.mail,i=t.get("savedSearch");this.set("search",t.get("search")).set("name",i?i.get("name"):"").set("mailboxId",t.get("searchIsGlobal")?null:t.get("mailboxId"))},willEnterDocument:function(){return this.updateData(),O.View.prototype.willEnterDocument.call(this)},didEnterDocument:function(){return O.UA.isIOS&&e.iOSKeyboard.addObserverForKey("keyboardHeight",this,"keyboardHeightDidChange"),O.View.prototype.didEnterDocument.call(this)},willLeaveDocument:function(){return O.UA.isIOS&&(e.iOSKeyboard.removeObserverForKey("keyboardHeight",this,"keyboardHeightDidChange"),this.keyboardHeightDidChange(null,"",0,0)),O.View.prototype.willLeaveDocument.call(this)},_kbDelta:0,keyboardHeightDidChange:function(e,t,i,s){var n,o,a=this.getParent(O.PopOverView),r=a._options.alignWithView,l=r.getParent(O.ScrollView),c=this._kbDelta;c&&(l.scrollBy(0,-c,!1),a.adjustPosition(0,c),this._kbDelta=0),s&&(n=l.get("pxHeight")-s,o=l.get("scrollTop"),(c=r.getPositionRelativeTo(l).top+this.get("pxHeight")+10-n-o)>0&&(l.scrollBy(0,c,!1),a.adjustPosition(0,-c),this._kbDelta=c))},draw:function(t,i,s){return this.updateData(),[s("h3.v-EditSavedSearch-title",{text:O.bind(this,"search")}),new O.TextView({didEnterDocument:function(){return O.TextView.prototype.didEnterDocument.call(this),this.focus()},placeholder:O.loc(182),value:O.bindTwoWay(this,"name")}),s("div.u-smallDialog-actions",[new O.ButtonView({type:function(){return(this.get("searchExists")?"v-Button--destructive":"v-Button--standard")+" v-Button--size13"}.property("searchExists"),searchExists:O.bind("savedSearch",e.mail,O.Transform.toBoolean),label:function(){return this.get("searchExists")?O.loc(4):O.loc(1)}.property("searchExists"),target:this,method:"destroy"}),new O.ButtonView({type:"v-Button--constructive v-Button--size13",layout:{float:"right"},label:O.loc(3),target:this,method:"save"})])]},saveOnEnter:function(e){"enter"===O.DOMEvent.lookupKey(e)&&this.save()}.on("keydown"),save:function(){var t=e.mail.get("savedSearch");for(t||(t=new e.SavedSearch(e.store).set("search",e.mail.get("search")).saveToStore()),t.set("name",this.get("name")).set("mailboxId",this.get("mailboxId"));t=t.get("parent");)t.set("isCollapsed",!1);this.get("parentView").hide()},destroy:function(){var t=e.mail.get("savedSearch");t&&t.destroy(),this.get("parentView").hide()}});e.views.editSavedSearch=t}(FastMail),function(e){var t=O.Class({Extends:O.View,className:"v-CreateFolder u-smallDialog",mailbox:new e.Mailbox(e.store),isSaving:!1,draw:function(t,i,s){var n,o,a=[s("div.v-CreateFolder-name",[s("i.icon.icon-folder"),n=new O.TextView({value:O.bindTwoWay(this,"mailbox.name"),validityError:O.bind(this,"mailbox.errorForAttribute.name"),isValid:function(){return!this.get("value")||!this.get("validityError")}.property("value","validityError"),isDisabled:O.bind(this,"isSaving")})]),s("div.u-small",[O.loc(614)]),o=new O.SelectView({value:O.bindTwoWay(this,"mailbox.parent"),isDisabled:O.bind(this,"isSaving"),options:function(){var t=e.allMailboxes.map(function(e){var t=e.get("depth");return{isDisabled:!e.get("permissions").mayCreateSub,text:" ".repeat(2*t)+e.get("displayName"),value:e}});return t.unshift({text:"",value:null}),t}.property(),foldersDidChange:function(){this.computedPropertyDidChange("options")}.queue("middle")}),s("div.u-smallDialog-actions",[new O.ButtonView({type:"v-Button--standard v-Button--size13",isDisabled:O.bind(this,"isSaving"),label:O.loc(1),target:this,method:"cancel"}),this.selectButton=new O.ButtonView({type:"v-Button--constructive v-Button--size13",layout:{float:"right"},isDisabled:O.bind(this,"isSaving"),label:O.bind(this,"isSaving",function(e){return e?O.loc(19):O.loc(45)}),target:this,method:"createFolder"})])];return this.infoView=new e.InfoBubbleView({id:"v-CreateFolder-infoView",rootView:e.views.mainWindow,isHidden:O.bind(n,"isValid"),text:O.bind(n,"validityError",function(e){return e?e.explanation:""}),alignWithView:e.popOver,alignToThe:"right"}),e.store.on(e.Mailbox,o,"foldersDidChange"),a},focusOnEntry:function(){if(this.get("isInDocument")){var e=this.get("childViews")[0];e.set("selection",{start:0,end:e.get("value").length}).focus()}}.queue("after").observes("isInDocument"),cancel:function(){this.getParent(O.PopOverView).hide(),this.get("mailbox").set("name","").set("parent",null)},createFolder:function(){var t,i,s=this.get("mailbox"),n=this;s.get("isValid")?(i=(t=(s.getFromPath("parent.subfolders")||e.rootMailboxes).last())?t.get("precedence"):32,t&&t.get("role")&&(i=i<32?32:i+32),s.set("precedence",i).saveToStore(),this.set("isSaving",!0),e.api.mail.addCallback(function(){n.set("isSaving",!1),n.get("isInDocument")&&n.getParent(O.PopOverView).hide();var t=s.get("id"),i=e.mail.actions;i.get("mayMove")?i.move(t):i.copy(t)}),this.set("mailbox",new e.Mailbox(e.store))):this.get("childViews")[0].focus()}.on("createFolder"),_createOnEnter:function(e){"enter"===O.DOMEvent.lookupKey(e)&&this.createFolder()}.on("keydown")});e.views.createFolderView=new t}(FastMail),function(e,t){var i=e.mail,s=O.Transform.undefinedToNull,n=O.Status.READY,o=i.navigationController=new O.Object({keys:{u:"goMailbox",j:"goNext",k:"goPrev"},awaken:function(){this.resumeBindings(),this.setNextPrevHeaders(),this.observeList(),i.addObserverForKey("mailboxMessageList",this,"observeList");var t,s=e.keyboardShortcuts,n=this.keys;for(t in n)s.register(t,this,n[t]);return this},sleep:function(){var t,s=e.keyboardShortcuts,n=this.keys;for(t in n)s.deregister(t,this,n[t]);return i.removeObserverForKey("mailboxMessageList",this,"observeList"),this.observeList(null,"",i.get("mailboxMessageList"),null),this.suspendBindings()},_range:{start:-1,end:-1},observeList:function(e,t,s){var n=this._range,o=i.get("mailboxMessageList");s&&s.removeObserverForRange(n,this,"setNextPrevHeaders"),o&&o.addObserverForRange(n,this,"setNextPrevHeaders")},prevHeader:null,nextHeader:null,index:O.bind(i.selectedMessage,"index"),setNextPrevHeaders:function(){var e=this.get("index"),t=i.get("mailboxMessageList"),s=this._range,n=e-1,o=e+1;(e<0||t&&t.getObjectAt(e)!==i.selectedMessage.get("record"))&&(o=e),s.start=n,s.end=o+1,this.set("nextHeader",e<0||!t?null:t.getObjectAt(o)).set("prevHeader",e<0||!t?null:t.getObjectAt(n))}.queue("middle").observes("index"),go:function(e){var t=e&&e.is(n);return t&&i.selectedMessage.set("record",e),!!t},goPrev:function(){return this.go(this.get("prevHeader"))},goNext:function(){return this.go(this.get("nextHeader"))},goMailbox:function(){i.set("screen","mailbox")}}).suspendBindings();e.views.threadNav=new O.View({className:"app-viewBar",positioning:"absolute",name:O.bind(i,"mailbox.displayName"),searchIsGlobal:O.bind(i,"searchIsGlobal"),index:O.bind(o,"index"),isFetchingIndex:O.bind(i.selectedMessage,"isFetchingIndex"),sort:O.bind(i,"mailboxMessageList.sort"),total:O.bind(i,"mailboxMessageList.length"),nextHeader:O.bind(o,"nextHeader",s),prevHeader:O.bind(o,"prevHeader",s),prevConversation:O.bind(null,"prevHeader.conversationId",s),nextConversation:O.bind(null,"nextHeader.conversationId",s),draw:function(t,s,n){var o,a=this.get("sort");return o=[this._navBack=n("a",{className:"v-ThreadNav-link v-ThreadNav-back",href:O.bind(i,"mailboxMessageList",function(){return e.base.getUrlForState({app:"mail",screen:"mailbox",mailboxId:i.get("mailboxId"),search:i.get("search"),searchIsGlobal:i.get("searchIsGlobal")})}),title:O.loc(0,"u")},[n("i.icon.nav-back"),n("span",{className:"v-ThreadNav-text",text:O.bind(this,"name",function(e){return O.loc(1190,e)})})]),n("div.v-Toolbar-section.v-Toolbar-section--right",[this._navPrev=n("a.v-ThreadNav-link.v-ThreadNav-prev",[n("span.v-ThreadNav-text",[this._getNavText(a,!1)])]),n("span.v-ThreadNav-divider"),this._count=n("span"),n("span.v-ThreadNav-divider"),this._navNext=n("a.v-ThreadNav-link.v-ThreadNav-next",[n("span.v-ThreadNav-text",[this._getNavText(a,!0)])])])],this._updatePrev(),this._updateCount(),this._updateNext(),o},_getNavText:function(e,t){return"date"===e.slice(0,4)?t===("A"===e.charAt(4))?O.loc(1191):O.loc(1192):t?O.loc(120):O.loc(204)},_updatePrev:function(){this._updateLink(this._navPrev,this.get("prevHeader"),"k")}.observes("prevConversation"),_updateNext:function(){this._updateLink(this._navNext,this.get("nextHeader"),"j")}.observes("nextConversation"),_updateLink:function(t,s,o){if(this.get("isRendered")){var a=O.Element;if(s&&s.is(n)){var r=s.get("id"),l=s.get("mailbox").get("useConversations")?s.get("conversationId"):"";t.title=O.loc(0,o)+". \n"+s.get("subject"),t.href=e.base.getUrlForState({app:"mail",screen:"conversation",mailboxId:i.get("mailboxId"),search:i.get("search"),searchIsGlobal:i.get("searchIsGlobal"),conversationId:l,messageId:r}),a.removeClass(t,"is-disabled"),l?e.store.getQuery(l,e.ConversationMessageList,{conversationId:l}).refresh():e.store.getRecord(e.MessageDetails,r)}else t.title="",t.removeAttribute("href"),a.addClass(t,"is-disabled")}},_updateCount:function(){if(this.get("isRendered")){var t=this.get("index"),i=e.preferences.get("enableConversations"),s=this.get("total");this._count.textContent=t>-1&&void 0!==s?O.loc(441,t+1,s):this.get("isFetchingIndex")?i?O.loc(1144)+"…":O.loc(1145)+"…":i?O.loc(1133):O.loc(1149)}}.observes("index","total","isFetchingIndex"),redrawSort:function(){if(this.get("isRendered")){var e=this.get("sort");this._navPrev.lastChild.textContent=this._getNavText(e,!1),this._navNext.lastChild.textContent=this._getNavText(e,!0)}}.queue("render").observes("sort"),click:function(e){if(!O.DOMEvent.isClickModified(e)){e.preventDefault();var t=O.Element.contains,i=e.target;t(this._navBack,i)?o.goMailbox():t(this._navPrev,i)?o.goPrev():t(this._navNext,i)&&o.goNext()}}.on("click"),manageStatusBarEventHandler:O.UA.isIOS?function(){var e=O.ViewEventsController,t=this.get("statusBarEventHandler");t&&(this.get("isInDocument")?e.addEventTarget(t,6):e.removeEventTarget(t))}.observes("isInDocument"):null,statusBarEventHandler:O.UA.isIOS?function(){return new O.StatusBarEventHandler({view:this})}.property():null,scrollToTop:function(){e.views.thread.scrollToTop()}.on("statusBarTap")})}(FastMail),function(e){var t=O.Status.READY,i=O.Class({Extends:O.View,isFocussed:!1,className:function(){return"v-CollapsedCard"+(this.get("isFocussed")?" is-focussed":"")}.property("isFocussed"),init:function(e){i.parent.init.call(this,e);for(var s,n,o,a,r=e.start,l=e.end,c=e.list,d=e.collapsedState,h=[],g=[],u={};r<l;r+=1)1===d[r]&&((s=c.getObjectAt(r,!0)).addObserverForKey("*",this,"headerDidChange"),s.is(t)&&(n=s.get("fromEmail"),o=s.get("fromName"),(a=u[n])||(a=u[n]={}),a[o]||(g.push({name:o,email:n}),a[o]=!0)),h.push(s));this._observed=h,this._from=g},destroy:function(){i.parent.destroy.call(this),this._observed.forEach(function(e){e.removeObserverForKey("*",this,"headerDidChange")},this)},headerDidChange:function(t){if(t.get("isUnread")||t.get("isFlagged")||t.get("isDraft")){var i=this.get("list").indexOfStoreKey(t.get("storeKey")),s=this.get("collapsedState");1===s[i]&&(s[i]=2,e.mail.threadViewController.removeSmallRuns(s),this.get("parentView").contentDidChange())}},draw:function(t,i,s){var n=this._observed.length;return s("div.v-MessageCard.is-collapsed.app-contentCard",[s("div.v-MessageCard-header",[s("i.app-avatar",{style:"background-image: url("+e.theme.getImageSrc("collapsedavatar.png")+");"}),s("div.v-MessageCard-fromAndPreview",[s("h2.v-MessageCard-from",this._from.map(function(t,i){var n=t.name,o=t.email;return[i?", ":null,s("span",{className:"u-colour"+e.mail.threadViewController.getColour(o),title:o,text:n})]}))]),s("a.v-MessageCard-showMore",{href:"",html:O.loc(1306,n)})])])},expand:function(t){t&&t.preventDefault();var i,s,n=this.get("collapsedState"),o=this.get("start"),a=this.get("end");for(i=o;i<a;i+=1)1===n[i]&&(n[i]=2);this.get("parentView").contentDidChange(),this.get("isFocussed")&&(s=e.mail.threadViewController,O.RunLoop.queueFn("after",s.kbGo.bind(s,a-o-1)))}.on("click")});e.CollapsedCardView=i}(FastMail),function(e,t){var i,s=O.Status.READY,n=e.mail,o=e.CollapsedCardView,a=e.mail.threadViewController=new O.Object({keys:{r:"reply",a:"replyAll","alt-r":"replySender",f:"forward",n:"kbNext",p:"kbPrevious",e:"kbToggleExpand",s:"toggleFlagged",'"':"toggleQuotes",":":"toggleDetails",";":"showActions","shift-e":"expandMessages","alt-shift-e":"collapseMessages","shift-l":"showRemoteImages"},initSingleton:function(){var e=this.get("conversationMessageList");return e&&e.on("query:updated",this,"updateCollapsedState"),this.resetColourMap(),this.suspendBindings()},awaken:function(){O.meta(this).bindings.conversationMessageList.fromDidChange(),this.resumeBindings();var t,i=e.keyboardShortcuts,s=this.keys;for(t in s)i.register(t,this,s[t]);return this},sleep:function(){var t,i=e.keyboardShortcuts,s=this.keys;for(t in s)i.deregister(t,this,s[t]);return this.set("conversationMessageList",null),this.suspendBindings()},firstMessage:O.bind(n,"conversationMessageList.0"),subject:O.bind(null,"firstMessage.subject",function(e){return e||(""===e?O.loc(1193):O.loc(13)+"…")}),forEachMessageView:function(t){i.get("childViews").forEach(function(i){var s=i.get("childViews")[0];s&&s instanceof e.MessageCardView&&t(s)})},_keepUnread:[],keepUnread:function(e){this._keepUnread=e},kbIndex:0,kbFocussed:null,kbFocussedDidChange:function(t,i,s,n){s&&s.set("isFocussed",!1),n&&(n.set("isFocussed",!0),e.views.thread.scrollToView(n,{x:-32,y:-32},!0))}.observes("kbFocussed"),childViewsChanged:function(){var t,s,n=this.get("kbFocussed"),o=this._keepUnread;n&&((t=i.get("childViews").indexOf(n))>-1?this.set("kbIndex",t):this.kbGo(0)),o.length&&((s=this.get("conversationMessageList"))instanceof e.ConversationMessageList&&o.some(function(e){return s.indexOfStoreKey(e)>-1})&&this.forEachMessageView(function(e){e.stopMonitoringScroll()}),o.length=0)},kbReset:function(){this.set("kbIndex",0).set("kbFocussed",null)}.observes("conversationMessageList"),kbGo:function(t){if(e.preferences.get("enableConversations")){var s=i.get("childViews"),n=this.get("kbIndex");this.get("kbFocussed")&&(n=(n+t).limit(0,s.length-1),this.set("kbIndex",n)),this.set("kbFocussed",s[n]||null)}},kbNext:function(){this.kbGo(1)},kbPrevious:function(){this.kbGo(-1)},kbToggleExpand:function(){var t=this.get("kbFocussed");t&&(t instanceof o?t.expand():(t=t.get("childViews")[0])&&t instanceof e.MessageCardView&&t.toggle("isExpanded"))},fireOnSelectedMessage:function(e){var t,s=i.get("childViews"),n=s.length;!(t=this.get("kbFocussed"))&&n&&(t=s[n-1]),(t=t.get("childViews")[0])&&t.fire(e)},reply:function(){this.fireOnSelectedMessage("reply")},replyAll:function(){this.fireOnSelectedMessage("replyAll")},replySender:function(){this.fireOnSelectedMessage("replySender")},forward:function(){this.fireOnSelectedMessage("forward")},expandMessages:function(){this.expandAll(!0)},collapseMessages:function(){this.expandAll(!1)},toggleFlagged:function(){if(!this.get("kbFocussed")){var e=!1;if(this.forEachMessageView(function(t){e=e||t.get("isFlagged")}),e)return void this.forEachMessageView(function(e){e.get("isFlagged")&&e.toggleFlagged()})}this.fireOnSelectedMessage("toggleFlagged")},toggleQuotes:function(){this.fireOnSelectedMessage("toggleQuotes")},toggleDetails:function(){this.fireOnSelectedMessage("toggleDetails")},showActions:function(){this.fireOnSelectedMessage("showActions")},showRemoteImages:function(){this.forEachMessageView(function(t){var i=t.get("childViews").find(function(t){return t instanceof e.MessageView});i&&i.get("blockExternalContent")&&i.set("blockExternalContent",!1)})},conversationMessageList:O.bind(n,"conversationMessageList"),convMessageListDidChange:function(t,i,s,n){s&&s.off("query:updated",this,"updateCollapsedState"),n&&n.on("query:updated",this,"updateCollapsedState"),this._firstRender=!0,e.views.thread.scrollTo(0,0)}.observes("conversationMessageList"),collapsedState:function(){var t,i,o,a,r=this.get("conversationMessageList"),l=[],c=e.systemFolderIds.get("trash"),d=!!n.get("search"),h=d&&n.get("searchIsGlobal"),g=d&&n.get("mailboxMessageList").getMatches(r.get("id")),u=n.get("mailboxId")===c;for(o=0,a=r.get("length");o<a;o+=1)t=(i=r.getObjectAt(o,!0)).isInMailbox(c),l[o]=h||t===u?d?!g||g.indexOf(i.get("id"))>-1?2:1:i.is(s)&&(i.get("isUnread")||i.get("isFlagged")||i.get("isDraft"))?2:1:0;for(;a--;)if(0!==l[a]){l[a]=2;break}return this.removeSmallRuns(l),l}.property("conversationMessageList"),removeSmallRuns:function(t){var i,s,n,o,a=0,r=!0;for(s=0,n=t.length;s<n;s+=1)if(1===(i=t[s]))a+=1,r=!1;else if(2===i){if(a<5)for(o=s;a&&o--;)1===t[o]&&(t[o]=2,a-=1);a=0,r=!1}r&&e.mail.navigationController.goMailbox()},updateCollapsedState:function(t){if(!this._firstRender){var i,s,o,a=t.removedIndexes,r=t.addedIndexes,l=t.added,c=e.systemFolderIds.get("trash"),d=n.get("mailboxId")===c,h=this.get("collapsedState");for(o=a.length;o--;)h.splice(a[o],1);for(s=0,o=r.length;s<o;s+=1)i=e.store.getRecord(e.MessageHeader,"#"+l[s],!0),h.splice(r[s],0,i.isInMailbox(c)!==d?0:2);this.removeSmallRuns(h)}},expandAll:function(e){if(e&&!this._firstRender){for(var t=this.get("collapsedState"),s=t.length,n=0,o=0;s--;)1===t[s]&&(o||(o=s+1),n=s,t[s]=2);n<o&&i.contentDidChange()}this.forEachMessageView(function(t){t.set("isExpanded",e)})},_firstRender:!0,resetColourMap:function(){this._colourMap={},this._colourMapLength=0,this._colourTaken=[]}.observes("conversationMessageList"),getColour:function(e){var t=this._colourMap,i=this._colourTaken,s=this._colourMapLength;if(t.hasOwnProperty(e))return t[e];var n=e.toLowerCase().hash().mod(7);if(s<7){for(;i[n];)n=(n+1).mod(7);i[n]=!0}return this._colourMapLength=s+1,t[e]=n,n}}).initSingleton();(i=new O.ListView({syncOnlyInDocument:!1,content:O.bind(a,"conversationMessageList"),className:O.bind(e.preferences,"showAvatar",function(e){return e?"":"v-Thread--noAvatars"}),propertyNeedsRedraw:function(){O.ListView.prototype.propertyNeedsRedraw.apply(this,arguments),this.get("isRendered")&&!this.get("isInDocument")&&this.redraw()}.observes("className","layerStyles"),isCorrectItemView:function(e,t){if(a._firstRender)return!1;if(e instanceof o){for(var i=e.get("collapsedState"),s=e.get("start"),n=e.get("end");s<n;){if(2===i[s])return!1;s+=1}return!0}return e.get("content")===t},createItemView:function(t,i,s){var n,r,l,c=a.get("collapsedState"),d=null;if(1===c[i]){for(l=!0,n=i+1,r=c.length;n<r;n+=1)if(0!==c[n]){l=1!==c[n];break}l&&(d=new o({parentView:this,list:s,index:i,collapsedState:c,start:c.lastIndexOf(2,i)+1,end:i+1}))}return 2===c[i]&&(d=new e.ThreadMessageView({parentView:this,content:t,index:i,list:s})),d},calculateDirtyRange:function(e,t,i){for(var s,n,a=null,r=this.get("childViews"),l=r.length,c=0;i&&l&&(s=r[l-1],n=e.getObjectAt(i-1),this.isCorrectItemView(s,n,i-1));)a=s,l-=1,i-=s instanceof o?s.get("end")-s.get("start"):1;for(;t<i&&c<l&&(s=r[c],n=e.getObjectAt(t),this.isCorrectItemView(s,n,t));)c+=1,t+=s instanceof o?s.get("end")-s.get("start"):1;return[t,i,a]},redrawLayer:function(e){var t,i,s,o=this.get("content");o===a.get("conversationMessageList")&&(a._firstRender||(t=n.screens.compose)&&(i=t.get("instance"))&&(s=i.get("view").saveScrollPosition()),O.ListView.prototype.redrawLayer.call(this,e),o&&o.get("length")&&(a._firstRender=!1),s&&s.get("isInDocument")&&s.restoreScrollPosition())}})).addObserverForKey("childViews",a,"childViewsChanged"),e.views.thread=new O.ScrollView({willEnterDocument:function(){return a.awaken(),O.ScrollView.prototype.willEnterDocument.call(this)},didLeaveDocument:function(){return a.sleep(),O.ScrollView.prototype.didLeaveDocument.call(this)},showScrollbarX:!0,keys:{home:"scrollToTop",end:"scrollToBottom",pagedown:"scrollPage",pageup:"reverseScrollPage",space:"scrollPage","shift-space":"reverseScrollPage",down:"scrollLine",up:"reverseScrollLine"},childViews:[O.Element.when(e.vacationResponse,"isActive").show(new O.View({className:"v-VacationNotice",draw:function(e,t,i){return i("div.v-VacationNotice-widthLimiter",[i("b",[O.loc(565)]),i("span.u-nowrap",[new O.ButtonView({layout:{marginLeft:15},type:"v-Button--standard v-Button--size11",label:O.loc(53),target:this,method:"goSettings"}),new O.ButtonView({layout:{marginLeft:10},type:"v-Button--standard v-Button--size11",label:O.loc(527),target:this,method:"turnOff"})])])},goSettings:function(){O.require("settings",function(){e.settings.set("pane","vacation")}),e.base.set("app","settings")},turnOff:function(){e.vacationResponse.set("isEnabled",!1)}})).end(),new O.View({className:"v-Thread",childViews:[new O.LabelView({allowTextSelection:!0,layerTag:"h1",className:"v-Thread-title",value:O.bind(a,"subject")}),i]})]})}(FastMail),function(e){var t=function(t,i){var s=t.get("content"),n=e.mail.threadViewController.getColour(s.get("fromEmail")),o=s.get("fromName"),a=o.indexOf(" ");return[i?", ":null,O.Element.create("span.u-colour"+n,[a>-1?o.slice(0,a):o])]},i=function(e,t){return e=e.get("parentView"),t=t.get("parentView"),e.get("index")-t.get("index")},s=new O.View({className:"v-StatusBar",positioning:"absolute",_index:0,_views:[],reset:function(){this._views.length=this._index,this._index=0}.queue("after"),add:function(e){var t=this._index,i=this._views;t||this.reset(),i[t]!==e&&(e&&(i[t]=e),this.redraw()),e&&(this._index=t+1)},draw:function(e){e.style.display="none"},redraw:function(){var e,s,n=O.Element.create,o=this._views,a=o.length,r=this.get("layer");a&&(o.sort(i),e=n("div.v-UnreadStatus.u-ellipsis",[n("b",[n("i.icon.icon-unread"),a+" "]),n("span.v-UnreadStatus-names",[o.map(t)])]),(s=r.firstChild)?r.replaceChild(e,s):r.appendChild(e)),r.style.display=a?"block":"none"}.queue("after"),hide:function(){this.get("layer").style.display="none"},scrollToNext:function(){var t=this._views[0];t&&e.views.thread.scrollToView(t,{x:-32,y:-32},!0)}.on("click")});e.mail.threadViewController.addObserverForKey("conversationMessageList",s,"hide"),e.views.unreadBelowFold=s}(FastMail),function(e,t){var i=e.mail;i.screens.conversation=new O.Object({activate:function(){this.resumeBindings(),i.navigationController.awaken()},deactivate:function(){i.navigationController.sleep(),this.suspendBindings()},composeCount:0,subject:O.bind(e.mail.threadViewController,"subject"),title:function(){return(this.get("composeCount")?"* ":"")+this.get("subject")}.property("subject","composeCount"),selectedConversations:function(){for(var t,s,n=i.get("mailboxMessageList"),o=i.get("conversationMessageList"),a=o?o.get("length"):0;a--;)if((s=(t=o.getObjectAt(a))&&t.get("storeKey"))&&n.indexOfStoreKey(s)>-1)return[s];return o?[e.store.getStoreKey(e.MessageHeader,i.get("messageId"))]:[]}.property().nocache(),markUnread:function(){e.mail.threadViewController.forEachMessageView(function(e){e.get("isExpanded")&&e.set("isUnread",!0)}),e.notifications.show(e.mail.get("mailboxMessageList").get("useConversations")?O.loc(422,1):O.loc(423,1),5e3)}});var s=e.views.conversationContent=new O.View({positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,childViews:[new O.SwitchView({list:O.bind(e.mail,"conversationMessageList"),length:O.bind("list.length"),index:function(){return this.get("list")?this.get("length")?0:1:2}.property("list","length"),views:[e.views.thread,new e.LoadingView,new O.View({positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,childViews:[new O.LabelView({layerTag:"h1",className:"app-list-emptyMessage",positioning:"absolute",value:O.bind(e.preferences,"enableConversations",function(e){return e?O.loc(732):O.loc(733)})})]})]}),e.views.unreadBelowFold]});e.views.conversation=new O.View({positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,childViews:[e.views.threadNav,new O.View({positioning:"absolute",className:"app-belowViewBar",willEnterDocument:function(){return this.insertView(s),O.View.prototype.willEnterDocument.call(this)},didLeaveDocument:function(){return O.View.prototype.didLeaveDocument.call(this),this.removeView(s)}})]})}(FastMail),function(e){var t=O.Status.DIRTY,i=O.Status.COMMITTING,s=O.Transform.isEqualToValue,n=s("yes"),o=s("maybe"),a=s("no"),r=function(e){return e.isYou},l=O.Class({Extends:O.View,className:"v-Event v-Invitation",init:function(t){this.messageId=t.messageId,this.attachmentId=t.attachmentId,this.isFetchingStatus=!0,this.isCalendarReady=!1,this.eventId=null,this.calendarNeedsUpdate=!1,this.rsvp="n/a",this.timeZone=null,l.parent.init.call(this,t),this.checkStatus(),O.require("calendar",function(){this.isDestroyed||(e.store.on(e.CalendarEvent,this,"checkStatus"),this.set("isCalendarReady",!0),this.registerBinding((new O.Binding).from("timeZone",e.calendar).to("timeZone",this).connect()))}.bind(this))},destroy:function(){this.get("isCalendarReady")&&e.store.off(e.CalendarEvent,this,"checkStatus"),l.parent.destroy.call(this)},checkStatus:function(){var s=this,n=this.get("eventId");n&&e.store.getRecordStatus(e.CalendarEvent,n)&(t|i)||e.api.peripheral.callMethod("getAttachedEventStatus",{messageId:this.messageId,attachmentId:this.attachmentId},function(e){var t=e[0][1];s.set("rsvp",t.rsvp).set("eventId",t.eventId).set("calendarNeedsUpdate",t.calendarNeedsUpdate).set("isFetchingStatus",!1)})},event:function(){var t,i,s=new e.CalendarEvent(e.store),n=this.get("invitation");for(t in n)i=n[t],/^utc/.test(t)?i=Date.fromJSON(i):i&&/TimeZone$/.test(t)?i=O.TimeZone.fromJSON(i):i&&"recurrence"===t?i=O.RecurringDate.fromJSON(i):i&&"inclusions"===t&&(i=i.map(Date.fromJSON)),s.set(t,i);return s}.property(),canView:function(){return!!this.get("eventId")&&("no"!==this.get("rsvp")||e.calendar.prefs.get("showDeclined"))}.property("eventId","rsvp"),allowTextSelection:!0,draw:function(t,i,l){if(!this.get("isCalendarReady"))return[l("div.v-Invitation-fetching",[e.loading.createLoadingEl()])];var c,d,h=this.get("timeZone"),g=this.get("event"),u=g.get("type"),p=g.get("summary"),m=g.get("location"),v=g.get("isAllDay"),f=g.get("utcStart"),b=g.get("utcEnd"),w=g.get("localStart"),y=g.get("localEnd"),x=g.get("startTimeZone"),S=g.get("endTimeZone"),C=g.get("duration"),M=g.get("recurrence"),I=g.get("organiser"),V=g.get("attendees"),D=g.get("description"),A=C>6e4,_=v?!w.isOnSameDayAs(y,!0):C>=864e5,L=x&&h&&x!==h?h.convertDateToTimeZone(f):w,T=S&&h&&S!==h?h.convertDateToTimeZone(b):y,F="request"===u,R="cancel"===u,E=O.TimeZone["Etc/UTC"],P=i.when,k=i.unless;return M&&(c=g.get("allStartDates"),d=g.get("totalOccurrences")),[F&&I&&!I.isYou?l("p",[O.loc(1395,[l("b",[I.name||I.email])])]):null,R?l("p",[O.loc(1393,[l("b",[I.name||I.email])])]):null,k(this,"isFetchingStatus").show([P(this,"calendarNeedsUpdate").show([new O.ButtonView({type:"v-Button--standard v-Button--size13",layout:{float:"right"},label:R?O.loc(495):O.loc(530),target:this,method:"updateCalendar"})]).otherwise(R?null:[k(this,"eventId").show([new O.ButtonView({type:"v-Button--constructive v-Button--size13",layout:{float:"right"},label:O.loc(478),target:this,method:"addToCalendar"})]).end(),P(this,"canView").show([new O.ButtonView({type:"v-Button--standard v-Button--size13 s-invitation-view",layout:{float:"right"},label:O.loc(533),target:this,method:"viewInCalendar"})]).end()]).end()]).end(),l("h1.v-Event-what",[p||" "]),m?l("h2.v-Event-where",[m]):null,l("div.v-Event-when.v-Event-section",[l("div.v-Event-date",[O.i18n.date(L,"fullDate",!0),v&&_?l("span.v-Event-to",[" – "]):null]),v?null:l("div.v-Event-time",[O.i18n.date(L,"time",!0),!h||!_&&A?null:[" ",l("span.u-light",[h.getSuffix(L)])],A?l("span.v-Event-to",[" – "]):null,A&&!_?[O.i18n.date(T,"time",!0),h?" ":null,h?l("span.u-light",[h.getSuffix(T)]):null]:null]),_?l("div.v-Event-date",[O.i18n.date(T,"fullDate",!0)]):null,_&&!v?l("div.v-Event-time",[O.i18n.date(T,"time",!0),h?" ":null,h?l("span.u-light",[h.getSuffix(T)]):null]):null,v||x===E||S===E||x===h&&S===h||O.isEqual(L,w)&&O.isEqual(T,y)?null:l("div.v-Event-eventTime",[L.isOnSameDayAs(w,!0)?null:l("div.v-Event-date",[O.i18n.date(w,"fullDate",!0)]),l("div.v-Event-time",[O.i18n.date(w,"time",!0),!x||!_&&A&&x===S?null:[" ",l("span.u-light",[x.getSuffix(w)])],A?l("span.v-Event-to",[" – "]):null,A&&!_?[O.i18n.date(y,"time",!0),S?" ":null,S?l("span.u-light",[S.getSuffix(y)]):null]:null]),_&&!T.isOnSameDayAs(y,!0)?l("div.v-Event-date",[O.i18n.date(y,"fullDate",!0)]):null,_?l("div.v-Event-time",[O.i18n.date(y,"time",!0),S?" ":null,S?l("span.u-light",[S.getSuffix(y)]):null]):null]),(v?_:A)?l("div.v-Event-duration",["("+Date.formatDuration(C)+")"]):null]),D||V?l("div.v-Event-section",[D?e.drawPlainText(D):null,V?l("div.v-Event-people",[l("h3.v-Invitation-title",D?{style:"margin-top:10px"}:null,[O.loc(363)]),V.reduce(function(e,t,i){var s=t.name,n=t.email;return s&&(s=s.replace(/"/g,"")),i&&e.push(", "),e.push(l("a.v-Event-participant",{title:n,text:s||n,href:"mailto:"+encodeURI(n)})),e},[])]):null]):null,M&&1!==d?l("p.v-Event-recurrence.v-Event-section",[O.loc(444,l("b",[e.EditRecurRuleView.formatRecurrence(M,L)]))," ",d!==Number.MAX_VALUE?O.loc(317,d,O.i18n.date(c.first(),"abbreviatedFullDate",!0),O.i18n.date(c.last(),"abbreviatedFullDate",!0)):null]):null,F&&V&&V.some(r)?P(this,"isFetchingStatus").show([l("div.v-Invitation-fetching",[e.loading.createLoadingEl()])]).otherwise([k(this,"rsvp",s("n/a")).show([l("div.v-Event-rsvp.v-Event-section",[l("h3.v-Invitation-title",[O.loc(1073)]),new O.ButtonView({type:"v-Button--standard v-Button--size13 v-Button--mergeRight s-invitation-going",isActive:O.bind(this,"rsvp",n),isDisabled:O.bind("isActive"),label:O.loc(106),target:this,action:"yes"}),new O.ButtonView({type:"v-Button--standard v-Button--size13 v-Button--mergeRight v-Button--mergeLeft s-invitation-maybe",isActive:O.bind(this,"rsvp",o),isDisabled:O.bind("isActive"),label:O.loc(104),target:this,action:"maybe"}),new O.ButtonView({type:"v-Button--standard v-Button--size13 v-Button--mergeLeft s-invitation-notgoing",isActive:O.bind(this,"rsvp",a),isDisabled:O.bind("isActive"),label:O.loc(105),target:this,action:"no"})])]).end()]).end():null,R?l("div.v-Invitation-cancel"):null]},viewNeedsRedraw:function(){this.propertyNeedsRedraw(this,"layer")}.observes("isCalendarReady","timeZone"),click:function(t){var i=t.target;if("v-Event-participant"===i.className){var s=new e.ContactCardView({name:i.get("text"),email:i.title});e.popOver.show({view:s,onHide:function(){s.destroy()},alignWithView:this,atNode:i,showCallout:!0,offsetTop:5}),t.preventDefault(),t.stopPropagation()}}.on("click"),addToCalendar:function(t){t&&t.set("isDisabled",!0).set("label",O.loc(19)+"…");var i=this;e.api.peripheral.callMethod("addAttachedEventToCalendar",{messageId:this.get("messageId"),attachmentId:this.get("attachmentId"),calendarId:e.calendar.prefs.get("defaultCalendar").get("id")},function(e){var t=e[0][1];i.set("eventId",t.eventId),i._cb&&i.getRealEvent(i._cb)})},updateCalendar:function(t){e.api.peripheral.callMethod("updateCalendarWithAttachedEvent",{messageId:this.get("messageId"),attachmentId:this.get("attachmentId"),eventId:this.get("eventId")},function(){t.set("label",O.loc(264)),e.store.fetchAll(e.CalendarEvent,!0)}),"cancel"===this.get("invitation").type?t.set("isDisabled",!0).set("label",O.loc(154)+"…"):this.set("calendarNeedsUpdate",!1)},viewInCalendar:function(){e.base.set("app","calendar"),this.getRealEvent(function(t){e.calendar.goToEvent(t,!0)})},changeRsvp:function(t){var i=t.type;if(i!==this.get("rsvp")){if(!e.auth.get("isVerified"))return void O.require("verify",function(){e.verify.show()});this.set("rsvp",i),this.get("eventId")||this.addToCalendar(),this.getRealEvent(function(t){t.set("rsvp",i),e.api.calendar.addCallback(function(){e.notifications.show(O.loc(1165),5e3);var t=e.mail.get("conversationMessageList");t&&t.refresh&&t.refresh(!0)})}.bind(this))}t.stopPropagation()}.on("yes","maybe","no"),getRealEvent:function(t){var i,s=this.get("eventId");s?(i=e.store.getRecord(e.CalendarEvent,s)).is(O.Status.READY)?t(i):i.addObserverForKey("status",{go:function(e,i){e.is(O.Status.READY)&&(e.removeObserverForKey(i,this,"go"),t(e))}},"go"):this._cb=t}});e.InvitationView=l}(FastMail),function(e){var t=!!O.UA.cssProps.transform,i=!!O.UA.cssProps.transform3d,s=O.Class({Extends:O.View,Mixin:O.AnimatableView,lightbox:null,index:0,activeIndex:-1,frameThickness:30,margin:76,position:function(){return this.get("index")-this.get("activeIndex")}.property("activeIndex"),isActive:O.bind(null,"lightbox.isActive",O.Transform.toBoolean),hideControls:!0,className:function(){return"v-LightboxItem"+(this.get("hideControls")?" v-LightboxItem--hideControls":"")}.property("hideControls"),positioning:"absolute",draw:function(e,t,i){return[this.renderContent(),this._close=i("a.v-LightboxItem-close",{href:""},[i("span.v-LightboxItem-closeIcon",[O.loc(29)])])]},updateDrawProperties:function(){var e=this.get("position"),t=e?e>0?"rightLayout":"leftLayout":this.get("isActive")?"centreLayout":"thumbLayout";this.set("animateLayerDuration","thumbLayout"===t?350:500).set("hideControls",!!e).set("layout",this.get(t))}.observes("isActive","position","dimensions"),didAnimate:function(){if(this.increment("animating",-1),!this.get("position")&&!this.get("isActive")){var e=this.get("lightbox");e&&e.removeFromDocument()}},thumbPosition:{top:0,right:0,bottom:0,left:0},contentDimensions:{width:300,height:300},didEnterDocument:function(){return this.get("position")||this.get("layer").getBoundingClientRect(),s.parent.didEnterDocument.call(this)},parentViewDidResize:function(){this.computedPropertyDidChange("dimensions")},dimensions:function(){var e=this.get("contentDimensions"),t=e.width,i=e.height,s=this.get("frameThickness"),n=this.get("margin"),o=this.get("lightbox"),a=o.get("pxWidth"),r=o.get("pxHeight"),l=Math.min(t,a-s-n),c=Math.min(i,r-s-n),d=Math.max(t/l,i/c);return 1!==d&&(t=parseInt(t/d,10),i=parseInt(i/d,10)),{canvasWidth:a,canvasHeight:r,width:t,height:i}}.property("contentDimensions","frameThickness"),thumbLayout:function(){var e=this.get("dimensions"),s=e.width,n=e.height,o=this.get("frameThickness"),a=this.get("thumbPosition"),r=Math.floor(a.left+(a.right-a.left-s-o)/2),l=Math.floor(a.top+(a.bottom-a.top-n-o)/2),c=(a.right-a.left)/(s+o);return t?{width:s,height:n,transform:(i?"translate3d("+r+"px,"+l+"px,0) ":"translate("+r+"px,"+l+"px) ")+"scale("+c+")"}:{top:l,left:r,width:s*c,heigh:n*c}}.property("dimensions","thumbPosition"),centreLayout:function(){var e=this.get("dimensions"),s=e.width,n=e.height,o=this.get("frameThickness"),a=e.canvasWidth-s-o>>1,r=e.canvasHeight-n-o>>1;return t?{width:s,height:n,transform:(i?"translate3d("+a+"px,"+r+"px,0) ":"translate("+a+"px,"+r+"px) ")+"scale(1)"}:{top:r,left:a,width:s,heigh:n}}.property("dimensions"),leftLayout:function(){var e=this.get("dimensions"),s=e.width,n=e.height,o=this.get("frameThickness"),a=-(s+o),r=e.canvasHeight-n-o>>1;return t?{width:s,height:n,transform:(i?"translate3d("+a+"px,"+r+"px,0) ":"translate("+a+"px,"+r+"px) ")+"scale(0.5)"}:{top:r,left:a,width:.5*s,heigh:.5*n}}.property("dimensions"),rightLayout:function(){var e=this.get("dimensions"),s=e.width,n=e.height,o=this.get("frameThickness"),a=e.canvasWidth,r=e.canvasHeight-n-o>>1;return t?{width:s,height:n,transform:(i?"translate3d("+a+"px,"+r+"px,0) ":"translate("+a+"px,"+r+"px) ")+"scale(0.5)"}:{top:r,left:a,width:.5*s,heigh:.5*n}}.property("dimensions"),close:function(){this.get("lightbox").close()},onClick:function(e){O.Element.contains(this._close,e.target)&&(e.preventDefault(),this.close()),e.stopPropagation()}.on("click")});e.LightboxItemView=s}(FastMail),function(e){var t=O.Class({Extends:e.LightboxItemView,renderContent:function(){var t=this.get("message");return new O.ScrollView({showScrollbarX:!0,childViews:[new e.MessageView({layout:{margin:30},message:t,mailboxId:null,showDetails:!0,isTrusted:!1,isPhishing:!1,hasBlockedContent:t.hasBlockedContent,collapseQuotes:!1})]})},contentDimensions:function(){var e=this.get("lightbox");return{width:Math.min(800,e.get("pxWidth")-40),height:e.get("pxHeight")-80}}.property(),centreLayout:function(){var e=this.get("dimensions"),t=e.width,i=e.height,s=this.get("frameThickness"),n=30*this.get("index"),o=e.canvasWidth-t-s>>1,a=(e.canvasHeight-i-s>>1)+n;return O.UA.cssProps.transform?{width:t,height:i-n,transform:(O.UA.cssProps.transform3d?"translate3d("+o+"px,"+a+"px,0) ":"translate("+o+"px,"+a+"px) ")+"scale(1)"}:{top:a,left:o,width:t,heigh:i-n}}.property("dimensions"),leftLayout:function(){return this.get("centreLayout")}.property("centreLayout"),rightLayout:function(){return this.get("thumbLayout")}.property("centreLayout"),_onClick:function(){this.get("lightbox").set("index",this.get("index"))}.on("click"),close:function(){var e=this.get("lightbox"),t=this.get("index");t?e.set("index",t-1):e.close()},didAnimate:function(){t.parent.didAnimate.call(this),this.get("activeIndex")<this.get("index")&&(this.get("lightbox").remove(this),this.destroy())}});e.LightboxEmailView=t}(FastMail),function(e){var t=O.Class({Extends:e.LightboxItemView,className:function(){return"v-LightboxItem v-LightboxPhoto"+(this.get("hideControls")?" v-LightboxItem--hideControls":"")}.property("hideControls"),didAnimate:function(){t.parent.didAnimate.call(this),this._highResShowing&&this.get("position")&&this.switchToLowRes()},thumbImage:function(){return O.Element.create("img",{src:this.get("imgThumb").src,alt:""})}.property(),getSrcForWidth:function(e){var t=this.get("imgSrc");return t+(t.indexOf("?")>-1?"&":"?")+"width="+e},_highResShowing:!1,highResLoaded:!1,highResImage:function(){var e=O.Element.create("img",{alt:""});return e.onload=function(){this.set("highResLoaded",!0),e=e.onload=null}.invokeInRunLoop().bind(this),e.src=this.getSrcForWidth(this.get("centreLayout").width),e}.property(),switchToHighRes:function(){if(this.get("isRendered")&&!this.get("position")&&!this._highResShowing){var e=this.get("highResImage");this.get("highResLoaded")&&(this.get("layer").replaceChild(e,this.get("thumbImage")),this._highResShowing=!0)}}.queue("render").observes("position","highResLoaded"),switchToLowRes:function(){this.get("layer").replaceChild(this.get("thumbImage"),this.get("highResImage")),this._highResShowing=!1}.queue("render"),renderContent:function(){return this.get("position")||this.get("highResImage"),this.get("thumbImage")},thumbPosition:function(){return this.get("imgThumb").getBoundingClientRect()}.property(),contentDimensions:function(){return{width:this.get("imgWidth"),height:this.get("imgHeight")}}.property()});e.LightboxPhotoView=t}(FastMail),function(e){var t=O.Class({Extends:O.View,isActive:!1,init:function(e,i){t.parent.init.call(this,i),this._rootView=e,this._shortcuts=O.ViewEventsController.kbShortcuts},index:function(e){return e=e?e.mod(this.get("total")):0,this.get("childViews").forEach(function(t){t.set("activeIndex",e)}),e}.property(),total:0,className:function(){return"v-Lightbox"+(this.get("isActive")?" is-active":"")+(this.get("total")<2?" v-Lightbox--hideControls":"")}.property("isActive","total"),positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,draw:function(e,i,s){return[s("div.v-Lightbox-background"),this._prev=s("a.v-Lightbox-navLink.v-Lightbox-prev",{href:""},[O.loc(204)]),this._next=s("a.v-Lightbox-navLink.v-Lightbox-next",{href:""},[O.loc(120)]),t.parent.draw.call(this,e,i,s)]},add:function(e,t){this.increment("total",1),void 0!==t&&this.set("index",t),e.set("lightbox",this).set("index",this.get("total")-1).set("activeIndex",this.get("index")),this.insertView(e)},remove:function(e){this.removeView(e).increment("total",-1).increment("index",0)},open:function(e,t){if(!this.get("isInDocument")){e instanceof Array||(e=[e]),this.set("total",e.length).set("index",t||(t=0));for(var i,s=e.length;s--;)(i=e[s]).set("lightbox",this).set("index",s).set("activeIndex",t),this.insertView(i);this._kbEnabled=this._shortcuts.get("isEnabled"),this._shortcuts.set("isEnabled",!1),this._rootView.insertView(this),O.ViewEventsController.addEventTarget(this.get("eventHandler"),10),this.set("isActive",!0)}},close:function(){this.get("isActive")&&(this._shortcuts.set("isEnabled",this._kbEnabled),O.ViewEventsController.removeEventTarget(this.get("eventHandler")),this.set("isActive",!1))},removeFromDocument:function(){this._rootView.removeView(this);for(var e,t=this.get("childViews"),i=t.length;i--;)e=t[i],this.removeView(e),e.set("lightbox",null)}.queue("render"),pxWidth:function(){return this._rootView.get("pxWidth")}.property().nocache(),pxHeight:function(){return this._rootView.get("pxHeight")}.property().nocache(),eventHandler:function(){return new O.ModalEventHandler({view:this})}.property(),clickedOutside:function(){this.close()},keyOutside:function(e){"keydown"===e.type&&this.keyboardShortcuts(e)},keyboardShortcuts:function(e){switch(O.DOMEvent.lookupKey(e)){case"esc":this.close();break;case"right":e.preventDefault(),this.increment("index",1);break;case"left":e.preventDefault(),this.increment("index",-1)}e.stopPropagation()}.on("keydown"),onClick:function(e){if(!O.DOMEvent.isClickModified(e)){var t=e.target;t===this._prev?this.increment("index",-1):t===this._next?this.increment("index",1):this.close(),e.preventDefault(),e.stopPropagation()}}.on("click")});e.LightboxView=t}(FastMail),function(e,t){var i=encodeURIComponent,s=function(e){return function(t){var i=this.data;return void 0!==t&&(i[e]=t),i[e]}.property()},n=/^image\/(?:x-)?(?:bmp|gif|p?jpe?g|png|tiff)$/i,o=/^(?:(?:image|audio|video)\/.+|application\/(?:pdf|json|javascript)|text\/.*)$/i,a=O.Class({Extends:O.Object,messageId:null,data:null,init:function(e,t,i){this.messageId=e,this.data=t,this.isEmail=i,a.parent.init.call(this)},id:s("id"),name:s("name"),type:s("type"),width:s("width"),height:s("height"),isInline:s("isInline"),isDeleted:s("isDeleted"),canView:function(){return o.test(this.data.type||"")||this.get("isEmail")}.property(),url:function(){var t=this.data;return t.isDeleted?null:e.auth.authenticateUrl("/unsafecontent/mail-attachment/"+this.get("messageId")+"/"+i(t.id)+"/"+i(t.name))}.property("isDeleted"),viewHref:function(){return this.get("canView")?this.get("url")+(this.get("isImage")?"":"&r=1"):this.get("downloadHref")}.property("url"),downloadHref:function(){var e=this.get("url");return e&&e+"&download=1"}.property("url"),size:function(){return O.i18n.fileSize(this.data.size,1)}.property(),extension:function(){var e=this.data.name;return e.slice(e.lastIndexOf(".")+1).toLowerCase()}.property(),isImage:function(){return!this.get("isDeleted")&&n.test(this.data.type||"")}.property("isDeleted"),thumbnailSrc:function(){return this.get("url")+"&width=128&height=128"}.property(),icon:function(){var t=e.theme;return O.Element.create("img",{src:t.getImageSrc(this.get("extension")+"_32x32.png")||t.getImageSrc("file_32x32.png")})}.property()}),r=O.Class({Extends:O.View,attachment:null,data:null,isSuspicious:!1,isSelected:!1,isImage:O.bind("attachment.isImage"),showInline:!1,isVisible:function(){return this.get("showInline")||!this.get("attachment").get("isInline")}.property("showInline"),className:function(){return this.get("isVisible")?(this.get("isImage")?"v-MessageAttachment--image ":"")+"v-MessageAttachment":"u-hidden"}.property("isVisible","isImage"),allowTextSelection:!0,layerTag:"li",draw:function(e,t,i){var s=t.when,n=this.get("attachment"),o=n.get("name");return e.set("draggable","true"),[i("a",{target:n.get("canView")?"_blank":void 0,href:O.bind(n,"viewHref")},[this._icon=n.get("isImage")?i("img.v-MessageAttachment-thumb",{src:n.get("thumbnailSrc"),alt:""}):i("i",{className:"u-fileIcon u-fileIcon--"+n.get("extension")})]),this._checkbox=i("label.u-ellipsis.v-MessageAttachment-name",{title:o},[t.unless(n,"isDeleted").show([i("input.v-MessageAttachment-box",{type:"checkbox",checked:O.bind(this,"isSelected")})]).end(),o]),s(n,"isDeleted").show([i("p.v-MessageAttachment-details.u-small",["("+O.loc(264)+")"])]).otherwise([i("p.v-MessageAttachment-details.u-small",[i("span.u-unimportant",[n.get("size")])," ",this._view=n.get("canView")?i("a.v-MessageAttachment-view",{text:O.loc(112),href:n.get("viewHref"),rel:"noreferrer",target:"_blank"}):null," ",this._download=i("a.v-MessageAttachment-download",{text:O.loc(31),href:n.get("downloadHref")})])]).end()]},click:function(t){if(!(t.button||t.altKey||t.ctrlKey||t.metaKey)){var i,s,n,o=t.target,a=this.get("attachment");if(!a.get("isDeleted")&&O.Element.contains(this._checkbox,o))t.preventDefault(),O.RunLoop.invokeInNextFrame(function(){this.get("parentView").select(this.get("index"),!this.get("isSelected"),t.shiftKey)},this);else if(!a.get("canView")||o!==this._icon&&o!==this._view){if(o===this._download){if(t.preventDefault(),this.get("isSuspicious")&&!confirm(O.loc(150)))return;o.textContent=O.loc(1084),setTimeout(function(){o.textContent=O.loc(31)},2e3),location.href=o.href,t.stopPropagation()}}else if(i=a.get("isImage"),s=a.get("isEmail"),i||s)t.preventDefault(),n=this.get("parentView"),i?n.viewImages(this):n.viewEmail(this),t.stopPropagation();else if(e.isMobile||e.isApp){if(t.preventDefault(),this.get("isSuspicious")&&!confirm(O.loc(150)))return;location.href=o.href,t.stopPropagation()}}}.on("click"),_dragAttachmentToDesktop:function(e){try{var t=this.get("attachment"),i=e.dataTransfer;t.get("isDeleted")||(i.setData("DownloadURL","application/octet-stream:"+t.get("name")+":"+location.protocol+"//"+location.host+t.get("downloadHref")),i.setDragImage(t.get("isImage")?this.get("layer").firstChild:t.get("icon"),10,10))}catch(e){}e.stopPropagation()}.on("dragstart")}),l=new e.LightboxView(e.views.mainWindow);e.auth.addObserverForKey("isAuthenticated",l,"close");var c=new e.LightboxView(e.views.mainWindow,{className:function(){return"v-Lightbox v-Lightbox--hideControls"+(this.get("isActive")?" is-active":"")}.property("isActive")});e.auth.addObserverForKey("isAuthenticated",c,"close"),e.MessageAttachmentsView=O.Class({Extends:O.View,className:"v-MessageAttachments",messageId:"",attachments:[],attachedMessages:null,isSuspicious:!1,_lastIndex:0,selectionLength:0,select:function(e,t,i){for(var s,n=this._lastIndex,o=i?Math.min(e,n):e,a=(i?Math.max(e,n):e)+1,r=this.get("childViews"),l=0;o<a;)(s=r[o]).get("isSelected")!==t&&s.get("isVisible")&&!s.get("attachment").get("isDeleted")&&(s.set("isSelected",t),l+=t?1:-1),o+=1;this._lastIndex=e,this.increment("selectionLength",l)},selection:function(){return this.get("childViews").filter(function(e){return e.get("isSelected")}).map(function(e){return e.get("attachment").get("id")})}.property().nocache(),getZipUrl:function(t){return e.auth.authenticateUrl("/unsafecontent/mail-attachment/"+this.get("messageId")+"/"+t.map(i).join(",")+"?download=1")},download:function(){this.get("isSuspicious")&&!confirm(O.loc(150))||(location.href=this.getZipUrl(this.get("selection")))},saveToService:function(t){var i=this;O.require("files",function(){if(i.get("isInDocument")){var s=t.get("root"),n=e.userPrefs.get("remoteServices");"vfs"===s||n.fs&&n.fs.indexOf(s)>-1?i.save(s+":"):(e.fsAuthorisationView.set("root",s).set("onSuccess",[i.save,i,[s+":"]]).authorise(),e.popOver.show({view:e.fsAuthorisationView,alignWithView:i._saveButton,offsetTop:1,showCallout:!0}))}})},save:function(t){var i="vfs:"===t?e.files.views.storageNodeSelector:e.views.fileSelector,s=i.get("controller"),n=new O.ButtonView({type:"v-Button--constructive v-Button--size16 u-dialog-buttonRight",isReadOnly:O.bind(s,"folder.isReadOnly"),inSearch:O.bind(s,"search",O.Transform.toBoolean),isDisabled:function(){return this.get("inSearch")||this.get("isReadOnly")}.property("inSearch","isReadOnly"),label:O.loc(3),target:this,method:"saveToFS"}),o=i.render().get("selectButton");i.replaceView(n,o).set("selectButton",n),o.destroy(),s.set("root","vfs:"===t?e.auth.get("fileStorageHomeDir"):t).set("allowedTypes",/^Folder$/).set("acceptMultiple",!1).get("selection").selectAll(!1),e.popOver.show({view:i,alignWithView:this._saveButton,offsetTop:1,showCallout:!0})},saveToFS:function(t){var i=t.get("parentView"),s=i.getFromPath("controller.path"),n=i.getFromPath("controller.root"),o=0===n.indexOf("vfs:");e.api.mail.callMethod("saveAttachments",{messageId:this.get("messageId"),attachmentIds:this.get("selection"),path:o?s.replace("/My Files",n):s}),e.notifications.show(O.loc(19)+"…"),e.popOver.hide()},remove:function(){e.api.mail.callMethod("deleteAttachments",{messageId:this.get("messageId"),attachmentIds:this.get("selection")}).callMethod("getMailboxQuota"),e.mail.get("mailboxMessageList").setObsolete();var t=e.mail.get("conversationMessageList");t instanceof e.ConversationMessageList&&t.setObsolete(),e.notifications.show(O.loc(154)+"…"),this.get("childViews").forEach(function(e){e.get("isSelected")&&e.set("isSelected",!1).get("attachment").set("isDeleted",!0)}),this.set("selectionLength",0)},draw:function(t,i,s){var n,o=this.get("messageId"),l=this.get("attachments"),c=this.get("attachedMessages")||{},d=this.get("isSuspicious"),h=0,g=l.reduce(function(e,t){return t.isInline&&(h+=1),t.isDeleted?e:e+1},0);return(n=l.map(function(e,t){var i=c[e.id];return new r({index:t,attachment:new a(o,e,!!i),data:i,isSuspicious:d})})).sort(function(e,t){var i=e.get("isImage");return i!==t.get("isImage")?i?-1:1:e.get("index")-t.get("index")}),n.forEach(function(e,t){e.index=t}),[new O.ToolbarView({className:O.bind(this,"selectionLength",function(e){return"v-Toolbar"+(e?" is-active":"")}),left:[new O.ButtonView({icon:"download icon-download",label:O.loc(1086),target:this,method:"download"}),this._saveButton=new O.MenuButtonView({icon:"saveFile icon-cloud-upload",label:O.loc(3),prefetch:function(){O.require("files"),O.require("filestorage")}.observes("isActive"),popOverView:e.popOver,menuView:new O.MenuView({showFilter:!1,closeOnActivate:!0,options:[new O.ButtonView({icon:"icon-cloud",label:O.loc(1096),target:this,method:"saveToService",root:"vfs"}),new O.ButtonView({icon:"icon-dropbox",label:O.loc(1097,"Dropbox"),target:this,method:"saveToService",root:"dropbox"})]})})],right:[new O.ButtonView({icon:"deleteForever icon-blocked",label:O.loc(1081),target:this,method:"remove"})]}),s("ul.v-MessageAttachments-images",n.filter(function(e){return e.get("isImage")})),s("ul.v-MessageAttachments-files",n.filter(function(e){return!e.get("isImage")})),h||g>1?s("div.v-MessageAttachments-downloadAll",[g>1?this._downloadAll=s("a",{className:"v-MessageAttachments-download",href:this.getZipUrl([]),text:O.loc(1085,g)}):null," ",h?this._showInline=s("a",{className:"v-MessageAttachments-download",href:"",text:O.loc(523,h)}):null]):null]},showInlineAttachments:function(e){var t=this._showInline;t&&O.Element.contains(t,e.target)&&(e.preventDefault(),this.get("childViews").forEach(function(e){e instanceof r&&e.set("showInline",!0)}),t.parentNode.removeChild(t),this._showInline=null),e.stopPropagation()}.on("click"),viewImages:function(t){var i=this.get("childViews").filter(function(e){var t=e.get("attachment");return t&&t.get("isImage")}),s=i.indexOf(t),n=i.map(function(t){var i=t.get("attachment"),s=t._icon;return new e.LightboxPhotoView({imgThumb:s,imgSrc:i.get("viewHref"),imgWidth:i.get("width")||8*s.width,imgHeight:i.get("height")||8*s.height})});l.open(n,s)},viewEmail:function(t){var i=new e.LightboxEmailView({message:t.get("data"),thumbPosition:t._icon.getBoundingClientRect()});c.get("isActive")?c.add(i,c.get("index")+1):c.open(i)}})}(FastMail),function(e,t){var i=O.Class({Extends:O.View,layerTag:"a",className:"u-subtleLink u-nowrap",allowTextSelection:!0,draw:function(e,t,i){var s=this.get("name").replace(/["\\]/g,""),n=this.get("email");return e.href="mailto:"+encodeURI(n),s?[i("strong.u-pageTextColour",[s])," <"+n+">"]:[n]},showContactCard:function(t){var i=new e.ContactCardView({name:this.get("name"),email:this.get("email")});e.popOver.show({view:i,onHide:function(){i.destroy()},alignWithView:this,showCallout:!0,offsetTop:5}),t.preventDefault(),t.stopPropagation()}.on("click")}),s=function(e,t,s,n){return e||(e=[]),e.push(new i({name:t.name||"",email:t.email||""})),s+1<n.length&&e.push(", "),e},n=function(e,t){var i=O.Element.create;return[i("dt",{className:"v-Message-detailsTitle"},[e+":"]),i("dd",{className:"v-Message-detailsValue"},[t||" "])]},o=O.Class({Extends:O.View,className:"v-Message",allowTextSelection:!0,showDetails:!0,blockExternalContent:function(t){if(void 0!==t)return t;if(!(t=this.get("hasBlockedContent")))return!1;var i,s,n,o=this.get("message"),a=e.preferences.get("allowExternalContent"),r=this.get("mailboxId")===e.systemFolderIds.get("spam");return!this.get("isTrusted")&&(!!r||"always"!==a&&("contacts"!==a||(i=o.from,!(s=(i&&i[0]&&i[0].email||"").toLowerCase())||(n=function(e){var t=e.value.toLowerCase();return"*"===t.charAt(0)?s.indexOf(t.slice(1))+t.length-1===s.length:t===s},!e.store.getQuery("contactsWithEmails",O.LiveQuery,{Type:e.Contact,filter:function(e){return!(!e.emails||!e.emails.length)},sort:["isFlagged","importance"],storeDidChangeRecords:function(e){var t=O.LiveQuery.prototype.storeDidChangeRecords.call(this,e);return t||this.computedPropertyDidChange("[]"),t}}).some(function(e){return e.get("emails").some(n)})))))}.property(),draw:function(t,i,o){var a,r,l=this.get("message"),c=l.from,d=l.to,h=l.cc,g=l.bcc,u=l.date,p=l.replyTo,m=l.listId,v=l.extraHeaders,f=l.size,b=l.body,w=l.attachments,y=l.attachedInvites,x=this.get("collapseQuotes"),S=this.get("isPhishing"),C=l.bodyIsHTML;return this.checkSize(),u instanceof Date||(u=new Date(u)),r=C?e.drawHTML(b,l.bodyStyles,{isForCompose:!1,rewriteIds:!0,rewriteInternalLinks:!0,blockExternalImages:!0,removeReferrer:!0,collapseQuotes:x,quoteComplexityMinCount:3}):e.drawPlainText(b,x),y&&function(e){for(var t in e)if("request"===e[t].type)return!0;return!1}(y)&&(r=[o("div.u-quote-topPostToggle",[o("a.u-quote-link",{href:"",title:O.loc(0,'"'),text:O.loc(73)})]),o("div.u-quote.u-quote--topPost",{"aria-hidden":"true"},[r,o("div")])]),a=[this._details=o("div.v-Message-details",{"aria-hidden":"true"},[o("dl.v-Message-detailsList",[n(O.loc(199),c?c.reduce(s,""):""),p?n("Reply-To",p.reduce(s,"")):null,n(O.loc(200),d?d.reduce(s,""):""),h&&h.length?n(O.loc(52),h.reduce(s,"")):null,g&&g.length?n(O.loc(427),g.reduce(s,"")):null,n(O.loc(119),l.subject),n(O.loc(428),O.i18n.date(u,"fullDateAndTime")),m?n("List-Id",m):null,v?v.map(n.apply.bind(n,null)):null,f?n(O.loc(1005),f):null])]),S?o("p.v-Message-edgeToEdge.v-Message-banner.v-Message-phishing",[o("b",[O.loc(746)]),o("br"),O.loc(731)," ",o("a",{target:"_blank",text:O.loc(6),href:e.auth.authenticateUrl("/help/account/phishing.html")}),"."]):null,y?Object.keys(y).map(function(t){return new e.InvitationView({messageId:l.id,attachmentId:t,invitation:y[t]})}):null,this.get("blockExternalContent")?this._showBlocked=o("p.v-Message-edgeToEdge.v-Message-banner.v-Message-remote",[O.loc(1159)+" ",o("a",{text:O.loc(1100),title:O.loc(0,O.formatKeyForPlatform("shift-l")),href:""}),"."]):null,this._body=o("div",{className:"v-Message-body"+(C?" v-Message-body--html":"")},[r]),this._attachmentsView=w&&w.length?new e.MessageAttachmentsView({messageId:l.id,attachments:w,attachedMessages:l.attachedMessages,isSuspicious:S}):null],this.get("showDetails")&&this.redrawShowDetails(),this.showRemoteImages(),a},setListener:function(){var e=this.get("layer");this.get("isInDocument")?e.addEventListener("load",this,!0):e.removeEventListener("load",this,!0)}.observes("isInDocument"),checkSize:function(){if(this.get("isInDocument")){var e,t,i,s,n=this._body,o=n.style,a=Math.max(2048,screen.width);o.height&&(o.height=""),o.width&&(o.width="",o.paddingRight=""),e=n.offsetWidth,t=n.offsetHeight,i=n.scrollWidth,s=n.scrollHeight,e<i&&(o.width=Math.min(i,a)+"px",o.paddingRight="15px"),t<s&&(o.height=s+"px")}}.queue("after").on("load"),messageNeedsRedraw:function(){this.propertyNeedsRedraw(this,"showDetails")}.observes("showDetails"),redrawShowDetails:function(){var e=this.get("showDetails"),t=this._details;e?(t.setAttribute("aria-hidden","false"),t.style.height=this.get("isInDocument")?t.firstChild.offsetHeight+"px":"auto"):(t.setAttribute("aria-hidden","true"),t.style.height="0")},redrawAttachments:function(){var t,i,s=this._attachmentsView;!this.isDestroyed&&s&&(t=this.get("message"),i=new e.MessageAttachmentsView({messageId:t.messageId,attachments:t.attachments,attachedMessages:t.attachedMessages}),this.replaceView(i,s),this._attachmentsView=i)},_onClick:function(t){if(!O.DOMEvent.isClickModified(t)){for(var i,s,n=t.target;n&&"A"!==n.nodeName;)n=n.parentNode;if(n)if(t.preventDefault(),t.stopPropagation(),i=n.getAttribute("href")||"",O.Element.hasClass(n,"u-quote-link"))this.toggleQuote(n);else if(this._showBlocked&&O.Element.contains(this._showBlocked,n))this.set("blockExternalContent",!1);else if("#"===i.charAt(0))this.scrollToAnchor(this._body,i.slice(1));else if(/^mailto/i.test(i))(s=this.getParent(e.LightboxItemView))&&s.lightbox.close(),e.views.mainWindow.interceptLinks(t);else if(0===i.indexOf("/verify/"))O.require("verify",function(){e.verify.show()});else if(i&&(!e.isApp||!O.UA.isIOS||!/^tel:/i.test(i))){if(this.get("isPhishing")&&!/^\/help\//.test(i)&&!confirm(O.loc(606)))return;e.isApp?location.href=i:O.WindowController.openExternal(i)}}}.on("click"),showRemoteImages:function(){if(this.get("hasBlockedContent")&&!this.get("blockExternalContent")){this._showBlocked&&O.Element.addClass(this._showBlocked,"u-hidden");var e=this._body.querySelector(".u-article");setTimeout(function(e){var t,i,s,n,o,a,r,l,c,d=/url\((\s*['"]?)[^)#]+#defang=([^)]*)/gi,h=function(e,t,i){return"url("+t+decodeURIComponent(i)},g=e.getElementsByTagName("*"),u=g.length,p=O.UA.isIOS,m={background:!0,src:!0,alt:p,title:p};for(t=0;t<u;t+=1)if("STYLE"===(i=g[t]).nodeName)n=i.textContent,d.test(n)&&(i.textContent=n.replace(d,h));else{for(o in m)m[o]&&(l="defang_"+(r=o),(c=(a=i).getAttribute(l))&&(a.removeAttribute(l),a.setAttribute(r,c)));(s=i.getAttribute("style"))&&d.test(s)&&i.setAttribute("style",s.replace(d,h))}}.bind(null,e),0)}}.observes("blockExternalContent"),toggleQuote:function(e){var t=O.Element,i=e.parentNode,s=t.hasClass(i,"u-quote-toggle")?i.previousSibling:i.nextSibling;t.hasClass(s,"is-expanded")?(t.removeClass(s,"is-expanded"),s.set("style",null),e.textContent=O.loc(73),s.setAttribute("aria-hidden","true")):(t.addClass(s,"is-expanded"),s.set("style","height:"+s.lastChild.offsetTop+"px"),e.textContent=O.loc(1089),s.removeAttribute("aria-hidden")),O.RunLoop.invokeAfterDelay(this.checkSize,400,this)},scrollToAnchor:function(e,t){var i,s,n,o;try{o=e.querySelector(".u-article").id,i=e.querySelector("#"+o+"-"+t+',[name="'+t+'"]')}catch(e){}i&&(s=this.getParent(O.ScrollView),n=O.Element.getPosition(i,s.get("layer")),s.scrollTo(0,n.top,!0))},defangForms:function(e){e.preventDefault()}.on("submit")});e.MessageView=o}(FastMail),function(e){e.mail.redirectOverlayView=new O.View({className:"v-RedirectOverlay",layout:{width:400},isSending:!1,isValid:!0,resetValidity:function(){this.get("isValid")||this.set("isValid",!0)._emailTextView.set("isValid",!0).focus()}.on("input"),title:function(){return this.get("isSending")?O.loc(421)+"…":this.get("isValid")?O.loc(1258):O.loc(191)}.property("isSending","isValid"),draw:function(t,i,s){var n;return[s("h3.u-bold",{text:O.bind(this,"title")}),s("div",{style:"position:relative"},[n=this._emailTextView=new e.EmailTextView({didEnterDocument:function(){return e.EmailTextView.prototype.didEnterDocument.call(this),this.set("selection",{start:0,end:this.get("value").length}).focus(),this},isDisabled:O.bind(this,"isSending"),value:O.bindTwoWay(this,"to")}),new e.AutoCompleteView({sources:[e.EmailAutoCompleteSource,e.ContactGroupAutoCompleteSource],inputView:n})]),s("p.u-alignRight",[new O.ButtonView({type:"v-Button--destructive v-Button--size13",isDisabled:O.bind(this,"isSending"),label:O.loc(1),target:e.popOver,method:"hide"}),new O.ButtonView({isWaiting:O.bind(this,"isSending"),type:"v-Button--constructive v-Button--size13",label:O.loc(110),target:this,method:"send"})])]},messageIdList:[],to:"",target:null,sendOnEnter:function(e){e.stopPropagation(),"enter"===O.DOMEvent.lookupKey(e,!0)&&(e.preventDefault(),this.send())}.on("keydown"),send:function(){if(!this.get("isSending")){var t=this.get("to").trim();","===t.slice(-1)&&(t=t.slice(0,-1)),t?(e.api.mail.callMethod("redirectMessages",{messageIdList:this.get("messageIdList"),applyToConversation:"no",to:t},function(t){this.set("isSending",!1);var i=t[0][0],s=t[0][1];"messagesRedirected"===i?this.sourceDidSend():"invalidArguments"===s.type?this.sourceDidReject():this.get("isInDocument")&&e.popOver.hide()}.bind(this)),this.set("isSending",!0)):this.sourceDidReject()}},sourceDidSend:function(){this.get("isInDocument")&&e.popOver.hide(),e.notifications.show(O.loc(416),5e3)},sourceDidReject:function(){this.set("isValid",!1),this._emailTextView.set("isValid",!1)}})}(FastMail),function(e){e.mail.shareOverlayView=new O.View({className:"v-ShareOverlay",layout:{width:400},title:O.loc(1002),sharePlainText:!0,shareInlineImages:!1,shareLinks:!1,osbridge:null,messageDetails:null,safeHTMLBodyNode:null,alignedView:null,canShare:function(){return this.get("sharePlainText")||this.get("shareInlineImages")||this.get("shareLinks")}.property("sharePlainText","shareInlineImages","shareLinks"),isPlainTextOnly:function(){return!this.get("messageDetails").get("bodyIsHTML")}.property("messageDetails"),resetSharingOptions:function(){this.get("isPlainTextOnly")&&(this.set("sharePlainText",!0),this.set("shareInlineImages",!1),this.set("shareLinks",!1))}.observes("isPlainTextOnly"),draw:function(t,i,s){return[s("h3.u-bold",{text:O.bind(this,"title")}),s("div",{style:"position:relative"},[s("p",[new O.CheckboxView({value:O.bindTwoWay(this,"sharePlainText"),label:" "+O.loc(996)})]),s("p",[new O.CheckboxView({value:O.bindTwoWay(this,"shareInlineImages"),label:" "+O.loc(1e3),isDisabled:O.bind(this,"isPlainTextOnly")})]),s("p",[new O.CheckboxView({value:O.bindTwoWay(this,"shareLinks"),label:" "+O.loc(1001),isDisabled:O.bind(this,"isPlainTextOnly")})])]),s("p.u-alignRight",[new O.ButtonView({type:"v-Button--destructive v-Button--size13",label:O.loc(1),target:e.popOver,method:"hide"}),new O.ButtonView({isDisabled:O.bind(this,"canShare",O.Transform.invert),type:"v-Button--constructive v-Button--size13",label:O.loc(141)+"…",target:this,method:"share"})])]},share:function(){this.get("osbridge").shareMessage(this.get("messageDetails"),this.get("safeHTMLBodyNode"),{sharePlainText:this.get("sharePlainText"),shareInlineImages:this.get("shareInlineImages"),shareLinks:this.get("shareLinks"),viewRect:this.get("alignedView").get("layer").getBoundingClientRect()}),this.get("isInDocument")&&e.popOver.hide()}})}(FastMail),function(e){var t=O.Status.READY,i=O.Class({Extends:O.View,isExpanded:!0,isLast:!1,details:function(){var t=this.get("content");return e.store.getRecord(e.MessageDetails,t.get("id"))}.property("content"),draw:function(i,s,n){var o=this.get("content"),a=this.get("details"),r=e.mail.screens.compose,l=r&&r.getInstanceByMsgId(o.get("id"));l?l.get("isVisible")||this.insertView(l.get("view")):"Templates"!==o.get("mailbox").get("name")?a.is(t)?O.require("compose",function(){if(!this.isDestroyed){var i=a.get("personalityId"),s=e.Personality,n=e.store,r=new e.ComposeController({messageId:o.get("messageId"),conversationId:o.get("conversationId"),personality:i&&t&n.getRecordStatus(s,i)?n.getRecord(s,i):e.userPrefs.get("defaultPersonality"),from:o.get("fullFrom"),to:o.get("fullTo"),cc:a.get("fullCc")||"",bcc:a.get("fullBcc")||"",subject:o.get("subject"),bodyIsHTML:a.get("bodyIsHTML"),body:a.get("body"),attachments:O.clone(a.get("attachments")),referenceTo:a.get("referenceTo"),mode:a.get("mode"),isFlagged:o.get("isFlagged"),isHighPriority:a.get("isHighPriority"),isReadReceiptRequested:a.get("isReadReceiptRequested")});this.insertView(r.get("view"))}}.bind(this)):(this._waitingForDetails=!0,a.addObserverForKey("status",this,"detailsDidLoad"),i.appendChild(n("div.v-LoadingCard.app-contentCard",[O.loc(13)+"…"]))):e.mail.set("composeDetails",{referenceTo:o.get("id"),mode:"asNew"}).set("screen","compose")},detailsDidLoad:function(e,i){e.is(t)&&(this._waitingForDetails=!1,e.removeObserverForKey(i,this,"detailsDidLoad"),this.propertyNeedsRedraw(this,"layer"))},destroy:function(){this._waitingForDetails&&this.get("details").removeObserverForKey("status",this,"detailsDidLoad"),i.parent.destroy.call(this)}});e.DraftCardView=i}(FastMail),function(e,t){e.isApp&&O.loader.prefetch("osbridge");var i=function(e){return e.reduce(function(e,t,i){return i&&e.push(", "),e.push(O.Element.create("span",{text:t.name||t.email.split("@")[0],title:t.email})),e},[])},s=function(t){return t||(t=e.theme.getImageSrc("avatar.png")),"background-image: url("+t+")"},n=function(e){return e?O.loc(1088):O.loc(1099)},o=function(e){return e?O.loc(74):O.loc(32)},a=function(e){return e?O.loc(373):O.loc(374)},r=function(e){return"v-MessageCard-pinButton "+(e?"is-pinned":"is-unpinned")},l=function(e){return"v-Button--iconOnly v-MessageCard-readButton "+(e?"is-unread":"is-read")},c=O.Status.READY,d=O.Class({Extends:O.View,Mixin:e.RedrawOnMinute,allowTextSelection:!0,_observingDetails:!1,isFlagged:O.bind("content.isFlagged"),isUnread:O.bind("content.isUnread"),status:O.bind("content.status"),showDetails:!1,isExpanded:!1,isFirst:!1,isLast:!1,className:function(){return"v-MessageCard app-contentCard "+(this.get("isExpanded")?"is-expanded":"is-collapsed")+(this.get("isLast")?" is-last":"")}.property("isExpanded","isLast"),init:function(t){if(d.parent.init.call(this,t),this._hasDrawnBody=!1,this._ignoreClick=0,this._downX=0,this._downY=0,e.mail.get("search")){var i=this.get("content"),s=i.get("id"),n=i.get("conversationId"),o=e.mail.get("mailboxMessageList").getMatches(n);(!o||o.indexOf(s)>-1)&&this.set("isExpanded",!0)}else{var a=e.systemFolderIds.get("drafts"),r=e.systemFolderIds.get("sent"),l=e.mail.get("mailboxId");l===a||(l===r&&t.content.get("mailboxId")===r?this.set("isExpanded",!0):this.checkIfExpanded())}},destroy:function(){this._observingDetails&&(this._observingDetails=!1,this.get("details").removeObserverForKey("status",this,"messageDidLoad")),d.parent.destroy.call(this)},details:function(){var t=e.store.getRecord(e.MessageDetails,this.get("content").get("id"));return t.is(c)||(t.addObserverForKey("status",this,"messageDidLoad"),this._observingDetails=!0),t}.property("content"),messageDidLoad:function(e){e.is(c)&&(this._observingDetails=!1,e.removeObserverForKey("status",this,"messageDidLoad"),this.get("isRendered")&&(this.propertyNeedsRedraw(this,"details"),this._triggerScroll()))},refreshMessage:function(e,t){e.get(t)&O.Status.OBSOLETE&&e.get("content").refresh()}.observes("status"),checkIfExpanded:function(){var e=this.get("isUnread")||this.get("isLast");e&&this.set("isExpanded",e)}.observes("isUnread","isLast"),expandedDidChange:function(){this.get("isExpanded")&&!this._hasDrawnBody&&(this.get("details"),this.propertyNeedsRedraw(this,"isExpanded"))}.observes("isExpanded"),showReplyAll:function(){var t=this.get("content"),i=this.get("details"),s=t.get("to"),n=i.get("cc"),o=i.get("listPost"),a=n&&n.length,r=s&&s.length&&(s.length>1||!e.personalities.some(function(e){return e.get("email")===s[0].email})&&s[0].email!==t.get("fromEmail"));return!!(a||r||o)}.property(),draw:function(t,d,h){var g=this.get("content"),u=g.get("id"),p=e.store,m=e.MessageDetails,v=p.getRecordStatus(m,u)&c?p.getRecord(m,u):null,f=g.get("fromEmail"),b=e.getContactFromEmail(f),w=g.get("trustedSender"),y=g.get("permissions"),x=!!v&&this.get("showReplyAll"),S=e.preferences.get("defaultReplyAll"),C=v?v.get("cc"):null,M=v?v.get("listPost"):"",I=g.getFromPath("mailbox.useConversations"),V=e.mail.threadViewController.getColour(f),D=g.get("mailbox"),A=this;return[this._header=h("div.v-MessageCard-header",[h("i",{className:"app-avatar u-bgcolour"+V,style:f?O.bind(f.replace(/\*/g,"").replace(/\./g,"⥷"),e.AvatarManager,s):s(null)}),h("div.v-MessageCard-fromAndPreview",[this._from=h("h2",{className:"v-MessageCard-from"+(I?" u-colour"+V:""),title:f},[g.get("fromName").replace(/[✅✓✔]/g,"")]),w||b?null:h("span",{className:"v-MessageCard-unknownSender u-unimportant",style:"margin-left:2px;"},[" <"+f+">"])," ",w?h("i",{className:"v-MessageCard-trustedBadge icon icon-checkmark-circle",title:O.loc(97,w)}):null,w?h("span",{className:"v-MessageCard-trustedFrom",title:O.loc(97,w),text:w+" "}):null,h("span.v-MessageCard-preview",{text:g.get("preview")})]),h("time.v-MessageCard-time",{title:g.get("fullDate")},[g.get("hasAttachment")?h("i.icon.icon-paperclip"):null,g.get("displayDate"),this._relativeDate=h("span",[" ("+g.get("relativeDate")+")"])]),new O.ButtonView({type:O.bind(this,"isFlagged",r),isDisabled:!y.mayUpdateFlags,positioning:"absolute",label:O.bind(this,"isFlagged",o),tooltip:O.loc(403)+"\n"+O.loc(0,O.formatKeyForPlatform("s")),target:this,method:"toggleFlagged"}),h("div.v-MessageCard-recipients",[h("span.v-MessageCard-to",[" "+O.loc(211)+" ",i(g.get("to")),this._cc=h("span",[C&&C.length?[", "+O.loc(52).toLowerCase()+" ",i(C)]:null])]),this._detailsToggle=h("span.v-MessageCard-toggleDetails",[h("a.u-subtleLink",{href:"",title:O.loc(0,":"),text:O.bind(this,"showDetails",n)})])]),h("span.v-MessageCard-actions",[h("span.v-MessageCard-folder",{text:D.get("displayName"),title:D.get("pathName")}),new O.ButtonView({type:O.bind(this,"isUnread",l),icon:"icon-unread",isDisabled:!y.mayUpdateSeen,label:O.bind(this,"isUnread",a),target:this,method:"toggleUnread"}),this._reply=new O.ButtonView({type:"s-small-reply v-Button--standard v-Button--size11",icon:S&&x?"icon-reply-all":"icon-reply",label:S&&M?O.loc(89):S&&x?O.loc(72):O.loc(109),tooltip:O.loc(0,O.formatKeyForPlatform(S&&x&&!M?"a":"r")),target:this,action:S&&M?"replyList":S&&x?"replyAll":"reply"})," ",this._more=new O.MenuButtonView({type:"s-message-actions v-MenuButton v-Button--standard v-Button--size11",label:O.loc(70),tooltip:O.loc(0,";"),popOverView:e.popOver,alignMenu:"right",menuView:function(){return A.get("moreMenuView")}.property(),prefetch:function(){O.loader.prefetch("settings+rules")}.observes("isActive")})])]),v&&this.get("isExpanded")?this._drawBody():this._loading=new O.LabelView({className:"v-MessageCard-loading",layerTag:"div",value:O.loc(13)+"…"}),v?this._drawToolbar():null]},_drawBody:function(){var t=this.get("details"),i=this.get("content"),s=!!i.get("trustedSender");return this._hasDrawnBody=!0,new e.MessageView({message:{id:i.get("id"),from:i.get("from"),to:i.get("to"),cc:t.get("cc"),bcc:t.get("bcc"),subject:i.get("subject"),date:i.get("date"),replyTo:i.get("replyTo"),listId:t.get("listId"),extraHeaders:t.get("extraHeaders"),size:i.get("formattedSize"),bodyIsHTML:t.get("bodyIsHTML"),bodyStyles:t.get("bodyStyles"),body:t.get("body"),attachments:t.get("attachments"),attachedInvites:t.get("attachedInvites"),attachedMessages:t.get("attachedMessages")},mailboxId:i.get("mailboxId"),showDetails:O.bind(this,"showDetails"),isTrusted:s,isPhishing:!s&&t.get("isSuspicious"),hasBlockedContent:t.get("hasBlockedContent"),collapseQuotes:!this.get("isFirst")})},_drawToolbar:function(){var t=this.get("details").get("listPost"),i=this.get("showReplyAll"),s=this;return new O.View({className:"v-Toolbar v-MessageCard-toolbar v-Message-edgeToEdge",draw:function(n,o,a){var r=e.preferences.get("defaultReplyAll"),l=r?t?"replyList":"replyAll":"reply",c=r?t?O.loc(89):O.loc(72):O.loc(109),d=r?t?"replySender":"reply":"replyAll",h=r?i?O.loc(377):O.loc(109):O.loc(72);return[a("div.v-Toolbar-section.v-Toolbar-section--left",[!r||i?new O.ButtonView({type:"s"+l.hyphenate(),icon:r?"icon-reply-all":"icon-reply",label:c,tooltip:O.loc(0,O.formatKeyForPlatform(r&&!t?"a":"r")),target:s,action:l}):null,!r||i?a("span.v-Toolbar-divider"):null,new O.ButtonView({type:"s-"+d.hyphenate(),icon:r?"icon-reply":"icon-reply-all",label:h,tooltip:O.loc(0,O.formatKeyForPlatform(r?t?"alt-r":"r":"a")),target:s,action:d}),a("span.v-Toolbar-divider"),new O.ButtonView({type:"s-forward",icon:"icon-forward",label:O.loc(367),tooltip:O.loc(0,O.formatKeyForPlatform("f")),target:s,action:"forward"})])]}})},redrawDetails:function(){var t=this.get("details"),s=t.get("cc");s&&s.length&&!this.get("content").get("isDraft")&&O.Element.appendChildren(this._cc,[", "+O.loc(52).toLowerCase()+" ",i(s)]),e.preferences.get("defaultReplyAll")&&(t.get("listPost")?this._reply.set("label",O.loc(89)).set("icon","icon-reply-all").set("action","replyList"):this.get("showReplyAll")&&this._reply.set("label",O.loc(72)).set("icon","icon-reply-all").set("action","replyAll").set("tooltip",O.loc(0,O.formatKeyForPlatform("a")))),this.get("isExpanded")&&this.redrawIsExpanded(),this.insertView(this._drawToolbar())},redrawIsExpanded:function(){this.get("details").is(c)&&!this._hasDrawnBody&&(this.replaceView(this._drawBody(),this._loading),this._loading.destroy(),this._loading=null)},attachmentsNeedsRedraw:function(){var t=this.get("childViews").find(function(t){return t instanceof e.MessageView});if(t){var i=this.get("details");O.extend(t.message,{messageId:i.get("messageId"),attachments:i.get("attachments"),attachedMessages:i.get("attachedMessages")}),t.propertyNeedsRedraw(t,"attachments")}}.observes("content.id"),nowNeedsRedraw:function(){this.propertyNeedsRedraw(this,"relativeDate")},redrawRelativeDate:function(){this._relativeDate.textContent=" ("+this.get("content").get("relativeDate")+")"},ignoreClickAfterSelect:function(e){if("mousedown"===e.type)this._downX=e.screenX,this._downY=e.screenY;else{var t=this._downX-e.screenX,i=this._downY-e.screenY;t*t+i*i>100&&(this._ignoreClick=Date.now()+1e3)}}.on("mousedown","mouseup"),click:function(t){if(!(t.button||t.altKey||t.ctrlKey||t.metaKey||Date.now()<this._ignoreClick)){var i,s,n=t.target,o=O.Element.contains,a=this._detailsToggle,r=this.get("isExpanded");t.targetView instanceof O.ButtonView||(a&&o(a,n)?this.toggleDetails():r&&o(this._from,n)?(i=this.get("content"),s=new e.ContactCardView({name:i.get("fromName")||"",email:i.get("fromEmail")||""}),e.popOver.show({view:s,onHide:function(){s.destroy()},alignWithView:this,atNode:this._from,showCallout:!0,offsetTop:5})):e.preferences.get("enableConversations")&&o(this._header,n)&&(t.shiftKey?e.mail.threadViewController.expandAll(!r):this.toggle("isExpanded")))}}.on("click"),_loadingDraft:!1,_notLoadingDraft:function(e,t){e.removeObserverForKey(t,this,"_notLoadingDraft"),this._loadingDraft=!1},_insertDraft:function(t){if(t.stopPropagation(),e.auth.get("isVerified")){if(!this._loadingDraft){var i,s=this.get("content").get("id"),n=t.type;"reply"===n&&e.preferences.get("defaultReplyAll")&&this.get("details").get("listPost")&&(n="replyList"),e.preferences.get("enableConversations")?(this._loadingDraft=!0,(i=new e.NewCardView(s,n)).addObserverForKey("controller",this,"_notLoadingDraft"),this.get("parentView").insertView(i)):e.mail.set("composeDetails",{referenceTo:s,mode:n}).set("screen","compose")}}else O.require("verify",function(){e.verify.show()})}.on("reply","replyAll","replyList","replySender","forward","forwardAttached"),toggleDetails:function(){this.toggle("showDetails")}.on("toggleDetails"),showMoreMenu:function(e){e.stopPropagation(),this.get("isExpanded")&&this._more.activate()}.on("showActions"),toggleQuotes:function(){var t,i,s,n=this.get("childViews").find(function(t){return t instanceof e.MessageView});if(n)for(i=0,s=(t=n.get("layer").querySelectorAll(".u-quote-link")).length;i<s;i+=1)n.toggleQuote(t[i])}.on("toggleQuotes"),editAsNew:function(){e.auth.get("isVerified")?e.mail.set("composeDetails",{referenceTo:this.get("content").get("id"),mode:"asNew"}).set("screen","compose"):O.require("verify",function(){e.verify.show()})},_delete:function(t){var i=this.get("content"),s=e.mail.get("conversationMessageList"),n="deletePermanently"===t.type,o=e.mail.actions;1===s.get("length")?(e.views.conversationContent.set("isSelected",!0),n?o.deletePermanently():o.deleteToTrash()):(n||e.api.mail.startTransaction(),s.deleteMessages([i.get("messageId")],n),n?e.notifications.show(O.loc(411,1),5e3):(e.api.mail.endTransaction(),e.notifications.show(new e.UndoableNotificationView({text:O.loc(412,1)})))),t.stopPropagation()}.on("delete","deletePermanently"),reportPhishing:function(){var t,i=this.get("content"),s=e.mail.get("conversationMessageList");1===s.get("length")?(e.views.conversationContent.set("isSelected",!0),e.mail.actions.reportPhishing()):(t=[i.get("messageId")],e.api.mail.startTransaction(),e.api.mail.callMethod("reportPhishing",{messageIdList:t,applyToConversation:"no"}),s.deleteMessages(t,!1),e.api.mail.endTransaction(),e.notifications.show(new e.UndoableNotificationView({text:O.loc(272)})))},showRedirectOverlay:function(){e.auth.get("isVerified")?e.popOver.show({view:e.mail.redirectOverlayView.set("messageIdList",[this.get("content").get("id")]),alignWithView:this._more,alignEdge:"right",offsetTop:2,showCallout:!0}):O.require("verify",function(){e.verify.show()})},print:function(){var e=O.Stylesheet.create("printMessageOnly","@media print {.v-MessageCard{display:none;}#"+this.get("id")+"{display:block;}}"),t=window;t.stop&&t.stop(),O.RunLoop.invokeInNextEventLoop(function(){t.print(),e.parentNode.removeChild(e)})},viewRaw:function(){e.auth.get("isVerified")?window.open(e.auth.authenticateUrl("/rawmessage/"+this.get("content").get("messageId"))):O.require("verify",function(){e.verify.show()})},toggleFlagged:function(){var t=!this.get("isFlagged"),i=this.get("content"),s=e.mail.get(i.get("mailbox").get("useConversations")?"conversationMessageList":"mailboxMessageList");i.get("permissions").mayUpdateFlags&&(s.setMessagesProperty([i.get("id")],"isFlagged",t),e.mail.get("mailboxMessageList").refresh(!0))}.on("toggleFlagged"),ruleFromMessage:function(){O.require("settings+rules",function(){if(!this.isDestroyed&&this.get("isInDocument")){var t=this.get("content"),i=this.get("details"),s=t.get("mailbox"),n=e.settings.rules;n.createRuleFromMessage({header:t,detail:i},s),n.messageAutoCompleteSources({header:t,details:i}),n.get("undoManager").dataDidChange(),e.popOver.show({view:e.views.ruleFromMessageView,alignWithView:this._more,alignEdge:"right",positionToThe:"bottom",offsetTop:2,showCallout:!0})}},this)},showShareOverlay:e.isApp?function(){O.require("osbridge",function(){if(!this.isDestroyed&&this.get("isInDocument")){var t=e.OSBridge;t.shareMessage&&e.popOver.show({view:e.mail.shareOverlayView.set("osbridge",t).set("messageDetails",this.get("details")).set("safeHTMLBodyNode",this.get("layer").querySelector("div.v-Message-body")).set("alignedView",this._more),alignWithView:this._more,alignEdge:"right",offsetTop:2,showCallout:!0})}},this)}:null,toggleUnread:function(){this.toggle("isUnread")},setupWatchForRead:function(){this.get("isInDocument")?this.startMonitoringScroll():this.stopMonitoringScroll()}.observes("isInDocument"),_scrollView:null,startMonitoringScroll:function(){if(!this._scrollView&&this.get("isUnread")&&this.get("content").get("permissions").mayUpdateSeen){var e=this.getParent(O.ScrollView);e&&(e.on("scroll",this,"checkPosition"),this._scrollView=e,this.checkPosition())}},stopMonitoringScroll:function(){var e=this._scrollView;e&&(e.off("scroll",this,"checkPosition"),this._scrollView=null)}.observes("isUnread"),checkPosition:function(){var t=this._scrollView;if(t&&this._hasDrawnBody&&this.get("isInDocument")&&this.get("isExpanded")){var i,s,n,o=t.get("scrollTop"),a=this._offsetHeight,r=this._offsetTop,l=t.get("pxHeight"),c=Date.now();(!r||this._offsetExpiry<c)&&(this._offsetHeight=a=this.get("layer").offsetHeight,this._offsetTop=r=this.getPositionRelativeTo(t).top),this._offsetExpiry=c+500,(n=!(s=o<r-l+(i=Math.min(a>>1,150)))&&o<r+a-i)&&(e.wc.get("isFocussed")?this.set("isUnread",!1):e.wc.addObserverForKey("isFocussed",this,"_markRead")),(s||n)&&e.views.unreadBelowFold.add(n?null:this)}}.queue("after"),_markRead:function(e,t){e.removeObserverForKey(t,this,"_markRead"),this.set("isUnread",!1)},_triggerScroll:function(){this.fire("scroll")}.queue("after").observes("isExpanded"),syncUnreadStatus:function(){var t,i,s,n,o=this.get("isUnread"),a=this.get("content"),r=e.mail.get("mailboxMessageList");o!==a.get("isUnread")&&a.get("permissions").mayUpdateSeen&&(t=o?1:-1,(i=a.get("mailbox")).get("useConversations")?(s=a.get("conversation"))&&s.is(c)&&(n=s.get("unread"),s.set("unread",n+t),n===(o?0:1)&&(i=r.get("mailbox"))&&i.set("unread",Math.max(i.get("unread")+t,0))):i.set("unread",Math.max(i.get("unread")+t,0)),a.set("isUnread",o),r.setObsolete())}.observes("isUnread"),moreMenuView:function(){var t=this.get("content"),i=t.get("mailboxId"),s=this.get("details").get("listPost"),o=i===e.systemFolderIds.get("trash")||i===e.systemFolderIds.get("spam"),a=[s?new O.ButtonView({label:O.loc(377),tooltip:O.loc(0,O.formatKeyForPlatform("alt-r")),target:this,action:"replySender"}):null,s?new O.ButtonView({label:O.loc(89),target:this,action:"replyList"}):null,s?null:new O.ButtonView({label:O.loc(109),tooltip:O.loc(0,O.formatKeyForPlatform("r")),target:this,action:"reply"}),new O.ButtonView({label:O.loc(72),tooltip:O.loc(0,O.formatKeyForPlatform("a")),target:this,action:"replyAll"}),new O.ButtonView({label:O.loc(367),tooltip:O.loc(0,O.formatKeyForPlatform("f")),target:this,action:"forward"}),new O.ButtonView({label:O.loc(368),target:this,action:"forwardAttached"}),"pobox"!==e.auth.get("accountType")?new O.ButtonView({label:O.loc(518)+"…",target:this,method:"ruleFromMessage"}):null,new O.ButtonView({label:O.loc(1087),target:this,method:"editAsNew"}),new O.ButtonView({label:O.loc(1092)+"…",target:this,method:"showRedirectOverlay"}),O.UA.isAndroid?null:new O.ButtonView({label:O.loc(376),target:this,method:"print"}),e.isApp?null:new O.ButtonView({label:O.loc(1101),target:this,method:"viewRaw"}),new O.ButtonView({label:O.loc(514),target:this,method:"reportPhishing"}),t.get("mailbox").get("useConversations")?new O.ButtonView({isDisabled:!t.get("permissions").mayDelete,label:o?O.loc(108):O.loc(4),target:this,action:o?"deletePermanently":"delete"}):null,!e.isApp||O.UA.isAndroid?null:new O.ButtonView({label:O.loc(520)+"…",target:this,method:"showShareOverlay",_isDisabled:!0,isDisabled:function(){return O.require("osbridge",function(){e.OSBridge.shareMessage&&this.set("_isDisabled",!1)},this),this.get("_isDisabled")}.property("_isDisabled")}),new O.ButtonView({label:O.bind(this,"showDetails",n),target:this,method:"toggleDetails"})].filter(O.Transform.toBoolean);return new O.MenuView({showFilter:!1,options:a})}.property()});e.MessageCardView=d}(FastMail),function(e){var t=O.Status.READY,i=e.MessageHeader.buildFullHeader,s=O.Class({Extends:O.View,isExpanded:!0,isLast:!1,init:function(t,i){s.parent.init.call(this),O.require("compose",function(){e.mail.screens.compose.registerInstance(this)}.bind(this)),e.api.mail.callMethod("newMessage",{clientId:this.get("id"),referenceTo:t,applyToConversation:e.mail.get("mailboxMessageList").get("useConversations")?"yes":"no",mode:i,textOnly:!O.RichTextView.isSupported}),this.scrollToVisible()},destroy:function(){O.require("compose",function(){e.mail.screens.compose.deregisterInstance(this)}.bind(this)),s.parent.destroy.call(this)},sourceDidFetchNewMessage:function(s){var n=e.Personality,o=s.personalityId;delete s.clientId,s.personality=e.store.getRecordStatus(n,o)&t?e.store.getRecord(n,o):e.userPrefs.get("defaultPersonality"),["from","to","cc","bcc"].forEach(function(e){var t=s[e];s[e]=t instanceof Array?t.reduce(i,""):t||""}),s.conversationId||"string"!=typeof s.referenceTo||(s.conversationId=e.store.getRecord(e.MessageHeader,s.referenceTo).get("conversationId")),s.bodyIsHTML&&(DOMPurify.isSupported||(s.body=s.body.replace(/src="cid:/g,'defang_src="cid:')),s.body=e.drawHTML(s.body,s.bodyStyles,{isForCompose:!0,rewriteIds:!0,rewriteInternalLinks:!1,blockExternalImages:!1,removeReferrer:!1,collapseQuotes:!1}).innerHTML,DOMPurify.isSupported||(s.body=s.body.replace(/defang_src="cid:/g,'src="cid:')),s.bodyStyles=""),this.set("controller",new e.ComposeController(s,!!s.mode)),this.propertyNeedsRedraw(this,"layer")},referenceMessageNotFound:function(){var t=e.mail.get("conversationMessageList");t&&t.refresh&&t.refresh(!0),this._loading&&(this._loading.textContent=O.loc(1154))},controller:null,scrollToVisible:function(){if(this.get("isInDocument")){var e=this.getParent(O.ScrollView);e&&e.scrollToView(this,{x:-15,y:-e.get("pxHeight")/2},!0)}}.queue("after"),positioning:"static",draw:function(t,i,s){var n=this.get("controller");n?this.insertView(n.get("view")):t.appendChild(this.get("parentView")instanceof e.ThreadMessageView?this._loading=s("div.v-LoadingCard.app-contentCard",[O.loc(13)+"…"]):this._loading=s("div.fill-parent",[e.loading.createLoadingEl()]))},redrawLayer:function(e){e.removeChild(this._loading),this._loading=null;var t=O.Element;this.draw(e,t,t.create)}});e.NewCardView=s}(FastMail),function(e){var t=O.Status.READY,i=O.Class({Extends:O.View,isFocussed:!1,className:function(){return"v-ThreadMessage"+(this.get("isFocussed")?" is-focussed":"")}.property("isFocussed"),destroy:function(){var e=this.get("content");e&&this.get("isRendered")&&e.removeObserverForKey("status",this,"contentDidLoad"),i.parent.destroy.call(this)},draw:function(i,s,n){var o=this.get("content");if(o&&o.is(t)){var a=new(o.get("isDraft")?e.DraftCardView:e.MessageCardView)({content:o,isFirst:!this.get("index"),isLast:this.get("isLast")});this.insertView(a)}else o&&o.addObserverForKey("status",this,"contentDidLoad"),i.appendChild(n("div.v-LoadingCard.app-contentCard",[O.loc(13)+"…"]))},contentDidLoad:function(e,i){e.is(t)&&(e.removeObserverForKey(i,this,"contentDidLoad"),this.propertyNeedsRedraw(this,"layer"))},isLast:!1,setIsLast:function(){var e=this.getFromPath("parentView.childViews");this.set("isLast",!(!e||e.last()!==this))}.observes("parentView.childViews"),indexDidChange:function(){for(var e=this.get("childViews"),t=!this.get("index"),i=this.get("isLast"),s=e.length;s--;)e[s].set("isFirst",t&&!s).set("isLast",i),i=!1}.observes("index","isLast","childViews")});e.ThreadMessageView=i}(FastMail),function(e){var t=0,i={};e.store.on(e.Mailbox,function(){i={}});var s=function(e){var t,i,s,n=0;if((i=e.indexOf("@"))>-1)return e.slice(0,i);for(;(i=e.indexOf(" ",n))>-1;){if((t=e.slice(n,i))&&!/^(?:the|m[rs]s?)$/i.test(t))return(s=e.lastIndexOf(" ")+1)&&s<e.length?t+" "+e.charAt(s):t;n=i+1}return e},n=function(t,i){for(var n,o,a,r,l,c,d,h,g,u,p,m={},v=[],f=[],b=[],w=0,y=0,x=t.length,S=O.Element.create;x--;)o=(n=t[x]).name||"",a=n.email||"",(r=e.getContactFromEmail(a))&&(l=r.get("name")).toLowerCase().contains(o.toLowerCase())&&(o=l),o||(o=a),m[c=(o=o.replace(/[✅✓✔]/g,"").trim()).contains(" ")?o:o+a]||(m[c]=!0,(d=o.indexOf(","))>-1&&t.length>1&&-1===o.lastIndexOf(" ",d)&&(o=o.slice(d+1).trim()+" "+o.slice(0,d).trim()),y+=o.length,v.push(o),f.push(a));if(y+=2*((w=v.length)-1),w>1){if(y>i)for(y=2*(w-1),x=v.length;x--;)o=s(v[x]),v[x]=o,y+=o.length;if(y>i){for(g=v.pop(),u=f.pop(),h=[],y+=2,w-=1;w&&y>i;)o=v.pop(),a=f.pop(),y-=o.length,h.push(a.contains(o)?a:o+" <"+a+">"),y-=2,w-=1;v.push("…",g),f.push(h.join(", "),u),w+=2}}for(v.reverse(),f.reverse(),p=0;p<w;p+=1)o=v[p],a=f[p],b.push(S("span",{text:o,title:a})),p+1<w&&b.push("…"===o?" ":", ");return b},o=O.loc(74),a=O.loc(32),r=function(e){return e?o:a},l=/^(?:re|fwd):\s*/i,c="u-hidden",d=O.Status.READY,h=O.Class({Extends:O.ListItemView,Mixin:[O.AnimatableView,O.Draggable,O.DragDataSource],itemHeight:51,conversation:null,isAdded:!1,isRemoved:!1,isUnread:!1,isFlagged:!1,init:function(e){this._link=null,this._pin=null,this._input=null,this._checkbox=null,this._touchState=0,this._touchStartX=0,this._touchStartY=0,this._touchScrollView=null,h.parent.init.call(this,e);var t=e.content;t&&(t.addObserverForKey("*",this,"headerDidChange"),this.headerDidChange()),e.isAdded&&this.resetAnimationState()},destroy:function(){var e=this.get("content"),t=this.get("conversation");e&&e.removeObserverForKey("*",this,"headerDidChange"),t&&t.removeObserverForKey("*",this,"convDidChange"),h.parent.destroy.call(this)},detach:function(e){e&&this.get("isInDocument")?this.set("isRemoved",!0):(h.parent.detach.call(this),this.destroy())},didAnimate:function(){if(this.increment("animating",-1),this.get("isRemoved"))this.detach(!1);else{var t=this._touchState,i=12&t;i&&16&t&&e.views.mailboxSwipeActions.trigger(this,i),this._touchState=-17&t}},didLeaveDocument:function(){return this.removeView(e.views.mailboxSwipeActions),h.parent.didLeaveDocument.call(this),this.get("isRemoved")&&!this.get("parentView").get("isInDocument")&&this.detach(!1),this},resetAnimationState:function(){this.set("isAdded",!1).set("animateLayer",!0)}.queue("after"),listDidChange:function(){this.set("animateLayer",!1),this.propertyNeedsRedraw(this,"content"),this.resetAnimationState()}.observes("list"),headerDidChange:function(){var e,t,i=this.get("content");if(i.is(d)){if(e=i.get("isDraft"),t=i.get("isFlagged"),i.get("mailbox").get("useConversations")){if(!this.get("conversation")){var s=i.get("conversation");s.addObserverForKey("*",this,"convDidChange"),this.set("conversation",s).convDidChange()}e&&this.set("isFlagged",t)}else this.set("isUnread",!e&&i.get("isUnread")).set("isFlagged",t);this.propertyNeedsRedraw(this,"content")}},convDidChange:function(){var e=this.get("conversation");if(e&&e.is(O.Status.OBSOLETE)&&e.refresh(),e&&e.is(d)){var t="trash"===this.getFromPath("content.mailbox.role"),i=e.get("unread"),s=e.get("unreadInTrash");this.set("isUnread",!!(t?s:i-s)),this.get("content").get("isDraft")||this.set("isFlagged",!!e.get("flagged")),this.propertyNeedsRedraw(this,"content")}},layout:(O.UA.cssProps.transform3d?function(e){if(!e){var t,i,s=this.get("index"),n=this.get("itemHeight"),o=this.get("isRemoved"),a=this.get("isAdded"),r=this._touchState,l=a||!!(8&r),c="";(l||!!(4&r))&&(i=(t=this.get("isInDocument")?this.get("layer").offsetWidth:0)?t+"px":"100%",l&&(i="-"+i),c="translate3d("+i+",0,0)"),e={top:s*n,left:0,transform:c,opacity:o?0:1}}return e}:function(){return{top:this.get("index")*this.get("itemHeight"),left:this.get("isAdded")?"-100%":"0",opacity:this.get("isRemoved")?0:1}}).property("index","itemHeight","isAdded","isRemoved"),className:function(){return"v-MailboxItem app-listItem"+(this.get("isSelected")?" is-selected":"")+(this.get("isUnread")?" is-unread":"")+(this.get("isFlagged")?" is-pinned":"")}.property("isSelected","isUnread","isFlagged"),draw:function(e,t,i){t.appendChildren(e,[this._link=i("a",[i("div",[i("span.v-MailboxItem-name"),i("span")]),i("div.v-MailboxItem-unread"),i("div"),i("div.v-MailboxItem-subject.u-ellipsis",[i("span"),i("span")]),i("div"),i("div.v-MailboxItem-time"),i("div.v-MailboxItem-size"),i("div.v-MailboxItem-preview.u-ellipsis"),i("div.v-MailboxItem-folders")]),this._checkbox=i("label.app-listItem-box",[this._input=i("input.app-listItem-boxInput",{type:"checkbox",checked:O.bind(this,"isSelected")})]),this._pin=i("button.app-listItem-pinButton",{title:O.loc(403),text:O.bind(this,"isFlagged",r)})]),this.redrawContent()},redrawContent:function(){var s,o=this.get("content"),a=o&&o.is(d),r=a&&o.get("mailbox"),h=r&&r.get("useConversations"),g=this.get("conversation"),u=this._link,p=u.firstChild,m=p.firstChild,v=p.lastChild,f=p.nextSibling,b=f.nextSibling,w=b.nextSibling,y=w.firstChild,x=y.nextSibling,S=w.nextSibling,C=S.nextSibling,M=C.nextSibling,I=M.nextSibling,V=I.nextSibling,D=this._pin,A=this._input;if(!a||h&&!g.is(d))u.className=c,A.disabled=!0,A.title="",D.disabled=!0;else{s=h?g.get("totalInTrash"):1,h&&"trash"!==r.get("role")&&(s=g.get("total")-s);var _,L,T=r.get("isForSentAndDraft"),F=r.get("role"),R="drafts"===F,E="spam"===F,P=this.get("list"),k=P.get("isSearch"),B=this.get("isUnread"),N=s>1&&!R,H=o.get("trustedSender"),U=N?!!g.get("attachments"):o.get("hasAttachment"),K=o.get("subject"),q=N?!!g.get("drafts"):o.get("isDraft"),G=o.get("isAnswered"),W=N?g.get("size"):o.get("size"),j="",Y=O.Element;for(k&&(_=P.getSnippet(o.get("id")),P.get("isGlobal")&&(j=N?function(s){var n,o,a,r,l,c,d=[],h=t+=1,g=O.Element.create;for(o=0,a=s.length;o<a;o+=1)(n=/^f(.*?)u/.exec(s[o]))&&(r=n[1],(l=i[r])||(c=e.store.getRecord(e.Mailbox,r),l=i[r]={seen:0,props:{text:c.get("displayName"),title:c.get("pathName")}}),l.seen!==h&&(l.seen=h,d.length&&d.push(", "),d.push(g("span",l.props))));return d}(P.getMatches(o.get("conversationId"))||[]):[Y.create("span",{text:r.get("displayName"),title:r.get("pathName")})])),s>1&&(K=K.replace(l,"")),u.className="app-listItem-link",u.href=e.base.getUrlForState({app:"mail",screen:"conversation",mailboxId:o.get("mailboxId"),search:e.mail.get("search"),searchIsGlobal:e.mail.get("searchIsGlobal"),conversationId:h?o.get("conversationId"):"",messageId:o.get("messageId")}),p.className="v-MailboxItem-from"+(s>1?" v-MailboxItem-from--withTotal":"");L=m.firstChild;)m.removeChild(L);if(O.Element.appendChildren(m,[H?O.Element.create("i",{className:"icon icon-checkmark-circle",title:O.loc(97,H)}):null,n(T?o.get("to"):N&&g.get("total")>1?g.get("senders"):o.get("safeFrom"),this.getFromPath("parentView.maxSenderChars")-(s>1?3:0))]),s>1?(v.className="v-MailboxItem-total",v.textContent="("+s+")"):v.className=c,f.textContent=B?O.loc(342):"",b.className=G?"s-answered v-MailboxItem-replied icon icon-reply":c,w.title=K,y.className=q?"v-MailboxItem-draft":E?"v-MailboxItem-score":c,y.textContent=q?O.loc(202):E?o.get("spamScore").toFixed(1):"",k&&_.subject?x.innerHTML=s>1?_.subject.replace(l,""):_.subject:x.textContent=K,S.className=U?"s-has-attachment v-MailboxItem-attachments icon icon-paperclip":c,C.title=o.get("fullDate")+" ("+o.get("relativeDate")+")",C.textContent=o.get("displayDate"),M.textContent=O.i18n.fileSize(W,1),k&&_.body?I.innerHTML=_.body:I.textContent=o.get("preview"),j){for(;L=V.firstChild;)V.removeChild(L);O.Element.appendChildren(V,j),V.style.display="block"}else V.style.display="none";A.disabled=!1,A.title=O.loc(85)+" ("+K+")",D.disabled=!o.get("permissions").mayUpdateFlags}},onClick:function(t){var i=this.get("content"),s=t.target,n=O.Element.contains;if(i&&!this._input.disabled)if(16&this._touchState)t.preventDefault();else{if(e.views.mainWindow.blurActive(),s!==this._pin)return e.preferences.get("showReadingPane")&&this.getFromPath("selection.length")||n(this._checkbox,s)?(t.preventDefault(),this.get("selection").selectIndex(this.get("index"),!this.get("isSelected"),t.shiftKey),void e.mail.get("selectedMessage").set("index",this.get("index"))):void(O.DOMEvent.isClickModified(t)||(t.preventDefault(),!i.get("isDraft")||e.preferences.get("enableConversations")&&"Templates"!==i.get("mailbox").get("name")?e.mail.beginPropertyChanges().set("messageId",i.get("id")).set("screen","conversation").endPropertyChanges():e.mail.set("composeDetails",{header:i}).set("screen","compose")));i.get("permissions").mayUpdateFlags&&this.get("list").setMessagesProperty([i.get("id")],"isFlagged",!this.get("isFlagged"))}}.on("click"),touchStart:function(e){var t=e.touches,i=t[0],s=this.get("content");i&&1===t.length&&s&&s.is(d)?(this._touchState=1,this._touchStartX=i.screenX,this._touchStartY=i.screenY,this.set("animateLayer",!1),this._touchScrollView=this.getParent(O.ScrollView).on("scroll",this,"touchCancel")):this._touchState=0}.on("touchstart"),touchMove:function(t){var i=this._touchState;if(0!==i){var s,n=t.touches[0],o=n.screenX-this._touchStartX,a=n.screenY-this._touchStartY,r=e.views.mailboxSwipeActions;if(1===i&&2===(i=this._touchState=Math.abs(o)>Math.abs(a)?2:0)&&this.insertView(r,null,"top"),2===i){if(s=this.get("itemHeight"),Math.abs(a)>s)return this.touchCancel(t);t.preventDefault(),this.set("layout",{top:this.get("index")*this.get("itemHeight"),left:0,transform:"translate3d("+o+"px,0,0)",opacity:1}),r.setState(o)}}}.on("touchmove"),touchEnd:function(t){var i=this._touchState;this.touchCancel(t),2===i&&(this._touchState=16|e.views.mailboxSwipeActions.get("state"))}.on("touchend"),touchCancel:function(){this._touchState=0,this._touchScrollView&&(this._touchScrollView.off("scroll",this,"touchCancel"),this._touchScrollView=null),this.computedPropertyDidChange("layout"),this.set("animateLayer",!0)}.on("touchcancel"),dragStarted:function(t){var i=this.get("content");if(i&&i.is(d)&&i.get("permissions").mayDelete){var s=e.mail.selection,o=i.get("mailbox"),a=o.get("useConversations"),r=o.get("isForSentAndDraft"),c=a&&i.get("conversation"),h=i.get("storeKey"),g=s.isStoreKeySelected(h)?s.get("length"):1,u=O.Element.create;t._draggedStoreKey=h,t.set("dragImage",u("div.u-dragItem",g>1?[u("h4.u-bold",[a?O.loc(439,g):O.loc(440,g)])]:[u("h4.u-bold",[n(r?i.get("to"):a&&c.get("total")>1?c.get("senders"):i.get("safeFrom"),23)]),u("p.u-dragItem-content.u-ellipsis",[!a||c.get("total")>1?i.get("subject").replace(l,""):i.get("subject")])]))}else t.endDrag()},dragDataTypes:["MessageStoreKeys"],getDragDataOfType:function(t,i){var s=i._draggedStoreKey,n=e.mail.selection;if(s&&"MessageStoreKeys"===t)return n.isStoreKeySelected(s)?n.get("selectedStoreKeys"):[s]}});e.MailboxItemView=h}(FastMail),function(e){var t=O.Class({Extends:O.View,Mixin:O.AnimatableView,isRefreshing:!1,willRefreshOnRelease:!1,className:"v-PullToRefresh",layout:{top:0},draw:function(i,s,n){var o=t.parent.draw.call(this,i,s,n);return[n("div",{"aria-hidden":"true",className:"v-PullToRefresh-header"},[s.unless(this,"isRefreshing").show([n("div",{className:O.bind(this,"willRefreshOnRelease",function(e){return"v-PullToRefresh-msg"+(e?" is-hidden":"")}),text:O.loc(510)}),n("div",{className:O.bind(this,"willRefreshOnRelease",function(e){return"v-PullToRefresh-msg"+(e?"":" is-hidden")}),text:O.loc(511)})]).otherwise([n("div",{className:"v-PullToRefresh-msg"},[e.loading.createLoadingEl()])]).end()]),o]},visibleRect:function(){return this.getFromPath("parentView.visibleRect")}.property("parentView.visibleRect"),monitor:function(e,t,i,s){var n=this.get("parentView");s?n.on("touchend",this,"touchEnded").on("touchmove",this,"touchMoved"):n.off("touchmove",this,"touchMoved").off("touchend",this,"touchEnded")}.observes("isInDocument"),touchMoved:function(){var e=this.getFromPath("parentView.scrollTop");!this.get("isRefreshing")&&e<0&&this.set("willRefreshOnRelease",e<-44)},touchEnded:function(){this.get("willRefreshOnRelease")&&(this.set("willRefreshOnRelease",!1),this.set("isRefreshing",!0),this.refresh(),this.animateLayer=!1,this.set("layout",{top:44}).redraw(),this.animateLayer=!0)},refresh:function(){this.set("isRefreshing",!0)},didFinishRefresh:function(){this.get("isRefreshing")||this.set("layout",{top:0})}.observes("isRefreshing")});e.PullToRefreshView=t}(FastMail),function(e){var t={name:"",icon:"",action:""},i={name:O.loc(365),icon:"icon-box",method:"archive"},s={name:O.loc(4),icon:"icon-blocked",method:"deleteToTrash"},n={name:O.loc(375),icon:"icon-move-inbox",method:"moveToInbox"},o={name:O.loc(378),icon:"icon-thumbs-up",method:"moveToInbox"},a={name:O.loc(379),icon:"icon-move-inbox",method:"restore"},r={name:O.loc(108),icon:"icon-blocked",method:"deletePermanently"},l={standard:[i,s],archive:[n,s],drafts:[t,t],sent:[t,s],spam:[o,r],trash:[a,r]},c=function(e){return"v-SwipeActions-icon icon "+e.icon},d=function(e){return e.name};e.views.mailboxSwipeActions=new O.View({className:function(){return"v-SwipeActions"+(this.get("state")?" is-active":"")}.property("state"),positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,state:0,actionLeft:O.bind(e.mail,"mailbox",function(e){return e&&e.get("permissions").mayDelete?(l[e.get("role")]||l.standard)[0]:l.drafts[0]}),actionRight:O.bind(e.mail,"mailbox",function(e){return e&&e.get("permissions").mayDelete?(l[e.get("role")]||l.standard)[1]:l.drafts[1]}),draw:function(e,t,i){return[i("div.v-SwipeActions-left",[i("i",{className:O.bind(this,"actionLeft",c)}),i("span.v-SwipeActions-label",{text:O.bind(this,"actionLeft",d)})]),i("div.v-SwipeActions-right",[i("i",{className:O.bind(this,"actionRight",c)}),i("span.v-SwipeActions-label",{text:O.bind(this,"actionRight",d)})])]},setState:function(e){var i=e>90&&this.get("actionLeft")!==t?4:e<-90&&this.get("actionRight")!==t?8:0;this.set("state",i)},trigger:function(t,i){var s=this.get(4===i?"actionLeft":"actionRight"),n=t.getFromPath("content.storeKey");s&&n&&e.mail.actions.setMessages([n])[s.method]()},cancelDelete:function(){var e=this.get("parentView");e&&(e._touchState=0,e.computedPropertyDidChange("layout"))}})}(FastMail),function(e,t){e.MailboxMessageList.prototype.optimiseFetching=!0;var i,s=O.bindTwoWay,n=O.Transform,o=n.toBoolean,a=n.invert,r=e.mail.selection,l=new O.ToolbarView({className:"app-viewBar",hasSelection:O.bind(r,"length",o),positioning:"absolute",inSearch:O.bind(e.mail,"search",o),isShort:O.bind(e.preferences,"showReadingPane"),config:function(){return this.get("isShort")?"short":this.get("hasSelection")?"selection":this.get("inSearch")?"search":"standard"}.property("isShort","hasSelection","inSearch")}).registerViews({selectAll:new e.SelectAllCheckboxView({id:"selectAll",positioning:"absolute",selectionController:r}),selection:new O.LabelView({className:"v-ViewBarMessage",layerTag:"div",value:O.bind(r,"length",function(t){return t?e.preferences.get("enableConversations")?O.loc(400,t):O.loc(431,t):""})}),search:new O.View({className:"v-ViewBarMessage",folderSelect:function(){var t=new O.SelectView({value:s(e.mail,"mailboxId"),options:function(){return e.allMailboxes.map(function(e){var t=e.get("depth");return{isDisabled:e.get("isDisabled"),text:" ".repeat(2*t)+e.get("displayName"),value:e.get("id")}})}.property(),foldersDidChange:function(){this.computedPropertyDidChange("options")}.queue("middle"),userDidSelectFolder:function(){e.mail.set("searchIsGlobal",!1)}.on("change")});return e.store.on(e.Mailbox,t,"foldersDidChange"),new O.View({layerTag:"span",childViews:[new O.RadioView({type:"v-ViewBarMessage-radio",label:O.loc(118),value:O.bindTwoWay(e.mail,"searchIsGlobal")}),new O.RadioView({type:"v-ViewBarMessage-radio",value:O.bindTwoWay(e.mail,"searchIsGlobal",a)}),t]}).render()}.property(),search:O.bind(e.mail,"search"),numResults:O.bind(e.mail,"mailboxMessageList.length"),draw:function(t,i,s,n){var o=this.get("numResults")||0,a=this.get("search"),r=e.preferences.get("enableConversations")?O.loc(1166,"[_1]","[_2]",o).replace(/\d[\d,.]*(?!\])/,"[_3]"):O.loc(1167,"[_1]","[_2]",o).replace(/\d[\d,.]*(?!\])/,"[_3]");return O.loc(r,/\b(?:in|folder):/.test(a)?s("b",[O.loc(118)]):n||this.get("folderSelect"),s("b",[a]),s("b",[O.i18n.number(o)]))},redrawLayer:function(){for(var e,t=O.Element,i=this.get("layer");e=i.lastChild;)i.removeChild(e);t.appendChildren(i,this.draw(this.get("layer"),t,t.create,this.get("folderSelect").get("layer")))}.queue("render").observes("search","numResults")}),filter:new e.PushSelectView({id:"FilterSelector",value:s(e.mail,"mailboxMessageList.filter"),options:[{text:O.loc(118),value:""},{text:O.loc(1178),value:"unread"},{text:O.loc(196),value:"personal"},{text:O.loc(1174),value:"notifications"},{text:O.loc(1173),value:"mailingList"}]}),pin:new e.PushSelectView({id:"v-PinSelect",value:s("mailboxMessageList.sortPinnedFirst",e.mail),options:[{text:" ",title:O.loc(197),className:"v-PinSelect-off",value:!1},{text:" ",title:O.loc(198),className:"v-PinSelect-on",value:!0}]}),sort:new O.SelectView({label:O.loc(121)+": ",value:s("mailboxMessageList.sortDirection",e.mail),role:O.bind(e.mail,"mailbox.inheritedRole"),_normalOptions:[{text:O.loc(435),value:"dateDescending"},{text:O.loc(434),value:"dateAscending"},{text:O.loc(1309),value:"fromAscending"},{text:O.loc(1311),value:"subjectAscending"},{text:O.loc(1310),value:"sizeDescending"}],render:function(){var e=this._normalOptions;return this._inSentOptions=e.slice(),this._inSentOptions[2]={text:O.loc(1308),value:"toAscending"},this._inTrashOptions=e.slice(),this._inTrashOptions.splice(2,0,{text:O.loc(1307),value:"uidDescending"}),this._inSpamOptions=e.slice(),this._inSpamOptions.splice(2,0,{text:O.loc(1008),value:"spamScoreAscending"}),this.redrawRole(),O.SelectView.prototype.render.call(this)},redrawRole:function(){var e=this.get("role"),t="sent"===e?this._inSentOptions:"trash"===e?this._inTrashOptions:"spam"===e?this._inSpamOptions:this._normalOptions;this.set("options",t)},roleNeedsRedraw:function(e,t,i){return this.propertyNeedsRedraw(e,t,i)}.observes("role")})}).registerConfigs({standard:{left:["selectAll","filter","pin"],right:["sort"]},short:{left:["selectAll","pin"]},search:{left:["selectAll","search"]},selection:{left:["selectAll","selection"]}}),c=new O.ProgressiveListView({className:function(){return"v-Mailbox "+(this.get("isShort")?"v-Mailbox--short":"v-Mailbox--long")+(this.get("isVLong")?" v-Mailbox--vlong":"")+(this.get("showSize")?" v-Mailbox--size":"")+(this.get("showPreview")?"":" v-Mailbox--noPreview")}.property("isShort","isVLong","showSize","showPreview"),showSize:O.bind(null,"content.sort",function(e){return/^size/.test(e)}),maxSenderChars:function(){var e=this.getFromPath("parentView.pxWidth"),t=this.get("isShort"),i=this.get("isVLong");return e?Math.round((t?e-145:i?200:.25*e)/7.4):23}.property("pxWidth","isShort","isVLong"),destroyItemView:function(){},showPreview:!0,isShort:!1,isVLong:O.bind(null,"pxWidth",function(e){return e?e>800:void 0}),content:O.bind(e.mail,"mailboxMessageList"),ItemView:e.MailboxItemView,itemHeight:51,selection:r,_scrollToTop:function(){i&&i.scrollTo(0,0)}.observes("content")}),d=new O.ListKBFocusView({itemHeight:O.bind(c,"itemHeight"),selection:e.mail.selection,singleSelection:e.mail.selectedMessage,recheckLayout:function(){this.computedPropertyDidChange("layout")}.observes("singleSelection.content.[]"),draw:function(e,t,i){e.title=O.loc(1117)},trigger:function(){var t=this.get("record");t&&t.is(O.Status.READY)&&e.mail.set("screen","conversation")},star:function(){var e=this.get("record");e&&e.is(O.Status.READY)&&e.get("permissions").mayUpdateFlags&&this.getFromPath("singleSelection.content").setMessagesProperty([e.get("id")],"isFlagged",e.get("mailbox").get("useConversations")?!e.get("conversation").get("flagged"):!e.get("isFlagged"))}}),h=new e.LoadingView,g=new O.LabelView({layerTag:"h1",className:"app-list-emptyMessage",positioning:"absolute",isSearch:O.bind(e.mail,"search",o),isEmpty:O.bind(e.mail,"mailbox.total",a),value:function(){return this.get("isSearch")?O.loc(194):this.get("isEmpty")?O.loc(117):O.loc(1153)+"."}.property("isSearch","isEmpty")});i=new O.ScrollView({className:"app-belowViewBar",layout:{},keys:{home:"scrollToTop",end:"scrollToBottom",pagedown:"scrollPage",pageup:"reverseScrollPage",space:"scrollPage","shift-space":"reverseScrollPage",down:"scrollLine",up:"reverseScrollLine"},childViews:[new e.PullToRefreshView({isRefreshing:O.bind(e.mail,"userTriggeredRefresh",function(e){return e&&void 0}),refresh:function(){e.mail.screens.mailbox.refresh()},childViews:[new O.SwitchView({index:O.bind(e.mail,"mailboxMessageList.length",function(e){return e?2:0===e?1:0}),views:[h,g,[c,d]]})]})],manageStatusBarEventHandler:O.UA.isIOS?function(){var e=O.ViewEventsController,t=this.get("statusBarEventHandler");t&&(this.get("isInDocument")?(e.addEventTarget(t,6),this.on("statusBarTap",this,"scrollToTop")):(this.off("statusBarTap",this,"scrollToTop"),e.removeEventTarget(t)))}.observes("isInDocument"):null,statusBarEventHandler:O.UA.isIOS?function(){return new O.StatusBarEventHandler({view:this})}.property():null});var u=new O.View({className:"v-StatusBar",positioning:"absolute",itemHeight:O.bind(c,"itemHeight"),scrollTop:O.bind(i,"scrollTop"),scrollHeight:O.bind(i,"pxHeight"),total:O.bind(e.mail,"mailboxMessageList.length"),first:function(){return Math.max(0,Math.floor(this.get("scrollTop")/this.get("itemHeight")))+1}.property("itemHeight","scrollTop"),last:function(){return Math.min(this.get("total"),Math.floor((this.get("scrollTop")+this.get("scrollHeight"))/this.get("itemHeight"))+1)}.property("itemHeight","scrollTop","scrollHeight","total"),draw:function(e,t,i){var s=this.get("first"),n=this.get("last"),o=this.get("total");e.textContent=O.loc(441,s+"–"+n,o)},redrawLayer:function(){this.draw(this.get("layer"))}.queue("render").observes("first","last","total")});e.views.mailbox=new O.View({className:"mailbox",positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,childViews:[l,i,O.Element.when(e.mail,"mailboxMessageList.length").show(u).end()],_selectLoadingShowing:!1,isLoadingSelection:O.bind(r,"isLoadingSelection"),drawIsLoadingSelection:function(){var e=this.get("isLoadingSelection");if(this._selectLoadingShowing!==e){var t=this._selectionLoadingEl,i=this.get("layer");e?(t||(t=this._selectionLoadingEl=O.Element.create("div.u-overlayMessage",[O.loc(1168)+"…"])),i.appendChild(t)):i.removeChild(t),this._selectLoadingShowing=e}}.queue("render").observes("isLoadingSelection")}),e.mail.screens.mailbox=new O.Object({initSingleton:function(){return this.updateItemHeight(),this},activate:function(){this.resumeBindings(),e.keyboardShortcuts.register("u",this,"refresh")},deactivate:function(){this.suspendBindings(),e.keyboardShortcuts.deregister("u",this,"refresh")},name:O.bind(e.mail,"mailbox.displayName"),role:O.bind(e.mail,"mailbox.role"),unread:O.bind(e.mail,"mailbox.unread"),totalMessages:O.bind(e.mail,"mailbox.totalMessages"),title:function(){var e=this.get("name")||"",t="drafts"===this.get("role")?this.get("totalMessages"):this.get("unread");return(t?"("+t+") ":"")+e}.property("name","role","unread","totalMessages"),selectedConversations:function(){return r.get("selectedStoreKeys")}.property().nocache(),refresh:function(){var t=e.mail.set("userTriggeredRefresh",!0).get("mailboxMessageList"),i=e.mail.get("mailbox");t&&t.refresh(!0,function(){e.mail.set("userTriggeredRefresh",!1)}.bind(this)),e.store.getAll(e.PopLink).forEach(function(e){e.get("isEnabled")&&e.get("fileIn")===i&&e.fetch()}),e.api.mail.refreshMailboxCounts()},itemHeight:51,inSearch:O.bind(e.mail,"search",o),showPreview:O.bind(e.preferences,"showPreview"),isShort:O.bind(c,"pxWidth",function(e){return e?e<=500:void 0}),updateItemHeight:function(){var e=this.get("showPreview"),t=this.get("isShort")?e?87:51:e?51:32;this.set("itemHeight",t)}.observes("showPreview","isShort"),itemHeightDidChange:function(t,i,s,n){var o,a;if(c.set("itemHeight",n).set("showPreview",this.get("showPreview")).set("isShort",!!this.get("isShort")),e.MailboxItemView.prototype.itemHeight=n,c.get("isRendered"))for(a=(o=c.get("childViews")).length;a--;)o[a].propertyDidChange("itemHeight",s,n)}.observes("itemHeight"),listView:c,scrollView:i}).initSingleton(),e.store.fetchAll(e.PopLink),!1!==e.preferences.get("showDeleteWarning")&&O.require("deletewarning"),O.loader.prefetch("compose")}(FastMail),function(e){var t=O.Status.READY,i=O.Status.OBSOLETE,s=e.mail.screens.mailbox.listView;e.ConversationPreloader=new O.Object({_isDirty:!0,_isScheduled:!1,_monitored:!1,_monitoring:{},_waitUntil:Date.now(),scrollTop:O.bind(e.mail.screens.mailbox.scrollView,"scrollTop"),list:O.bind(e.mail,"mailboxMessageList"),_change:function(e,t,i,s){var n=Date.now(),o="scrollTop"===t&&s?1e3:50;this._waitUntil=n+o,this._isDirty=!0,this.schedule(o)}.observes("scrollTop","list.[]"),schedule:function(e){this._isScheduled||(this._isScheduled=!0,O.RunLoop.invokeAfterDelay(this.update,e,this))},scheduleAfterIO:function(){e.api.mail.get("inFlightRequest")||this.schedule(50)}.queue("middle"),queryStatusDidChange:function(e,t,s,n){!(s&i)&&n&i&&(this._monitoring[e.get("id")].dirty=!0,this.schedule(50))},update:function(){var t=Date.now();this._isScheduled=!1,this._waitUntil>t?this.schedule(this._waitUntil+10-t):(this._isDirty&&this.calculate(),e.api.mail.get("inFlightRequest")||e.api.mail.hasRequests()||this.fetch())},calculate:function(){var n,o,a,r,l,c=s,d=this.get("list"),h=c.get("visibleRect"),g=c.get("itemHeight"),u=h.y,p=Math.max(0,~~(u/g)),m=Math.min(1+~~((u+h.height)/g),d&&d.get("length")||0),v=this._monitored,f=this._monitored=!v,b=this._monitoring,w=e.store;for(n=p;n<m;n+=1)(o=d.getObjectAt(n))&&o.is(t)&&(o.get("mailbox").get("useConversations")?(l=b[a=o.get("conversationId")])?l.gc=f:(r=w.getQuery(a),b[a]={isConv:!0,dirty:!r||r.is(i),query:r||null,gc:f},r&&r.addObserverForKey("status",this,"queryStatusDidChange")):(a=o.get("id"),w.getRecordStatus(e.MessageDetails,a)&O.Status.READY||(b[a]={isConv:!1,dirty:!0,gc:f})));for(a in b)(l=b[a]).gc===v&&((r=l.query)&&r.removeObserverForKey("status",this,"queryStatusDidChange"),delete b[a]);this._isDirty=!1},fetch:function(){var t,i,s,n=this._monitoring,o=0,a=e.store;for(t in n)if((i=n[t]).dirty&&(i.isConv?(s=i.query)?s.refresh():(s=i.query=a.getQuery(t,e.ConversationMessageList,{conversationId:t})).addObserverForKey("status",this,"queryStatusDidChange"):a.getRecord(e.MessageDetails,t),i.dirty=!1,(o+=1)>=10))break}}),e.api.mail.on("io:end",e.ConversationPreloader,"scheduleAfterIO")}(FastMail),function(e,t){var i=/^(?:re|fwd):\s*/i,s=function(t,i){var s=t.name,n=t.email,o=e.preferences.get("enableConversations")?"u-colour"+n.toLowerCase().hash().mod(7):void 0,a=s?s.indexOf(" "):n.indexOf("@");return s||(s=n),[i?", ":null,O.Element.create("span",{className:o},[a>-1?s.slice(0,a):s])]},n=O.Class({Extends:O.ListItemView,Mixin:[O.Draggable,O.DragDataSource],content:null,className:"v-SelectedConversation app-contentCard",positioning:"absolute",layout:function(){return{zIndex:this.get("index")}}.property("index"),setClass:function(){var t=this.constructor.prototype.className,i=e.mail.screens.mailboxconv;this.get("isInDocument")?(t+=" v-SelectedConversation--p",t+=i.takeIndex(this),this.get("index")&&(this.get("layer").className=t,this.get("pxHeight")),t+=" is-active"):i.releaseIndex(this),this.set("className",t)}.queue("after").observes("isInDocument"),draw:function(e,t,n){var o=this.get("content"),a=o.is(O.Status.READY)&&o.get("mailbox").get("useConversations")?o.get("conversation"):null,r=a&&a.get("total")>1?a.get("senders"):o.get("safeFrom"),l=a?a.get("total"):1,c=o.get("subject"),d=o.get("preview");return l>1&&(c=c.replace(i,"")),[n("h2.v-SelectedConversation-names.u-ellipsis",[r.map(s),l>1?" ("+l+")":null]),n("time.v-SelectedConversation-date",[o.get("displayDate")]),n("h3.v-SelectedConversation-subject",[c]),n("p.v-SelectedConversation-preview",[d+"…"])]},dragStarted:e.MailboxItemView.prototype.dragStarted,dragDataTypes:["MessageStoreKeys"],getDragDataOfType:e.MailboxItemView.prototype.getDragDataOfType});e.SelectedConversationView=n}(FastMail),function(e){var t=e.mail.screens,i=t.mailbox,s=t.conversation;e.mail.screens.mailboxconv=new O.Object({activate:function(){s.activate(),i.activate()},deactivate:function(){i.deactivate(),s.deactivate()},mailboxTitle:O.bind(i,"title"),conversationTitle:O.bind(s,"title"),screen:O.bind(e.mail,"screen"),title:function(){var e=this.get("mailboxTitle"),t=this.get("conversationTitle");return e+("conversation"===this.get("screen")?" – "+t:"")}.property("mailboxTitle","conversationTitle","screen"),selectedConversations:function(){var e=i.get("selectedConversations");return e.length?e:s.get("selectedConversations")}.property().nocache(),markUnread:function(){"mailbox"===e.mail.get("screen")?(e.mail.threadViewController.keepUnread(i.get("selectedConversations")),e.mail.actions.doAction("setMessagesProperty",null,"isUnread",!0,!0)):e.mail.screens.conversation.markUnread()},_indexes:[null,null,null],takeIndex:function(e){var t,i=this._indexes;for(t=0;t<3;t+=1)if(!i[t])return i[t]=e,t},releaseIndex:function(e){var t,i=this._indexes;for(t=0;t<3;t+=1)if(i[t]===e){i[t]=null;break}}});var n=new O.View({className:"v-SelectedConversations",childViews:[new O.LabelView({layerTag:"h1",className:"v-SelectedConversations-title",value:O.bind(e.mail.selection,"length",function(t){return t?e.preferences.get("enableConversations")?O.loc(400,t):O.loc(431,t):""})}),new O.ListView({content:new O.ObservableArray(null,{selectedStoreKeys:O.bind(e.mail.selection,"selectedStoreKeys"),selectionChanged:function(t,i,s,n){this.set("[]",n.slice(-3).map(function(t){return e.store.getRecord(e.MessageHeader,"#"+t)}))}.observes("selectedStoreKeys")}),ItemView:e.SelectedConversationView})]}),o=O.Element.when(e.mail,"selection.length").show(n).otherwise(e.views.conversationContent).end(),a=new O.SplitViewController({flex:O.SplitViewController.BOTTOM_RIGHT,staticPaneLength:O.bindTwoWay(e.localPrefs,"listPaneWidth"),minStaticPaneLength:250,maxStaticPaneLength:Math.max(500,e.views.mainWindow.get("pxWidth")-700)});e.views.mailboxconv=new O.View({id:"mailboxconv",positioning:"absolute",layout:O.View.LAYOUT_FILL_PARENT,childViews:[new O.View(e.AriaHiddenIfOffScreen,{className:"app-list",positioning:"absolute",layout:O.bind(a,"topLeftLayout"),willEnterDocument:function(){return this.insertView(e.views.mailbox),O.View.prototype.willEnterDocument.call(this)},didLeaveDocument:function(){return this.removeView(e.views.mailbox),O.View.prototype.didLeaveDocument.call(this)}}),new O.View(e.AriaHiddenIfOffScreen,{className:"app-content",positioning:"absolute",layout:O.bind(a,"bottomRightLayout"),willEnterDocument:function(){return this.insertView(o),O.View.prototype.willEnterDocument.call(this)},didLeaveDocument:function(){return O.View.prototype.didLeaveDocument.call(this),this.removeView(o)}}),new O.SplitDividerView({controller:a})]})}(FastMail);
